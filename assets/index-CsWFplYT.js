import{t as A,u as M,v as Re,w as Pe}from"./index-Divbg3oe.js";const B=()=>"9.1.0",Me=e=>e.toString(16).padStart(2,"0"),Le=e=>{const n=new Uint8Array(e/2);return window.crypto.getRandomValues(n),Array.from(n,Me).join("")},Be=()=>typeof window<"u"?Le(10):new Date().getTime().toString(36);class C{}C.makeRequest=(e,n)=>({id:Be(),method:e,params:n,env:{sdkVersion:B()}});C.makeResponse=(e,n,t)=>({id:e,success:!0,version:t,data:n});C.makeErrorResponse=(e,n,t)=>({id:e,success:!1,error:n,version:t});var l;(function(e){e.sendTransactions="sendTransactions",e.rpcCall="rpcCall",e.getChainInfo="getChainInfo",e.getSafeInfo="getSafeInfo",e.getTxBySafeTxHash="getTxBySafeTxHash",e.getSafeBalances="getSafeBalances",e.signMessage="signMessage",e.signTypedMessage="signTypedMessage",e.getEnvironmentInfo="getEnvironmentInfo",e.getOffChainSignature="getOffChainSignature",e.requestAddressBook="requestAddressBook",e.wallet_getPermissions="wallet_getPermissions",e.wallet_requestPermissions="wallet_requestPermissions"})(l||(l={}));var b;(function(e){e.requestAddressBook="requestAddressBook"})(b||(b={}));class He{constructor(n=null,t=!1){this.allowedOrigins=null,this.callbacks=new Map,this.debugMode=!1,this.isServer=typeof window>"u",this.isValidMessage=({origin:a,data:c,source:i})=>{const d=!c,f=!this.isServer&&i===window.parent,h=typeof c.version<"u"&&parseInt(c.version.split(".")[0]),y=typeof h=="number"&&h>=1;let E=!0;return Array.isArray(this.allowedOrigins)&&(E=this.allowedOrigins.find(v=>v.test(a))!==void 0),!d&&f&&y&&E},this.logIncomingMessage=a=>{console.info(`Safe Apps SDK v1: A message was received from origin ${a.origin}. `,a.data)},this.onParentMessage=a=>{this.isValidMessage(a)&&(this.debugMode&&this.logIncomingMessage(a),this.handleIncomingMessage(a.data))},this.handleIncomingMessage=a=>{const{id:c}=a,i=this.callbacks.get(c);i&&(i(a),this.callbacks.delete(c))},this.send=(a,c)=>{const i=C.makeRequest(a,c);if(this.isServer)throw new Error("Window doesn't exist");return window.parent.postMessage(i,"*"),new Promise((d,f)=>{this.callbacks.set(i.id,h=>{if(!h.success){f(new Error(h.error));return}d(h)})})},this.allowedOrigins=n,this.debugMode=t,this.isServer||window.addEventListener("message",this.onParentMessage)}}const R=e=>typeof e=="object"&&e!=null&&"domain"in e&&"types"in e&&"message"in e;var O={},_={},T={},P=A&&A.__awaiter||function(e,n,t,a){function c(i){return i instanceof t?i:new t(function(d){d(i)})}return new(t||(t=Promise))(function(i,d){function f(E){try{y(a.next(E))}catch(v){d(v)}}function h(E){try{y(a.throw(E))}catch(v){d(v)}}function y(E){E.done?i(E.value):c(E.value).then(f,h)}y((a=a.apply(e,n||[])).next())})};Object.defineProperty(T,"__esModule",{value:!0});T.getData=T.fetchData=T.stringifyQuery=T.insertParams=void 0;const Ue=e=>typeof e=="object"&&e!==null&&"code"in e&&"message"in e;function je(e,n,t){return e.replace(new RegExp(`\\{${n}\\}`,"g"),t)}function Ge(e,n){return n?Object.keys(n).reduce((t,a)=>je(t,a,String(n[a])),e):e}T.insertParams=Ge;function qe(e){if(!e)return"";const n=new URLSearchParams;Object.keys(e).forEach(a=>{e[a]!=null&&n.append(a,String(e[a]))});const t=n.toString();return t?`?${t}`:""}T.stringifyQuery=qe;function H(e){return P(this,void 0,void 0,function*(){let n;try{n=e.status===204?{}:yield e.json()}catch{if(e.headers&&e.headers.get("content-length")!=="0")throw new Error(`Invalid response content: ${e.statusText}`)}if(!e.ok){const t=Ue(n)?`${n.code}: ${n.message}`:e.statusText;throw new Error(t)}return n})}function ke(e,n,t,a){return P(this,void 0,void 0,function*(){const c=Object.assign({"Content-Type":"application/json"},a),i={method:n??"POST",headers:c};t!=null&&(i.body=typeof t=="string"?t:JSON.stringify(t));const d=yield fetch(e,i);return H(d)})}T.fetchData=ke;function Ve(e,n){return P(this,void 0,void 0,function*(){const t={method:"GET"};n&&(t.headers=Object.assign(Object.assign({},n),{"Content-Type":"application/json"}));const a=yield fetch(e,t);return H(a)})}T.getData=Ve;Object.defineProperty(_,"__esModule",{value:!0});_.getEndpoint=_.deleteEndpoint=_.putEndpoint=_.postEndpoint=void 0;const S=T;function D(e,n,t,a){const c=(0,S.insertParams)(n,t),i=(0,S.stringifyQuery)(a);return`${e}${c}${i}`}function Fe(e,n,t){const a=D(e,n,t?.path,t?.query);return(0,S.fetchData)(a,"POST",t?.body,t?.headers)}_.postEndpoint=Fe;function We(e,n,t){const a=D(e,n,t?.path,t?.query);return(0,S.fetchData)(a,"PUT",t?.body,t?.headers)}_.putEndpoint=We;function Ke(e,n,t){const a=D(e,n,t?.path,t?.query);return(0,S.fetchData)(a,"DELETE",t?.body,t?.headers)}_.deleteEndpoint=Ke;function Xe(e,n,t,a){if(a)return(0,S.getData)(a);const c=D(e,n,t?.path,t?.query);return(0,S.getData)(c,t?.headers)}_.getEndpoint=Xe;var p={};Object.defineProperty(p,"__esModule",{value:!0});p.DEFAULT_BASE_URL=void 0;p.DEFAULT_BASE_URL="https://safe-client.safe.global";var U={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ImplementationVersionState=void 0,function(n){n.UP_TO_DATE="UP_TO_DATE",n.OUTDATED="OUTDATED",n.UNKNOWN="UNKNOWN"}(e.ImplementationVersionState||(e.ImplementationVersionState={}))})(U);var j={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SafeAppSocialPlatforms=e.SafeAppFeatures=e.SafeAppAccessPolicyTypes=void 0,function(n){n.NoRestrictions="NO_RESTRICTIONS",n.DomainAllowlist="DOMAIN_ALLOWLIST"}(e.SafeAppAccessPolicyTypes||(e.SafeAppAccessPolicyTypes={})),function(n){n.BATCHED_TRANSACTIONS="BATCHED_TRANSACTIONS"}(e.SafeAppFeatures||(e.SafeAppFeatures={})),function(n){n.TWITTER="TWITTER",n.GITHUB="GITHUB",n.DISCORD="DISCORD"}(e.SafeAppSocialPlatforms||(e.SafeAppSocialPlatforms={}))})(j);var G={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.LabelValue=e.DetailedExecutionInfoType=e.TransactionListItemType=e.ConflictType=e.TransactionInfoType=e.SettingsInfoType=e.TransactionTokenType=e.TransferDirection=e.TransactionStatus=e.Operation=void 0,function(n){n[n.CALL=0]="CALL",n[n.DELEGATE=1]="DELEGATE"}(e.Operation||(e.Operation={})),function(n){n.AWAITING_CONFIRMATIONS="AWAITING_CONFIRMATIONS",n.AWAITING_EXECUTION="AWAITING_EXECUTION",n.CANCELLED="CANCELLED",n.FAILED="FAILED",n.SUCCESS="SUCCESS"}(e.TransactionStatus||(e.TransactionStatus={})),function(n){n.INCOMING="INCOMING",n.OUTGOING="OUTGOING",n.UNKNOWN="UNKNOWN"}(e.TransferDirection||(e.TransferDirection={})),function(n){n.ERC20="ERC20",n.ERC721="ERC721",n.NATIVE_COIN="NATIVE_COIN"}(e.TransactionTokenType||(e.TransactionTokenType={})),function(n){n.SET_FALLBACK_HANDLER="SET_FALLBACK_HANDLER",n.ADD_OWNER="ADD_OWNER",n.REMOVE_OWNER="REMOVE_OWNER",n.SWAP_OWNER="SWAP_OWNER",n.CHANGE_THRESHOLD="CHANGE_THRESHOLD",n.CHANGE_IMPLEMENTATION="CHANGE_IMPLEMENTATION",n.ENABLE_MODULE="ENABLE_MODULE",n.DISABLE_MODULE="DISABLE_MODULE",n.SET_GUARD="SET_GUARD",n.DELETE_GUARD="DELETE_GUARD"}(e.SettingsInfoType||(e.SettingsInfoType={})),function(n){n.TRANSFER="Transfer",n.SETTINGS_CHANGE="SettingsChange",n.CUSTOM="Custom",n.CREATION="Creation"}(e.TransactionInfoType||(e.TransactionInfoType={})),function(n){n.NONE="None",n.HAS_NEXT="HasNext",n.END="End"}(e.ConflictType||(e.ConflictType={})),function(n){n.TRANSACTION="TRANSACTION",n.LABEL="LABEL",n.CONFLICT_HEADER="CONFLICT_HEADER",n.DATE_LABEL="DATE_LABEL"}(e.TransactionListItemType||(e.TransactionListItemType={})),function(n){n.MULTISIG="MULTISIG",n.MODULE="MODULE"}(e.DetailedExecutionInfoType||(e.DetailedExecutionInfoType={})),function(n){n.Queued="Queued",n.Next="Next"}(e.LabelValue||(e.LabelValue={}))})(G);var q={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.FEATURES=e.GAS_PRICE_TYPE=e.RPC_AUTHENTICATION=void 0,function(n){n.API_KEY_PATH="API_KEY_PATH",n.NO_AUTHENTICATION="NO_AUTHENTICATION",n.UNKNOWN="UNKNOWN"}(e.RPC_AUTHENTICATION||(e.RPC_AUTHENTICATION={})),function(n){n.ORACLE="ORACLE",n.FIXED="FIXED",n.FIXED_1559="FIXED1559",n.UNKNOWN="UNKNOWN"}(e.GAS_PRICE_TYPE||(e.GAS_PRICE_TYPE={})),function(n){n.ERC721="ERC721",n.SAFE_APPS="SAFE_APPS",n.CONTRACT_INTERACTION="CONTRACT_INTERACTION",n.DOMAIN_LOOKUP="DOMAIN_LOOKUP",n.SPENDING_LIMIT="SPENDING_LIMIT",n.EIP1559="EIP1559",n.SAFE_TX_GAS_OPTIONAL="SAFE_TX_GAS_OPTIONAL",n.TX_SIMULATION="TX_SIMULATION",n.EIP1271="EIP1271"}(e.FEATURES||(e.FEATURES={}))})(q);var k={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.TokenType=void 0,function(n){n.ERC20="ERC20",n.ERC721="ERC721",n.NATIVE_TOKEN="NATIVE_TOKEN"}(e.TokenType||(e.TokenType={}))})(k);var V={};Object.defineProperty(V,"__esModule",{value:!0});var F={};Object.defineProperty(F,"__esModule",{value:!0});var W={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SafeMessageStatus=e.SafeMessageListItemType=void 0,function(n){n.DATE_LABEL="DATE_LABEL",n.MESSAGE="MESSAGE"}(e.SafeMessageListItemType||(e.SafeMessageListItemType={})),function(n){n.NEEDS_CONFIRMATION="NEEDS_CONFIRMATION",n.CONFIRMED="CONFIRMED"}(e.SafeMessageStatus||(e.SafeMessageStatus={}))})(W);var K={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.DeviceType=void 0,function(n){n.ANDROID="ANDROID",n.IOS="IOS",n.WEB="WEB"}(e.DeviceType||(e.DeviceType={}))})(K);var X={};Object.defineProperty(X,"__esModule",{value:!0});(function(e){var n=A&&A.__createBinding||(Object.create?function(s,r,o,u){u===void 0&&(u=o);var I=Object.getOwnPropertyDescriptor(r,o);(!I||("get"in I?!r.__esModule:I.writable||I.configurable))&&(I={enumerable:!0,get:function(){return r[o]}}),Object.defineProperty(s,u,I)}:function(s,r,o,u){u===void 0&&(u=o),s[u]=r[o]}),t=A&&A.__exportStar||function(s,r){for(var o in s)o!=="default"&&!Object.prototype.hasOwnProperty.call(r,o)&&n(r,s,o)};Object.defineProperty(e,"__esModule",{value:!0}),e.unsubscribeAll=e.unsubscribeSingle=e.registerRecoveryModule=e.deleteRegisteredEmail=e.getRegisteredEmail=e.verifyEmail=e.resendEmailVerificationCode=e.changeEmail=e.registerEmail=e.unregisterDevice=e.unregisterSafe=e.registerDevice=e.getDelegates=e.confirmSafeMessage=e.proposeSafeMessage=e.getSafeMessage=e.getSafeMessages=e.getDecodedData=e.getMasterCopies=e.getSafeApps=e.getChainConfig=e.getChainsConfig=e.proposeTransaction=e.getNonces=e.postSafeGasEstimation=e.deleteTransaction=e.getTransactionDetails=e.getTransactionQueue=e.getTransactionHistory=e.getCollectiblesPage=e.getCollectibles=e.getAllOwnedSafes=e.getOwnedSafes=e.getFiatCurrencies=e.getBalances=e.getMultisigTransactions=e.getModuleTransactions=e.getIncomingTransfers=e.getSafeInfo=e.getRelayCount=e.relayTransaction=e.setBaseUrl=void 0;const a=_,c=p;t(U,e),t(j,e),t(G,e),t(q,e),t(k,e),t(V,e),t(F,e),t(W,e),t(K,e),t(X,e);let i=c.DEFAULT_BASE_URL;const d=s=>{i=s};e.setBaseUrl=d;function f(s,r){return(0,a.postEndpoint)(i,"/v1/chains/{chainId}/relay",{path:{chainId:s},body:r})}e.relayTransaction=f;function h(s,r){return(0,a.getEndpoint)(i,"/v1/chains/{chainId}/relay/{address}",{path:{chainId:s,address:r}})}e.getRelayCount=h;function y(s,r){return(0,a.getEndpoint)(i,"/v1/chains/{chainId}/safes/{address}",{path:{chainId:s,address:r}})}e.getSafeInfo=y;function E(s,r,o,u){return(0,a.getEndpoint)(i,"/v1/chains/{chainId}/safes/{address}/incoming-transfers/",{path:{chainId:s,address:r},query:o},u)}e.getIncomingTransfers=E;function v(s,r,o,u){return(0,a.getEndpoint)(i,"/v1/chains/{chainId}/safes/{address}/module-transactions/",{path:{chainId:s,address:r},query:o},u)}e.getModuleTransactions=v;function Y(s,r,o,u){return(0,a.getEndpoint)(i,"/v1/chains/{chainId}/safes/{address}/multisig-transactions/",{path:{chainId:s,address:r},query:o},u)}e.getMultisigTransactions=Y;function J(s,r,o="usd",u={}){return(0,a.getEndpoint)(i,"/v1/chains/{chainId}/safes/{address}/balances/{currency}",{path:{chainId:s,address:r,currency:o},query:u})}e.getBalances=J;function z(){return(0,a.getEndpoint)(i,"/v1/balances/supported-fiat-codes")}e.getFiatCurrencies=z;function Z(s,r){return(0,a.getEndpoint)(i,"/v1/chains/{chainId}/owners/{address}/safes",{path:{chainId:s,address:r}})}e.getOwnedSafes=Z;function x(s){return(0,a.getEndpoint)(i,"/v1/owners/{address}/safes",{path:{address:s}})}e.getAllOwnedSafes=x;function ee(s,r,o={}){return(0,a.getEndpoint)(i,"/v1/chains/{chainId}/safes/{address}/collectibles",{path:{chainId:s,address:r},query:o})}e.getCollectibles=ee;function ne(s,r,o={},u){return(0,a.getEndpoint)(i,"/v2/chains/{chainId}/safes/{address}/collectibles",{path:{chainId:s,address:r},query:o},u)}e.getCollectiblesPage=ne;function te(s,r,o={},u){return(0,a.getEndpoint)(i,"/v1/chains/{chainId}/safes/{safe_address}/transactions/history",{path:{chainId:s,safe_address:r},query:o},u)}e.getTransactionHistory=te;function ae(s,r,o={},u){return(0,a.getEndpoint)(i,"/v1/chains/{chainId}/safes/{safe_address}/transactions/queued",{path:{chainId:s,safe_address:r},query:o},u)}e.getTransactionQueue=ae;function se(s,r){return(0,a.getEndpoint)(i,"/v1/chains/{chainId}/transactions/{transactionId}",{path:{chainId:s,transactionId:r}})}e.getTransactionDetails=se;function ie(s,r,o){return(0,a.deleteEndpoint)(i,"/v1/chains/{chainId}/transactions/{safeTxHash}",{path:{chainId:s,safeTxHash:r},body:{signature:o}})}e.deleteTransaction=ie;function re(s,r,o){return(0,a.postEndpoint)(i,"/v2/chains/{chainId}/safes/{safe_address}/multisig-transactions/estimations",{path:{chainId:s,safe_address:r},body:o})}e.postSafeGasEstimation=re;function oe(s,r){return(0,a.getEndpoint)(i,"/v1/chains/{chainId}/safes/{safe_address}/nonces",{path:{chainId:s,safe_address:r}})}e.getNonces=oe;function ce(s,r,o){return(0,a.postEndpoint)(i,"/v1/chains/{chainId}/transactions/{safe_address}/propose",{path:{chainId:s,safe_address:r},body:o})}e.proposeTransaction=ce;function ue(s){return(0,a.getEndpoint)(i,"/v1/chains",{query:s})}e.getChainsConfig=ue;function de(s){return(0,a.getEndpoint)(i,"/v1/chains/{chainId}",{path:{chainId:s}})}e.getChainConfig=de;function le(s,r={}){return(0,a.getEndpoint)(i,"/v1/chains/{chainId}/safe-apps",{path:{chainId:s},query:r})}e.getSafeApps=le;function fe(s){return(0,a.getEndpoint)(i,"/v1/chains/{chainId}/about/master-copies",{path:{chainId:s}})}e.getMasterCopies=fe;function ge(s,r,o){return(0,a.postEndpoint)(i,"/v1/chains/{chainId}/data-decoder",{path:{chainId:s},body:{data:r,to:o}})}e.getDecodedData=ge;function he(s,r,o){return(0,a.getEndpoint)(i,"/v1/chains/{chainId}/safes/{safe_address}/messages",{path:{chainId:s,safe_address:r},query:{}},o)}e.getSafeMessages=he;function Ee(s,r){return(0,a.getEndpoint)(i,"/v1/chains/{chainId}/messages/{message_hash}",{path:{chainId:s,message_hash:r}})}e.getSafeMessage=Ee;function _e(s,r,o){return(0,a.postEndpoint)(i,"/v1/chains/{chainId}/safes/{safe_address}/messages",{path:{chainId:s,safe_address:r},body:o})}e.proposeSafeMessage=_e;function Te(s,r,o){return(0,a.postEndpoint)(i,"/v1/chains/{chainId}/messages/{message_hash}/signatures",{path:{chainId:s,message_hash:r},body:o})}e.confirmSafeMessage=Te;function me(s,r={}){return(0,a.getEndpoint)(i,"/v1/chains/{chainId}/delegates",{path:{chainId:s},query:r})}e.getDelegates=me;function Ie(s){return(0,a.postEndpoint)(i,"/v1/register/notifications",{body:s})}e.registerDevice=Ie;function ye(s,r,o){return(0,a.deleteEndpoint)(i,"/v1/chains/{chainId}/notifications/devices/{uuid}/safes/{safe_address}",{path:{chainId:s,safe_address:r,uuid:o}})}e.unregisterSafe=ye;function ve(s,r){return(0,a.deleteEndpoint)(i,"/v1/chains/{chainId}/notifications/devices/{uuid}",{path:{chainId:s,uuid:r}})}e.unregisterDevice=ve;function Se(s,r,o,u){return(0,a.postEndpoint)(i,"/v1/chains/{chainId}/safes/{safe_address}/emails",{path:{chainId:s,safe_address:r},body:o,headers:u})}e.registerEmail=Se;function Ae(s,r,o,u,I){return(0,a.putEndpoint)(i,"/v1/chains/{chainId}/safes/{safe_address}/emails/{signer}",{path:{chainId:s,safe_address:r,signer:o},body:u,headers:I})}e.changeEmail=Ae;function Oe(s,r,o){return(0,a.postEndpoint)(i,"/v1/chains/{chainId}/safes/{safe_address}/emails/{signer}/verify-resend",{path:{chainId:s,safe_address:r,signer:o},body:""})}e.resendEmailVerificationCode=Oe;function Ne(s,r,o,u){return(0,a.putEndpoint)(i,"/v1/chains/{chainId}/safes/{safe_address}/emails/{signer}/verify",{path:{chainId:s,safe_address:r,signer:o},body:u})}e.verifyEmail=Ne;function Ce(s,r,o,u){return(0,a.getEndpoint)(i,"/v1/chains/{chainId}/safes/{safe_address}/emails/{signer}",{path:{chainId:s,safe_address:r,signer:o},headers:u})}e.getRegisteredEmail=Ce;function be(s,r,o,u){return(0,a.deleteEndpoint)(i,"/v1/chains/{chainId}/safes/{safe_address}/emails/{signer}",{path:{chainId:s,safe_address:r,signer:o},headers:u})}e.deleteRegisteredEmail=be;function De(s,r,o){return(0,a.postEndpoint)(i,"/v1/chains/{chainId}/safes/{safe_address}/recovery",{path:{chainId:s,safe_address:r},body:o})}e.registerRecoveryModule=De;function pe(s){return(0,a.deleteEndpoint)(i,"/v1/subscriptions",{query:s})}e.unsubscribeSingle=pe;function we(s){return(0,a.deleteEndpoint)(i,"/v1/subscriptions/all",{query:s})}e.unsubscribeAll=we})(O);class Qe{constructor(n){this.communicator=n}async getBySafeTxHash(n){if(!n)throw new Error("Invalid safeTxHash");return(await this.communicator.send(l.getTxBySafeTxHash,{safeTxHash:n})).data}async signMessage(n){const t={message:n};return(await this.communicator.send(l.signMessage,t)).data}async signTypedMessage(n){if(!R(n))throw new Error("Invalid typed data");return(await this.communicator.send(l.signTypedMessage,{typedData:n})).data}async send({txs:n,params:t}){if(!n||!n.length)throw new Error("No transactions were passed");const a={txs:n,params:t};return(await this.communicator.send(l.sendTransactions,a)).data}}const g={eth_call:"eth_call",eth_gasPrice:"eth_gasPrice",eth_getLogs:"eth_getLogs",eth_getBalance:"eth_getBalance",eth_getCode:"eth_getCode",eth_getBlockByHash:"eth_getBlockByHash",eth_getBlockByNumber:"eth_getBlockByNumber",eth_getStorageAt:"eth_getStorageAt",eth_getTransactionByHash:"eth_getTransactionByHash",eth_getTransactionReceipt:"eth_getTransactionReceipt",eth_getTransactionCount:"eth_getTransactionCount",eth_estimateGas:"eth_estimateGas",safe_setSettings:"safe_setSettings"},m={defaultBlockParam:(e="latest")=>e,returnFullTxObjectParam:(e=!1)=>e,blockNumberToHex:e=>Number.isInteger(e)?`0x${e.toString(16)}`:e};class $e{constructor(n){this.communicator=n,this.call=this.buildRequest({call:g.eth_call,formatters:[null,m.defaultBlockParam]}),this.getBalance=this.buildRequest({call:g.eth_getBalance,formatters:[null,m.defaultBlockParam]}),this.getCode=this.buildRequest({call:g.eth_getCode,formatters:[null,m.defaultBlockParam]}),this.getStorageAt=this.buildRequest({call:g.eth_getStorageAt,formatters:[null,m.blockNumberToHex,m.defaultBlockParam]}),this.getPastLogs=this.buildRequest({call:g.eth_getLogs}),this.getBlockByHash=this.buildRequest({call:g.eth_getBlockByHash,formatters:[null,m.returnFullTxObjectParam]}),this.getBlockByNumber=this.buildRequest({call:g.eth_getBlockByNumber,formatters:[m.blockNumberToHex,m.returnFullTxObjectParam]}),this.getTransactionByHash=this.buildRequest({call:g.eth_getTransactionByHash}),this.getTransactionReceipt=this.buildRequest({call:g.eth_getTransactionReceipt}),this.getTransactionCount=this.buildRequest({call:g.eth_getTransactionCount,formatters:[null,m.defaultBlockParam]}),this.getGasPrice=this.buildRequest({call:g.eth_gasPrice}),this.getEstimateGas=t=>this.buildRequest({call:g.eth_estimateGas})([t]),this.setSafeSettings=this.buildRequest({call:g.safe_setSettings})}buildRequest(n){const{call:t,formatters:a}=n;return async c=>{a&&Array.isArray(c)&&a.forEach((f,h)=>{f&&(c[h]=f(c[h]))});const i={call:t,params:c||[]};return(await this.communicator.send(l.rpcCall,i)).data}}}const Ye="0x1626ba7e",Je="0x20c13b0b",w=4001;class N extends Error{constructor(n,t,a){super(n),this.code=t,this.data=a,Object.setPrototypeOf(this,N.prototype)}}class Q{constructor(n){this.communicator=n}async getPermissions(){return(await this.communicator.send(l.wallet_getPermissions,void 0)).data}async requestPermissions(n){if(!this.isPermissionRequestValid(n))throw new N("Permissions request is invalid",w);try{return(await this.communicator.send(l.wallet_requestPermissions,n)).data}catch{throw new N("Permissions rejected",w)}}isPermissionRequestValid(n){return n.every(t=>typeof t=="object"?Object.keys(t).every(a=>!!Object.values(b).includes(a)):!1)}}const L=(e,n)=>n.some(t=>t.parentCapability===e),ze=()=>(e,n,t)=>{const a=t.value;return t.value=async function(){const c=new Q(this.communicator);let i=await c.getPermissions();if(L(n,i)||(i=await c.requestPermissions([{[n]:{}}])),!L(n,i))throw new N("Permissions rejected",w);return a.apply(this)},t};var Ze=function(e,n,t,a){var c=arguments.length,i=c<3?n:a===null?a=Object.getOwnPropertyDescriptor(n,t):a,d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,a);else for(var f=e.length-1;f>=0;f--)(d=e[f])&&(i=(c<3?d(i):c>3?d(n,t,i):d(n,t))||i);return c>3&&i&&Object.defineProperty(n,t,i),i};class ${constructor(n){this.communicator=n}async getChainInfo(){return(await this.communicator.send(l.getChainInfo,void 0)).data}async getInfo(){return(await this.communicator.send(l.getSafeInfo,void 0)).data}async experimental_getBalances({currency:n="usd"}={}){return(await this.communicator.send(l.getSafeBalances,{currency:n})).data}async check1271Signature(n,t="0x"){const a=await this.getInfo(),c=M({abi:[{constant:!1,inputs:[{name:"_dataHash",type:"bytes32"},{name:"_signature",type:"bytes"}],name:"isValidSignature",outputs:[{name:"",type:"bytes4"}],payable:!1,stateMutability:"nonpayable",type:"function"}],functionName:"isValidSignature",args:[n,t]}),i={call:g.eth_call,params:[{to:a.safeAddress,data:c},"latest"]};try{return(await this.communicator.send(l.rpcCall,i)).data.slice(0,10).toLowerCase()===Ye}catch{return!1}}async check1271SignatureBytes(n,t="0x"){const a=await this.getInfo(),c=M({abi:[{constant:!1,inputs:[{name:"_data",type:"bytes"},{name:"_signature",type:"bytes"}],name:"isValidSignature",outputs:[{name:"",type:"bytes4"}],payable:!1,stateMutability:"nonpayable",type:"function"}],functionName:"isValidSignature",args:[n,t]}),i={call:g.eth_call,params:[{to:a.safeAddress,data:c},"latest"]};try{return(await this.communicator.send(l.rpcCall,i)).data.slice(0,10).toLowerCase()===Je}catch{return!1}}calculateMessageHash(n){return Re(n)}calculateTypedMessageHash(n){const t=typeof n.domain.chainId=="object"?n.domain.chainId.toNumber():Number(n.domain.chainId);let a=n.primaryType;if(!a){const c=Object.values(n.types),i=Object.keys(n.types).filter(d=>c.every(f=>f.every(({type:h})=>h.replace("[","").replace("]","")!==d)));if(i.length===0||i.length>1)throw new Error("Please specify primaryType");a=i[0]}return Pe({message:n.message,domain:{...n.domain,chainId:t,verifyingContract:n.domain.verifyingContract,salt:n.domain.salt},types:n.types,primaryType:a})}async getOffChainSignature(n){return(await this.communicator.send(l.getOffChainSignature,n)).data}async isMessageSigned(n,t="0x"){let a;if(typeof n=="string"&&(a=async()=>{const c=this.calculateMessageHash(n);return await this.isMessageHashSigned(c,t)}),R(n)&&(a=async()=>{const c=this.calculateTypedMessageHash(n);return await this.isMessageHashSigned(c,t)}),a)return await a();throw new Error("Invalid message type")}async isMessageHashSigned(n,t="0x"){const a=[this.check1271Signature.bind(this),this.check1271SignatureBytes.bind(this)];for(const c of a)if(await c(n,t))return!0;return!1}async getEnvironmentInfo(){return(await this.communicator.send(l.getEnvironmentInfo,void 0)).data}async requestAddressBook(){return(await this.communicator.send(l.requestAddressBook,void 0)).data}}Ze([ze()],$.prototype,"requestAddressBook",null);class xe{constructor(n={}){const{allowedDomains:t=null,debug:a=!1}=n;this.communicator=new He(t,a),this.eth=new $e(this.communicator),this.txs=new Qe(this.communicator),this.safe=new $(this.communicator),this.wallet=new Q(this.communicator)}}const en=xe,tn=Object.freeze(Object.defineProperty({__proto__:null,MessageFormatter:C,get Methods(){return l},Operation:O.Operation,RPC_CALLS:g,get RestrictedMethods(){return b},TokenType:O.TokenType,TransactionStatus:O.TransactionStatus,TransferDirection:O.TransferDirection,default:en,getSDKVersion:B,isObjectEIP712TypedData:R},Symbol.toStringTag,{value:"Module"}));export{tn as e};
