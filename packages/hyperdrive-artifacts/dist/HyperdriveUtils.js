export const HyperdriveUtils = { "abi": [], "bytecode": { "object": "0x60566037600b82828239805160001a607314602a57634e487b7160e01b600052600060045260246000fd5b30600052607381538281f3fe73000000000000000000000000000000000000000030146080604052600080fdfea26469706673582212200fbe85dfad0636cff96ed95b1a0deab698833ba52fa90f9d86180c510cef48e064736f6c63430008140033", "sourceMap": "497:59762:237:-:0;;;;;;;;;;;;;;;-1:-1:-1;;;497:59762:237;;;;;;;;;;;;;;;;;", "linkReferences": {} }, "deployedBytecode": { "object": "0x73000000000000000000000000000000000000000030146080604052600080fdfea26469706673582212200fbe85dfad0636cff96ed95b1a0deab698833ba52fa90f9d86180c510cef48e064736f6c63430008140033", "sourceMap": "497:59762:237:-:0;;;;;;;;", "linkReferences": {} }, "methodIdentifiers": {}, "rawMetadata": "{\"compiler\":{\"version\":\"0.8.20+commit.a1b79de6\"},\"language\":\"Solidity\",\"output\":{\"abi\":[],\"devdoc\":{\"kind\":\"dev\",\"methods\":{},\"version\":1},\"userdoc\":{\"kind\":\"user\",\"methods\":{},\"version\":1}},\"settings\":{\"compilationTarget\":{\"test/utils/HyperdriveUtils.sol\":\"HyperdriveUtils\"},\"evmVersion\":\"paris\",\"libraries\":{},\"metadata\":{\"bytecodeHash\":\"ipfs\"},\"optimizer\":{\"enabled\":true,\"runs\":200},\"remappings\":[\":@openzeppelin/contracts/=lib/openzeppelin-contracts/contracts/\",\":aave-v3-core/=lib/aave-v3-core/\",\":ds-test/=lib/forge-std/lib/ds-test/src/\",\":erc4626-tests/=lib/openzeppelin-contracts/lib/erc4626-tests/\",\":forge-std/=lib/forge-std/src/\",\":openzeppelin-contracts/=lib/openzeppelin-contracts/\",\":openzeppelin/=lib/openzeppelin-contracts/contracts/\",\":solmate/=lib/solmate/src/\"]},\"sources\":{\"contracts/src/interfaces/IERC20.sol\":{\"keccak256\":\"0x5f446a4987d57c64380d44c234ee079172e98bed9595ec067eb519898c3117d9\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://a3245994c58110716f5099c07e5cb270137356d288044f03c713d29c36e207ac\",\"dweb:/ipfs/QmYdn52sGRQKXfSyL8ieSz8HysG6R5kLJWsNwEnyX1e22p\"]},\"contracts/src/interfaces/IHyperdrive.sol\":{\"keccak256\":\"0xb8ee04f3090b498966970e210f7de0f982f6445628556f2f176385423d8c5952\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://db789f03faa935c6e3b0882b6e873e8f683c9c8841a4b128366dcbe7321911bf\",\"dweb:/ipfs/QmSQh1cX79nApuSAfJbVN99dmEaE4CK9QwWfEGcwhJMBLK\"]},\"contracts/src/interfaces/IHyperdriveCore.sol\":{\"keccak256\":\"0x68adcd293ff25711add1698b6024faa45beec01eb044bd0103d3020aa96d856e\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://0e0f5e35a7d2c656e249394d25896e5adfb9af3e210c01b9ef5fa81d25a45e24\",\"dweb:/ipfs/QmbLASezHPWHcbodqSfw3Qh9NzqekqVPM8FhCXKGTCXL1h\"]},\"contracts/src/interfaces/IHyperdriveEvents.sol\":{\"keccak256\":\"0x812ccb32dff907e8614c89a65196eec239eceb3e63f9f14dde2b2269c75a67c0\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://da5f2ce974bfcd8185342c121c879ba5aef23e1e4e7b36cf9fcba68296b8892c\",\"dweb:/ipfs/QmSho3PWs9bzejTYYjySuXcH9tVP4xFnkbUmSzQA54g8eG\"]},\"contracts/src/interfaces/IHyperdriveRead.sol\":{\"keccak256\":\"0x5922cbd86a7267c8fd19e3dc7a6f2636bad2b3330c28bca8e66adc7cd8ce2b55\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://ced8bce3f3c15a9f0bcdd11ba16e69651179edd6b16e267936788f4ab4d6eabf\",\"dweb:/ipfs/QmcoZPj4h2ym6r13KDU7JG2GoVdDWa1GwfKL2jjFRsp8H6\"]},\"contracts/src/interfaces/IMultiToken.sol\":{\"keccak256\":\"0xf5f82b8223e0c1bfcf4f73566a909ba07a9266960dfe2335c1494e06debbbe3f\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://920cf3fd66132a1e98a6a5708ad9a3bb047f4df8848119ab382b51094c1290a7\",\"dweb:/ipfs/QmWL3SyG8L91Coe9DsHz3Ke9tGMvYBf2NgRRDr3Fg5xFzp\"]},\"contracts/src/interfaces/IMultiTokenCore.sol\":{\"keccak256\":\"0x5c27315743bb6ef8a121ecf72cb24d5c144786dedb6526ef010f580eb872e501\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://3e102c51bac9c82766c9826d97dc780a05a2bf64703b070757a7531a0851a1ae\",\"dweb:/ipfs/QmXYwbzPbiznj5AeDiX7NNfRE9xyhSx1huTMfMFndrUZWs\"]},\"contracts/src/interfaces/IMultiTokenEvents.sol\":{\"keccak256\":\"0x165f79e628b1975343f979549f3fdb5073a29aeecb03861f41d165961ee39fdb\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://3c0751cf322944d080a7a6692897807d0cef798268689afc1f6c8f91182a4222\",\"dweb:/ipfs/QmQVWtCgphU9sjqD2q6F6ww62uXDSWZx5KJVj6jFJpXeDK\"]},\"contracts/src/interfaces/IMultiTokenMetadata.sol\":{\"keccak256\":\"0xcc21ad6d3d4e3de354fbc25a472d940e5e2af0b48766404f9efecdac600d72ca\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://b48fa111a773c820fe578efdd737d164e3957930ed46f3f304c6a8602a7e26a3\",\"dweb:/ipfs/QmcA7bjBC6ZBvYyojZZx3eKpugHmSrAAA14p14bQugiVKG\"]},\"contracts/src/interfaces/IMultiTokenRead.sol\":{\"keccak256\":\"0xac84dd306f29ae9d6becf764d93545c33f7c37737bb1aeb714c85930d0c074a0\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://d9082a16d5a736ab7ce5670be4f2475ea5c5fdae8ad7096ed9663f84eed96b11\",\"dweb:/ipfs/QmUTH8dZaQJt56UsT7N2aCUCKmjQYj7Ah53rRXk6DuVNUR\"]},\"contracts/src/libraries/AssetId.sol\":{\"keccak256\":\"0x3031a1ec376be333eebe0062c474a22d7f970cb02de62ab6823c6918c0a7f83b\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://6c80cc2fd8b7908b6420ebb21cb99266c93e01d6cdd9d1a41f8847493849b131\",\"dweb:/ipfs/QmeMehWbF2RwQaf6c6yaj5KHjXboDRpzBCtvFnLW4BXBbc\"]},\"contracts/src/libraries/Errors.sol\":{\"keccak256\":\"0x45f48f5b8caec5b751850b7266abd84c7400debfbad0f112847582bb052058b0\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://46c85e0c750cdb752bec5d67a8a0bc8df071d934c568c880d08a5120a1a11d88\",\"dweb:/ipfs/Qmc2L1ePB1gqBwUiaAUeoG6hvoPtS2hdY6rhEXzX1SfB41\"]},\"contracts/src/libraries/FixedPointMath.sol\":{\"keccak256\":\"0x631f6529908f62f71775f8c6120afdca3a836fb24fa9fa4701cad54f4a9da076\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://2baf6ad8917a3fbb6d040334451f6b4f6936b00518c4cd308b9c6fa11569b2bd\",\"dweb:/ipfs/QmXD16vk6MRxmPRqy8ZXSpRA5XxhSf1pnsQH32ARDJTk8L\"]},\"contracts/src/libraries/HyperdriveMath.sol\":{\"keccak256\":\"0xcf305dde8aa320d1e1b767734ce8edce456af537525d40e30d5345f09f6e34ab\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://056c9a563f1a9e0133e17463497ad19be517d35b770170122edea50ca9fbe002\",\"dweb:/ipfs/QmS6dkVRHzdbv7etumcCtNtm9GuXDCjqZxxhtYfP6keAAY\"]},\"contracts/src/libraries/LPMath.sol\":{\"keccak256\":\"0x5b3c0d159b1945a14227028d835e011bf740e007f664cba049ece1b6ab963067\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://d8f4fef22462dabc799b2f8124440a7cc57076f7ceecb46219c69b09f50baf5f\",\"dweb:/ipfs/Qmcw9iC1RZt4Nh7dGH1yR7vUi6qZHJf6ReAvF2uLFHESqZ\"]},\"contracts/src/libraries/SafeCast.sol\":{\"keccak256\":\"0xc5282be69c8c85c1a1bbbf1554a501c17599f4b84119339b660018ae90eb7148\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://fd29b570d1e3205d25939b1c0e78e98ae34747a8118703fc5b2c9690791b26c8\",\"dweb:/ipfs/QmSdecxKRE66cgEipikK5uS4mUJxz2FgfncCk9iXvkdjG8\"]},\"contracts/src/libraries/YieldSpaceMath.sol\":{\"keccak256\":\"0x4a9c91313bed7cda6ef503af23c9f777008b5258e9cb2176eab6acc52be79891\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://88da1f5502a12fe1024be90f6a6ea08556cc1f2660ab8cbeb5e07640abb7711c\",\"dweb:/ipfs/QmVQoG9TyrAsVYcgvgZfgA5pQk8V8wvS4BewGNP4B3Txyy\"]},\"test/utils/HyperdriveUtils.sol\":{\"keccak256\":\"0x764719deaf8b833fc87b8436d166030eaa05832bf3d5e259172f431778666e04\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://04c4bd84c0d60f9a7c68604cbe76d0cc88170bb569298749bc97d40b197f62f6\",\"dweb:/ipfs/QmQV6zkCCvLkbta2vDzjbMXKUzYDrAhcEyFA7QSRTVZJ1P\"]}},\"version\":1}", "metadata": { "compiler": { "version": "0.8.20+commit.a1b79de6" }, "language": "Solidity", "output": { "abi": [], "devdoc": { "kind": "dev", "methods": {}, "version": 1 }, "userdoc": { "kind": "user", "methods": {}, "version": 1 } }, "settings": { "remappings": ["@openzeppelin/contracts/=lib/openzeppelin-contracts/contracts/", "aave-v3-core/=lib/aave-v3-core/", "ds-test/=lib/forge-std/lib/ds-test/src/", "erc4626-tests/=lib/openzeppelin-contracts/lib/erc4626-tests/", "forge-std/=lib/forge-std/src/", "openzeppelin-contracts/=lib/openzeppelin-contracts/", "openzeppelin/=lib/openzeppelin-contracts/contracts/", "solmate/=lib/solmate/src/"], "optimizer": { "enabled": true, "runs": 200 }, "metadata": { "bytecodeHash": "ipfs" }, "compilationTarget": { "test/utils/HyperdriveUtils.sol": "HyperdriveUtils" }, "libraries": {} }, "sources": { "contracts/src/interfaces/IERC20.sol": { "keccak256": "0x5f446a4987d57c64380d44c234ee079172e98bed9595ec067eb519898c3117d9", "urls": ["bzz-raw://a3245994c58110716f5099c07e5cb270137356d288044f03c713d29c36e207ac", "dweb:/ipfs/QmYdn52sGRQKXfSyL8ieSz8HysG6R5kLJWsNwEnyX1e22p"], "license": "Apache-2.0" }, "contracts/src/interfaces/IHyperdrive.sol": { "keccak256": "0xb8ee04f3090b498966970e210f7de0f982f6445628556f2f176385423d8c5952", "urls": ["bzz-raw://db789f03faa935c6e3b0882b6e873e8f683c9c8841a4b128366dcbe7321911bf", "dweb:/ipfs/QmSQh1cX79nApuSAfJbVN99dmEaE4CK9QwWfEGcwhJMBLK"], "license": "Apache-2.0" }, "contracts/src/interfaces/IHyperdriveCore.sol": { "keccak256": "0x68adcd293ff25711add1698b6024faa45beec01eb044bd0103d3020aa96d856e", "urls": ["bzz-raw://0e0f5e35a7d2c656e249394d25896e5adfb9af3e210c01b9ef5fa81d25a45e24", "dweb:/ipfs/QmbLASezHPWHcbodqSfw3Qh9NzqekqVPM8FhCXKGTCXL1h"], "license": "Apache-2.0" }, "contracts/src/interfaces/IHyperdriveEvents.sol": { "keccak256": "0x812ccb32dff907e8614c89a65196eec239eceb3e63f9f14dde2b2269c75a67c0", "urls": ["bzz-raw://da5f2ce974bfcd8185342c121c879ba5aef23e1e4e7b36cf9fcba68296b8892c", "dweb:/ipfs/QmSho3PWs9bzejTYYjySuXcH9tVP4xFnkbUmSzQA54g8eG"], "license": "Apache-2.0" }, "contracts/src/interfaces/IHyperdriveRead.sol": { "keccak256": "0x5922cbd86a7267c8fd19e3dc7a6f2636bad2b3330c28bca8e66adc7cd8ce2b55", "urls": ["bzz-raw://ced8bce3f3c15a9f0bcdd11ba16e69651179edd6b16e267936788f4ab4d6eabf", "dweb:/ipfs/QmcoZPj4h2ym6r13KDU7JG2GoVdDWa1GwfKL2jjFRsp8H6"], "license": "Apache-2.0" }, "contracts/src/interfaces/IMultiToken.sol": { "keccak256": "0xf5f82b8223e0c1bfcf4f73566a909ba07a9266960dfe2335c1494e06debbbe3f", "urls": ["bzz-raw://920cf3fd66132a1e98a6a5708ad9a3bb047f4df8848119ab382b51094c1290a7", "dweb:/ipfs/QmWL3SyG8L91Coe9DsHz3Ke9tGMvYBf2NgRRDr3Fg5xFzp"], "license": "Apache-2.0" }, "contracts/src/interfaces/IMultiTokenCore.sol": { "keccak256": "0x5c27315743bb6ef8a121ecf72cb24d5c144786dedb6526ef010f580eb872e501", "urls": ["bzz-raw://3e102c51bac9c82766c9826d97dc780a05a2bf64703b070757a7531a0851a1ae", "dweb:/ipfs/QmXYwbzPbiznj5AeDiX7NNfRE9xyhSx1huTMfMFndrUZWs"], "license": "Apache-2.0" }, "contracts/src/interfaces/IMultiTokenEvents.sol": { "keccak256": "0x165f79e628b1975343f979549f3fdb5073a29aeecb03861f41d165961ee39fdb", "urls": ["bzz-raw://3c0751cf322944d080a7a6692897807d0cef798268689afc1f6c8f91182a4222", "dweb:/ipfs/QmQVWtCgphU9sjqD2q6F6ww62uXDSWZx5KJVj6jFJpXeDK"], "license": "Apache-2.0" }, "contracts/src/interfaces/IMultiTokenMetadata.sol": { "keccak256": "0xcc21ad6d3d4e3de354fbc25a472d940e5e2af0b48766404f9efecdac600d72ca", "urls": ["bzz-raw://b48fa111a773c820fe578efdd737d164e3957930ed46f3f304c6a8602a7e26a3", "dweb:/ipfs/QmcA7bjBC6ZBvYyojZZx3eKpugHmSrAAA14p14bQugiVKG"], "license": "Apache-2.0" }, "contracts/src/interfaces/IMultiTokenRead.sol": { "keccak256": "0xac84dd306f29ae9d6becf764d93545c33f7c37737bb1aeb714c85930d0c074a0", "urls": ["bzz-raw://d9082a16d5a736ab7ce5670be4f2475ea5c5fdae8ad7096ed9663f84eed96b11", "dweb:/ipfs/QmUTH8dZaQJt56UsT7N2aCUCKmjQYj7Ah53rRXk6DuVNUR"], "license": "Apache-2.0" }, "contracts/src/libraries/AssetId.sol": { "keccak256": "0x3031a1ec376be333eebe0062c474a22d7f970cb02de62ab6823c6918c0a7f83b", "urls": ["bzz-raw://6c80cc2fd8b7908b6420ebb21cb99266c93e01d6cdd9d1a41f8847493849b131", "dweb:/ipfs/QmeMehWbF2RwQaf6c6yaj5KHjXboDRpzBCtvFnLW4BXBbc"], "license": "Apache-2.0" }, "contracts/src/libraries/Errors.sol": { "keccak256": "0x45f48f5b8caec5b751850b7266abd84c7400debfbad0f112847582bb052058b0", "urls": ["bzz-raw://46c85e0c750cdb752bec5d67a8a0bc8df071d934c568c880d08a5120a1a11d88", "dweb:/ipfs/Qmc2L1ePB1gqBwUiaAUeoG6hvoPtS2hdY6rhEXzX1SfB41"], "license": "Apache-2.0" }, "contracts/src/libraries/FixedPointMath.sol": { "keccak256": "0x631f6529908f62f71775f8c6120afdca3a836fb24fa9fa4701cad54f4a9da076", "urls": ["bzz-raw://2baf6ad8917a3fbb6d040334451f6b4f6936b00518c4cd308b9c6fa11569b2bd", "dweb:/ipfs/QmXD16vk6MRxmPRqy8ZXSpRA5XxhSf1pnsQH32ARDJTk8L"], "license": "Apache-2.0" }, "contracts/src/libraries/HyperdriveMath.sol": { "keccak256": "0xcf305dde8aa320d1e1b767734ce8edce456af537525d40e30d5345f09f6e34ab", "urls": ["bzz-raw://056c9a563f1a9e0133e17463497ad19be517d35b770170122edea50ca9fbe002", "dweb:/ipfs/QmS6dkVRHzdbv7etumcCtNtm9GuXDCjqZxxhtYfP6keAAY"], "license": "Apache-2.0" }, "contracts/src/libraries/LPMath.sol": { "keccak256": "0x5b3c0d159b1945a14227028d835e011bf740e007f664cba049ece1b6ab963067", "urls": ["bzz-raw://d8f4fef22462dabc799b2f8124440a7cc57076f7ceecb46219c69b09f50baf5f", "dweb:/ipfs/Qmcw9iC1RZt4Nh7dGH1yR7vUi6qZHJf6ReAvF2uLFHESqZ"], "license": "Apache-2.0" }, "contracts/src/libraries/SafeCast.sol": { "keccak256": "0xc5282be69c8c85c1a1bbbf1554a501c17599f4b84119339b660018ae90eb7148", "urls": ["bzz-raw://fd29b570d1e3205d25939b1c0e78e98ae34747a8118703fc5b2c9690791b26c8", "dweb:/ipfs/QmSdecxKRE66cgEipikK5uS4mUJxz2FgfncCk9iXvkdjG8"], "license": "Apache-2.0" }, "contracts/src/libraries/YieldSpaceMath.sol": { "keccak256": "0x4a9c91313bed7cda6ef503af23c9f777008b5258e9cb2176eab6acc52be79891", "urls": ["bzz-raw://88da1f5502a12fe1024be90f6a6ea08556cc1f2660ab8cbeb5e07640abb7711c", "dweb:/ipfs/QmVQoG9TyrAsVYcgvgZfgA5pQk8V8wvS4BewGNP4B3Txyy"], "license": "Apache-2.0" }, "test/utils/HyperdriveUtils.sol": { "keccak256": "0x764719deaf8b833fc87b8436d166030eaa05832bf3d5e259172f431778666e04", "urls": ["bzz-raw://04c4bd84c0d60f9a7c68604cbe76d0cc88170bb569298749bc97d40b197f62f6", "dweb:/ipfs/QmQV6zkCCvLkbta2vDzjbMXKUzYDrAhcEyFA7QSRTVZJ1P"], "license": "Apache-2.0" } }, "version": 1 }, "ast": { "absolutePath": "test/utils/HyperdriveUtils.sol", "id": 161567, "exportedSymbols": { "AssetId": [18772], "FixedPointMath": [19572], "HyperdriveMath": [20320], "HyperdriveUtils": [161566], "IHyperdrive": [11143], "LPMath": [22264], "ONE": [18806], "YieldSpaceMath": [23422] }, "nodeType": "SourceUnit", "src": "39:60221:237", "nodes": [{ "id": 158984, "nodeType": "PragmaDirective", "src": "39:23:237", "nodes": [], "literals": ["solidity", "0.8", ".20"] }, { "id": 158986, "nodeType": "ImportDirective", "src": "64:71:237", "nodes": [], "absolutePath": "contracts/src/interfaces/IHyperdrive.sol", "file": "contracts/src/interfaces/IHyperdrive.sol", "nameLocation": "-1:-1:-1", "scope": 161567, "sourceUnit": 11144, "symbolAliases": [{ "foreign": { "id": 158985, "name": "IHyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 11143, "src": "73:11:237", "typeDescriptions": {} }, "nameLocation": "-1:-1:-1" }], "unitAlias": "" }, { "id": 158988, "nodeType": "ImportDirective", "src": "136:62:237", "nodes": [], "absolutePath": "contracts/src/libraries/AssetId.sol", "file": "contracts/src/libraries/AssetId.sol", "nameLocation": "-1:-1:-1", "scope": 161567, "sourceUnit": 18773, "symbolAliases": [{ "foreign": { "id": 158987, "name": "AssetId", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18772, "src": "145:7:237", "typeDescriptions": {} }, "nameLocation": "-1:-1:-1" }], "unitAlias": "" }, { "id": 158991, "nodeType": "ImportDirective", "src": "199:81:237", "nodes": [], "absolutePath": "contracts/src/libraries/FixedPointMath.sol", "file": "contracts/src/libraries/FixedPointMath.sol", "nameLocation": "-1:-1:-1", "scope": 161567, "sourceUnit": 19573, "symbolAliases": [{ "foreign": { "id": 158989, "name": "FixedPointMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19572, "src": "208:14:237", "typeDescriptions": {} }, "nameLocation": "-1:-1:-1" }, { "foreign": { "id": 158990, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "224:3:237", "typeDescriptions": {} }, "nameLocation": "-1:-1:-1" }], "unitAlias": "" }, { "id": 158993, "nodeType": "ImportDirective", "src": "281:76:237", "nodes": [], "absolutePath": "contracts/src/libraries/HyperdriveMath.sol", "file": "contracts/src/libraries/HyperdriveMath.sol", "nameLocation": "-1:-1:-1", "scope": 161567, "sourceUnit": 20321, "symbolAliases": [{ "foreign": { "id": 158992, "name": "HyperdriveMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20320, "src": "290:14:237", "typeDescriptions": {} }, "nameLocation": "-1:-1:-1" }], "unitAlias": "" }, { "id": 158995, "nodeType": "ImportDirective", "src": "358:60:237", "nodes": [], "absolutePath": "contracts/src/libraries/LPMath.sol", "file": "contracts/src/libraries/LPMath.sol", "nameLocation": "-1:-1:-1", "scope": 161567, "sourceUnit": 22265, "symbolAliases": [{ "foreign": { "id": 158994, "name": "LPMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 22264, "src": "367:6:237", "typeDescriptions": {} }, "nameLocation": "-1:-1:-1" }], "unitAlias": "" }, { "id": 158997, "nodeType": "ImportDirective", "src": "419:76:237", "nodes": [], "absolutePath": "contracts/src/libraries/YieldSpaceMath.sol", "file": "contracts/src/libraries/YieldSpaceMath.sol", "nameLocation": "-1:-1:-1", "scope": 161567, "sourceUnit": 23423, "symbolAliases": [{ "foreign": { "id": 158996, "name": "YieldSpaceMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 23422, "src": "428:14:237", "typeDescriptions": {} }, "nameLocation": "-1:-1:-1" }], "unitAlias": "" }, { "id": 161566, "nodeType": "ContractDefinition", "src": "497:59762:237", "nodes": [{ "id": 158999, "nodeType": "UsingForDirective", "src": "527:28:237", "nodes": [], "global": false, "libraryName": { "id": 158998, "name": "HyperdriveUtils", "nameLocations": ["533:15:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 161566, "src": "533:15:237" } }, { "id": 159002, "nodeType": "UsingForDirective", "src": "560:33:237", "nodes": [], "global": false, "libraryName": { "id": 159000, "name": "FixedPointMath", "nameLocations": ["566:14:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 19572, "src": "566:14:237" }, "typeName": { "id": 159001, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "585:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } } }, { "id": 159005, "nodeType": "UsingForDirective", "src": "598:32:237", "nodes": [], "global": false, "libraryName": { "id": 159003, "name": "FixedPointMath", "nameLocations": ["604:14:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 19572, "src": "604:14:237" }, "typeName": { "id": 159004, "name": "int256", "nodeType": "ElementaryTypeName", "src": "623:6:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } } }, { "id": 159027, "nodeType": "FunctionDefinition", "src": "664:227:237", "nodes": [], "body": { "id": 159026, "nodeType": "Block", "src": "760:131:237", "nodes": [], "statements": [{ "expression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159024, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "expression": { "id": 159014, "name": "block", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": -4, "src": "789:5:237", "typeDescriptions": { "typeIdentifier": "t_magic_block", "typeString": "block" } }, "id": 159015, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "795:9:237", "memberName": "timestamp", "nodeType": "MemberAccess", "src": "789:15:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159022, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "expression": { "id": 159016, "name": "block", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": -4, "src": "820:5:237", "typeDescriptions": { "typeIdentifier": "t_magic_block", "typeString": "block" } }, "id": 159017, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "826:9:237", "memberName": "timestamp", "nodeType": "MemberAccess", "src": "820:15:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "%", "rightExpression": { "expression": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 159018, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159009, "src": "838:10:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "id": 159019, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "849:13:237", "memberName": "getPoolConfig", "nodeType": "MemberAccess", "referencedDeclaration": 11941, "src": "838:24:237", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolConfig_$10934_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolConfig memory)" } }, "id": 159020, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "838:26:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 159021, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "865:18:237", "memberName": "checkpointDuration", "nodeType": "MemberAccess", "referencedDeclaration": 10917, "src": "838:45:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "820:63:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 159023, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "819:65:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "789:95:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 159013, "id": 159025, "nodeType": "Return", "src": "770:114:237" }] }, "documentation": { "id": 159006, "nodeType": "StructuredDocumentation", "src": "636:23:237", "text": "Time Utilities ///" }, "implemented": true, "kind": "function", "modifiers": [], "name": "latestCheckpoint", "nameLocation": "673:16:237", "parameters": { "id": 159010, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159009, "mutability": "mutable", "name": "hyperdrive", "nameLocation": "711:10:237", "nodeType": "VariableDeclaration", "scope": 159027, "src": "699:22:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" }, "typeName": { "id": 159008, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 159007, "name": "IHyperdrive", "nameLocations": ["699:11:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 11143, "src": "699:11:237" }, "referencedDeclaration": 11143, "src": "699:11:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "visibility": "internal" }], "src": "689:38:237" }, "returnParameters": { "id": 159013, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159012, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 159027, "src": "751:7:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159011, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "751:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "750:9:237" }, "scope": 161566, "stateMutability": "view", "virtual": false, "visibility": "internal" }, { "id": 159065, "nodeType": "FunctionDefinition", "src": "897:447:237", "nodes": [], "body": { "id": 159064, "nodeType": "Block", "src": "1045:299:237", "nodes": [], "statements": [{ "expression": { "id": 159050, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 159037, "name": "timeRemaining", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159035, "src": "1055:13:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "condition": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159042, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159038, "name": "_maturityTime", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159032, "src": "1071:13:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": ">", "rightExpression": { "arguments": [{ "id": 159040, "name": "_hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159030, "src": "1104:11:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" }], "id": 159039, "name": "latestCheckpoint", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159027, "src": "1087:16:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_view$_t_contract$_IHyperdrive_$11143_$returns$_t_uint256_$", "typeString": "function (contract IHyperdrive) view returns (uint256)" } }, "id": 159041, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "1087:29:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "1071:45:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "falseExpression": { "hexValue": "30", "id": 159048, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "1191:1:237", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }, "id": 159049, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "Conditional", "src": "1071:121:237", "trueExpression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159047, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159043, "name": "_maturityTime", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159032, "src": "1131:13:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [{ "id": 159045, "name": "_hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159030, "src": "1164:11:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" }], "id": 159044, "name": "latestCheckpoint", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159027, "src": "1147:16:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_view$_t_contract$_IHyperdrive_$11143_$returns$_t_uint256_$", "typeString": "function (contract IHyperdrive) view returns (uint256)" } }, "id": 159046, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "1147:29:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "1131:45:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "1055:137:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159051, "nodeType": "ExpressionStatement", "src": "1055:137:237" }, { "expression": { "id": 159060, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 159052, "name": "timeRemaining", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159035, "src": "1202:13:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "expression": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 159055, "name": "_hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159030, "src": "1253:11:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "id": 159056, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "1265:13:237", "memberName": "getPoolConfig", "nodeType": "MemberAccess", "referencedDeclaration": 11941, "src": "1253:25:237", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolConfig_$10934_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolConfig memory)" } }, "id": 159057, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "1253:27:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 159058, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "1281:16:237", "memberName": "positionDuration", "nodeType": "MemberAccess", "referencedDeclaration": 10914, "src": "1253:44:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159053, "name": "timeRemaining", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159035, "src": "1218:13:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159054, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "1232:7:237", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "1218:21:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159059, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "1218:89:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "1202:105:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159061, "nodeType": "ExpressionStatement", "src": "1202:105:237" }, { "expression": { "id": 159062, "name": "timeRemaining", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159035, "src": "1324:13:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 159036, "id": 159063, "nodeType": "Return", "src": "1317:20:237" }] }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateTimeRemaining", "nameLocation": "906:22:237", "parameters": { "id": 159033, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159030, "mutability": "mutable", "name": "_hyperdrive", "nameLocation": "950:11:237", "nodeType": "VariableDeclaration", "scope": 159065, "src": "938:23:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" }, "typeName": { "id": 159029, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 159028, "name": "IHyperdrive", "nameLocations": ["938:11:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 11143, "src": "938:11:237" }, "referencedDeclaration": 11143, "src": "938:11:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "visibility": "internal" }, { "constant": false, "id": 159032, "mutability": "mutable", "name": "_maturityTime", "nameLocation": "979:13:237", "nodeType": "VariableDeclaration", "scope": 159065, "src": "971:21:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159031, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "971:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "928:70:237" }, "returnParameters": { "id": 159036, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159035, "mutability": "mutable", "name": "timeRemaining", "nameLocation": "1030:13:237", "nodeType": "VariableDeclaration", "scope": 159065, "src": "1022:21:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159034, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "1022:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "1021:23:237" }, "scope": 161566, "stateMutability": "view", "virtual": false, "visibility": "internal" }, { "id": 159083, "nodeType": "FunctionDefinition", "src": "1350:237:237", "nodes": [], "body": { "id": 159082, "nodeType": "Block", "src": "1463:124:237", "nodes": [], "statements": [{ "expression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159080, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "arguments": [{ "id": 159074, "name": "_hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159068, "src": "1509:11:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" }], "id": 159073, "name": "latestCheckpoint", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159027, "src": "1492:16:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_view$_t_contract$_IHyperdrive_$11143_$returns$_t_uint256_$", "typeString": "function (contract IHyperdrive) view returns (uint256)" } }, "id": 159075, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "1492:29:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "expression": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 159076, "name": "_hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159068, "src": "1536:11:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "id": 159077, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "1548:13:237", "memberName": "getPoolConfig", "nodeType": "MemberAccess", "referencedDeclaration": 11941, "src": "1536:25:237", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolConfig_$10934_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolConfig memory)" } }, "id": 159078, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "1536:27:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 159079, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "1564:16:237", "memberName": "positionDuration", "nodeType": "MemberAccess", "referencedDeclaration": 10914, "src": "1536:44:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "1492:88:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 159072, "id": 159081, "nodeType": "Return", "src": "1473:107:237" }] }, "implemented": true, "kind": "function", "modifiers": [], "name": "maturityTimeFromLatestCheckpoint", "nameLocation": "1359:32:237", "parameters": { "id": 159069, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159068, "mutability": "mutable", "name": "_hyperdrive", "nameLocation": "1413:11:237", "nodeType": "VariableDeclaration", "scope": 159083, "src": "1401:23:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" }, "typeName": { "id": 159067, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 159066, "name": "IHyperdrive", "nameLocations": ["1401:11:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 11143, "src": "1401:11:237" }, "referencedDeclaration": 11143, "src": "1401:11:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "visibility": "internal" }], "src": "1391:39:237" }, "returnParameters": { "id": 159072, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159071, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 159083, "src": "1454:7:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159070, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "1454:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "1453:9:237" }, "scope": 161566, "stateMutability": "view", "virtual": false, "visibility": "internal" }, { "id": 159128, "nodeType": "FunctionDefinition", "src": "1627:638:237", "nodes": [], "body": { "id": 159127, "nodeType": "Block", "src": "1726:539:237", "nodes": [], "statements": [{ "assignments": [159096], "declarations": [{ "constant": false, "id": 159096, "mutability": "mutable", "name": "poolConfig", "nameLocation": "1766:10:237", "nodeType": "VariableDeclaration", "scope": 159127, "src": "1736:40:237", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig" }, "typeName": { "id": 159095, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 159094, "name": "IHyperdrive.PoolConfig", "nameLocations": ["1736:11:237", "1748:10:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 10934, "src": "1736:22:237" }, "referencedDeclaration": 10934, "src": "1736:22:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_storage_ptr", "typeString": "struct IHyperdrive.PoolConfig" } }, "visibility": "internal" }], "id": 159100, "initialValue": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 159097, "name": "_hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159087, "src": "1779:11:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "id": 159098, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "1791:13:237", "memberName": "getPoolConfig", "nodeType": "MemberAccess", "referencedDeclaration": 11941, "src": "1779:25:237", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolConfig_$10934_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolConfig memory)" } }, "id": 159099, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "1779:27:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "nodeType": "VariableDeclarationStatement", "src": "1736:70:237" }, { "assignments": [159105], "declarations": [{ "constant": false, "id": 159105, "mutability": "mutable", "name": "poolInfo", "nameLocation": "1844:8:237", "nodeType": "VariableDeclaration", "scope": 159127, "src": "1816:36:237", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo" }, "typeName": { "id": 159104, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 159103, "name": "IHyperdrive.PoolInfo", "nameLocations": ["1816:11:237", "1828:8:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 10980, "src": "1816:20:237" }, "referencedDeclaration": 10980, "src": "1816:20:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_storage_ptr", "typeString": "struct IHyperdrive.PoolInfo" } }, "visibility": "internal" }], "id": 159109, "initialValue": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 159106, "name": "_hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159087, "src": "1855:11:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "id": 159107, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "1867:11:237", "memberName": "getPoolInfo", "nodeType": "MemberAccess", "referencedDeclaration": 11948, "src": "1855:23:237", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolInfo_$10980_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolInfo memory)" } }, "id": 159108, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "1855:25:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "nodeType": "VariableDeclarationStatement", "src": "1816:64:237" }, { "expression": { "arguments": [{ "arguments": [{ "expression": { "id": 159114, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159105, "src": "2028:8:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 159115, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "2037:13:237", "memberName": "shareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 10937, "src": "2028:22:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159116, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159105, "src": "2072:8:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 159117, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "2081:15:237", "memberName": "shareAdjustment", "nodeType": "MemberAccess", "referencedDeclaration": 10940, "src": "2072:24:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_int256", "typeString": "int256" }], "expression": { "id": 159112, "name": "HyperdriveMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20320, "src": "1960:14:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_HyperdriveMath_$20320_$", "typeString": "type(library HyperdriveMath)" } }, "id": 159113, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "1975:31:237", "memberName": "calculateEffectiveShareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 19763, "src": "1960:46:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_int256_$returns$_t_uint256_$", "typeString": "function (uint256,int256) pure returns (uint256)" } }, "id": 159118, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "1960:154:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159119, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159105, "src": "2132:8:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 159120, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "2141:12:237", "memberName": "bondReserves", "nodeType": "MemberAccess", "referencedDeclaration": 10949, "src": "2132:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159121, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159096, "src": "2171:10:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 159122, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "2182:22:237", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 10905, "src": "2171:33:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159123, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159096, "src": "2222:10:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 159124, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "2233:11:237", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 10920, "src": "2222:22:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159110, "name": "HyperdriveMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20320, "src": "1909:14:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_HyperdriveMath_$20320_$", "typeString": "type(library HyperdriveMath)" } }, "id": 159111, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "1924:18:237", "memberName": "calculateSpotPrice", "nodeType": "MemberAccess", "referencedDeclaration": 19690, "src": "1909:33:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256,uint256) pure returns (uint256)" } }, "id": 159125, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "1909:349:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 159091, "id": 159126, "nodeType": "Return", "src": "1890:368:237" }] }, "documentation": { "id": 159084, "nodeType": "StructuredDocumentation", "src": "1593:29:237", "text": "Price and Rate Utils ///" }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateSpotPrice", "nameLocation": "1636:18:237", "parameters": { "id": 159088, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159087, "mutability": "mutable", "name": "_hyperdrive", "nameLocation": "1676:11:237", "nodeType": "VariableDeclaration", "scope": 159128, "src": "1664:23:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" }, "typeName": { "id": 159086, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 159085, "name": "IHyperdrive", "nameLocations": ["1664:11:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 11143, "src": "1664:11:237" }, "referencedDeclaration": 11143, "src": "1664:11:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "visibility": "internal" }], "src": "1654:39:237" }, "returnParameters": { "id": 159091, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159090, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 159128, "src": "1717:7:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159089, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "1717:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "1716:9:237" }, "scope": 161566, "stateMutability": "view", "virtual": false, "visibility": "internal" }, { "id": 159174, "nodeType": "FunctionDefinition", "src": "2271:679:237", "nodes": [], "body": { "id": 159173, "nodeType": "Block", "src": "2368:582:237", "nodes": [], "statements": [{ "assignments": [159140], "declarations": [{ "constant": false, "id": 159140, "mutability": "mutable", "name": "poolConfig", "nameLocation": "2408:10:237", "nodeType": "VariableDeclaration", "scope": 159173, "src": "2378:40:237", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig" }, "typeName": { "id": 159139, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 159138, "name": "IHyperdrive.PoolConfig", "nameLocations": ["2378:11:237", "2390:10:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 10934, "src": "2378:22:237" }, "referencedDeclaration": 10934, "src": "2378:22:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_storage_ptr", "typeString": "struct IHyperdrive.PoolConfig" } }, "visibility": "internal" }], "id": 159144, "initialValue": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 159141, "name": "_hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159131, "src": "2421:11:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "id": 159142, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "2433:13:237", "memberName": "getPoolConfig", "nodeType": "MemberAccess", "referencedDeclaration": 11941, "src": "2421:25:237", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolConfig_$10934_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolConfig memory)" } }, "id": 159143, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "2421:27:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "nodeType": "VariableDeclarationStatement", "src": "2378:70:237" }, { "assignments": [159149], "declarations": [{ "constant": false, "id": 159149, "mutability": "mutable", "name": "poolInfo", "nameLocation": "2486:8:237", "nodeType": "VariableDeclaration", "scope": 159173, "src": "2458:36:237", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo" }, "typeName": { "id": 159148, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 159147, "name": "IHyperdrive.PoolInfo", "nameLocations": ["2458:11:237", "2470:8:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 10980, "src": "2458:20:237" }, "referencedDeclaration": 10980, "src": "2458:20:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_storage_ptr", "typeString": "struct IHyperdrive.PoolInfo" } }, "visibility": "internal" }], "id": 159153, "initialValue": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 159150, "name": "_hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159131, "src": "2497:11:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "id": 159151, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "2509:11:237", "memberName": "getPoolInfo", "nodeType": "MemberAccess", "referencedDeclaration": 11948, "src": "2497:23:237", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolInfo_$10980_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolInfo memory)" } }, "id": 159152, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "2497:25:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "nodeType": "VariableDeclarationStatement", "src": "2458:64:237" }, { "expression": { "arguments": [{ "arguments": [{ "expression": { "id": 159158, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159149, "src": "2668:8:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 159159, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "2677:13:237", "memberName": "shareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 10937, "src": "2668:22:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159160, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159149, "src": "2712:8:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 159161, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "2721:15:237", "memberName": "shareAdjustment", "nodeType": "MemberAccess", "referencedDeclaration": 10940, "src": "2712:24:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_int256", "typeString": "int256" }], "expression": { "id": 159156, "name": "HyperdriveMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20320, "src": "2600:14:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_HyperdriveMath_$20320_$", "typeString": "type(library HyperdriveMath)" } }, "id": 159157, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "2615:31:237", "memberName": "calculateEffectiveShareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 19763, "src": "2600:46:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_int256_$returns$_t_uint256_$", "typeString": "function (uint256,int256) pure returns (uint256)" } }, "id": 159162, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "2600:154:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159163, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159149, "src": "2772:8:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 159164, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "2781:12:237", "memberName": "bondReserves", "nodeType": "MemberAccess", "referencedDeclaration": 10949, "src": "2772:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159165, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159140, "src": "2811:10:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 159166, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "2822:22:237", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 10905, "src": "2811:33:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159167, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159140, "src": "2862:10:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 159168, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "2873:16:237", "memberName": "positionDuration", "nodeType": "MemberAccess", "referencedDeclaration": 10914, "src": "2862:27:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159169, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159140, "src": "2907:10:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 159170, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "2918:11:237", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 10920, "src": "2907:22:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159154, "name": "HyperdriveMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20320, "src": "2551:14:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_HyperdriveMath_$20320_$", "typeString": "type(library HyperdriveMath)" } }, "id": 159155, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "2566:16:237", "memberName": "calculateSpotAPR", "nodeType": "MemberAccess", "referencedDeclaration": 19728, "src": "2551:31:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256,uint256,uint256) pure returns (uint256)" } }, "id": 159171, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "2551:392:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 159135, "id": 159172, "nodeType": "Return", "src": "2532:411:237" }] }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateSpotAPR", "nameLocation": "2280:16:237", "parameters": { "id": 159132, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159131, "mutability": "mutable", "name": "_hyperdrive", "nameLocation": "2318:11:237", "nodeType": "VariableDeclaration", "scope": 159174, "src": "2306:23:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" }, "typeName": { "id": 159130, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 159129, "name": "IHyperdrive", "nameLocations": ["2306:11:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 11143, "src": "2306:11:237" }, "referencedDeclaration": 11143, "src": "2306:11:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "visibility": "internal" }], "src": "2296:39:237" }, "returnParameters": { "id": 159135, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159134, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 159174, "src": "2359:7:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159133, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "2359:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "2358:9:237" }, "scope": 161566, "stateMutability": "view", "virtual": false, "visibility": "internal" }, { "id": 159208, "nodeType": "FunctionDefinition", "src": "2956:603:237", "nodes": [], "body": { "id": 159207, "nodeType": "Block", "src": "3120:439:237", "nodes": [], "statements": [{ "expression": { "arguments": [{ "commonType": { "typeIdentifier": "t_bool", "typeString": "bool" }, "id": 159192, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159188, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159186, "name": "timeRemaining", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159180, "src": "3324:13:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "<=", "rightExpression": { "hexValue": "31653138", "id": 159187, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "3341:4:237", "typeDescriptions": { "typeIdentifier": "t_rational_1000000000000000000_by_1", "typeString": "int_const 1000000000000000000" }, "value": "1e18" }, "src": "3324:21:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "nodeType": "BinaryOperation", "operator": "&&", "rightExpression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159191, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159189, "name": "timeRemaining", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159180, "src": "3349:13:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": ">", "rightExpression": { "hexValue": "30", "id": 159190, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "3365:1:237", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }, "src": "3349:17:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "src": "3324:42:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, { "hexValue": "457870656374696e67204e6f726d616c697a656454696d6552656d61696e696e67", "id": 159193, "isConstant": false, "isLValue": false, "isPure": true, "kind": "string", "lValueRequested": false, "nodeType": "Literal", "src": "3380:35:237", "typeDescriptions": { "typeIdentifier": "t_stringliteral_f6bed8350536a611c3f5aa1607d036e667248cfc544b671ec115b04e29d87c30", "typeString": "literal_string \"Expecting NormalizedTimeRemaining\"" }, "value": "Expecting NormalizedTimeRemaining" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_bool", "typeString": "bool" }, { "typeIdentifier": "t_stringliteral_f6bed8350536a611c3f5aa1607d036e667248cfc544b671ec115b04e29d87c30", "typeString": "literal_string \"Expecting NormalizedTimeRemaining\"" }], "id": 159185, "name": "require", "nodeType": "Identifier", "overloadedDeclarations": [-18, -18], "referencedDeclaration": -18, "src": "3303:7:237", "typeDescriptions": { "typeIdentifier": "t_function_require_pure$_t_bool_$_t_string_memory_ptr_$returns$__$", "typeString": "function (bool,string memory) pure" } }, "id": 159194, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "3303:122:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_tuple$__$", "typeString": "tuple()" } }, "id": 159195, "nodeType": "ExpressionStatement", "src": "3303:122:237" }, { "expression": { "arguments": [{ "arguments": [{ "id": 159203, "name": "timeRemaining", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159180, "src": "3524:13:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159201, "name": "baseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159176, "src": "3505:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159202, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "3516:7:237", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "3505:18:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159204, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "3505:33:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159198, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159196, "name": "bondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159178, "src": "3455:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 159197, "name": "baseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159176, "src": "3468:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "3455:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 159199, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "3454:25:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159200, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "3480:7:237", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "3454:33:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159205, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "3454:98:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 159184, "id": 159206, "nodeType": "Return", "src": "3435:117:237" }] }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateAPRFromRealizedPrice", "nameLocation": "2965:29:237", "parameters": { "id": 159181, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159176, "mutability": "mutable", "name": "baseAmount", "nameLocation": "3012:10:237", "nodeType": "VariableDeclaration", "scope": 159208, "src": "3004:18:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159175, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "3004:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159178, "mutability": "mutable", "name": "bondAmount", "nameLocation": "3040:10:237", "nodeType": "VariableDeclaration", "scope": 159208, "src": "3032:18:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159177, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "3032:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159180, "mutability": "mutable", "name": "timeRemaining", "nameLocation": "3068:13:237", "nodeType": "VariableDeclaration", "scope": 159208, "src": "3060:21:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159179, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "3060:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "2994:93:237" }, "returnParameters": { "id": 159184, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159183, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 159208, "src": "3111:7:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159182, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "3111:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "3110:9:237" }, "scope": 161566, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 159281, "nodeType": "FunctionDefinition", "src": "3957:602:237", "nodes": [], "body": { "id": 159280, "nodeType": "Block", "src": "4123:436:237", "nodes": [], "statements": [{ "assignments": [159223], "declarations": [{ "constant": false, "id": 159223, "mutability": "mutable", "name": "normalizedTime", "nameLocation": "4188:14:237", "nodeType": "VariableDeclaration", "scope": 159280, "src": "4180:22:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159222, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "4180:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 159228, "initialValue": { "arguments": [{ "hexValue": "333635", "id": 159226, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "4219:8:237", "subdenomination": "days", "typeDescriptions": { "typeIdentifier": "t_rational_31536000_by_1", "typeString": "int_const 31536000" }, "value": "365" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_rational_31536000_by_1", "typeString": "int_const 31536000" }], "expression": { "id": 159224, "name": "_time", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159215, "src": "4205:5:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159225, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "4211:7:237", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "4205:13:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159227, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "4205:23:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "4180:48:237" }, { "expression": { "id": 159262, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 159229, "name": "interest", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159220, "src": "4238:8:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "condition": { "commonType": { "typeIdentifier": "t_int256", "typeString": "int256" }, "id": 159232, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159230, "name": "_apr", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159213, "src": "4249:4:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "nodeType": "BinaryOperation", "operator": ">=", "rightExpression": { "hexValue": "30", "id": 159231, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "4257:1:237", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }, "src": "4249:9:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "falseExpression": { "id": 159260, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "UnaryOperation", "operator": "-", "prefix": true, "src": "4353:97:237", "subExpression": { "arguments": [{ "arguments": [{ "arguments": [{ "id": 159256, "name": "normalizedTime", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159223, "src": "4420:14:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "id": 159253, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "UnaryOperation", "operator": "-", "prefix": true, "src": "4405:5:237", "subExpression": { "id": 159252, "name": "_apr", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159213, "src": "4406:4:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 159251, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "4397:7:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_uint256_$", "typeString": "type(uint256)" }, "typeName": { "id": 159250, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "4397:7:237", "typeDescriptions": {} } }, "id": 159254, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "4397:14:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159255, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "4412:7:237", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "4397:22:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159257, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "4397:38:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159248, "name": "_principal", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159211, "src": "4378:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159249, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "4389:7:237", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "4378:18:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159258, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "4378:58:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159247, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "4354:6:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_int256_$", "typeString": "type(int256)" }, "typeName": { "id": 159246, "name": "int256", "nodeType": "ElementaryTypeName", "src": "4354:6:237", "typeDescriptions": {} } }, "id": 159259, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "4354:96:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "id": 159261, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "Conditional", "src": "4249:201:237", "trueExpression": { "arguments": [{ "arguments": [{ "arguments": [{ "id": 159242, "name": "normalizedTime", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159223, "src": "4321:14:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "id": 159239, "name": "_apr", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159213, "src": "4307:4:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 159238, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "4299:7:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_uint256_$", "typeString": "type(uint256)" }, "typeName": { "id": 159237, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "4299:7:237", "typeDescriptions": {} } }, "id": 159240, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "4299:13:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159241, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "4313:7:237", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "4299:21:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159243, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "4299:37:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159235, "name": "_principal", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159211, "src": "4280:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159236, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "4291:7:237", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "4280:18:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159244, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "4280:57:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159234, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "4273:6:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_int256_$", "typeString": "type(int256)" }, "typeName": { "id": 159233, "name": "int256", "nodeType": "ElementaryTypeName", "src": "4273:6:237", "typeDescriptions": {} } }, "id": 159245, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "4273:65:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "src": "4238:212:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "id": 159263, "nodeType": "ExpressionStatement", "src": "4238:212:237" }, { "expression": { "id": 159274, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 159264, "name": "totalAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159218, "src": "4460:11:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "commonType": { "typeIdentifier": "t_int256", "typeString": "int256" }, "id": 159272, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "arguments": [{ "id": 159269, "name": "_principal", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159211, "src": "4489:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159268, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "4482:6:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_int256_$", "typeString": "type(int256)" }, "typeName": { "id": 159267, "name": "int256", "nodeType": "ElementaryTypeName", "src": "4482:6:237", "typeDescriptions": {} } }, "id": 159270, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "4482:18:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "id": 159271, "name": "interest", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159220, "src": "4503:8:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "src": "4482:29:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 159266, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "4474:7:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_uint256_$", "typeString": "type(uint256)" }, "typeName": { "id": 159265, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "4474:7:237", "typeDescriptions": {} } }, "id": 159273, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "4474:38:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "4460:52:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159275, "nodeType": "ExpressionStatement", "src": "4460:52:237" }, { "expression": { "components": [{ "id": 159276, "name": "totalAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159218, "src": "4530:11:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159277, "name": "interest", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159220, "src": "4543:8:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "id": 159278, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "4529:23:237", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_int256_$", "typeString": "tuple(uint256,int256)" } }, "functionReturnParameters": 159221, "id": 159279, "nodeType": "Return", "src": "4522:30:237" }] }, "documentation": { "id": 159209, "nodeType": "StructuredDocumentation", "src": "3565:387:237", "text": "@dev Calculates the non-compounded interest over a period.\n @param _principal The principal amount that will accrue interest.\n @param _apr Annual percentage rate\n @param _time Amount of time in seconds over which interest accrues.\n @return totalAmount The total amount of capital after interest accrues.\n @return interest The interest that accrued." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateInterest", "nameLocation": "3966:17:237", "parameters": { "id": 159216, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159211, "mutability": "mutable", "name": "_principal", "nameLocation": "4001:10:237", "nodeType": "VariableDeclaration", "scope": 159281, "src": "3993:18:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159210, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "3993:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159213, "mutability": "mutable", "name": "_apr", "nameLocation": "4028:4:237", "nodeType": "VariableDeclaration", "scope": 159281, "src": "4021:11:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" }, "typeName": { "id": 159212, "name": "int256", "nodeType": "ElementaryTypeName", "src": "4021:6:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "visibility": "internal" }, { "constant": false, "id": 159215, "mutability": "mutable", "name": "_time", "nameLocation": "4050:5:237", "nodeType": "VariableDeclaration", "scope": 159281, "src": "4042:13:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159214, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "4042:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "3983:78:237" }, "returnParameters": { "id": 159221, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159218, "mutability": "mutable", "name": "totalAmount", "nameLocation": "4093:11:237", "nodeType": "VariableDeclaration", "scope": 159281, "src": "4085:19:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159217, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "4085:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159220, "mutability": "mutable", "name": "interest", "nameLocation": "4113:8:237", "nodeType": "VariableDeclaration", "scope": 159281, "src": "4106:15:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" }, "typeName": { "id": 159219, "name": "int256", "nodeType": "ElementaryTypeName", "src": "4106:6:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "visibility": "internal" }], "src": "4084:38:237" }, "scope": 161566, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 159394, "nodeType": "FunctionDefinition", "src": "4992:1056:237", "nodes": [], "body": { "id": 159393, "nodeType": "Block", "src": "5167:881:237", "nodes": [], "statements": [{ "assignments": [159296], "declarations": [{ "constant": false, "id": 159296, "mutability": "mutable", "name": "normalizedTime", "nameLocation": "5232:14:237", "nodeType": "VariableDeclaration", "scope": 159393, "src": "5224:22:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159295, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "5224:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 159301, "initialValue": { "arguments": [{ "hexValue": "333635", "id": 159299, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "5263:8:237", "subdenomination": "days", "typeDescriptions": { "typeIdentifier": "t_rational_31536000_by_1", "typeString": "int_const 31536000" }, "value": "365" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_rational_31536000_by_1", "typeString": "int_const 31536000" }], "expression": { "id": 159297, "name": "_time", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159288, "src": "5249:5:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159298, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "5255:7:237", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "5249:13:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159300, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "5249:23:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "5224:48:237" }, { "assignments": [159303], "declarations": [{ "constant": false, "id": 159303, "mutability": "mutable", "name": "rt", "nameLocation": "5290:2:237", "nodeType": "VariableDeclaration", "scope": 159393, "src": "5282:10:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159302, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "5282:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 159317, "initialValue": { "arguments": [{ "id": 159315, "name": "normalizedTime", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159296, "src": "5352:14:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "condition": { "commonType": { "typeIdentifier": "t_int256", "typeString": "int256" }, "id": 159308, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159306, "name": "_rate", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159286, "src": "5303:5:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "nodeType": "BinaryOperation", "operator": "<", "rightExpression": { "hexValue": "30", "id": 159307, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "5311:1:237", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }, "src": "5303:9:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "falseExpression": { "id": 159311, "name": "_rate", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159286, "src": "5324:5:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "id": 159312, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "Conditional", "src": "5303:26:237", "trueExpression": { "id": 159310, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "UnaryOperation", "operator": "-", "prefix": true, "src": "5315:6:237", "subExpression": { "id": 159309, "name": "_rate", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159286, "src": "5316:5:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 159305, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "5295:7:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_uint256_$", "typeString": "type(uint256)" }, "typeName": { "id": 159304, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "5295:7:237", "typeDescriptions": {} } }, "id": 159313, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "5295:35:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159314, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "5331:7:237", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "5295:43:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159316, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "5295:81:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "5282:94:237" }, { "condition": { "commonType": { "typeIdentifier": "t_int256", "typeString": "int256" }, "id": 159320, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159318, "name": "_rate", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159286, "src": "5391:5:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "nodeType": "BinaryOperation", "operator": ">", "rightExpression": { "hexValue": "30", "id": 159319, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "5399:1:237", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }, "src": "5391:9:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "falseBody": { "condition": { "commonType": { "typeIdentifier": "t_int256", "typeString": "int256" }, "id": 159353, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159351, "name": "_rate", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159286, "src": "5641:5:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "nodeType": "BinaryOperation", "operator": "<", "rightExpression": { "hexValue": "30", "id": 159352, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "5649:1:237", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }, "src": "5641:9:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "id": 159387, "nodeType": "IfStatement", "src": "5637:373:237", "trueBody": { "id": 159386, "nodeType": "Block", "src": "5652:358:237", "statements": [{ "expression": { "id": 159368, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 159354, "name": "totalAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159291, "src": "5787:11:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "arguments": [{ "arguments": [{ "arguments": [{ "id": 159363, "name": "rt", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159303, "src": "5871:2:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159362, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "5864:6:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_int256_$", "typeString": "type(int256)" }, "typeName": { "id": 159361, "name": "int256", "nodeType": "ElementaryTypeName", "src": "5864:6:237", "typeDescriptions": {} } }, "id": 159364, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "5864:10:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_int256", "typeString": "int256" }], "expression": { "id": 159359, "name": "FixedPointMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19572, "src": "5845:14:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_FixedPointMath_$19572_$", "typeString": "type(library FixedPointMath)" } }, "id": 159360, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "5860:3:237", "memberName": "exp", "nodeType": "MemberAccess", "referencedDeclaration": 19174, "src": "5845:18:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_int256_$returns$_t_int256_$", "typeString": "function (int256) pure returns (int256)" } }, "id": 159365, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "5845:30:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 159358, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "5837:7:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_uint256_$", "typeString": "type(uint256)" }, "typeName": { "id": 159357, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "5837:7:237", "typeDescriptions": {} } }, "id": 159366, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "5837:39:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159355, "name": "_principal", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159284, "src": "5801:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159356, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "5812:7:237", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "5801:18:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159367, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "5801:89:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "5787:103:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159369, "nodeType": "ExpressionStatement", "src": "5787:103:237" }, { "expression": { "id": 159380, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 159370, "name": "interest", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159293, "src": "5904:8:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "commonType": { "typeIdentifier": "t_int256", "typeString": "int256" }, "id": 159379, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "arguments": [{ "id": 159373, "name": "totalAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159291, "src": "5922:11:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159372, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "5915:6:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_int256_$", "typeString": "type(int256)" }, "typeName": { "id": 159371, "name": "int256", "nodeType": "ElementaryTypeName", "src": "5915:6:237", "typeDescriptions": {} } }, "id": 159374, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "5915:19:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [{ "id": 159377, "name": "_principal", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159284, "src": "5944:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159376, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "5937:6:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_int256_$", "typeString": "type(int256)" }, "typeName": { "id": 159375, "name": "int256", "nodeType": "ElementaryTypeName", "src": "5937:6:237", "typeDescriptions": {} } }, "id": 159378, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "5937:18:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "src": "5915:40:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "src": "5904:51:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "id": 159381, "nodeType": "ExpressionStatement", "src": "5904:51:237" }, { "expression": { "components": [{ "id": 159382, "name": "totalAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159291, "src": "5977:11:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159383, "name": "interest", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159293, "src": "5990:8:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "id": 159384, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "5976:23:237", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_int256_$", "typeString": "tuple(uint256,int256)" } }, "functionReturnParameters": 159294, "id": 159385, "nodeType": "Return", "src": "5969:30:237" }] } }, "id": 159388, "nodeType": "IfStatement", "src": "5387:623:237", "trueBody": { "id": 159350, "nodeType": "Block", "src": "5402:229:237", "statements": [{ "expression": { "id": 159335, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 159321, "name": "totalAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159291, "src": "5416:11:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "arguments": [{ "arguments": [{ "arguments": [{ "id": 159330, "name": "rt", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159303, "src": "5500:2:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159329, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "5493:6:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_int256_$", "typeString": "type(int256)" }, "typeName": { "id": 159328, "name": "int256", "nodeType": "ElementaryTypeName", "src": "5493:6:237", "typeDescriptions": {} } }, "id": 159331, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "5493:10:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_int256", "typeString": "int256" }], "expression": { "id": 159326, "name": "FixedPointMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19572, "src": "5474:14:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_FixedPointMath_$19572_$", "typeString": "type(library FixedPointMath)" } }, "id": 159327, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "5489:3:237", "memberName": "exp", "nodeType": "MemberAccess", "referencedDeclaration": 19174, "src": "5474:18:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_int256_$returns$_t_int256_$", "typeString": "function (int256) pure returns (int256)" } }, "id": 159332, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "5474:30:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 159325, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "5466:7:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_uint256_$", "typeString": "type(uint256)" }, "typeName": { "id": 159324, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "5466:7:237", "typeDescriptions": {} } }, "id": 159333, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "5466:39:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159322, "name": "_principal", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159284, "src": "5430:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159323, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "5441:7:237", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "5430:18:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159334, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "5430:89:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "5416:103:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159336, "nodeType": "ExpressionStatement", "src": "5416:103:237" }, { "expression": { "id": 159344, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 159337, "name": "interest", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159293, "src": "5533:8:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159342, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159340, "name": "totalAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159291, "src": "5551:11:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 159341, "name": "_principal", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159284, "src": "5565:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "5551:24:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159339, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "5544:6:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_int256_$", "typeString": "type(int256)" }, "typeName": { "id": 159338, "name": "int256", "nodeType": "ElementaryTypeName", "src": "5544:6:237", "typeDescriptions": {} } }, "id": 159343, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "5544:32:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "src": "5533:43:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "id": 159345, "nodeType": "ExpressionStatement", "src": "5533:43:237" }, { "expression": { "components": [{ "id": 159346, "name": "totalAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159291, "src": "5598:11:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159347, "name": "interest", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159293, "src": "5611:8:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "id": 159348, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "5597:23:237", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_int256_$", "typeString": "tuple(uint256,int256)" } }, "functionReturnParameters": 159294, "id": 159349, "nodeType": "Return", "src": "5590:30:237" }] } }, { "expression": { "components": [{ "id": 159389, "name": "_principal", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159284, "src": "6027:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "hexValue": "30", "id": 159390, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "6039:1:237", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }], "id": 159391, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "6026:15:237", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_rational_0_by_1_$", "typeString": "tuple(uint256,int_const 0)" } }, "functionReturnParameters": 159294, "id": 159392, "nodeType": "Return", "src": "6019:22:237" }] }, "documentation": { "id": 159282, "nodeType": "StructuredDocumentation", "src": "4565:422:237", "text": "@dev Calculates principal + compounded rate of interest over a period\n      principal * e ^ (rate * time)\n @param _principal The initial amount interest will be accrued on\n @param _rate Interest rate\n @param _time Number of seconds compounding will occur for\n @return totalAmount The total amount of capital after interest accrues.\n @return interest The interest that accrued." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateCompoundInterest", "nameLocation": "5001:25:237", "parameters": { "id": 159289, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159284, "mutability": "mutable", "name": "_principal", "nameLocation": "5044:10:237", "nodeType": "VariableDeclaration", "scope": 159394, "src": "5036:18:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159283, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "5036:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159286, "mutability": "mutable", "name": "_rate", "nameLocation": "5071:5:237", "nodeType": "VariableDeclaration", "scope": 159394, "src": "5064:12:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" }, "typeName": { "id": 159285, "name": "int256", "nodeType": "ElementaryTypeName", "src": "5064:6:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "visibility": "internal" }, { "constant": false, "id": 159288, "mutability": "mutable", "name": "_time", "nameLocation": "5094:5:237", "nodeType": "VariableDeclaration", "scope": 159394, "src": "5086:13:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159287, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "5086:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "5026:79:237" }, "returnParameters": { "id": 159294, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159291, "mutability": "mutable", "name": "totalAmount", "nameLocation": "5137:11:237", "nodeType": "VariableDeclaration", "scope": 159394, "src": "5129:19:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159290, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "5129:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159293, "mutability": "mutable", "name": "interest", "nameLocation": "5157:8:237", "nodeType": "VariableDeclaration", "scope": 159394, "src": "5150:15:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" }, "typeName": { "id": 159292, "name": "int256", "nodeType": "ElementaryTypeName", "src": "5150:6:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "visibility": "internal" }], "src": "5128:38:237" }, "scope": 161566, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 159468, "nodeType": "FunctionDefinition", "src": "6347:1230:237", "nodes": [], "body": { "id": 159467, "nodeType": "Block", "src": "6487:1090:237", "nodes": [], "statements": [{ "assignments": [159409], "declarations": [{ "constant": false, "id": 159409, "mutability": "mutable", "name": "poolConfig", "nameLocation": "6527:10:237", "nodeType": "VariableDeclaration", "scope": 159467, "src": "6497:40:237", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig" }, "typeName": { "id": 159408, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 159407, "name": "IHyperdrive.PoolConfig", "nameLocations": ["6497:11:237", "6509:10:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 10934, "src": "6497:22:237" }, "referencedDeclaration": 10934, "src": "6497:22:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_storage_ptr", "typeString": "struct IHyperdrive.PoolConfig" } }, "visibility": "internal" }], "id": 159413, "initialValue": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 159410, "name": "_hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159398, "src": "6540:11:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "id": 159411, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "6552:13:237", "memberName": "getPoolConfig", "nodeType": "MemberAccess", "referencedDeclaration": 11941, "src": "6540:25:237", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolConfig_$10934_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolConfig memory)" } }, "id": 159412, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "6540:27:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "nodeType": "VariableDeclarationStatement", "src": "6497:70:237" }, { "assignments": [159418], "declarations": [{ "constant": false, "id": 159418, "mutability": "mutable", "name": "poolInfo", "nameLocation": "6605:8:237", "nodeType": "VariableDeclaration", "scope": 159467, "src": "6577:36:237", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo" }, "typeName": { "id": 159417, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 159416, "name": "IHyperdrive.PoolInfo", "nameLocations": ["6577:11:237", "6589:8:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 10980, "src": "6577:20:237" }, "referencedDeclaration": 10980, "src": "6577:20:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_storage_ptr", "typeString": "struct IHyperdrive.PoolInfo" } }, "visibility": "internal" }], "id": 159422, "initialValue": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 159419, "name": "_hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159398, "src": "6616:11:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "id": 159420, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "6628:11:237", "memberName": "getPoolInfo", "nodeType": "MemberAccess", "referencedDeclaration": 11948, "src": "6616:23:237", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolInfo_$10980_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolInfo memory)" } }, "id": 159421, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "6616:25:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "nodeType": "VariableDeclarationStatement", "src": "6577:64:237" }, { "expression": { "id": 159463, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "components": [{ "id": 159423, "name": "baseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159403, "src": "6652:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, null], "id": 159424, "isConstant": false, "isInlineArray": false, "isLValue": true, "isPure": false, "lValueRequested": true, "nodeType": "TupleExpression", "src": "6651:14:237", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$__$", "typeString": "tuple(uint256,)" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "arguments": [{ "expression": { "id": 159427, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159418, "src": "6746:8:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 159428, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "6755:13:237", "memberName": "shareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 10937, "src": "6746:22:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159429, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159418, "src": "6803:8:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 159430, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "6812:15:237", "memberName": "shareAdjustment", "nodeType": "MemberAccess", "referencedDeclaration": 10940, "src": "6803:24:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, { "expression": { "id": 159431, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159418, "src": "6859:8:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 159432, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "6868:12:237", "memberName": "bondReserves", "nodeType": "MemberAccess", "referencedDeclaration": 10949, "src": "6859:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159433, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159418, "src": "6916:8:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 159434, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "6925:16:237", "memberName": "longsOutstanding", "nodeType": "MemberAccess", "referencedDeclaration": 10958, "src": "6916:25:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159435, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159418, "src": "6973:8:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 159436, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "6982:12:237", "memberName": "longExposure", "nodeType": "MemberAccess", "referencedDeclaration": 10979, "src": "6973:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159437, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159409, "src": "7025:10:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 159438, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "7036:11:237", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 10920, "src": "7025:22:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159439, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159418, "src": "7082:8:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 159440, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "7091:15:237", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 10955, "src": "7082:24:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159441, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159409, "src": "7148:10:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 159442, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "7159:22:237", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 10905, "src": "7148:33:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159443, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159409, "src": "7221:10:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 159444, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "7232:20:237", "memberName": "minimumShareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 10908, "src": "7221:31:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "expression": { "id": 159445, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159409, "src": "7280:10:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 159446, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "7291:4:237", "memberName": "fees", "nodeType": "MemberAccess", "referencedDeclaration": 10933, "src": "7280:15:237", "typeDescriptions": { "typeIdentifier": "t_struct$_Fees_$10853_memory_ptr", "typeString": "struct IHyperdrive.Fees memory" } }, "id": 159447, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "7296:5:237", "memberName": "curve", "nodeType": "MemberAccess", "referencedDeclaration": 10843, "src": "7280:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "expression": { "id": 159448, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159409, "src": "7328:10:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 159449, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "7339:4:237", "memberName": "fees", "nodeType": "MemberAccess", "referencedDeclaration": 10933, "src": "7328:15:237", "typeDescriptions": { "typeIdentifier": "t_struct$_Fees_$10853_memory_ptr", "typeString": "struct IHyperdrive.Fees memory" } }, "id": 159450, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "7344:4:237", "memberName": "flat", "nodeType": "MemberAccess", "referencedDeclaration": 10846, "src": "7328:20:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "expression": { "id": 159451, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159409, "src": "7383:10:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 159452, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "7394:4:237", "memberName": "fees", "nodeType": "MemberAccess", "referencedDeclaration": 10933, "src": "7383:15:237", "typeDescriptions": { "typeIdentifier": "t_struct$_Fees_$10853_memory_ptr", "typeString": "struct IHyperdrive.Fees memory" } }, "id": 159453, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "7399:12:237", "memberName": "governanceLP", "nodeType": "MemberAccess", "referencedDeclaration": 10849, "src": "7383:28:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_int256", "typeString": "int256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159426, "name": "MaxTradeParams", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159592, "src": "6698:14:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_struct$_MaxTradeParams_$159592_storage_ptr_$", "typeString": "type(struct HyperdriveUtils.MaxTradeParams storage pointer)" } }, "id": 159454, "isConstant": false, "isLValue": false, "isPure": false, "kind": "structConstructorCall", "lValueRequested": false, "nameLocations": ["6731:13:237", "6786:15:237", "6845:12:237", "6898:16:237", "6959:12:237", "7012:11:237", "7065:15:237", "7124:22:237", "7199:20:237", "7270:8:237", "7319:7:237", "7366:15:237"], "names": ["shareReserves", "shareAdjustment", "bondReserves", "longsOutstanding", "longExposure", "timeStretch", "vaultSharePrice", "initialVaultSharePrice", "minimumShareReserves", "curveFee", "flatFee", "governanceLPFee"], "nodeType": "FunctionCall", "src": "6698:728:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, { "arguments": [{ "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 159457, "name": "_hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159398, "src": "7474:11:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "id": 159458, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "7486:16:237", "memberName": "latestCheckpoint", "nodeType": "MemberAccess", "referencedDeclaration": 159027, "src": "7474:28:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_view$_t_contract$_IHyperdrive_$11143_$returns$_t_uint256_$attached_to$_t_contract$_IHyperdrive_$11143_$", "typeString": "function (contract IHyperdrive) view returns (uint256)" } }, "id": 159459, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "7474:30:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159455, "name": "_hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159398, "src": "7440:11:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "id": 159456, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "7452:21:237", "memberName": "getCheckpointExposure", "nodeType": "MemberAccess", "referencedDeclaration": 11927, "src": "7440:33:237", "typeDescriptions": { "typeIdentifier": "t_function_external_view$_t_uint256_$returns$_t_int256_$", "typeString": "function (uint256) view external returns (int256)" } }, "id": 159460, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "7440:65:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, { "id": 159461, "name": "_maxIterations", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159400, "src": "7519:14:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" }, { "typeIdentifier": "t_int256", "typeString": "int256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159425, "name": "calculateMaxLong", "nodeType": "Identifier", "overloadedDeclarations": [159468, 159483, 159785], "referencedDeclaration": 159785, "src": "6668:16:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_MaxTradeParams_$159592_memory_ptr_$_t_int256_$_t_uint256_$returns$_t_uint256_$_t_uint256_$", "typeString": "function (struct HyperdriveUtils.MaxTradeParams memory,int256,uint256) pure returns (uint256,uint256)" } }, "id": 159462, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "6668:875:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_uint256_$", "typeString": "tuple(uint256,uint256)" } }, "src": "6651:892:237", "typeDescriptions": { "typeIdentifier": "t_tuple$__$", "typeString": "tuple()" } }, "id": 159464, "nodeType": "ExpressionStatement", "src": "6651:892:237" }, { "expression": { "id": 159465, "name": "baseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159403, "src": "7560:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 159404, "id": 159466, "nodeType": "Return", "src": "7553:17:237" }] }, "documentation": { "id": 159395, "nodeType": "StructuredDocumentation", "src": "6079:263:237", "text": "@dev Calculates the maximum amount of longs that can be opened.\n @param _hyperdrive A Hyperdrive instance.\n @param _maxIterations The maximum number of iterations to use.\n @return baseAmount The cost of buying the maximum amount of longs." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateMaxLong", "nameLocation": "6356:16:237", "parameters": { "id": 159401, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159398, "mutability": "mutable", "name": "_hyperdrive", "nameLocation": "6394:11:237", "nodeType": "VariableDeclaration", "scope": 159468, "src": "6382:23:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" }, "typeName": { "id": 159397, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 159396, "name": "IHyperdrive", "nameLocations": ["6382:11:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 11143, "src": "6382:11:237" }, "referencedDeclaration": 11143, "src": "6382:11:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "visibility": "internal" }, { "constant": false, "id": 159400, "mutability": "mutable", "name": "_maxIterations", "nameLocation": "6423:14:237", "nodeType": "VariableDeclaration", "scope": 159468, "src": "6415:22:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159399, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "6415:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "6372:71:237" }, "returnParameters": { "id": 159404, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159403, "mutability": "mutable", "name": "baseAmount", "nameLocation": "6475:10:237", "nodeType": "VariableDeclaration", "scope": 159468, "src": "6467:18:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159402, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "6467:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "6466:20:237" }, "scope": 161566, "stateMutability": "view", "virtual": false, "visibility": "internal" }, { "id": 159483, "nodeType": "FunctionDefinition", "src": "7780:164:237", "nodes": [], "body": { "id": 159482, "nodeType": "Block", "src": "7888:56:237", "nodes": [], "statements": [{ "expression": { "arguments": [{ "id": 159478, "name": "_hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159472, "src": "7922:11:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, { "hexValue": "37", "id": 159479, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "7935:1:237", "typeDescriptions": { "typeIdentifier": "t_rational_7_by_1", "typeString": "int_const 7" }, "value": "7" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" }, { "typeIdentifier": "t_rational_7_by_1", "typeString": "int_const 7" }], "id": 159477, "name": "calculateMaxLong", "nodeType": "Identifier", "overloadedDeclarations": [159468, 159483, 159785], "referencedDeclaration": 159468, "src": "7905:16:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_view$_t_contract$_IHyperdrive_$11143_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (contract IHyperdrive,uint256) view returns (uint256)" } }, "id": 159480, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "7905:32:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 159476, "id": 159481, "nodeType": "Return", "src": "7898:39:237" }] }, "documentation": { "id": 159469, "nodeType": "StructuredDocumentation", "src": "7583:192:237", "text": "@dev Calculates the maximum amount of longs that can be opened.\n @param _hyperdrive A Hyperdrive instance.\n @return baseAmount The cost of buying the maximum amount of longs." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateMaxLong", "nameLocation": "7789:16:237", "parameters": { "id": 159473, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159472, "mutability": "mutable", "name": "_hyperdrive", "nameLocation": "7827:11:237", "nodeType": "VariableDeclaration", "scope": 159483, "src": "7815:23:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" }, "typeName": { "id": 159471, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 159470, "name": "IHyperdrive", "nameLocations": ["7815:11:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 11143, "src": "7815:11:237" }, "referencedDeclaration": 11143, "src": "7815:11:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "visibility": "internal" }], "src": "7805:39:237" }, "returnParameters": { "id": 159476, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159475, "mutability": "mutable", "name": "baseAmount", "nameLocation": "7876:10:237", "nodeType": "VariableDeclaration", "scope": 159483, "src": "7868:18:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159474, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "7868:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "7867:20:237" }, "scope": 161566, "stateMutability": "view", "virtual": false, "visibility": "internal" }, { "id": 159552, "nodeType": "FunctionDefinition", "src": "8209:1302:237", "nodes": [], "body": { "id": 159551, "nodeType": "Block", "src": "8339:1172:237", "nodes": [], "statements": [{ "assignments": [159498], "declarations": [{ "constant": false, "id": 159498, "mutability": "mutable", "name": "poolConfig", "nameLocation": "8379:10:237", "nodeType": "VariableDeclaration", "scope": 159551, "src": "8349:40:237", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig" }, "typeName": { "id": 159497, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 159496, "name": "IHyperdrive.PoolConfig", "nameLocations": ["8349:11:237", "8361:10:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 10934, "src": "8349:22:237" }, "referencedDeclaration": 10934, "src": "8349:22:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_storage_ptr", "typeString": "struct IHyperdrive.PoolConfig" } }, "visibility": "internal" }], "id": 159502, "initialValue": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 159499, "name": "_hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159487, "src": "8392:11:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "id": 159500, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "8404:13:237", "memberName": "getPoolConfig", "nodeType": "MemberAccess", "referencedDeclaration": 11941, "src": "8392:25:237", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolConfig_$10934_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolConfig memory)" } }, "id": 159501, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "8392:27:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "nodeType": "VariableDeclarationStatement", "src": "8349:70:237" }, { "assignments": [159507], "declarations": [{ "constant": false, "id": 159507, "mutability": "mutable", "name": "poolInfo", "nameLocation": "8457:8:237", "nodeType": "VariableDeclaration", "scope": 159551, "src": "8429:36:237", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo" }, "typeName": { "id": 159506, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 159505, "name": "IHyperdrive.PoolInfo", "nameLocations": ["8429:11:237", "8441:8:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 10980, "src": "8429:20:237" }, "referencedDeclaration": 10980, "src": "8429:20:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_storage_ptr", "typeString": "struct IHyperdrive.PoolInfo" } }, "visibility": "internal" }], "id": 159511, "initialValue": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 159508, "name": "_hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159487, "src": "8468:11:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "id": 159509, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "8480:11:237", "memberName": "getPoolInfo", "nodeType": "MemberAccess", "referencedDeclaration": 11948, "src": "8468:23:237", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolInfo_$10980_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolInfo memory)" } }, "id": 159510, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "8468:25:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "nodeType": "VariableDeclarationStatement", "src": "8429:64:237" }, { "expression": { "arguments": [{ "arguments": [{ "expression": { "id": 159514, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159507, "src": "8609:8:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 159515, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "8618:13:237", "memberName": "shareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 10937, "src": "8609:22:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159516, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159507, "src": "8670:8:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 159517, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "8679:15:237", "memberName": "shareAdjustment", "nodeType": "MemberAccess", "referencedDeclaration": 10940, "src": "8670:24:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, { "expression": { "id": 159518, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159507, "src": "8730:8:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 159519, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "8739:12:237", "memberName": "bondReserves", "nodeType": "MemberAccess", "referencedDeclaration": 10949, "src": "8730:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159520, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159507, "src": "8791:8:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 159521, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "8800:16:237", "memberName": "longsOutstanding", "nodeType": "MemberAccess", "referencedDeclaration": 10958, "src": "8791:25:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159522, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159507, "src": "8852:8:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 159523, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "8861:12:237", "memberName": "longExposure", "nodeType": "MemberAccess", "referencedDeclaration": 10979, "src": "8852:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159524, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159498, "src": "8908:10:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 159525, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "8919:11:237", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 10920, "src": "8908:22:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159526, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159507, "src": "8969:8:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 159527, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "8978:15:237", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 10955, "src": "8969:24:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159528, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159498, "src": "9039:10:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 159529, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "9050:22:237", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 10905, "src": "9039:33:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159530, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159498, "src": "9116:10:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 159531, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "9127:20:237", "memberName": "minimumShareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 10908, "src": "9116:31:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "expression": { "id": 159532, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159498, "src": "9179:10:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 159533, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "9190:4:237", "memberName": "fees", "nodeType": "MemberAccess", "referencedDeclaration": 10933, "src": "9179:15:237", "typeDescriptions": { "typeIdentifier": "t_struct$_Fees_$10853_memory_ptr", "typeString": "struct IHyperdrive.Fees memory" } }, "id": 159534, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "9195:5:237", "memberName": "curve", "nodeType": "MemberAccess", "referencedDeclaration": 10843, "src": "9179:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "expression": { "id": 159535, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159498, "src": "9231:10:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 159536, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "9242:4:237", "memberName": "fees", "nodeType": "MemberAccess", "referencedDeclaration": 10933, "src": "9231:15:237", "typeDescriptions": { "typeIdentifier": "t_struct$_Fees_$10853_memory_ptr", "typeString": "struct IHyperdrive.Fees memory" } }, "id": 159537, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "9247:4:237", "memberName": "flat", "nodeType": "MemberAccess", "referencedDeclaration": 10846, "src": "9231:20:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "expression": { "id": 159538, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159498, "src": "9290:10:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 159539, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "9301:4:237", "memberName": "fees", "nodeType": "MemberAccess", "referencedDeclaration": 10933, "src": "9290:15:237", "typeDescriptions": { "typeIdentifier": "t_struct$_Fees_$10853_memory_ptr", "typeString": "struct IHyperdrive.Fees memory" } }, "id": 159540, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "9306:12:237", "memberName": "governanceLP", "nodeType": "MemberAccess", "referencedDeclaration": 10849, "src": "9290:28:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_int256", "typeString": "int256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159513, "name": "MaxTradeParams", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159592, "src": "8557:14:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_struct$_MaxTradeParams_$159592_storage_ptr_$", "typeString": "type(struct HyperdriveUtils.MaxTradeParams storage pointer)" } }, "id": 159541, "isConstant": false, "isLValue": false, "isPure": false, "kind": "structConstructorCall", "lValueRequested": false, "nameLocations": ["8594:13:237", "8653:15:237", "8716:12:237", "8773:16:237", "8838:12:237", "8895:11:237", "8952:15:237", "9015:22:237", "9094:20:237", "9169:8:237", "9222:7:237", "9273:15:237"], "names": ["shareReserves", "shareAdjustment", "bondReserves", "longsOutstanding", "longExposure", "timeStretch", "vaultSharePrice", "initialVaultSharePrice", "minimumShareReserves", "curveFee", "flatFee", "governanceLPFee"], "nodeType": "FunctionCall", "src": "8557:780:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, { "arguments": [{ "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 159544, "name": "_hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159487, "src": "9410:11:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "id": 159545, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "9422:16:237", "memberName": "latestCheckpoint", "nodeType": "MemberAccess", "referencedDeclaration": 159027, "src": "9410:28:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_view$_t_contract$_IHyperdrive_$11143_$returns$_t_uint256_$attached_to$_t_contract$_IHyperdrive_$11143_$", "typeString": "function (contract IHyperdrive) view returns (uint256)" } }, "id": 159546, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "9410:30:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159542, "name": "_hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159487, "src": "9355:11:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "id": 159543, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "9367:21:237", "memberName": "getCheckpointExposure", "nodeType": "MemberAccess", "referencedDeclaration": 11927, "src": "9355:33:237", "typeDescriptions": { "typeIdentifier": "t_function_external_view$_t_uint256_$returns$_t_int256_$", "typeString": "function (uint256) view external returns (int256)" } }, "id": 159547, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "9355:103:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, { "id": 159548, "name": "_maxIterations", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159489, "src": "9476:14:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" }, { "typeIdentifier": "t_int256", "typeString": "int256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159512, "name": "calculateMaxShort", "nodeType": "Identifier", "overloadedDeclarations": [159552, 159567, 160715], "referencedDeclaration": 160715, "src": "8522:17:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_MaxTradeParams_$159592_memory_ptr_$_t_int256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (struct HyperdriveUtils.MaxTradeParams memory,int256,uint256) pure returns (uint256)" } }, "id": 159549, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "8522:982:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 159493, "id": 159550, "nodeType": "Return", "src": "8503:1001:237" }] }, "documentation": { "id": 159484, "nodeType": "StructuredDocumentation", "src": "7950:254:237", "text": "@dev Calculates the maximum amount of shorts that can be opened.\n @param _hyperdrive A Hyperdrive instance.\n @param _maxIterations The maximum number of iterations to use.\n @return The maximum amount of bonds that can be shorted." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateMaxShort", "nameLocation": "8218:17:237", "parameters": { "id": 159490, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159487, "mutability": "mutable", "name": "_hyperdrive", "nameLocation": "8257:11:237", "nodeType": "VariableDeclaration", "scope": 159552, "src": "8245:23:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" }, "typeName": { "id": 159486, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 159485, "name": "IHyperdrive", "nameLocations": ["8245:11:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 11143, "src": "8245:11:237" }, "referencedDeclaration": 11143, "src": "8245:11:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "visibility": "internal" }, { "constant": false, "id": 159489, "mutability": "mutable", "name": "_maxIterations", "nameLocation": "8286:14:237", "nodeType": "VariableDeclaration", "scope": 159552, "src": "8278:22:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159488, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "8278:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "8235:71:237" }, "returnParameters": { "id": 159493, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159492, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 159552, "src": "8330:7:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159491, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "8330:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "8329:9:237" }, "scope": 161566, "stateMutability": "view", "virtual": false, "visibility": "internal" }, { "id": 159567, "nodeType": "FunctionDefinition", "src": "9705:155:237", "nodes": [], "body": { "id": 159566, "nodeType": "Block", "src": "9803:57:237", "nodes": [], "statements": [{ "expression": { "arguments": [{ "id": 159562, "name": "_hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159556, "src": "9838:11:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, { "hexValue": "37", "id": 159563, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "9851:1:237", "typeDescriptions": { "typeIdentifier": "t_rational_7_by_1", "typeString": "int_const 7" }, "value": "7" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" }, { "typeIdentifier": "t_rational_7_by_1", "typeString": "int_const 7" }], "id": 159561, "name": "calculateMaxShort", "nodeType": "Identifier", "overloadedDeclarations": [159552, 159567, 160715], "referencedDeclaration": 159552, "src": "9820:17:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_view$_t_contract$_IHyperdrive_$11143_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (contract IHyperdrive,uint256) view returns (uint256)" } }, "id": 159564, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "9820:33:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 159560, "id": 159565, "nodeType": "Return", "src": "9813:40:237" }] }, "documentation": { "id": 159553, "nodeType": "StructuredDocumentation", "src": "9517:183:237", "text": "@dev Calculates the maximum amount of shorts that can be opened.\n @param _hyperdrive A Hyperdrive instance.\n @return The maximum amount of bonds that can be shorted." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateMaxShort", "nameLocation": "9714:17:237", "parameters": { "id": 159557, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159556, "mutability": "mutable", "name": "_hyperdrive", "nameLocation": "9753:11:237", "nodeType": "VariableDeclaration", "scope": 159567, "src": "9741:23:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" }, "typeName": { "id": 159555, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 159554, "name": "IHyperdrive", "nameLocations": ["9741:11:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 11143, "src": "9741:11:237" }, "referencedDeclaration": 11143, "src": "9741:11:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "visibility": "internal" }], "src": "9731:39:237" }, "returnParameters": { "id": 159560, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159559, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 159567, "src": "9794:7:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159558, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "9794:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "9793:9:237" }, "scope": 161566, "stateMutability": "view", "virtual": false, "visibility": "internal" }, { "id": 159592, "nodeType": "StructDefinition", "src": "9866:410:237", "nodes": [], "canonicalName": "HyperdriveUtils.MaxTradeParams", "members": [{ "constant": false, "id": 159569, "mutability": "mutable", "name": "shareReserves", "nameLocation": "9906:13:237", "nodeType": "VariableDeclaration", "scope": 159592, "src": "9898:21:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159568, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "9898:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159571, "mutability": "mutable", "name": "shareAdjustment", "nameLocation": "9936:15:237", "nodeType": "VariableDeclaration", "scope": 159592, "src": "9929:22:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" }, "typeName": { "id": 159570, "name": "int256", "nodeType": "ElementaryTypeName", "src": "9929:6:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "visibility": "internal" }, { "constant": false, "id": 159573, "mutability": "mutable", "name": "bondReserves", "nameLocation": "9969:12:237", "nodeType": "VariableDeclaration", "scope": 159592, "src": "9961:20:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159572, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "9961:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159575, "mutability": "mutable", "name": "longsOutstanding", "nameLocation": "9999:16:237", "nodeType": "VariableDeclaration", "scope": 159592, "src": "9991:24:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159574, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "9991:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159577, "mutability": "mutable", "name": "longExposure", "nameLocation": "10033:12:237", "nodeType": "VariableDeclaration", "scope": 159592, "src": "10025:20:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159576, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "10025:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159579, "mutability": "mutable", "name": "timeStretch", "nameLocation": "10063:11:237", "nodeType": "VariableDeclaration", "scope": 159592, "src": "10055:19:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159578, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "10055:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159581, "mutability": "mutable", "name": "vaultSharePrice", "nameLocation": "10092:15:237", "nodeType": "VariableDeclaration", "scope": 159592, "src": "10084:23:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159580, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "10084:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159583, "mutability": "mutable", "name": "initialVaultSharePrice", "nameLocation": "10125:22:237", "nodeType": "VariableDeclaration", "scope": 159592, "src": "10117:30:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159582, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "10117:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159585, "mutability": "mutable", "name": "minimumShareReserves", "nameLocation": "10165:20:237", "nodeType": "VariableDeclaration", "scope": 159592, "src": "10157:28:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159584, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "10157:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159587, "mutability": "mutable", "name": "curveFee", "nameLocation": "10203:8:237", "nodeType": "VariableDeclaration", "scope": 159592, "src": "10195:16:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159586, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "10195:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159589, "mutability": "mutable", "name": "flatFee", "nameLocation": "10229:7:237", "nodeType": "VariableDeclaration", "scope": 159592, "src": "10221:15:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159588, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "10221:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159591, "mutability": "mutable", "name": "governanceLPFee", "nameLocation": "10254:15:237", "nodeType": "VariableDeclaration", "scope": 159592, "src": "10246:23:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159590, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "10246:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "name": "MaxTradeParams", "nameLocation": "9873:14:237", "scope": 161566, "visibility": "public" }, { "id": 159785, "nodeType": "FunctionDefinition", "src": "10963:5032:237", "nodes": [], "body": { "id": 159784, "nodeType": "Block", "src": "11171:4824:237", "nodes": [], "statements": [{ "assignments": [159608], "declarations": [{ "constant": false, "id": 159608, "mutability": "mutable", "name": "effectiveShareReserves", "nameLocation": "11330:22:237", "nodeType": "VariableDeclaration", "scope": 159784, "src": "11322:30:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159607, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "11322:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 159616, "initialValue": { "arguments": [{ "expression": { "id": 159611, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159596, "src": "11432:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159612, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "11440:13:237", "memberName": "shareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159569, "src": "11432:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159613, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159596, "src": "11471:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159614, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "11479:15:237", "memberName": "shareAdjustment", "nodeType": "MemberAccess", "referencedDeclaration": 159571, "src": "11471:23:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_int256", "typeString": "int256" }], "expression": { "id": 159609, "name": "HyperdriveMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20320, "src": "11355:14:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_HyperdriveMath_$20320_$", "typeString": "type(library HyperdriveMath)" } }, "id": 159610, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "11383:31:237", "memberName": "calculateEffectiveShareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 19763, "src": "11355:59:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_int256_$returns$_t_uint256_$", "typeString": "function (uint256,int256) pure returns (uint256)" } }, "id": 159615, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "11355:153:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "11322:186:237" }, { "assignments": [159618], "declarations": [{ "constant": false, "id": 159618, "mutability": "mutable", "name": "spotPrice", "nameLocation": "11526:9:237", "nodeType": "VariableDeclaration", "scope": 159784, "src": "11518:17:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159617, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "11518:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 159629, "initialValue": { "arguments": [{ "id": 159621, "name": "effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159608, "src": "11585:22:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159622, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159596, "src": "11621:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159623, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "11629:12:237", "memberName": "bondReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159573, "src": "11621:20:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159624, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159596, "src": "11655:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159625, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "11663:22:237", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159583, "src": "11655:30:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159626, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159596, "src": "11699:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159627, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "11707:11:237", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159579, "src": "11699:19:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159619, "name": "HyperdriveMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20320, "src": "11538:14:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_HyperdriveMath_$20320_$", "typeString": "type(library HyperdriveMath)" } }, "id": 159620, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "11553:18:237", "memberName": "calculateSpotPrice", "nodeType": "MemberAccess", "referencedDeclaration": 19690, "src": "11538:33:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256,uint256) pure returns (uint256)" } }, "id": 159628, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "11538:190:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "11518:210:237" }, { "assignments": [159631], "declarations": [{ "constant": false, "id": 159631, "mutability": "mutable", "name": "absoluteMaxBaseAmount", "nameLocation": "11746:21:237", "nodeType": "VariableDeclaration", "scope": 159784, "src": "11738:29:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159630, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "11738:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 159632, "nodeType": "VariableDeclarationStatement", "src": "11738:29:237" }, { "assignments": [159634], "declarations": [{ "constant": false, "id": 159634, "mutability": "mutable", "name": "absoluteMaxBondAmount", "nameLocation": "11785:21:237", "nodeType": "VariableDeclaration", "scope": 159784, "src": "11777:29:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159633, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "11777:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 159635, "nodeType": "VariableDeclarationStatement", "src": "11777:29:237" }, { "id": 159663, "nodeType": "Block", "src": "11816:608:237", "statements": [{ "expression": { "id": 159644, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "components": [{ "id": 159636, "name": "absoluteMaxBaseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159631, "src": "11848:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159637, "name": "absoluteMaxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159634, "src": "11887:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 159638, "isConstant": false, "isInlineArray": false, "isLValue": true, "isPure": false, "lValueRequested": true, "nodeType": "TupleExpression", "src": "11830:92:237", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_uint256_$", "typeString": "tuple(uint256,uint256)" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 159640, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159596, "src": "11967:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, { "id": 159641, "name": "effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159608, "src": "11992:22:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159642, "name": "spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159618, "src": "12032:9:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159639, "name": "calculateAbsoluteMaxLong", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159979, "src": "11925:24:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_MaxTradeParams_$159592_memory_ptr_$_t_uint256_$_t_uint256_$returns$_t_uint256_$_t_uint256_$", "typeString": "function (struct HyperdriveUtils.MaxTradeParams memory,uint256,uint256) pure returns (uint256,uint256)" } }, "id": 159643, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "11925:130:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_uint256_$", "typeString": "tuple(uint256,uint256)" } }, "src": "11830:225:237", "typeDescriptions": { "typeIdentifier": "t_tuple$__$", "typeString": "tuple()" } }, "id": 159645, "nodeType": "ExpressionStatement", "src": "11830:225:237" }, { "assignments": [null, 159647], "declarations": [null, { "constant": false, "id": 159647, "mutability": "mutable", "name": "isSolvent_", "nameLocation": "12077:10:237", "nodeType": "VariableDeclaration", "scope": 159663, "src": "12072:15:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "typeName": { "id": 159646, "name": "bool", "nodeType": "ElementaryTypeName", "src": "12072:4:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "visibility": "internal" }], "id": 159655, "initialValue": { "arguments": [{ "id": 159649, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159596, "src": "12135:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, { "id": 159650, "name": "_checkpointExposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159598, "src": "12160:19:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, { "id": 159651, "name": "absoluteMaxBaseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159631, "src": "12197:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159652, "name": "absoluteMaxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159634, "src": "12236:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159653, "name": "spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159618, "src": "12275:9:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" }, { "typeIdentifier": "t_int256", "typeString": "int256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159648, "name": "calculateSolvencyAfterLong", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160247, "src": "12091:26:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_MaxTradeParams_$159592_memory_ptr_$_t_int256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$_t_bool_$", "typeString": "function (struct HyperdriveUtils.MaxTradeParams memory,int256,uint256,uint256,uint256) pure returns (uint256,bool)" } }, "id": 159654, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "12091:207:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "nodeType": "VariableDeclarationStatement", "src": "12069:229:237" }, { "condition": { "id": 159656, "name": "isSolvent_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159647, "src": "12316:10:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "id": 159662, "nodeType": "IfStatement", "src": "12312:102:237", "trueBody": { "id": 159661, "nodeType": "Block", "src": "12328:86:237", "statements": [{ "expression": { "components": [{ "id": 159657, "name": "absoluteMaxBaseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159631, "src": "12354:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159658, "name": "absoluteMaxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159634, "src": "12377:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 159659, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "12353:46:237", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_uint256_$", "typeString": "tuple(uint256,uint256)" } }, "functionReturnParameters": 159606, "id": 159660, "nodeType": "Return", "src": "12346:53:237" }] } }] }, { "expression": { "id": 159671, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 159664, "name": "maxBaseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159603, "src": "13303:13:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 159666, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159596, "src": "13354:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, { "id": 159667, "name": "absoluteMaxBaseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159631, "src": "13375:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159668, "name": "_checkpointExposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159598, "src": "13410:19:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, { "id": 159669, "name": "spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159618, "src": "13443:9:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_int256", "typeString": "int256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159665, "name": "calculateMaxLongGuess", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160048, "src": "13319:21:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_MaxTradeParams_$159592_memory_ptr_$_t_uint256_$_t_int256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (struct HyperdriveUtils.MaxTradeParams memory,uint256,int256,uint256) pure returns (uint256)" } }, "id": 159670, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "13319:143:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "13303:159:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159672, "nodeType": "ExpressionStatement", "src": "13303:159:237" }, { "expression": { "id": 159680, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 159673, "name": "maxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159605, "src": "13472:13:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 159675, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159596, "src": "13521:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, { "id": 159676, "name": "maxBaseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159603, "src": "13542:13:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159677, "name": "effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159608, "src": "13569:22:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159678, "name": "spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159618, "src": "13605:9:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159674, "name": "calculateLongAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160356, "src": "13488:19:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_MaxTradeParams_$159592_memory_ptr_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (struct HyperdriveUtils.MaxTradeParams memory,uint256,uint256,uint256) pure returns (uint256)" } }, "id": 159679, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "13488:136:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "13472:152:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159681, "nodeType": "ExpressionStatement", "src": "13472:152:237" }, { "assignments": [159683, 159685], "declarations": [{ "constant": false, "id": 159683, "mutability": "mutable", "name": "solvency_", "nameLocation": "13643:9:237", "nodeType": "VariableDeclaration", "scope": 159784, "src": "13635:17:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159682, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "13635:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159685, "mutability": "mutable", "name": "success", "nameLocation": "13659:7:237", "nodeType": "VariableDeclaration", "scope": 159784, "src": "13654:12:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "typeName": { "id": 159684, "name": "bool", "nodeType": "ElementaryTypeName", "src": "13654:4:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "visibility": "internal" }], "id": 159693, "initialValue": { "arguments": [{ "id": 159687, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159596, "src": "13710:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, { "id": 159688, "name": "_checkpointExposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159598, "src": "13731:19:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, { "id": 159689, "name": "maxBaseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159603, "src": "13764:13:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159690, "name": "maxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159605, "src": "13791:13:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159691, "name": "spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159618, "src": "13818:9:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" }, { "typeIdentifier": "t_int256", "typeString": "int256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159686, "name": "calculateSolvencyAfterLong", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160247, "src": "13670:26:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_MaxTradeParams_$159592_memory_ptr_$_t_int256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$_t_bool_$", "typeString": "function (struct HyperdriveUtils.MaxTradeParams memory,int256,uint256,uint256,uint256) pure returns (uint256,bool)" } }, "id": 159692, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "13670:167:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "nodeType": "VariableDeclarationStatement", "src": "13634:203:237" }, { "expression": { "arguments": [{ "id": 159695, "name": "success", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159685, "src": "13855:7:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, { "hexValue": "496e697469616c20677565737320696e206063616c63756c6174654d61784c6f6e676020697320696e736f6c76656e742e", "id": 159696, "isConstant": false, "isLValue": false, "isPure": true, "kind": "string", "lValueRequested": false, "nodeType": "Literal", "src": "13864:51:237", "typeDescriptions": { "typeIdentifier": "t_stringliteral_4e6d63cecf3a70a5745c0f55ea1d84484c3dcb5e4cec0df8dd19ed87d5edc294", "typeString": "literal_string \"Initial guess in `calculateMaxLong` is insolvent.\"" }, "value": "Initial guess in `calculateMaxLong` is insolvent." }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_bool", "typeString": "bool" }, { "typeIdentifier": "t_stringliteral_4e6d63cecf3a70a5745c0f55ea1d84484c3dcb5e4cec0df8dd19ed87d5edc294", "typeString": "literal_string \"Initial guess in `calculateMaxLong` is insolvent.\"" }], "id": 159694, "name": "require", "nodeType": "Identifier", "overloadedDeclarations": [-18, -18], "referencedDeclaration": -18, "src": "13847:7:237", "typeDescriptions": { "typeIdentifier": "t_function_require_pure$_t_bool_$_t_string_memory_ptr_$returns$__$", "typeString": "function (bool,string memory) pure" } }, "id": 159697, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "13847:69:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_tuple$__$", "typeString": "tuple()" } }, "id": 159698, "nodeType": "ExpressionStatement", "src": "13847:69:237" }, { "body": { "id": 159778, "nodeType": "Block", "src": "13971:1970:237", "statements": [{ "expression": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159712, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159710, "name": "maxBaseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159603, "src": "14195:13:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "<", "rightExpression": { "id": 159711, "name": "absoluteMaxBaseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159631, "src": "14211:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "14195:37:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, { "hexValue": "52656163686564206162736f6c757465206d617820626f6e6420616d6f756e7420696e20606765745f6d61785f6c6f6e67602e", "id": 159713, "isConstant": false, "isLValue": false, "isPure": true, "kind": "string", "lValueRequested": false, "nodeType": "Literal", "src": "14250:53:237", "typeDescriptions": { "typeIdentifier": "t_stringliteral_f73cbb65781b5d25c319ac55965af78a368c7603f407050cca4d559a6b41dbaf", "typeString": "literal_string \"Reached absolute max bond amount in `get_max_long`.\"" }, "value": "Reached absolute max bond amount in `get_max_long`." }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_bool", "typeString": "bool" }, { "typeIdentifier": "t_stringliteral_f73cbb65781b5d25c319ac55965af78a368c7603f407050cca4d559a6b41dbaf", "typeString": "literal_string \"Reached absolute max bond amount in `get_max_long`.\"" }], "id": 159709, "name": "require", "nodeType": "Identifier", "overloadedDeclarations": [-18, -18], "referencedDeclaration": -18, "src": "14170:7:237", "typeDescriptions": { "typeIdentifier": "t_function_require_pure$_t_bool_$_t_string_memory_ptr_$returns$__$", "typeString": "function (bool,string memory) pure" } }, "id": 159714, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "14170:147:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_tuple$__$", "typeString": "tuple()" } }, "id": 159715, "nodeType": "ExpressionStatement", "src": "14170:147:237" }, { "assignments": [159717], "declarations": [{ "constant": false, "id": 159717, "mutability": "mutable", "name": "derivative", "nameLocation": "14888:10:237", "nodeType": "VariableDeclaration", "scope": 159778, "src": "14880:18:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159716, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "14880:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 159718, "nodeType": "VariableDeclarationStatement", "src": "14880:18:237" }, { "expression": { "id": 159728, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "components": [{ "id": 159719, "name": "derivative", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159717, "src": "14913:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159720, "name": "success", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159685, "src": "14925:7:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }], "id": 159721, "isConstant": false, "isInlineArray": false, "isLValue": true, "isPure": false, "lValueRequested": true, "nodeType": "TupleExpression", "src": "14912:21:237", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 159723, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159596, "src": "14990:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, { "id": 159724, "name": "maxBaseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159603, "src": "15015:13:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159725, "name": "effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159608, "src": "15046:22:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159726, "name": "spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159618, "src": "15086:9:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159722, "name": "calculateSolvencyAfterLongDerivative", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160311, "src": "14936:36:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_MaxTradeParams_$159592_memory_ptr_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$_t_bool_$", "typeString": "function (struct HyperdriveUtils.MaxTradeParams memory,uint256,uint256,uint256) pure returns (uint256,bool)" } }, "id": 159727, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "14936:173:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "src": "14912:197:237", "typeDescriptions": { "typeIdentifier": "t_tuple$__$", "typeString": "tuple()" } }, "id": 159729, "nodeType": "ExpressionStatement", "src": "14912:197:237" }, { "condition": { "id": 159731, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "UnaryOperation", "operator": "!", "prefix": true, "src": "15127:8:237", "subExpression": { "id": 159730, "name": "success", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159685, "src": "15128:7:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "id": 159734, "nodeType": "IfStatement", "src": "15123:52:237", "trueBody": { "id": 159733, "nodeType": "Block", "src": "15137:38:237", "statements": [{ "id": 159732, "nodeType": "Break", "src": "15155:5:237" }] } }, { "assignments": [159736], "declarations": [{ "constant": false, "id": 159736, "mutability": "mutable", "name": "possibleMaxBaseAmount", "nameLocation": "15196:21:237", "nodeType": "VariableDeclaration", "scope": 159778, "src": "15188:29:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159735, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "15188:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 159743, "initialValue": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159742, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159737, "name": "maxBaseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159603, "src": "15220:13:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "arguments": [{ "id": 159740, "name": "derivative", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159717, "src": "15270:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159738, "name": "solvency_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159683, "src": "15252:9:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159739, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "15262:7:237", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "15252:17:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159741, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "15252:29:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "15220:61:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "15188:93:237" }, { "assignments": [159745], "declarations": [{ "constant": false, "id": 159745, "mutability": "mutable", "name": "possibleMaxBondAmount", "nameLocation": "15303:21:237", "nodeType": "VariableDeclaration", "scope": 159778, "src": "15295:29:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159744, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "15295:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 159752, "initialValue": { "arguments": [{ "id": 159747, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159596, "src": "15364:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, { "id": 159748, "name": "possibleMaxBaseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159736, "src": "15389:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159749, "name": "effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159608, "src": "15428:22:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159750, "name": "spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159618, "src": "15468:9:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159746, "name": "calculateLongAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160356, "src": "15327:19:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_MaxTradeParams_$159592_memory_ptr_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (struct HyperdriveUtils.MaxTradeParams memory,uint256,uint256,uint256) pure returns (uint256)" } }, "id": 159751, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "15327:164:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "15295:196:237" }, { "expression": { "id": 159763, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "components": [{ "id": 159753, "name": "solvency_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159683, "src": "15506:9:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159754, "name": "success", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159685, "src": "15517:7:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }], "id": 159755, "isConstant": false, "isInlineArray": false, "isLValue": true, "isPure": false, "lValueRequested": true, "nodeType": "TupleExpression", "src": "15505:20:237", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 159757, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159596, "src": "15572:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, { "id": 159758, "name": "_checkpointExposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159598, "src": "15597:19:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, { "id": 159759, "name": "possibleMaxBaseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159736, "src": "15634:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159760, "name": "possibleMaxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159745, "src": "15673:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159761, "name": "spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159618, "src": "15712:9:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" }, { "typeIdentifier": "t_int256", "typeString": "int256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159756, "name": "calculateSolvencyAfterLong", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160247, "src": "15528:26:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_MaxTradeParams_$159592_memory_ptr_$_t_int256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$_t_bool_$", "typeString": "function (struct HyperdriveUtils.MaxTradeParams memory,int256,uint256,uint256,uint256) pure returns (uint256,bool)" } }, "id": 159762, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "15528:207:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "src": "15505:230:237", "typeDescriptions": { "typeIdentifier": "t_tuple$__$", "typeString": "tuple()" } }, "id": 159764, "nodeType": "ExpressionStatement", "src": "15505:230:237" }, { "condition": { "id": 159765, "name": "success", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159685, "src": "15753:7:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "falseBody": { "id": 159776, "nodeType": "Block", "src": "15893:38:237", "statements": [{ "id": 159775, "nodeType": "Break", "src": "15911:5:237" }] }, "id": 159777, "nodeType": "IfStatement", "src": "15749:182:237", "trueBody": { "id": 159774, "nodeType": "Block", "src": "15762:125:237", "statements": [{ "expression": { "id": 159768, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 159766, "name": "maxBaseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159603, "src": "15780:13:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "id": 159767, "name": "possibleMaxBaseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159736, "src": "15796:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "15780:37:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159769, "nodeType": "ExpressionStatement", "src": "15780:37:237" }, { "expression": { "id": 159772, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 159770, "name": "maxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159605, "src": "15835:13:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "id": 159771, "name": "possibleMaxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159745, "src": "15851:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "15835:37:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159773, "nodeType": "ExpressionStatement", "src": "15835:37:237" }] } }] }, "condition": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159705, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159703, "name": "i", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159700, "src": "13946:1:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "<", "rightExpression": { "id": 159704, "name": "_maxIterations", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159600, "src": "13950:14:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "13946:18:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "id": 159779, "initializationExpression": { "assignments": [159700], "declarations": [{ "constant": false, "id": 159700, "mutability": "mutable", "name": "i", "nameLocation": "13939:1:237", "nodeType": "VariableDeclaration", "scope": 159779, "src": "13931:9:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159699, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "13931:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 159702, "initialValue": { "hexValue": "30", "id": 159701, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "13943:1:237", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }, "nodeType": "VariableDeclarationStatement", "src": "13931:13:237" }, "loopExpression": { "expression": { "id": 159707, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "UnaryOperation", "operator": "++", "prefix": true, "src": "13966:3:237", "subExpression": { "id": 159706, "name": "i", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159700, "src": "13968:1:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159708, "nodeType": "ExpressionStatement", "src": "13966:3:237" }, "nodeType": "ForStatement", "src": "13926:2015:237" }, { "expression": { "components": [{ "id": 159780, "name": "maxBaseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159603, "src": "15959:13:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159781, "name": "maxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159605, "src": "15974:13:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 159782, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "15958:30:237", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_uint256_$", "typeString": "tuple(uint256,uint256)" } }, "functionReturnParameters": 159606, "id": 159783, "nodeType": "Return", "src": "15951:37:237" }] }, "documentation": { "id": 159593, "nodeType": "StructuredDocumentation", "src": "10282:676:237", "text": "@dev Gets the max long that can be opened given a budget.\n      We start by calculating the long that brings the pool's spot price\n      to 1. If we are solvent at this point, then we're done. Otherwise,\n      we approach the max long iteratively using Newton's method.\n @param _params The parameters for the max long calculation.\n @param _checkpointExposure The exposure in the checkpoint.\n @param _maxIterations The maximum number of iterations to use in the\n                       Newton's method loop.\n @return maxBaseAmount The maximum base amount.\n @return maxBondAmount The maximum bond amount." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateMaxLong", "nameLocation": "10972:16:237", "parameters": { "id": 159601, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159596, "mutability": "mutable", "name": "_params", "nameLocation": "11020:7:237", "nodeType": "VariableDeclaration", "scope": 159785, "src": "10998:29:237", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" }, "typeName": { "id": 159595, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 159594, "name": "MaxTradeParams", "nameLocations": ["10998:14:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 159592, "src": "10998:14:237" }, "referencedDeclaration": 159592, "src": "10998:14:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_storage_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" } }, "visibility": "internal" }, { "constant": false, "id": 159598, "mutability": "mutable", "name": "_checkpointExposure", "nameLocation": "11044:19:237", "nodeType": "VariableDeclaration", "scope": 159785, "src": "11037:26:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" }, "typeName": { "id": 159597, "name": "int256", "nodeType": "ElementaryTypeName", "src": "11037:6:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "visibility": "internal" }, { "constant": false, "id": 159600, "mutability": "mutable", "name": "_maxIterations", "nameLocation": "11081:14:237", "nodeType": "VariableDeclaration", "scope": 159785, "src": "11073:22:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159599, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "11073:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "10988:113:237" }, "returnParameters": { "id": 159606, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159603, "mutability": "mutable", "name": "maxBaseAmount", "nameLocation": "11133:13:237", "nodeType": "VariableDeclaration", "scope": 159785, "src": "11125:21:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159602, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "11125:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159605, "mutability": "mutable", "name": "maxBondAmount", "nameLocation": "11156:13:237", "nodeType": "VariableDeclaration", "scope": 159785, "src": "11148:21:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159604, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "11148:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "11124:46:237" }, "scope": 161566, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 159979, "nodeType": "FunctionDefinition", "src": "16597:3723:237", "nodes": [], "body": { "id": 159978, "nodeType": "Block", "src": "16858:3462:237", "nodes": [], "statements": [{ "assignments": [159801], "declarations": [{ "constant": false, "id": 159801, "mutability": "mutable", "name": "inner", "nameLocation": "18026:5:237", "nodeType": "VariableDeclaration", "scope": 159978, "src": "18018:13:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159800, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "18018:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 159802, "nodeType": "VariableDeclarationStatement", "src": "18018:13:237" }, { "id": 159896, "nodeType": "Block", "src": "18041:822:237", "statements": [{ "assignments": [159804], "declarations": [{ "constant": false, "id": 159804, "mutability": "mutable", "name": "k_", "nameLocation": "18063:2:237", "nodeType": "VariableDeclaration", "scope": 159896, "src": "18055:10:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159803, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "18055:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 159819, "initialValue": { "arguments": [{ "id": 159807, "name": "_effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159791, "src": "18106:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159808, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159789, "src": "18147:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159809, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "18155:12:237", "memberName": "bondReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159573, "src": "18147:20:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159813, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159810, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "18185:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 159811, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159789, "src": "18191:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159812, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "18199:11:237", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159579, "src": "18191:19:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "18185:25:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159814, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159789, "src": "18228:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159815, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "18236:15:237", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159581, "src": "18228:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159816, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159789, "src": "18269:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159817, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "18277:22:237", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159583, "src": "18269:30:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159805, "name": "YieldSpaceMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 23422, "src": "18068:14:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_YieldSpaceMath_$23422_$", "typeString": "type(library YieldSpaceMath)" } }, "id": 159806, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "18083:5:237", "memberName": "kDown", "nodeType": "MemberAccess", "referencedDeclaration": 23421, "src": "18068:20:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256,uint256,uint256) pure returns (uint256)" } }, "id": 159818, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "18068:245:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "18055:258:237" }, { "expression": { "id": 159837, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 159820, "name": "inner", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159801, "src": "18327:5:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159835, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159832, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "18410:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 159833, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159789, "src": "18416:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159834, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "18424:7:237", "memberName": "flatFee", "nodeType": "MemberAccess", "referencedDeclaration": 159589, "src": "18416:15:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "18410:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159829, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "arguments": [{ "id": 159826, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159793, "src": "18368:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159824, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "18358:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159825, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "18362:5:237", "memberName": "divUp", "nodeType": "MemberAccess", "referencedDeclaration": 18920, "src": "18358:9:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159827, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "18358:21:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 159828, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "18382:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "18358:27:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 159821, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159789, "src": "18335:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159822, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "18343:8:237", "memberName": "curveFee", "nodeType": "MemberAccess", "referencedDeclaration": 159587, "src": "18335:16:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159823, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "18352:5:237", "memberName": "mulUp", "nodeType": "MemberAccess", "referencedDeclaration": 18902, "src": "18335:22:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159830, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "18335:51:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159831, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "18387:5:237", "memberName": "mulUp", "nodeType": "MemberAccess", "referencedDeclaration": 18902, "src": "18335:57:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159836, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "18335:110:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "18327:118:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159838, "nodeType": "ExpressionStatement", "src": "18327:118:237" }, { "expression": { "id": 159850, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 159839, "name": "inner", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159801, "src": "18459:5:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159848, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159845, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "18487:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 159846, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159789, "src": "18493:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159847, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "18501:7:237", "memberName": "flatFee", "nodeType": "MemberAccess", "referencedDeclaration": 159589, "src": "18493:15:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "18487:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159842, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159840, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "18468:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "id": 159841, "name": "inner", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159801, "src": "18474:5:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "18468:11:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 159843, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "18467:13:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159844, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "18481:5:237", "memberName": "divUp", "nodeType": "MemberAccess", "referencedDeclaration": 18920, "src": "18467:19:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159849, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "18467:42:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "18459:50:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159851, "nodeType": "ExpressionStatement", "src": "18459:50:237" }, { "expression": { "id": 159865, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 159852, "name": "inner", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159801, "src": "18523:5:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "arguments": [{ "expression": { "id": 159861, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159789, "src": "18594:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159862, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "18602:11:237", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159579, "src": "18594:19:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159858, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159855, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "18559:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 159856, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159789, "src": "18565:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159857, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "18573:11:237", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159579, "src": "18565:19:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "18559:25:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 159859, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "18558:27:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159860, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "18586:7:237", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "18558:35:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159863, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "18558:56:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159853, "name": "inner", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159801, "src": "18531:5:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159854, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "18537:3:237", "memberName": "pow", "nodeType": "MemberAccess", "referencedDeclaration": 18977, "src": "18531:9:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159864, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "18531:97:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "18523:105:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159866, "nodeType": "ExpressionStatement", "src": "18523:105:237" }, { "expression": { "id": 159874, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 159867, "name": "inner", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159801, "src": "18642:5:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "+=", "rightHandSide": { "arguments": [{ "expression": { "id": 159871, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159789, "src": "18698:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159872, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "18706:22:237", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159583, "src": "18698:30:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 159868, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159789, "src": "18651:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159869, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "18659:15:237", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159581, "src": "18651:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159870, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "18675:5:237", "memberName": "divUp", "nodeType": "MemberAccess", "referencedDeclaration": 18920, "src": "18651:29:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159873, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "18651:91:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "18642:100:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159875, "nodeType": "ExpressionStatement", "src": "18642:100:237" }, { "expression": { "id": 159881, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 159876, "name": "inner", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159801, "src": "18756:5:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 159879, "name": "inner", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159801, "src": "18775:5:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159877, "name": "k_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159804, "src": "18764:2:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159878, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "18767:7:237", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "18764:10:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159880, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "18764:17:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "18756:25:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159882, "nodeType": "ExpressionStatement", "src": "18756:25:237" }, { "expression": { "id": 159894, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 159883, "name": "inner", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159801, "src": "18795:5:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159891, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159888, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "18825:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 159889, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159789, "src": "18831:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159890, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "18839:11:237", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159579, "src": "18831:19:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "18825:25:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159886, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "18813:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159887, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "18817:7:237", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "18813:11:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159892, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "18813:38:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159884, "name": "inner", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159801, "src": "18803:5:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159885, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "18809:3:237", "memberName": "pow", "nodeType": "MemberAccess", "referencedDeclaration": 18977, "src": "18803:9:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159893, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "18803:49:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "18795:57:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159895, "nodeType": "ExpressionStatement", "src": "18795:57:237" }] }, { "assignments": [159898], "declarations": [{ "constant": false, "id": 159898, "mutability": "mutable", "name": "targetShareReserves", "nameLocation": "18880:19:237", "nodeType": "VariableDeclaration", "scope": 159978, "src": "18872:27:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159897, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "18872:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 159904, "initialValue": { "arguments": [{ "expression": { "id": 159901, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159789, "src": "18929:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159902, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "18937:22:237", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159583, "src": "18929:30:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159899, "name": "inner", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159801, "src": "18902:5:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159900, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "18908:7:237", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "18902:13:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159903, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "18902:67:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "18872:97:237" }, { "assignments": [159906], "declarations": [{ "constant": false, "id": 159906, "mutability": "mutable", "name": "targetBondReserves", "nameLocation": "19332:18:237", "nodeType": "VariableDeclaration", "scope": 159978, "src": "19324:26:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159905, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "19324:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 159907, "nodeType": "VariableDeclarationStatement", "src": "19324:26:237" }, { "id": 159951, "nodeType": "Block", "src": "19360:356:237", "statements": [{ "assignments": [159909], "declarations": [{ "constant": false, "id": 159909, "mutability": "mutable", "name": "feeAdjustment", "nameLocation": "19382:13:237", "nodeType": "VariableDeclaration", "scope": 159951, "src": "19374:21:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159908, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "19374:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 159926, "initialValue": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159924, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159921, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "19513:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 159922, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159789, "src": "19519:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159923, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "19527:7:237", "memberName": "flatFee", "nodeType": "MemberAccess", "referencedDeclaration": 159589, "src": "19519:15:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "19513:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159918, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "arguments": [{ "id": 159915, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159793, "src": "19469:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159913, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "19457:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159914, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "19461:7:237", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "19457:11:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159916, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "19457:23:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 159917, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "19483:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "19457:29:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 159910, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159789, "src": "19398:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159911, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "19423:8:237", "memberName": "curveFee", "nodeType": "MemberAccess", "referencedDeclaration": 159587, "src": "19398:33:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159912, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "19449:7:237", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "19398:58:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159919, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "19398:89:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159920, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "19505:7:237", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "19398:114:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159925, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "19398:137:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "19374:161:237" }, { "expression": { "id": 159949, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 159927, "name": "targetBondReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159906, "src": "19549:18:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 159947, "name": "inner", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159801, "src": "19699:5:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "arguments": [{ "expression": { "id": 159942, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159789, "src": "19669:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159943, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "19677:11:237", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159579, "src": "19669:19:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159940, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "19659:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159941, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "19663:5:237", "memberName": "divUp", "nodeType": "MemberAccess", "referencedDeclaration": 18920, "src": "19659:9:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159944, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "19659:30:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "components": [{ "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159936, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159933, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "19618:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 159934, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159789, "src": "19624:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159935, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "19632:7:237", "memberName": "flatFee", "nodeType": "MemberAccess", "referencedDeclaration": 159589, "src": "19624:15:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "19618:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159930, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159928, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "19589:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "id": 159929, "name": "feeAdjustment", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159909, "src": "19595:13:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "19589:19:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 159931, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "19588:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159932, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "19610:7:237", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "19588:29:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159937, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "19588:52:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 159938, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "19570:84:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159939, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "19655:3:237", "memberName": "pow", "nodeType": "MemberAccess", "referencedDeclaration": 18977, "src": "19570:88:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159945, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "19570:120:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159946, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "19691:7:237", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "19570:128:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159948, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "19570:135:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "19549:156:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159950, "nodeType": "ExpressionStatement", "src": "19549:156:237" }] }, { "expression": { "id": 159961, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 159952, "name": "absoluteMaxBaseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159796, "src": "19839:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "expression": { "id": 159958, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159789, "src": "19932:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159959, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "19940:15:237", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159581, "src": "19932:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159955, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159953, "name": "targetShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159898, "src": "19864:19:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 159954, "name": "_effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159791, "src": "19886:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "19864:45:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 159956, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "19863:47:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159957, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "19924:7:237", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "19863:68:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159960, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "19863:93:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "19839:117:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159962, "nodeType": "ExpressionStatement", "src": "19839:117:237" }, { "expression": { "id": 159976, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 159963, "name": "absoluteMaxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159798, "src": "20083:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159975, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159967, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "expression": { "id": 159964, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159789, "src": "20120:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159965, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "20128:12:237", "memberName": "bondReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159573, "src": "20120:20:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 159966, "name": "targetBondReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159906, "src": "20143:18:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "20120:41:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 159968, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "20119:43:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [{ "id": 159970, "name": "absoluteMaxBaseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159796, "src": "20216:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159971, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159793, "src": "20255:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159972, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159789, "src": "20283:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159973, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "20291:8:237", "memberName": "curveFee", "nodeType": "MemberAccess", "referencedDeclaration": 159587, "src": "20283:16:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159969, "name": "calculateLongCurveFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160506, "src": "20177:21:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 159974, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "20177:136:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "20119:194:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "20083:230:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159977, "nodeType": "ExpressionStatement", "src": "20083:230:237" }] }, "documentation": { "id": 159786, "nodeType": "StructuredDocumentation", "src": "16001:591:237", "text": "@dev Calculates the largest long that can be opened without buying bonds\n      at a negative interest rate. This calculation does not take\n      Hyperdrive's solvency constraints into account and shouldn't be\n      used directly.\n @param _params The parameters for the max long calculation.\n @param _effectiveShareReserves The pool's effective share reserves.\n @param _spotPrice The pool's spot price.\n @return absoluteMaxBaseAmount The absolute maximum base amount.\n @return absoluteMaxBondAmount The absolute maximum bond amount." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateAbsoluteMaxLong", "nameLocation": "16606:24:237", "parameters": { "id": 159794, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159789, "mutability": "mutable", "name": "_params", "nameLocation": "16662:7:237", "nodeType": "VariableDeclaration", "scope": 159979, "src": "16640:29:237", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" }, "typeName": { "id": 159788, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 159787, "name": "MaxTradeParams", "nameLocations": ["16640:14:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 159592, "src": "16640:14:237" }, "referencedDeclaration": 159592, "src": "16640:14:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_storage_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" } }, "visibility": "internal" }, { "constant": false, "id": 159791, "mutability": "mutable", "name": "_effectiveShareReserves", "nameLocation": "16687:23:237", "nodeType": "VariableDeclaration", "scope": 159979, "src": "16679:31:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159790, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "16679:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159793, "mutability": "mutable", "name": "_spotPrice", "nameLocation": "16728:10:237", "nodeType": "VariableDeclaration", "scope": 159979, "src": "16720:18:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159792, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "16720:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "16630:114:237" }, "returnParameters": { "id": 159799, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159796, "mutability": "mutable", "name": "absoluteMaxBaseAmount", "nameLocation": "16800:21:237", "nodeType": "VariableDeclaration", "scope": 159979, "src": "16792:29:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159795, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "16792:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159798, "mutability": "mutable", "name": "absoluteMaxBondAmount", "nameLocation": "16831:21:237", "nodeType": "VariableDeclaration", "scope": 159979, "src": "16823:29:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159797, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "16823:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "16791:62:237" }, "scope": 161566, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 160048, "nodeType": "FunctionDefinition", "src": "20970:1484:237", "nodes": [], "body": { "id": 160047, "nodeType": "Block", "src": "21182:1272:237", "nodes": [], "statements": [{ "assignments": [159995], "declarations": [{ "constant": false, "id": 159995, "mutability": "mutable", "name": "guess", "nameLocation": "21313:5:237", "nodeType": "VariableDeclaration", "scope": 160047, "src": "21305:13:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159994, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "21305:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160002, "initialValue": { "arguments": [{ "id": 159997, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159983, "src": "21359:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, { "id": 159998, "name": "_checkpointExposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159987, "src": "21380:19:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, { "id": 159999, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159989, "src": "21413:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160000, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159989, "src": "21437:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" }, { "typeIdentifier": "t_int256", "typeString": "int256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159996, "name": "calculateMaxLongEstimate", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160139, "src": "21321:24:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_MaxTradeParams_$159592_memory_ptr_$_t_int256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (struct HyperdriveUtils.MaxTradeParams memory,int256,uint256,uint256) pure returns (uint256)" } }, "id": 160001, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "21321:136:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "21305:152:237" }, { "assignments": [160004], "declarations": [{ "constant": false, "id": 160004, "mutability": "mutable", "name": "t", "nameLocation": "21909:1:237", "nodeType": "VariableDeclaration", "scope": 160047, "src": "21901:9:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160003, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "21901:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160021, "initialValue": { "arguments": [{ "hexValue": "302e38653138", "id": 160019, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "22040:6:237", "typeDescriptions": { "typeIdentifier": "t_rational_800000000000000000_by_1", "typeString": "int_const 800000000000000000" }, "value": "0.8e18" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_rational_800000000000000000_by_1", "typeString": "int_const 800000000000000000" }], "expression": { "arguments": [{ "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160015, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160012, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "21991:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 160013, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159983, "src": "21997:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160014, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "22005:11:237", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159579, "src": "21997:19:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "21991:25:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160010, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "21981:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160011, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "21985:5:237", "memberName": "divUp", "nodeType": "MemberAccess", "referencedDeclaration": 18920, "src": "21981:9:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160016, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "21981:36:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "id": 160007, "name": "_absoluteMaxBaseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159985, "src": "21940:22:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160005, "name": "guess", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159995, "src": "21913:5:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160006, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "21932:7:237", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "21913:26:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160008, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "21913:50:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160009, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "21977:3:237", "memberName": "pow", "nodeType": "MemberAccess", "referencedDeclaration": 18977, "src": "21913:67:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160017, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "21913:105:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160018, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "22032:7:237", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "21913:126:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160020, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "21913:134:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "21901:146:237" }, { "assignments": [160023], "declarations": [{ "constant": false, "id": 160023, "mutability": "mutable", "name": "estimateSpotPrice", "nameLocation": "22065:17:237", "nodeType": "VariableDeclaration", "scope": 160047, "src": "22057:25:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160022, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "22057:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160035, "initialValue": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160034, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160028, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160026, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "22104:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 160027, "name": "t", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160004, "src": "22110:1:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "22104:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160024, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159989, "src": "22085:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160025, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "22096:7:237", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "22085:18:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160029, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "22085:27:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "arguments": [{ "id": 160032, "name": "t", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160004, "src": "22139:1:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160030, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "22127:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160031, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "22131:7:237", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "22127:11:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160033, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "22127:14:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "22085:56:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "22057:84:237" }, { "expression": { "id": 160043, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 160036, "name": "guess", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159995, "src": "22273:5:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 160038, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159983, "src": "22319:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, { "id": 160039, "name": "_checkpointExposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159987, "src": "22340:19:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, { "id": 160040, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159989, "src": "22373:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160041, "name": "estimateSpotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160023, "src": "22397:17:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" }, { "typeIdentifier": "t_int256", "typeString": "int256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 160037, "name": "calculateMaxLongEstimate", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160139, "src": "22281:24:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_MaxTradeParams_$159592_memory_ptr_$_t_int256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (struct HyperdriveUtils.MaxTradeParams memory,int256,uint256,uint256) pure returns (uint256)" } }, "id": 160042, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "22281:143:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "22273:151:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160044, "nodeType": "ExpressionStatement", "src": "22273:151:237" }, { "expression": { "id": 160045, "name": "guess", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159995, "src": "22442:5:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 159993, "id": 160046, "nodeType": "Return", "src": "22435:12:237" }] }, "documentation": { "id": 159980, "nodeType": "StructuredDocumentation", "src": "20326:639:237", "text": "@dev Calculates an initial guess of the max long that can be opened.\n      This is a reasonable estimate that is guaranteed to be less than\n      the true max long. We use this to get a reasonable starting point\n      for Newton's method.\n @param _params The max long calculation parameters.\n @param _absoluteMaxBaseAmount The absolute max base amount that can be\n        used to open a long.\n @param _checkpointExposure The exposure in the checkpoint.\n @param _spotPrice The spot price of the pool.\n @return A conservative estimate of the max long that the pool can open." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateMaxLongGuess", "nameLocation": "20979:21:237", "parameters": { "id": 159990, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159983, "mutability": "mutable", "name": "_params", "nameLocation": "21032:7:237", "nodeType": "VariableDeclaration", "scope": 160048, "src": "21010:29:237", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" }, "typeName": { "id": 159982, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 159981, "name": "MaxTradeParams", "nameLocations": ["21010:14:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 159592, "src": "21010:14:237" }, "referencedDeclaration": 159592, "src": "21010:14:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_storage_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" } }, "visibility": "internal" }, { "constant": false, "id": 159985, "mutability": "mutable", "name": "_absoluteMaxBaseAmount", "nameLocation": "21057:22:237", "nodeType": "VariableDeclaration", "scope": 160048, "src": "21049:30:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159984, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "21049:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159987, "mutability": "mutable", "name": "_checkpointExposure", "nameLocation": "21096:19:237", "nodeType": "VariableDeclaration", "scope": 160048, "src": "21089:26:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" }, "typeName": { "id": 159986, "name": "int256", "nodeType": "ElementaryTypeName", "src": "21089:6:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "visibility": "internal" }, { "constant": false, "id": 159989, "mutability": "mutable", "name": "_spotPrice", "nameLocation": "21133:10:237", "nodeType": "VariableDeclaration", "scope": 160048, "src": "21125:18:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159988, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "21125:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "21000:149:237" }, "returnParameters": { "id": 159993, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159992, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 160048, "src": "21173:7:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159991, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "21173:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "21172:9:237" }, "scope": 161566, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 160139, "nodeType": "FunctionDefinition", "src": "24388:947:237", "nodes": [], "body": { "id": 160138, "nodeType": "Block", "src": "24595:740:237", "nodes": [], "statements": [{ "assignments": [160064], "declarations": [{ "constant": false, "id": 160064, "mutability": "mutable", "name": "checkpointExposure", "nameLocation": "24613:18:237", "nodeType": "VariableDeclaration", "scope": 160138, "src": "24605:26:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160063, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "24605:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160073, "initialValue": { "arguments": [{ "id": 160071, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "UnaryOperation", "operator": "-", "prefix": true, "src": "24642:27:237", "subExpression": { "arguments": [{ "hexValue": "30", "id": 160069, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "24667:1:237", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }], "expression": { "id": 160067, "name": "_checkpointExposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160054, "src": "24643:19:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "id": 160068, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "24663:3:237", "memberName": "min", "nodeType": "MemberAccess", "referencedDeclaration": 19553, "src": "24643:23:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_int256_$_t_int256_$returns$_t_int256_$attached_to$_t_int256_$", "typeString": "function (int256,int256) pure returns (int256)" } }, "id": 160070, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "24643:26:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 160066, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "24634:7:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_uint256_$", "typeString": "type(uint256)" }, "typeName": { "id": 160065, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "24634:7:237", "typeDescriptions": {} } }, "id": 160072, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "24634:36:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "24605:65:237" }, { "assignments": [160075], "declarations": [{ "constant": false, "id": 160075, "mutability": "mutable", "name": "estimate", "nameLocation": "24688:8:237", "nodeType": "VariableDeclaration", "scope": 160138, "src": "24680:16:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160074, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "24680:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160100, "initialValue": { "arguments": [{ "expression": { "id": 160096, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160052, "src": "24928:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160097, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "24936:15:237", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159581, "src": "24928:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "hexValue": "32653138", "id": 160098, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "24969:4:237", "typeDescriptions": { "typeIdentifier": "t_rational_2000000000000000000_by_1", "typeString": "int_const 2000000000000000000" }, "value": "2e18" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_rational_2000000000000000000_by_1", "typeString": "int_const 2000000000000000000" }], "expression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160093, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160090, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160083, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "expression": { "id": 160076, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160052, "src": "24700:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160077, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "24708:13:237", "memberName": "shareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159569, "src": "24700:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "arguments": [{ "expression": { "id": 160080, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160052, "src": "24763:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160081, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "24771:15:237", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159581, "src": "24763:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160078, "name": "checkpointExposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160064, "src": "24736:18:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160079, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "24755:7:237", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "24736:26:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160082, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "24736:51:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "24700:87:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [{ "expression": { "id": 160087, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160052, "src": "24831:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160088, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "24839:15:237", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159581, "src": "24831:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 160084, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160052, "src": "24802:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160085, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "24810:12:237", "memberName": "longExposure", "nodeType": "MemberAccess", "referencedDeclaration": 159577, "src": "24802:20:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160086, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "24823:7:237", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "24802:28:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160089, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "24802:53:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "24700:155:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 160091, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160052, "src": "24870:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160092, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "24878:20:237", "memberName": "minimumShareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159585, "src": "24870:28:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "24700:198:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 160094, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "24699:200:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160095, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "24900:10:237", "memberName": "mulDivDown", "nodeType": "MemberAccess", "referencedDeclaration": 18834, "src": "24699:211:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 160099, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "24699:288:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "24680:307:237" }, { "expression": { "id": 160134, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 160101, "name": "estimate", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160075, "src": "24997:8:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160132, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160121, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160119, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "arguments": [{ "id": 160106, "name": "_estimatePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160058, "src": "25050:14:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160104, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "25038:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160105, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "25042:7:237", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "25038:11:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160107, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "25038:27:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160117, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160115, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "25163:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 160116, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160056, "src": "25169:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "25163:16:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "expression": { "id": 160111, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160052, "src": "25116:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160112, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "25124:8:237", "memberName": "curveFee", "nodeType": "MemberAccess", "referencedDeclaration": 159587, "src": "25116:16:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 160108, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160052, "src": "25084:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160109, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "25092:15:237", "memberName": "governanceLPFee", "nodeType": "MemberAccess", "referencedDeclaration": 159591, "src": "25084:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160110, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "25108:7:237", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "25084:31:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160113, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "25084:49:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160114, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "25134:7:237", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "25084:57:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160118, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "25084:113:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "25038:159:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 160120, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "25216:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "25038:181:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160130, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "arguments": [{ "id": 160127, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160056, "src": "25275:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160125, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "25263:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160126, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "25267:7:237", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "25263:11:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160128, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "25263:23:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 160129, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "25289:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "25263:29:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 160122, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160052, "src": "25238:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160123, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "25246:8:237", "memberName": "curveFee", "nodeType": "MemberAccess", "referencedDeclaration": 159587, "src": "25238:16:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160124, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "25255:7:237", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "25238:24:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160131, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "25238:55:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "25038:255:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160102, "name": "estimate", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160075, "src": "25008:8:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160103, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "25017:7:237", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "25008:16:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160133, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "25008:295:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "24997:306:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160135, "nodeType": "ExpressionStatement", "src": "24997:306:237" }, { "expression": { "id": 160136, "name": "estimate", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160075, "src": "25320:8:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 160062, "id": 160137, "nodeType": "Return", "src": "25313:15:237" }] }, "documentation": { "id": 160049, "nodeType": "StructuredDocumentation", "src": "22460:1923:237", "text": "@dev Estimates the max long based on the pool's current solvency and a\n      conservative price estimate, $p_r$.\n      We can use our estimate price $p_r$ to approximate $y(x)$ as\n      $y(x) \\approx p_r^{-1} \\cdot x - c(x)$. Plugging this into our\n      solvency function $s(x)$, we can calculate the share reserves and\n      exposure after opening a long with $x$ base as:\n      \\begin{aligned}\n      z(x) &= z_0 + \\tfrac{x - g(x)}{c} - z_{min} \\\\\n      e(x) &= e_0 + min(exposure_{c}, 0) + 2 \\cdot y(x) - x + g(x) \\\\\n           &= e_0 + min(exposure_{c}, 0) + 2 \\cdot p_r^{-1} \\cdot x -\n                  2 \\cdot c(x) - x + g(x)\n      \\end{aligned}\n      We debit and negative checkpoint exposure from $e_0$ since the\n      global exposure doesn't take into account the negative exposure\n      from non-netted shorts in the checkpoint. These formulas allow us\n      to calculate the approximate ending solvency of:\n      $$\n      s(x) \\approx z(x) - \\tfrac{e(x)}{c} - z_{min}\n      $$\n      If we let the initial solvency be given by $s_0$, we can solve for\n      $x$ as:\n      $$\n      x = \\frac{c}{2} \\cdot \\frac{s_0 + min(exposure_{c}, 0)}{\n              p_r^{-1} +\n              \\phi_{g} \\cdot \\phi_{c} \\cdot \\left( 1 - p \\right) -\n              1 -\n              \\phi_{c} \\cdot \\left( p^{-1} - 1 \\right)\n          }\n      $$\n @param _params The max long calculation parameters.\n @param _checkpointExposure The exposure in the checkpoint.\n @param _spotPrice The spot price of the pool.\n @param _estimatePrice The estimated realized price the max long will pay.\n @return A conservative estimate of the max long that the pool can open." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateMaxLongEstimate", "nameLocation": "24397:24:237", "parameters": { "id": 160059, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160052, "mutability": "mutable", "name": "_params", "nameLocation": "24453:7:237", "nodeType": "VariableDeclaration", "scope": 160139, "src": "24431:29:237", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" }, "typeName": { "id": 160051, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 160050, "name": "MaxTradeParams", "nameLocations": ["24431:14:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 159592, "src": "24431:14:237" }, "referencedDeclaration": 159592, "src": "24431:14:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_storage_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" } }, "visibility": "internal" }, { "constant": false, "id": 160054, "mutability": "mutable", "name": "_checkpointExposure", "nameLocation": "24477:19:237", "nodeType": "VariableDeclaration", "scope": 160139, "src": "24470:26:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" }, "typeName": { "id": 160053, "name": "int256", "nodeType": "ElementaryTypeName", "src": "24470:6:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "visibility": "internal" }, { "constant": false, "id": 160056, "mutability": "mutable", "name": "_spotPrice", "nameLocation": "24514:10:237", "nodeType": "VariableDeclaration", "scope": 160139, "src": "24506:18:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160055, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "24506:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160058, "mutability": "mutable", "name": "_estimatePrice", "nameLocation": "24542:14:237", "nodeType": "VariableDeclaration", "scope": 160139, "src": "24534:22:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160057, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "24534:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "24421:141:237" }, "returnParameters": { "id": 160062, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160061, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 160139, "src": "24586:7:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160060, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "24586:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "24585:9:237" }, "scope": 161566, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 160247, "nodeType": "FunctionDefinition", "src": "27211:1307:237", "nodes": [], "body": { "id": 160246, "nodeType": "Block", "src": "27452:1066:237", "nodes": [], "statements": [{ "assignments": [160159], "declarations": [{ "constant": false, "id": 160159, "mutability": "mutable", "name": "governanceFee", "nameLocation": "27470:13:237", "nodeType": "VariableDeclaration", "scope": 160246, "src": "27462:21:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160158, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "27462:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160168, "initialValue": { "arguments": [{ "id": 160161, "name": "_baseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160147, "src": "27526:11:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160162, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160151, "src": "27551:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160163, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160143, "src": "27575:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160164, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "27583:8:237", "memberName": "curveFee", "nodeType": "MemberAccess", "referencedDeclaration": 159587, "src": "27575:16:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160165, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160143, "src": "27605:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160166, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "27613:15:237", "memberName": "governanceLPFee", "nodeType": "MemberAccess", "referencedDeclaration": 159591, "src": "27605:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 160160, "name": "calculateLongGovernanceFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160533, "src": "27486:26:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256,uint256) pure returns (uint256)" } }, "id": 160167, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "27486:152:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "27462:176:237" }, { "assignments": [160170], "declarations": [{ "constant": false, "id": 160170, "mutability": "mutable", "name": "shareReserves", "nameLocation": "27656:13:237", "nodeType": "VariableDeclaration", "scope": 160246, "src": "27648:21:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160169, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "27648:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160185, "initialValue": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160184, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160178, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "expression": { "id": 160171, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160143, "src": "27672:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160172, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "27680:13:237", "memberName": "shareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159569, "src": "27672:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "arguments": [{ "expression": { "id": 160175, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160143, "src": "27728:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160176, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "27736:15:237", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159581, "src": "27728:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160173, "name": "_baseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160147, "src": "27708:11:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160174, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "27720:7:237", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "27708:19:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160177, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "27708:44:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "27672:80:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [{ "expression": { "id": 160181, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160143, "src": "27789:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160182, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "27797:15:237", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159581, "src": "27789:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160179, "name": "governanceFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160159, "src": "27767:13:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160180, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "27781:7:237", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "27767:21:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160183, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "27767:46:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "27672:141:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "27648:165:237" }, { "assignments": [160187], "declarations": [{ "constant": false, "id": 160187, "mutability": "mutable", "name": "exposure", "nameLocation": "27831:8:237", "nodeType": "VariableDeclaration", "scope": 160246, "src": "27823:16:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160186, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "27823:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160192, "initialValue": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160191, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "expression": { "id": 160188, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160143, "src": "27842:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160189, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "27850:12:237", "memberName": "longExposure", "nodeType": "MemberAccess", "referencedDeclaration": 159577, "src": "27842:20:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "id": 160190, "name": "_bondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160149, "src": "27865:11:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "27842:34:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "27823:53:237" }, { "assignments": [160194], "declarations": [{ "constant": false, "id": 160194, "mutability": "mutable", "name": "checkpointExposure", "nameLocation": "27894:18:237", "nodeType": "VariableDeclaration", "scope": 160246, "src": "27886:26:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160193, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "27886:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160203, "initialValue": { "arguments": [{ "id": 160201, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "UnaryOperation", "operator": "-", "prefix": true, "src": "27923:27:237", "subExpression": { "arguments": [{ "hexValue": "30", "id": 160199, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "27948:1:237", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }], "expression": { "id": 160197, "name": "_checkpointExposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160145, "src": "27924:19:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "id": 160198, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "27944:3:237", "memberName": "min", "nodeType": "MemberAccess", "referencedDeclaration": 19553, "src": "27924:23:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_int256_$_t_int256_$returns$_t_int256_$attached_to$_t_int256_$", "typeString": "function (int256,int256) pure returns (int256)" } }, "id": 160200, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "27924:26:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 160196, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "27915:7:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_uint256_$", "typeString": "type(uint256)" }, "typeName": { "id": 160195, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "27915:7:237", "typeDescriptions": {} } }, "id": 160202, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "27915:36:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "27886:65:237" }, { "condition": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160219, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160210, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160204, "name": "shareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160170, "src": "27978:13:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "arguments": [{ "expression": { "id": 160207, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160143, "src": "28037:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160208, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "28045:15:237", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159581, "src": "28037:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160205, "name": "checkpointExposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160194, "src": "28010:18:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160206, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "28029:7:237", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "28010:26:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160209, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "28010:51:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "27978:83:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": ">=", "rightExpression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160218, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "arguments": [{ "expression": { "id": 160213, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160143, "src": "28094:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160214, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "28102:15:237", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159581, "src": "28094:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160211, "name": "exposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160187, "src": "28077:8:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160212, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "28086:7:237", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "28077:16:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160215, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "28077:41:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "expression": { "id": 160216, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160143, "src": "28137:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160217, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "28145:20:237", "memberName": "minimumShareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159585, "src": "28137:28:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "28077:88:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "27978:187:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "falseBody": { "id": 160244, "nodeType": "Block", "src": "28470:42:237", "statements": [{ "expression": { "components": [{ "hexValue": "30", "id": 160240, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "28492:1:237", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }, { "hexValue": "66616c7365", "id": 160241, "isConstant": false, "isLValue": false, "isPure": true, "kind": "bool", "lValueRequested": false, "nodeType": "Literal", "src": "28495:5:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "value": "false" }], "id": 160242, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "TupleExpression", "src": "28491:10:237", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_rational_0_by_1_$_t_bool_$", "typeString": "tuple(int_const 0,bool)" } }, "functionReturnParameters": 160157, "id": 160243, "nodeType": "Return", "src": "28484:17:237" }] }, "id": 160245, "nodeType": "IfStatement", "src": "27961:551:237", "trueBody": { "id": 160239, "nodeType": "Block", "src": "28176:288:237", "statements": [{ "expression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160235, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160232, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160226, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160220, "name": "shareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160170, "src": "28215:13:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "arguments": [{ "expression": { "id": 160223, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160143, "src": "28278:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160224, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "28286:15:237", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159581, "src": "28278:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160221, "name": "checkpointExposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160194, "src": "28251:18:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160222, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "28270:7:237", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "28251:26:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160225, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "28251:51:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "28215:87:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [{ "expression": { "id": 160229, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160143, "src": "28342:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160230, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "28350:15:237", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159581, "src": "28342:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160227, "name": "exposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160187, "src": "28325:8:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160228, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "28334:7:237", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "28325:16:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160231, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "28325:41:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "28215:151:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 160233, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160143, "src": "28389:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160234, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "28397:20:237", "memberName": "minimumShareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159585, "src": "28389:28:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "28215:202:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "hexValue": "74727565", "id": 160236, "isConstant": false, "isLValue": false, "isPure": true, "kind": "bool", "lValueRequested": false, "nodeType": "Literal", "src": "28435:4:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "value": "true" }], "id": 160237, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "28197:256:237", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "functionReturnParameters": 160157, "id": 160238, "nodeType": "Return", "src": "28190:263:237" }] } }] }, "documentation": { "id": 160140, "nodeType": "StructuredDocumentation", "src": "25341:1865:237", "text": "@dev Gets the solvency of the pool $S(x)$ after a long is opened with a\n      base amount $x$.\n      Since longs can net out with shorts in this checkpoint, we decrease\n      the global exposure variable by any negative exposure we have\n      in the checkpoint. The pool's solvency is calculated as:\n      $$\n      s = z - \\tfrac{exposure + min(exposure_{checkpoint}, 0)}{c} - z_{min}\n      $$\n      When a long is opened, the share reserves $z$ increase by:\n      $$\n      \\Delta z = \\tfrac{x - g(x)}{c}\n      $$\n      Opening the long increases the non-netted longs by the bond amount.\n      From this, the change in the exposure is given by:\n      $$\n      \\Delta exposure = y(x)\n      $$\n      From this, we can calculate $S(x)$ as:\n      $$\n      S(x) = \\left( z + \\Delta z \\right) - \\left(\n                 \\tfrac{\n                     exposure +\n                     min(exposure_{checkpoint}, 0) +\n                     \\Delta exposure\n                 }{c}\n             \\right) - z_{min}\n      $$\n      It's possible that the pool is insolvent after opening a long. In\n      this case, we return `None` since the fixed point library can't\n      represent negative numbers.\n @param _params The max long calculation parameters.\n @param _checkpointExposure The exposure in the checkpoint.\n @param _baseAmount The base amount.\n @param _bondAmount The bond amount.\n @param _spotPrice The spot price.\n @return The solvency of the pool.\n @return A flag indicating that the pool is solvent if true and insolvent\n         if false." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateSolvencyAfterLong", "nameLocation": "27220:26:237", "parameters": { "id": 160152, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160143, "mutability": "mutable", "name": "_params", "nameLocation": "27278:7:237", "nodeType": "VariableDeclaration", "scope": 160247, "src": "27256:29:237", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" }, "typeName": { "id": 160142, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 160141, "name": "MaxTradeParams", "nameLocations": ["27256:14:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 159592, "src": "27256:14:237" }, "referencedDeclaration": 159592, "src": "27256:14:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_storage_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" } }, "visibility": "internal" }, { "constant": false, "id": 160145, "mutability": "mutable", "name": "_checkpointExposure", "nameLocation": "27302:19:237", "nodeType": "VariableDeclaration", "scope": 160247, "src": "27295:26:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" }, "typeName": { "id": 160144, "name": "int256", "nodeType": "ElementaryTypeName", "src": "27295:6:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "visibility": "internal" }, { "constant": false, "id": 160147, "mutability": "mutable", "name": "_baseAmount", "nameLocation": "27339:11:237", "nodeType": "VariableDeclaration", "scope": 160247, "src": "27331:19:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160146, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "27331:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160149, "mutability": "mutable", "name": "_bondAmount", "nameLocation": "27368:11:237", "nodeType": "VariableDeclaration", "scope": 160247, "src": "27360:19:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160148, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "27360:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160151, "mutability": "mutable", "name": "_spotPrice", "nameLocation": "27397:10:237", "nodeType": "VariableDeclaration", "scope": 160247, "src": "27389:18:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160150, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "27389:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "27246:167:237" }, "returnParameters": { "id": 160157, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160154, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 160247, "src": "27437:7:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160153, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "27437:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160156, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 160247, "src": "27446:4:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "typeName": { "id": 160155, "name": "bool", "nodeType": "ElementaryTypeName", "src": "27446:4:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "visibility": "internal" }], "src": "27436:15:237" }, "scope": 161566, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 160311, "nodeType": "FunctionDefinition", "src": "29903:929:237", "nodes": [], "body": { "id": 160310, "nodeType": "Block", "src": "30149:683:237", "nodes": [], "statements": [{ "expression": { "id": 160273, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "components": [{ "id": 160264, "name": "derivative", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160260, "src": "30315:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160265, "name": "success", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160262, "src": "30327:7:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }], "id": 160266, "isConstant": false, "isInlineArray": false, "isLValue": true, "isPure": false, "lValueRequested": true, "nodeType": "TupleExpression", "src": "30314:21:237", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 160268, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160251, "src": "30381:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, { "id": 160269, "name": "_baseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160253, "src": "30402:11:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160270, "name": "_effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160255, "src": "30427:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160271, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160257, "src": "30464:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 160267, "name": "calculateLongAmountDerivative", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160480, "src": "30338:29:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_MaxTradeParams_$159592_memory_ptr_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$_t_bool_$", "typeString": "function (struct HyperdriveUtils.MaxTradeParams memory,uint256,uint256,uint256) pure returns (uint256,bool)" } }, "id": 160272, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "30338:146:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "src": "30314:170:237", "typeDescriptions": { "typeIdentifier": "t_tuple$__$", "typeString": "tuple()" } }, "id": 160274, "nodeType": "ExpressionStatement", "src": "30314:170:237" }, { "condition": { "id": 160276, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "UnaryOperation", "operator": "!", "prefix": true, "src": "30498:8:237", "subExpression": { "id": 160275, "name": "success", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160262, "src": "30499:7:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "id": 160282, "nodeType": "IfStatement", "src": "30494:58:237", "trueBody": { "id": 160281, "nodeType": "Block", "src": "30508:44:237", "statements": [{ "expression": { "components": [{ "hexValue": "30", "id": 160277, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "30530:1:237", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }, { "id": 160278, "name": "success", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160262, "src": "30533:7:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }], "id": 160279, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "30529:12:237", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_rational_0_by_1_$_t_bool_$", "typeString": "tuple(int_const 0,bool)" } }, "functionReturnParameters": 160263, "id": 160280, "nodeType": "Return", "src": "30522:19:237" }] } }, { "expression": { "id": 160295, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 160283, "name": "derivative", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160260, "src": "30606:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "+=", "rightHandSide": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160293, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160291, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "30691:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 160292, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160257, "src": "30697:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "30691:16:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "expression": { "id": 160287, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160251, "src": "30652:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160288, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "30660:8:237", "memberName": "curveFee", "nodeType": "MemberAccess", "referencedDeclaration": 159587, "src": "30652:16:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 160284, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160251, "src": "30620:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160285, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "30628:15:237", "memberName": "governanceLPFee", "nodeType": "MemberAccess", "referencedDeclaration": 159591, "src": "30620:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160286, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "30644:7:237", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "30620:31:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160289, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "30620:49:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160290, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "30670:7:237", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "30620:57:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160294, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "30620:97:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "30606:111:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160296, "nodeType": "ExpressionStatement", "src": "30606:111:237" }, { "expression": { "id": 160299, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 160297, "name": "derivative", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160260, "src": "30727:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "-=", "rightHandSide": { "id": 160298, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "30741:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "30727:17:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160300, "nodeType": "ExpressionStatement", "src": "30727:17:237" }, { "expression": { "components": [{ "arguments": [{ "hexValue": "31653138", "id": 160303, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "30785:4:237", "typeDescriptions": { "typeIdentifier": "t_rational_1000000000000000000_by_1", "typeString": "int_const 1000000000000000000" }, "value": "1e18" }, { "expression": { "id": 160304, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160251, "src": "30791:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160305, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "30799:15:237", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159581, "src": "30791:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_rational_1000000000000000000_by_1", "typeString": "int_const 1000000000000000000" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160301, "name": "derivative", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160260, "src": "30763:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160302, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "30774:10:237", "memberName": "mulDivDown", "nodeType": "MemberAccess", "referencedDeclaration": 18834, "src": "30763:21:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 160306, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "30763:52:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160307, "name": "success", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160262, "src": "30817:7:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }], "id": 160308, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "30762:63:237", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "functionReturnParameters": 160263, "id": 160309, "nodeType": "Return", "src": "30755:70:237" }] }, "documentation": { "id": 160248, "nodeType": "StructuredDocumentation", "src": "28524:1374:237", "text": "@dev Gets the negation of the derivative of the pool's solvency with\n      respect to the base amount that the long pays.\n      The derivative of the pool's solvency $S(x)$ with respect to the\n      base amount that the long pays is given by:\n      $$\n      S'(x) = \\tfrac{1}{c} \\cdot \\left(\n                  1 - y'(x) - \\phi_{g} \\cdot p \\cdot c'(x)\n              \\right) \\\\\n            = \\tfrac{1}{c} \\cdot \\left(\n                  1 - y'(x) - \\phi_{g} \\cdot \\phi_{c} \\cdot \\left(\n                      1 - p\n                  \\right)\n              \\right)\n      $$\n      This derivative is negative since solvency decreases as more longs\n      are opened. We use the negation of the derivative to stay in the\n      positive domain, which allows us to use the fixed point library.\n @param _params The max long calculation parameters.\n @param _baseAmount The base amount.\n @param _effectiveShareReserves The effective share reserves.\n @param _spotPrice The spot price.\n @return derivative The negation of the derivative of the pool's solvency\n         w.r.t the base amount.\n @return success A flag indicating whether or not the derivative was\n         successfully calculated." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateSolvencyAfterLongDerivative", "nameLocation": "29912:36:237", "parameters": { "id": 160258, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160251, "mutability": "mutable", "name": "_params", "nameLocation": "29980:7:237", "nodeType": "VariableDeclaration", "scope": 160311, "src": "29958:29:237", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" }, "typeName": { "id": 160250, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 160249, "name": "MaxTradeParams", "nameLocations": ["29958:14:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 159592, "src": "29958:14:237" }, "referencedDeclaration": 159592, "src": "29958:14:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_storage_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" } }, "visibility": "internal" }, { "constant": false, "id": 160253, "mutability": "mutable", "name": "_baseAmount", "nameLocation": "30005:11:237", "nodeType": "VariableDeclaration", "scope": 160311, "src": "29997:19:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160252, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "29997:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160255, "mutability": "mutable", "name": "_effectiveShareReserves", "nameLocation": "30034:23:237", "nodeType": "VariableDeclaration", "scope": 160311, "src": "30026:31:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160254, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "30026:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160257, "mutability": "mutable", "name": "_spotPrice", "nameLocation": "30075:10:237", "nodeType": "VariableDeclaration", "scope": 160311, "src": "30067:18:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160256, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "30067:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "29948:143:237" }, "returnParameters": { "id": 160263, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160260, "mutability": "mutable", "name": "derivative", "nameLocation": "30123:10:237", "nodeType": "VariableDeclaration", "scope": 160311, "src": "30115:18:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160259, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "30115:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160262, "mutability": "mutable", "name": "success", "nameLocation": "30140:7:237", "nodeType": "VariableDeclaration", "scope": 160311, "src": "30135:12:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "typeName": { "id": 160261, "name": "bool", "nodeType": "ElementaryTypeName", "src": "30135:4:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "visibility": "internal" }], "src": "30114:34:237" }, "scope": 161566, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 160356, "nodeType": "FunctionDefinition", "src": "31845:645:237", "nodes": [], "body": { "id": 160355, "nodeType": "Block", "src": "32049:441:237", "nodes": [], "statements": [{ "assignments": [160327], "declarations": [{ "constant": false, "id": 160327, "mutability": "mutable", "name": "longAmount", "nameLocation": "32067:10:237", "nodeType": "VariableDeclaration", "scope": 160355, "src": "32059:18:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160326, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "32059:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160345, "initialValue": { "arguments": [{ "id": 160330, "name": "_effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160319, "src": "32126:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160331, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160315, "src": "32163:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160332, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "32171:12:237", "memberName": "bondReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159573, "src": "32163:20:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "arguments": [{ "expression": { "id": 160335, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160315, "src": "32217:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160336, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "32225:15:237", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159581, "src": "32217:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160333, "name": "_baseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160317, "src": "32197:11:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160334, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "32209:7:237", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "32197:19:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160337, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "32197:44:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160338, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160315, "src": "32255:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160339, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "32263:11:237", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159579, "src": "32255:19:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160340, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160315, "src": "32288:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160341, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "32296:15:237", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159581, "src": "32288:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160342, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160315, "src": "32325:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160343, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "32333:22:237", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159583, "src": "32325:30:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160328, "name": "HyperdriveMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20320, "src": "32080:14:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_HyperdriveMath_$20320_$", "typeString": "type(library HyperdriveMath)" } }, "id": 160329, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "32095:17:237", "memberName": "calculateOpenLong", "nodeType": "MemberAccess", "referencedDeclaration": 20058, "src": "32080:32:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256,uint256,uint256,uint256) pure returns (uint256)" } }, "id": 160344, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "32080:285:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "32059:306:237" }, { "expression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160353, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160346, "name": "longAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160327, "src": "32394:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [{ "id": 160348, "name": "_baseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160317, "src": "32441:11:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160349, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160321, "src": "32454:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160350, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160315, "src": "32466:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160351, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "32474:8:237", "memberName": "curveFee", "nodeType": "MemberAccess", "referencedDeclaration": 159587, "src": "32466:16:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 160347, "name": "calculateLongCurveFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160506, "src": "32419:21:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 160352, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "32419:64:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "32394:89:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 160325, "id": 160354, "nodeType": "Return", "src": "32375:108:237" }] }, "documentation": { "id": 160312, "nodeType": "StructuredDocumentation", "src": "30838:1002:237", "text": "@dev Gets the long amount that will be opened for a given base amount.\n      The long amount $y(x)$ that a trader will receive is given by:\n      $$\n      y(x) = y_{*}(x) - c(x)\n      $$\n      Where $y_{*}(x)$ is the amount of long that would be opened if there\n      was no curve fee and [$c(x)$](long_curve_fee) is the curve fee.\n      $y_{*}(x)$ is given by:\n      $$\n      y_{*}(x) = y - \\left(\n                     k - \\tfrac{c}{\\mu} \\cdot \\left(\n                         \\mu \\cdot \\left( z - \\zeta + \\tfrac{x}{c}\n                     \\right) \\right)^{1 - t_s}\n                 \\right)^{\\tfrac{1}{1 - t_s}}\n      $$\n @param _params The max long calculation parameters.\n @param _baseAmount The base amount.\n @param _effectiveShareReserves The effective share reserves.\n @param _spotPrice The spot price.\n @return The long amount." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateLongAmount", "nameLocation": "31854:19:237", "parameters": { "id": 160322, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160315, "mutability": "mutable", "name": "_params", "nameLocation": "31905:7:237", "nodeType": "VariableDeclaration", "scope": 160356, "src": "31883:29:237", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" }, "typeName": { "id": 160314, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 160313, "name": "MaxTradeParams", "nameLocations": ["31883:14:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 159592, "src": "31883:14:237" }, "referencedDeclaration": 159592, "src": "31883:14:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_storage_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" } }, "visibility": "internal" }, { "constant": false, "id": 160317, "mutability": "mutable", "name": "_baseAmount", "nameLocation": "31930:11:237", "nodeType": "VariableDeclaration", "scope": 160356, "src": "31922:19:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160316, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "31922:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160319, "mutability": "mutable", "name": "_effectiveShareReserves", "nameLocation": "31959:23:237", "nodeType": "VariableDeclaration", "scope": 160356, "src": "31951:31:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160318, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "31951:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160321, "mutability": "mutable", "name": "_spotPrice", "nameLocation": "32000:10:237", "nodeType": "VariableDeclaration", "scope": 160356, "src": "31992:18:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160320, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "31992:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "31873:143:237" }, "returnParameters": { "id": 160325, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160324, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 160356, "src": "32040:7:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160323, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "32040:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "32039:9:237" }, "scope": 161566, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 160480, "nodeType": "FunctionDefinition", "src": "33928:1494:237", "nodes": [], "body": { "id": 160479, "nodeType": "Block", "src": "34159:1263:237", "nodes": [], "statements": [{ "assignments": [160374], "declarations": [{ "constant": false, "id": 160374, "mutability": "mutable", "name": "shareAmount", "nameLocation": "34230:11:237", "nodeType": "VariableDeclaration", "scope": 160479, "src": "34222:19:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160373, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "34222:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160380, "initialValue": { "arguments": [{ "expression": { "id": 160377, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160360, "src": "34264:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160378, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "34272:15:237", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159581, "src": "34264:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160375, "name": "_baseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160362, "src": "34244:11:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160376, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "34256:7:237", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "34244:19:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160379, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "34244:44:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "34222:66:237" }, { "assignments": [160382], "declarations": [{ "constant": false, "id": 160382, "mutability": "mutable", "name": "inner", "nameLocation": "34306:5:237", "nodeType": "VariableDeclaration", "scope": 160479, "src": "34298:13:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160381, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "34298:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160390, "initialValue": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160388, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160386, "name": "_effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160364, "src": "34366:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "id": 160387, "name": "shareAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160374, "src": "34392:11:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "34366:37:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 160383, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160360, "src": "34314:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160384, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "34322:22:237", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159583, "src": "34314:30:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160385, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "34345:7:237", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "34314:38:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160389, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "34314:99:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "34298:115:237" }, { "assignments": [160392], "declarations": [{ "constant": false, "id": 160392, "mutability": "mutable", "name": "k_", "nameLocation": "34431:2:237", "nodeType": "VariableDeclaration", "scope": 160479, "src": "34423:10:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160391, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "34423:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160407, "initialValue": { "arguments": [{ "id": 160395, "name": "_effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160364, "src": "34470:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160396, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160360, "src": "34507:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160397, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "34515:12:237", "memberName": "bondReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159573, "src": "34507:20:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160401, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160398, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "34541:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 160399, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160360, "src": "34547:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160400, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "34555:11:237", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159579, "src": "34547:19:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "34541:25:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160402, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160360, "src": "34580:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160403, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "34588:15:237", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159581, "src": "34580:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160404, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160360, "src": "34617:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160405, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "34625:22:237", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159583, "src": "34617:30:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160393, "name": "YieldSpaceMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 23422, "src": "34436:14:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_YieldSpaceMath_$23422_$", "typeString": "type(library YieldSpaceMath)" } }, "id": 160394, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "34451:5:237", "memberName": "kDown", "nodeType": "MemberAccess", "referencedDeclaration": 23421, "src": "34436:20:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256,uint256,uint256) pure returns (uint256)" } }, "id": 160406, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "34436:221:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "34423:234:237" }, { "expression": { "id": 160417, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 160408, "name": "derivative", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160369, "src": "34667:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "arguments": [{ "expression": { "id": 160413, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160360, "src": "34702:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160414, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "34710:11:237", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159579, "src": "34702:19:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160411, "name": "inner", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160382, "src": "34692:5:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160412, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "34698:3:237", "memberName": "pow", "nodeType": "MemberAccess", "referencedDeclaration": 18977, "src": "34692:9:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160415, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "34692:30:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160409, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "34680:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160410, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "34684:7:237", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "34680:11:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160416, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "34680:43:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "34667:56:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160418, "nodeType": "ExpressionStatement", "src": "34667:56:237" }, { "assignments": [160420], "declarations": [{ "constant": false, "id": 160420, "mutability": "mutable", "name": "rhs", "nameLocation": "34919:3:237", "nodeType": "VariableDeclaration", "scope": 160479, "src": "34911:11:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160419, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "34911:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160432, "initialValue": { "arguments": [{ "arguments": [{ "expression": { "id": 160426, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160360, "src": "34983:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160427, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "34991:11:237", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159579, "src": "34983:19:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160424, "name": "inner", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160382, "src": "34973:5:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160425, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "34979:3:237", "memberName": "pow", "nodeType": "MemberAccess", "referencedDeclaration": 18977, "src": "34973:9:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160428, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "34973:30:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160429, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160360, "src": "35017:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160430, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "35025:22:237", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159583, "src": "35017:30:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 160421, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160360, "src": "34925:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160422, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "34933:15:237", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159581, "src": "34925:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160423, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "34949:10:237", "memberName": "mulDivDown", "nodeType": "MemberAccess", "referencedDeclaration": 18834, "src": "34925:34:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 160431, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "34925:132:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "34911:146:237" }, { "condition": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160435, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160433, "name": "k_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160392, "src": "35071:2:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "<", "rightExpression": { "id": 160434, "name": "rhs", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160420, "src": "35076:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "35071:8:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "id": 160441, "nodeType": "IfStatement", "src": "35067:56:237", "trueBody": { "id": 160440, "nodeType": "Block", "src": "35081:42:237", "statements": [{ "expression": { "components": [{ "hexValue": "30", "id": 160436, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "35103:1:237", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }, { "hexValue": "66616c7365", "id": 160437, "isConstant": false, "isLValue": false, "isPure": true, "kind": "bool", "lValueRequested": false, "nodeType": "Literal", "src": "35106:5:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "value": "false" }], "id": 160438, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "TupleExpression", "src": "35102:10:237", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_rational_0_by_1_$_t_bool_$", "typeString": "tuple(int_const 0,bool)" } }, "functionReturnParameters": 160372, "id": 160439, "nodeType": "Return", "src": "35095:17:237" }] } }, { "expression": { "id": 160460, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 160442, "name": "derivative", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160369, "src": "35132:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "arguments": [{ "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160456, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160453, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "35218:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 160454, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160360, "src": "35224:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160455, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "35232:11:237", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159579, "src": "35224:19:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "35218:25:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 160450, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160360, "src": "35192:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160451, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "35200:11:237", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159579, "src": "35192:19:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160452, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "35212:5:237", "memberName": "divUp", "nodeType": "MemberAccess", "referencedDeclaration": 18920, "src": "35192:25:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160457, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "35192:52:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160447, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160445, "name": "k_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160392, "src": "35178:2:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 160446, "name": "rhs", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160420, "src": "35183:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "35178:8:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 160448, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "35177:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160449, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "35188:3:237", "memberName": "pow", "nodeType": "MemberAccess", "referencedDeclaration": 18977, "src": "35177:14:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160458, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "35177:68:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160443, "name": "derivative", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160369, "src": "35145:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160444, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "35156:7:237", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "35145:18:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160459, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "35145:110:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "35132:123:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160461, "nodeType": "ExpressionStatement", "src": "35132:123:237" }, { "expression": { "id": 160473, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 160462, "name": "derivative", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160369, "src": "35310:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "-=", "rightHandSide": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160471, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "arguments": [{ "id": 160468, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160366, "src": "35361:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160466, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "35349:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160467, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "35353:7:237", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "35349:11:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160469, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "35349:23:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 160470, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "35375:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "35349:29:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 160463, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160360, "src": "35324:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160464, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "35332:8:237", "memberName": "curveFee", "nodeType": "MemberAccess", "referencedDeclaration": 159587, "src": "35324:16:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160465, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "35341:7:237", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "35324:24:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160472, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "35324:55:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "35310:69:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160474, "nodeType": "ExpressionStatement", "src": "35310:69:237" }, { "expression": { "components": [{ "id": 160475, "name": "derivative", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160369, "src": "35398:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "hexValue": "74727565", "id": 160476, "isConstant": false, "isLValue": false, "isPure": true, "kind": "bool", "lValueRequested": false, "nodeType": "Literal", "src": "35410:4:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "value": "true" }], "id": 160477, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "35397:18:237", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "functionReturnParameters": 160372, "id": 160478, "nodeType": "Return", "src": "35390:25:237" }] }, "documentation": { "id": 160357, "nodeType": "StructuredDocumentation", "src": "32496:1427:237", "text": "@dev Gets the derivative of [long_amount](long_amount) with respect to\n      the base amount.\n      We calculate the derivative of the long amount $y(x)$ as:\n      $$\n      y'(x) = y_{*}'(x) - c'(x)\n      $$\n      Where $y_{*}'(x)$ is the derivative of $y_{*}(x)$ and $c'(x)$ is the\n      derivative of [$c(x)$](long_curve_fee). $y_{*}'(x)$ is given by:\n      $$\n      y_{*}'(x) = \\left( \\mu \\cdot (z - \\zeta + \\tfrac{x}{c}) \\right)^{-t_s}\n                  \\left(\n                      k - \\tfrac{c}{\\mu} \\cdot\n                      \\left(\n                          \\mu \\cdot (z - \\zeta + \\tfrac{x}{c}\n                      \\right)^{1 - t_s}\n                  \\right)^{\\tfrac{t_s}{1 - t_s}}\n      $$\n      and $c'(x)$ is given by:\n      $$\n      c'(x) = \\phi_{c} \\cdot \\left( \\tfrac{1}{p} - 1 \\right)\n      $$\n @param _params The max long calculation parameters.\n @param _baseAmount The base amount.\n @param _spotPrice The spot price.\n @param _effectiveShareReserves The effective share reserves.\n @return derivative The derivative of the long amount w.r.t. the base\n         amount.\n @return A flag indicating whether or not the derivative was\n         successfully calculated." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateLongAmountDerivative", "nameLocation": "33937:29:237", "parameters": { "id": 160367, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160360, "mutability": "mutable", "name": "_params", "nameLocation": "33998:7:237", "nodeType": "VariableDeclaration", "scope": 160480, "src": "33976:29:237", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" }, "typeName": { "id": 160359, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 160358, "name": "MaxTradeParams", "nameLocations": ["33976:14:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 159592, "src": "33976:14:237" }, "referencedDeclaration": 159592, "src": "33976:14:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_storage_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" } }, "visibility": "internal" }, { "constant": false, "id": 160362, "mutability": "mutable", "name": "_baseAmount", "nameLocation": "34023:11:237", "nodeType": "VariableDeclaration", "scope": 160480, "src": "34015:19:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160361, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "34015:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160364, "mutability": "mutable", "name": "_effectiveShareReserves", "nameLocation": "34052:23:237", "nodeType": "VariableDeclaration", "scope": 160480, "src": "34044:31:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160363, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "34044:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160366, "mutability": "mutable", "name": "_spotPrice", "nameLocation": "34093:10:237", "nodeType": "VariableDeclaration", "scope": 160480, "src": "34085:18:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160365, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "34085:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "33966:143:237" }, "returnParameters": { "id": 160372, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160369, "mutability": "mutable", "name": "derivative", "nameLocation": "34141:10:237", "nodeType": "VariableDeclaration", "scope": 160480, "src": "34133:18:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160368, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "34133:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160371, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 160480, "src": "34153:4:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "typeName": { "id": 160370, "name": "bool", "nodeType": "ElementaryTypeName", "src": "34153:4:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "visibility": "internal" }], "src": "34132:26:237" }, "scope": 161566, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 160506, "nodeType": "FunctionDefinition", "src": "35831:330:237", "nodes": [], "body": { "id": 160505, "nodeType": "Block", "src": "35984:177:237", "nodes": [], "statements": [{ "expression": { "arguments": [{ "id": 160502, "name": "_baseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160483, "src": "36129:11:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160499, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "arguments": [{ "id": 160496, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160485, "src": "36085:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160494, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "36073:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160495, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "36077:7:237", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "36073:11:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160497, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "36073:23:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 160498, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "36099:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "36073:29:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160492, "name": "_curveFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160487, "src": "36055:9:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160493, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "36065:7:237", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "36055:17:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160500, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "36055:48:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160501, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "36104:7:237", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "36055:56:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160503, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "36055:99:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 160491, "id": 160504, "nodeType": "Return", "src": "36036:118:237" }] }, "documentation": { "id": 160481, "nodeType": "StructuredDocumentation", "src": "35428:398:237", "text": "@dev Gets the curve fee paid by longs for a given base amount.\n      The curve fee $c(x)$ paid by longs is given by:\n      $$\n      c(x) = \\phi_{c} \\cdot \\left( \\tfrac{1}{p} - 1 \\right) \\cdot x\n      $$\n @param _baseAmount The base amount, $x$.\n @param _spotPrice The spot price, $p$.\n @param _curveFee The curve fee, $\\phi_{c}$." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateLongCurveFee", "nameLocation": "35840:21:237", "parameters": { "id": 160488, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160483, "mutability": "mutable", "name": "_baseAmount", "nameLocation": "35879:11:237", "nodeType": "VariableDeclaration", "scope": 160506, "src": "35871:19:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160482, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "35871:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160485, "mutability": "mutable", "name": "_spotPrice", "nameLocation": "35908:10:237", "nodeType": "VariableDeclaration", "scope": 160506, "src": "35900:18:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160484, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "35900:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160487, "mutability": "mutable", "name": "_curveFee", "nameLocation": "35936:9:237", "nodeType": "VariableDeclaration", "scope": 160506, "src": "35928:17:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160486, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "35928:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "35861:90:237" }, "returnParameters": { "id": 160491, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160490, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 160506, "src": "35975:7:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160489, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "35975:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "35974:9:237" }, "scope": 161566, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 160533, "nodeType": "FunctionDefinition", "src": "36742:361:237", "nodes": [], "body": { "id": 160532, "nodeType": "Block", "src": "36934:169:237", "nodes": [], "statements": [{ "expression": { "arguments": [{ "arguments": [{ "id": 160526, "name": "_baseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160509, "src": "37047:11:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160527, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160511, "src": "37060:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160528, "name": "_curveFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160513, "src": "37072:9:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 160525, "name": "calculateLongCurveFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160506, "src": "37025:21:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 160529, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "37025:57:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "id": 160522, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160511, "src": "36988:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160520, "name": "_governanceLPFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160515, "src": "36963:16:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160521, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "36980:7:237", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "36963:24:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160523, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "36963:36:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160524, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "37000:7:237", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "36963:44:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160530, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "36963:133:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 160519, "id": 160531, "nodeType": "Return", "src": "36944:152:237" }] }, "documentation": { "id": 160507, "nodeType": "StructuredDocumentation", "src": "36167:570:237", "text": "@dev Gets the governance fee paid by longs for a given base amount.\n      Unlike the [curve fee](long_curve_fee) which is paid in bonds, the\n      governance fee is paid in base. The governance fee $g(x)$ paid by\n      longs is given by:\n      $$\n      g(x) = \\phi_{g} \\cdot p \\cdot c(x)\n      $$\n @param _baseAmount The base amount, $x$.\n @param _spotPrice The spot price, $p$.\n @param _curveFee The curve fee, $\\phi_{c}$.\n @param _governanceLPFee The governance fee, $\\phi_{g}$." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateLongGovernanceFee", "nameLocation": "36751:26:237", "parameters": { "id": 160516, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160509, "mutability": "mutable", "name": "_baseAmount", "nameLocation": "36795:11:237", "nodeType": "VariableDeclaration", "scope": 160533, "src": "36787:19:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160508, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "36787:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160511, "mutability": "mutable", "name": "_spotPrice", "nameLocation": "36824:10:237", "nodeType": "VariableDeclaration", "scope": 160533, "src": "36816:18:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160510, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "36816:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160513, "mutability": "mutable", "name": "_curveFee", "nameLocation": "36852:9:237", "nodeType": "VariableDeclaration", "scope": 160533, "src": "36844:17:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160512, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "36844:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160515, "mutability": "mutable", "name": "_governanceLPFee", "nameLocation": "36879:16:237", "nodeType": "VariableDeclaration", "scope": 160533, "src": "36871:24:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160514, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "36871:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "36777:124:237" }, "returnParameters": { "id": 160519, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160518, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 160533, "src": "36925:7:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160517, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "36925:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "36924:9:237" }, "scope": 161566, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 160541, "nodeType": "StructDefinition", "src": "37243:107:237", "nodes": [], "canonicalName": "HyperdriveUtils.MaxShortInternal", "documentation": { "id": 160534, "nodeType": "StructuredDocumentation", "src": "37109:129:237", "text": "@dev A struct used to hold extra variables in the max short calculation\n      function to avoid stack-too-deep errors." }, "members": [{ "constant": false, "id": 160536, "mutability": "mutable", "name": "solvency", "nameLocation": "37285:8:237", "nodeType": "VariableDeclaration", "scope": 160541, "src": "37277:16:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160535, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "37277:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160538, "mutability": "mutable", "name": "derivative", "nameLocation": "37311:10:237", "nodeType": "VariableDeclaration", "scope": 160541, "src": "37303:18:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160537, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "37303:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160540, "mutability": "mutable", "name": "success", "nameLocation": "37336:7:237", "nodeType": "VariableDeclaration", "scope": 160541, "src": "37331:12:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "typeName": { "id": 160539, "name": "bool", "nodeType": "ElementaryTypeName", "src": "37331:4:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "visibility": "internal" }], "name": "MaxShortInternal", "nameLocation": "37250:16:237", "scope": 161566, "visibility": "public" }, { "id": 160715, "nodeType": "FunctionDefinition", "src": "37638:4492:237", "nodes": [], "body": { "id": 160714, "nodeType": "Block", "src": "37810:4320:237", "nodes": [], "statements": [{ "assignments": [160556], "declarations": [{ "constant": false, "id": 160556, "mutability": "mutable", "name": "internal_", "nameLocation": "38101:9:237", "nodeType": "VariableDeclaration", "scope": 160714, "src": "38077:33:237", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxShortInternal_$160541_memory_ptr", "typeString": "struct HyperdriveUtils.MaxShortInternal" }, "typeName": { "id": 160555, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 160554, "name": "MaxShortInternal", "nameLocations": ["38077:16:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 160541, "src": "38077:16:237" }, "referencedDeclaration": 160541, "src": "38077:16:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxShortInternal_$160541_storage_ptr", "typeString": "struct HyperdriveUtils.MaxShortInternal" } }, "visibility": "internal" }], "id": 160557, "nodeType": "VariableDeclarationStatement", "src": "38077:33:237" }, { "assignments": [160559], "declarations": [{ "constant": false, "id": 160559, "mutability": "mutable", "name": "effectiveShareReserves", "nameLocation": "38128:22:237", "nodeType": "VariableDeclaration", "scope": 160714, "src": "38120:30:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160558, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "38120:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160567, "initialValue": { "arguments": [{ "expression": { "id": 160562, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160545, "src": "38230:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160563, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "38238:13:237", "memberName": "shareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159569, "src": "38230:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160564, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160545, "src": "38269:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160565, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "38277:15:237", "memberName": "shareAdjustment", "nodeType": "MemberAccess", "referencedDeclaration": 159571, "src": "38269:23:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_int256", "typeString": "int256" }], "expression": { "id": 160560, "name": "HyperdriveMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20320, "src": "38153:14:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_HyperdriveMath_$20320_$", "typeString": "type(library HyperdriveMath)" } }, "id": 160561, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "38181:31:237", "memberName": "calculateEffectiveShareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 19763, "src": "38153:59:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_int256_$returns$_t_uint256_$", "typeString": "function (uint256,int256) pure returns (uint256)" } }, "id": 160566, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "38153:153:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "38120:186:237" }, { "assignments": [160569], "declarations": [{ "constant": false, "id": 160569, "mutability": "mutable", "name": "spotPrice", "nameLocation": "38324:9:237", "nodeType": "VariableDeclaration", "scope": 160714, "src": "38316:17:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160568, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "38316:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160580, "initialValue": { "arguments": [{ "id": 160572, "name": "effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160559, "src": "38383:22:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160573, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160545, "src": "38419:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160574, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "38427:12:237", "memberName": "bondReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159573, "src": "38419:20:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160575, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160545, "src": "38453:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160576, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "38461:22:237", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159583, "src": "38453:30:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160577, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160545, "src": "38497:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160578, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "38505:11:237", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159579, "src": "38497:19:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160570, "name": "HyperdriveMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20320, "src": "38336:14:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_HyperdriveMath_$20320_$", "typeString": "type(library HyperdriveMath)" } }, "id": 160571, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "38351:18:237", "memberName": "calculateSpotPrice", "nodeType": "MemberAccess", "referencedDeclaration": 19690, "src": "38336:33:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256,uint256) pure returns (uint256)" } }, "id": 160579, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "38336:190:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "38316:210:237" }, { "assignments": [160582], "declarations": [{ "constant": false, "id": 160582, "mutability": "mutable", "name": "absoluteMaxBondAmount", "nameLocation": "38544:21:237", "nodeType": "VariableDeclaration", "scope": 160714, "src": "38536:29:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160581, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "38536:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160587, "initialValue": { "arguments": [{ "id": 160584, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160545, "src": "38609:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, { "id": 160585, "name": "effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160559, "src": "38630:22:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 160583, "name": "calculateMaxShortUpperBound", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160824, "src": "38568:27:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_MaxTradeParams_$159592_memory_ptr_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (struct HyperdriveUtils.MaxTradeParams memory,uint256) pure returns (uint256)" } }, "id": 160586, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "38568:94:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "38536:126:237" }, { "expression": { "id": 160601, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "components": [{ "expression": { "id": 160588, "name": "internal_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160556, "src": "38673:9:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxShortInternal_$160541_memory_ptr", "typeString": "struct HyperdriveUtils.MaxShortInternal memory" } }, "id": 160590, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": true, "memberLocation": "38683:8:237", "memberName": "solvency", "nodeType": "MemberAccess", "referencedDeclaration": 160536, "src": "38673:18:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160591, "name": "internal_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160556, "src": "38693:9:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxShortInternal_$160541_memory_ptr", "typeString": "struct HyperdriveUtils.MaxShortInternal memory" } }, "id": 160592, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": true, "memberLocation": "38703:7:237", "memberName": "success", "nodeType": "MemberAccess", "referencedDeclaration": 160540, "src": "38693:17:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }], "id": 160593, "isConstant": false, "isInlineArray": false, "isLValue": true, "isPure": false, "lValueRequested": true, "nodeType": "TupleExpression", "src": "38672:39:237", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 160595, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160545, "src": "38755:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, { "id": 160596, "name": "absoluteMaxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160582, "src": "38776:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160597, "name": "effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160559, "src": "38811:22:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160598, "name": "spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160569, "src": "38847:9:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160599, "name": "_checkpointExposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160547, "src": "38870:19:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 160594, "name": "calculateSolvencyAfterShort", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161015, "src": "38714:27:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_MaxTradeParams_$159592_memory_ptr_$_t_uint256_$_t_uint256_$_t_uint256_$_t_int256_$returns$_t_uint256_$_t_bool_$", "typeString": "function (struct HyperdriveUtils.MaxTradeParams memory,uint256,uint256,uint256,int256) pure returns (uint256,bool)" } }, "id": 160600, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "38714:185:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "src": "38672:227:237", "typeDescriptions": { "typeIdentifier": "t_tuple$__$", "typeString": "tuple()" } }, "id": 160602, "nodeType": "ExpressionStatement", "src": "38672:227:237" }, { "condition": { "expression": { "id": 160603, "name": "internal_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160556, "src": "38913:9:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxShortInternal_$160541_memory_ptr", "typeString": "struct HyperdriveUtils.MaxShortInternal memory" } }, "id": 160604, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "38923:7:237", "memberName": "success", "nodeType": "MemberAccess", "referencedDeclaration": 160540, "src": "38913:17:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "id": 160608, "nodeType": "IfStatement", "src": "38909:76:237", "trueBody": { "id": 160607, "nodeType": "Block", "src": "38932:53:237", "statements": [{ "expression": { "id": 160605, "name": "absoluteMaxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160582, "src": "38953:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 160553, "id": 160606, "nodeType": "Return", "src": "38946:28:237" }] } }, { "assignments": [160610], "declarations": [{ "constant": false, "id": 160610, "mutability": "mutable", "name": "maxBondAmount", "nameLocation": "39887:13:237", "nodeType": "VariableDeclaration", "scope": 160714, "src": "39879:21:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160609, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "39879:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160616, "initialValue": { "arguments": [{ "id": 160612, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160545, "src": "39939:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, { "id": 160613, "name": "spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160569, "src": "39960:9:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160614, "name": "_checkpointExposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160547, "src": "39983:19:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 160611, "name": "calculateMaxShortGuess", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160898, "src": "39903:22:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_MaxTradeParams_$159592_memory_ptr_$_t_uint256_$_t_int256_$returns$_t_uint256_$", "typeString": "function (struct HyperdriveUtils.MaxTradeParams memory,uint256,int256) pure returns (uint256)" } }, "id": 160615, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "39903:109:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "39879:133:237" }, { "expression": { "id": 160630, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "components": [{ "expression": { "id": 160617, "name": "internal_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160556, "src": "40023:9:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxShortInternal_$160541_memory_ptr", "typeString": "struct HyperdriveUtils.MaxShortInternal memory" } }, "id": 160619, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": true, "memberLocation": "40033:8:237", "memberName": "solvency", "nodeType": "MemberAccess", "referencedDeclaration": 160536, "src": "40023:18:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160620, "name": "internal_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160556, "src": "40043:9:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxShortInternal_$160541_memory_ptr", "typeString": "struct HyperdriveUtils.MaxShortInternal memory" } }, "id": 160621, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": true, "memberLocation": "40053:7:237", "memberName": "success", "nodeType": "MemberAccess", "referencedDeclaration": 160540, "src": "40043:17:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }], "id": 160622, "isConstant": false, "isInlineArray": false, "isLValue": true, "isPure": false, "lValueRequested": true, "nodeType": "TupleExpression", "src": "40022:39:237", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 160624, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160545, "src": "40105:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, { "id": 160625, "name": "maxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160610, "src": "40126:13:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160626, "name": "effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160559, "src": "40153:22:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160627, "name": "spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160569, "src": "40189:9:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160628, "name": "_checkpointExposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160547, "src": "40212:19:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 160623, "name": "calculateSolvencyAfterShort", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161015, "src": "40064:27:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_MaxTradeParams_$159592_memory_ptr_$_t_uint256_$_t_uint256_$_t_uint256_$_t_int256_$returns$_t_uint256_$_t_bool_$", "typeString": "function (struct HyperdriveUtils.MaxTradeParams memory,uint256,uint256,uint256,int256) pure returns (uint256,bool)" } }, "id": 160629, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "40064:177:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "src": "40022:219:237", "typeDescriptions": { "typeIdentifier": "t_tuple$__$", "typeString": "tuple()" } }, "id": 160631, "nodeType": "ExpressionStatement", "src": "40022:219:237" }, { "expression": { "arguments": [{ "expression": { "id": 160633, "name": "internal_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160556, "src": "40272:9:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxShortInternal_$160541_memory_ptr", "typeString": "struct HyperdriveUtils.MaxShortInternal memory" } }, "id": 160634, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "40282:7:237", "memberName": "success", "nodeType": "MemberAccess", "referencedDeclaration": 160540, "src": "40272:17:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, { "hexValue": "496e697469616c20677565737320696e206063616c63756c6174654d617853686f72746020697320696e736f6c76656e74", "id": 160635, "isConstant": false, "isLValue": false, "isPure": true, "kind": "string", "lValueRequested": false, "nodeType": "Literal", "src": "40303:51:237", "typeDescriptions": { "typeIdentifier": "t_stringliteral_69d37a589c0b0e15423d2257480eeb8ca78f6563e04484f780925f7fdf966b65", "typeString": "literal_string \"Initial guess in `calculateMaxShort` is insolvent\"" }, "value": "Initial guess in `calculateMaxShort` is insolvent" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_bool", "typeString": "bool" }, { "typeIdentifier": "t_stringliteral_69d37a589c0b0e15423d2257480eeb8ca78f6563e04484f780925f7fdf966b65", "typeString": "literal_string \"Initial guess in `calculateMaxShort` is insolvent\"" }], "id": 160632, "name": "require", "nodeType": "Identifier", "overloadedDeclarations": [-18, -18], "referencedDeclaration": -18, "src": "40251:7:237", "typeDescriptions": { "typeIdentifier": "t_function_require_pure$_t_bool_$_t_string_memory_ptr_$returns$__$", "typeString": "function (bool,string memory) pure" } }, "id": 160636, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "40251:113:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_tuple$__$", "typeString": "tuple()" } }, "id": 160637, "nodeType": "ExpressionStatement", "src": "40251:113:237" }, { "body": { "id": 160710, "nodeType": "Block", "src": "40419:1674:237", "statements": [{ "expression": { "id": 160660, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "components": [{ "expression": { "id": 160648, "name": "internal_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160556, "src": "40922:9:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxShortInternal_$160541_memory_ptr", "typeString": "struct HyperdriveUtils.MaxShortInternal memory" } }, "id": 160650, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": true, "memberLocation": "40932:10:237", "memberName": "derivative", "nodeType": "MemberAccess", "referencedDeclaration": 160538, "src": "40922:20:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160651, "name": "internal_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160556, "src": "40960:9:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxShortInternal_$160541_memory_ptr", "typeString": "struct HyperdriveUtils.MaxShortInternal memory" } }, "id": 160652, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": true, "memberLocation": "40970:7:237", "memberName": "success", "nodeType": "MemberAccess", "referencedDeclaration": 160540, "src": "40960:17:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }], "id": 160653, "isConstant": false, "isInlineArray": false, "isLValue": true, "isPure": false, "lValueRequested": true, "nodeType": "TupleExpression", "src": "40904:87:237", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 160655, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160545, "src": "41049:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, { "id": 160656, "name": "maxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160610, "src": "41074:13:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160657, "name": "spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160569, "src": "41105:9:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160658, "name": "effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160559, "src": "41132:22:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 160654, "name": "calculateSolvencyAfterShortDerivative", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161077, "src": "40994:37:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_MaxTradeParams_$159592_memory_ptr_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$_t_bool_$", "typeString": "function (struct HyperdriveUtils.MaxTradeParams memory,uint256,uint256,uint256) pure returns (uint256,bool)" } }, "id": 160659, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "40994:174:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "src": "40904:264:237", "typeDescriptions": { "typeIdentifier": "t_tuple$__$", "typeString": "tuple()" } }, "id": 160661, "nodeType": "ExpressionStatement", "src": "40904:264:237" }, { "condition": { "id": 160664, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "UnaryOperation", "operator": "!", "prefix": true, "src": "41186:18:237", "subExpression": { "expression": { "id": 160662, "name": "internal_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160556, "src": "41187:9:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxShortInternal_$160541_memory_ptr", "typeString": "struct HyperdriveUtils.MaxShortInternal memory" } }, "id": 160663, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "41197:7:237", "memberName": "success", "nodeType": "MemberAccess", "referencedDeclaration": 160540, "src": "41187:17:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "id": 160667, "nodeType": "IfStatement", "src": "41182:62:237", "trueBody": { "id": 160666, "nodeType": "Block", "src": "41206:38:237", "statements": [{ "id": 160665, "nodeType": "Break", "src": "41224:5:237" }] } }, { "assignments": [160669], "declarations": [{ "constant": false, "id": 160669, "mutability": "mutable", "name": "possibleMaxBondAmount", "nameLocation": "41265:21:237", "nodeType": "VariableDeclaration", "scope": 160710, "src": "41257:29:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160668, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "41257:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160678, "initialValue": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160677, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160670, "name": "maxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160610, "src": "41289:13:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "arguments": [{ "expression": { "id": 160674, "name": "internal_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160556, "src": "41348:9:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxShortInternal_$160541_memory_ptr", "typeString": "struct HyperdriveUtils.MaxShortInternal memory" } }, "id": 160675, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "41358:10:237", "memberName": "derivative", "nodeType": "MemberAccess", "referencedDeclaration": 160538, "src": "41348:20:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 160671, "name": "internal_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160556, "src": "41321:9:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxShortInternal_$160541_memory_ptr", "typeString": "struct HyperdriveUtils.MaxShortInternal memory" } }, "id": 160672, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "41331:8:237", "memberName": "solvency", "nodeType": "MemberAccess", "referencedDeclaration": 160536, "src": "41321:18:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160673, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "41340:7:237", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "41321:26:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160676, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "41321:48:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "41289:80:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "41257:112:237" }, { "condition": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160681, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160679, "name": "possibleMaxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160669, "src": "41387:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": ">", "rightExpression": { "id": 160680, "name": "absoluteMaxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160582, "src": "41411:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "41387:45:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "id": 160684, "nodeType": "IfStatement", "src": "41383:89:237", "trueBody": { "id": 160683, "nodeType": "Block", "src": "41434:38:237", "statements": [{ "id": 160682, "nodeType": "Break", "src": "41452:5:237" }] } }, { "expression": { "id": 160698, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "components": [{ "expression": { "id": 160685, "name": "internal_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160556, "src": "41653:9:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxShortInternal_$160541_memory_ptr", "typeString": "struct HyperdriveUtils.MaxShortInternal memory" } }, "id": 160687, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": true, "memberLocation": "41663:8:237", "memberName": "solvency", "nodeType": "MemberAccess", "referencedDeclaration": 160536, "src": "41653:18:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160688, "name": "internal_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160556, "src": "41689:9:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxShortInternal_$160541_memory_ptr", "typeString": "struct HyperdriveUtils.MaxShortInternal memory" } }, "id": 160689, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": true, "memberLocation": "41699:7:237", "memberName": "success", "nodeType": "MemberAccess", "referencedDeclaration": 160540, "src": "41689:17:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }], "id": 160690, "isConstant": false, "isInlineArray": false, "isLValue": true, "isPure": false, "lValueRequested": true, "nodeType": "TupleExpression", "src": "41635:85:237", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 160692, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160545, "src": "41768:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, { "id": 160693, "name": "possibleMaxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160669, "src": "41793:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160694, "name": "effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160559, "src": "41832:22:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160695, "name": "spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160569, "src": "41872:9:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160696, "name": "_checkpointExposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160547, "src": "41899:19:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 160691, "name": "calculateSolvencyAfterShort", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161015, "src": "41723:27:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_MaxTradeParams_$159592_memory_ptr_$_t_uint256_$_t_uint256_$_t_uint256_$_t_int256_$returns$_t_uint256_$_t_bool_$", "typeString": "function (struct HyperdriveUtils.MaxTradeParams memory,uint256,uint256,uint256,int256) pure returns (uint256,bool)" } }, "id": 160697, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "41723:209:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "src": "41635:297:237", "typeDescriptions": { "typeIdentifier": "t_tuple$__$", "typeString": "tuple()" } }, "id": 160699, "nodeType": "ExpressionStatement", "src": "41635:297:237" }, { "condition": { "expression": { "id": 160700, "name": "internal_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160556, "src": "41950:9:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxShortInternal_$160541_memory_ptr", "typeString": "struct HyperdriveUtils.MaxShortInternal memory" } }, "id": 160701, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "41960:7:237", "memberName": "success", "nodeType": "MemberAccess", "referencedDeclaration": 160540, "src": "41950:17:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "falseBody": { "id": 160708, "nodeType": "Block", "src": "42045:38:237", "statements": [{ "id": 160707, "nodeType": "Break", "src": "42063:5:237" }] }, "id": 160709, "nodeType": "IfStatement", "src": "41946:137:237", "trueBody": { "id": 160706, "nodeType": "Block", "src": "41969:70:237", "statements": [{ "expression": { "id": 160704, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 160702, "name": "maxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160610, "src": "41987:13:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "id": 160703, "name": "possibleMaxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160669, "src": "42003:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "41987:37:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160705, "nodeType": "ExpressionStatement", "src": "41987:37:237" }] } }] }, "condition": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160644, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160642, "name": "i", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160639, "src": "40394:1:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "<", "rightExpression": { "id": 160643, "name": "_maxIterations", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160549, "src": "40398:14:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "40394:18:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "id": 160711, "initializationExpression": { "assignments": [160639], "declarations": [{ "constant": false, "id": 160639, "mutability": "mutable", "name": "i", "nameLocation": "40387:1:237", "nodeType": "VariableDeclaration", "scope": 160711, "src": "40379:9:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160638, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "40379:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160641, "initialValue": { "hexValue": "30", "id": 160640, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "40391:1:237", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }, "nodeType": "VariableDeclarationStatement", "src": "40379:13:237" }, "loopExpression": { "expression": { "id": 160646, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "UnaryOperation", "operator": "++", "prefix": true, "src": "40414:3:237", "subExpression": { "id": 160645, "name": "i", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160639, "src": "40416:1:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160647, "nodeType": "ExpressionStatement", "src": "40414:3:237" }, "nodeType": "ForStatement", "src": "40374:1719:237" }, { "expression": { "id": 160712, "name": "maxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160610, "src": "42110:13:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 160553, "id": 160713, "nodeType": "Return", "src": "42103:20:237" }] }, "documentation": { "id": 160542, "nodeType": "StructuredDocumentation", "src": "37356:277:237", "text": "@dev Gets the absolute max short that can be opened without violating\n      the pool's solvency constraints.\n @param _checkpointExposure The long exposure in the current checkpoint.\n @return The maximum amount of shares that can be used to open shorts." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateMaxShort", "nameLocation": "37647:17:237", "parameters": { "id": 160550, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160545, "mutability": "mutable", "name": "_params", "nameLocation": "37696:7:237", "nodeType": "VariableDeclaration", "scope": 160715, "src": "37674:29:237", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" }, "typeName": { "id": 160544, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 160543, "name": "MaxTradeParams", "nameLocations": ["37674:14:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 159592, "src": "37674:14:237" }, "referencedDeclaration": 159592, "src": "37674:14:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_storage_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" } }, "visibility": "internal" }, { "constant": false, "id": 160547, "mutability": "mutable", "name": "_checkpointExposure", "nameLocation": "37720:19:237", "nodeType": "VariableDeclaration", "scope": 160715, "src": "37713:26:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" }, "typeName": { "id": 160546, "name": "int256", "nodeType": "ElementaryTypeName", "src": "37713:6:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "visibility": "internal" }, { "constant": false, "id": 160549, "mutability": "mutable", "name": "_maxIterations", "nameLocation": "37757:14:237", "nodeType": "VariableDeclaration", "scope": 160715, "src": "37749:22:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160548, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "37749:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "37664:113:237" }, "returnParameters": { "id": 160553, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160552, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 160715, "src": "37801:7:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160551, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "37801:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "37800:9:237" }, "scope": 161566, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 160824, "nodeType": "FunctionDefinition", "src": "42555:2183:237", "nodes": [], "body": { "id": 160823, "nodeType": "Block", "src": "42710:2028:237", "nodes": [], "statements": [{ "assignments": [160727], "declarations": [{ "constant": false, "id": 160727, "mutability": "mutable", "name": "optimalShareReserves", "nameLocation": "42952:20:237", "nodeType": "VariableDeclaration", "scope": 160823, "src": "42944:28:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160726, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "42944:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160739, "initialValue": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160738, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "expression": { "id": 160728, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160719, "src": "42975:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160729, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "42983:20:237", "memberName": "minimumShareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159585, "src": "42975:28:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "arguments": [{ "arguments": [{ "hexValue": "30", "id": 160735, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "43054:1:237", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }], "expression": { "expression": { "id": 160732, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160719, "src": "43026:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160733, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "43034:15:237", "memberName": "shareAdjustment", "nodeType": "MemberAccess", "referencedDeclaration": 159571, "src": "43026:23:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "id": 160734, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "43050:3:237", "memberName": "max", "nodeType": "MemberAccess", "referencedDeclaration": 19571, "src": "43026:27:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_int256_$_t_int256_$returns$_t_int256_$attached_to$_t_int256_$", "typeString": "function (int256,int256) pure returns (int256)" } }, "id": 160736, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "43026:30:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 160731, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "43018:7:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_uint256_$", "typeString": "type(uint256)" }, "typeName": { "id": 160730, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "43018:7:237", "typeDescriptions": {} } }, "id": 160737, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "43018:39:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "42975:82:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "42944:113:237" }, { "assignments": [160741], "declarations": [{ "constant": false, "id": 160741, "mutability": "mutable", "name": "k_", "nameLocation": "43469:2:237", "nodeType": "VariableDeclaration", "scope": 160823, "src": "43461:10:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160740, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "43461:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160756, "initialValue": { "arguments": [{ "id": 160744, "name": "_effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160721, "src": "43508:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160745, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160719, "src": "43545:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160746, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "43553:12:237", "memberName": "bondReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159573, "src": "43545:20:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160750, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160747, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "43579:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 160748, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160719, "src": "43585:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160749, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "43593:11:237", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159579, "src": "43585:19:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "43579:25:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160751, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160719, "src": "43618:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160752, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "43626:15:237", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159581, "src": "43618:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160753, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160719, "src": "43655:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160754, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "43663:22:237", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159583, "src": "43655:30:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160742, "name": "YieldSpaceMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 23422, "src": "43474:14:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_YieldSpaceMath_$23422_$", "typeString": "type(library YieldSpaceMath)" } }, "id": 160743, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "43489:5:237", "memberName": "kDown", "nodeType": "MemberAccess", "referencedDeclaration": 23421, "src": "43474:20:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256,uint256,uint256) pure returns (uint256)" } }, "id": 160755, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "43474:221:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "43461:234:237" }, { "assignments": [160758], "declarations": [{ "constant": false, "id": 160758, "mutability": "mutable", "name": "optimalBondReserves", "nameLocation": "43713:19:237", "nodeType": "VariableDeclaration", "scope": 160823, "src": "43705:27:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160757, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "43705:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160785, "initialValue": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160784, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160759, "name": "k_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160741, "src": "43735:2:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [{ "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160781, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160778, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "44164:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 160779, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160719, "src": "44170:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160780, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "44178:11:237", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159579, "src": "44170:19:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "44164:25:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "arguments": [{ "id": 160772, "name": "optimalShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160727, "src": "44017:20:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160773, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160719, "src": "44067:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160774, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "44075:15:237", "memberName": "shareAdjustment", "nodeType": "MemberAccess", "referencedDeclaration": 159571, "src": "44067:23:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_int256", "typeString": "int256" }], "expression": { "id": 160770, "name": "HyperdriveMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20320, "src": "43941:14:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_HyperdriveMath_$20320_$", "typeString": "type(library HyperdriveMath)" } }, "id": 160771, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "43956:31:237", "memberName": "calculateEffectiveShareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 19763, "src": "43941:46:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_int256_$returns$_t_uint256_$", "typeString": "function (uint256,int256) pure returns (uint256)" } }, "id": 160775, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "43941:175:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 160767, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160719, "src": "43837:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160768, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "43866:22:237", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159583, "src": "43837:51:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160769, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "43910:5:237", "memberName": "mulUp", "nodeType": "MemberAccess", "referencedDeclaration": 18902, "src": "43837:78:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160776, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "43837:301:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160777, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "44160:3:237", "memberName": "pow", "nodeType": "MemberAccess", "referencedDeclaration": 18977, "src": "43837:326:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160782, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "43837:353:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "expression": { "id": 160763, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160719, "src": "43782:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160764, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "43790:22:237", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159583, "src": "43782:30:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 160760, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160719, "src": "43752:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160761, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "43760:15:237", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159581, "src": "43752:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160762, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "43776:5:237", "memberName": "divUp", "nodeType": "MemberAccess", "referencedDeclaration": 18920, "src": "43752:29:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160765, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "43752:61:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160766, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "43814:5:237", "memberName": "mulUp", "nodeType": "MemberAccess", "referencedDeclaration": 18902, "src": "43752:67:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160783, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "43752:452:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "43735:469:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "43705:499:237" }, { "condition": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160788, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160786, "name": "optimalBondReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160758, "src": "44218:19:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": ">=", "rightExpression": { "id": 160787, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "44241:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "44218:26:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "falseBody": { "id": 160816, "nodeType": "Block", "src": "44464:208:237", "statements": [{ "expression": { "id": 160814, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 160803, "name": "optimalBondReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160758, "src": "44548:19:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160811, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160808, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "44621:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 160809, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160719, "src": "44627:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160810, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "44635:11:237", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159579, "src": "44627:19:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "44621:25:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160806, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "44611:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160807, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "44615:5:237", "memberName": "divUp", "nodeType": "MemberAccess", "referencedDeclaration": 18920, "src": "44611:9:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160812, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "44611:36:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160804, "name": "optimalBondReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160758, "src": "44570:19:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160805, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "44590:3:237", "memberName": "pow", "nodeType": "MemberAccess", "referencedDeclaration": 18977, "src": "44570:23:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160813, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "44570:91:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "44548:113:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160815, "nodeType": "ExpressionStatement", "src": "44548:113:237" }] }, "id": 160817, "nodeType": "IfStatement", "src": "44214:458:237", "trueBody": { "id": 160802, "nodeType": "Block", "src": "44246:212:237", "statements": [{ "expression": { "id": 160800, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 160789, "name": "optimalBondReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160758, "src": "44332:19:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160797, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160794, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "44407:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 160795, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160719, "src": "44413:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160796, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "44421:11:237", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159579, "src": "44413:19:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "44407:25:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160792, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "44395:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160793, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "44399:7:237", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "44395:11:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160798, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "44395:38:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160790, "name": "optimalBondReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160758, "src": "44354:19:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160791, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "44374:3:237", "memberName": "pow", "nodeType": "MemberAccess", "referencedDeclaration": 18977, "src": "44354:23:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160799, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "44354:93:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "44332:115:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160801, "nodeType": "ExpressionStatement", "src": "44332:115:237" }] } }, { "expression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160821, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160818, "name": "optimalBondReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160758, "src": "44689:19:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 160819, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160719, "src": "44711:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160820, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "44719:12:237", "memberName": "bondReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159573, "src": "44711:20:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "44689:42:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 160725, "id": 160822, "nodeType": "Return", "src": "44682:49:237" }] }, "documentation": { "id": 160716, "nodeType": "StructuredDocumentation", "src": "42136:414:237", "text": "@dev Calculates the max short that can be opened on the YieldSpace curve\n      without considering solvency constraints.\n @param _params Information about the market state and pool configuration\n        used to compute the maximum trade.\n @param _effectiveShareReserves The effective share reserves.\n @return The max short YieldSpace can support without considering solvency." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateMaxShortUpperBound", "nameLocation": "42564:27:237", "parameters": { "id": 160722, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160719, "mutability": "mutable", "name": "_params", "nameLocation": "42623:7:237", "nodeType": "VariableDeclaration", "scope": 160824, "src": "42601:29:237", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" }, "typeName": { "id": 160718, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 160717, "name": "MaxTradeParams", "nameLocations": ["42601:14:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 159592, "src": "42601:14:237" }, "referencedDeclaration": 159592, "src": "42601:14:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_storage_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" } }, "visibility": "internal" }, { "constant": false, "id": 160721, "mutability": "mutable", "name": "_effectiveShareReserves", "nameLocation": "42648:23:237", "nodeType": "VariableDeclaration", "scope": 160824, "src": "42640:31:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160720, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "42640:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "42591:86:237" }, "returnParameters": { "id": 160725, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160724, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 160824, "src": "42701:7:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160723, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "42701:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "42700:9:237" }, "scope": 161566, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 160898, "nodeType": "FunctionDefinition", "src": "46195:866:237", "nodes": [], "body": { "id": 160897, "nodeType": "Block", "src": "46368:693:237", "nodes": [], "statements": [{ "assignments": [160838], "declarations": [{ "constant": false, "id": 160838, "mutability": "mutable", "name": "estimatePrice", "nameLocation": "46386:13:237", "nodeType": "VariableDeclaration", "scope": 160897, "src": "46378:21:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160837, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "46378:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160840, "initialValue": { "id": 160839, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160830, "src": "46402:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "46378:34:237" }, { "assignments": [160842], "declarations": [{ "constant": false, "id": 160842, "mutability": "mutable", "name": "guess", "nameLocation": "46430:5:237", "nodeType": "VariableDeclaration", "scope": 160897, "src": "46422:13:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160841, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "46422:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160871, "initialValue": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160869, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160866, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160859, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "expression": { "id": 160846, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160828, "src": "46483:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160847, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "46491:13:237", "memberName": "shareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159569, "src": "46483:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "arguments": [{ "expression": { "id": 160856, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160828, "src": "46588:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160857, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "46596:15:237", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159581, "src": "46588:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "arguments": [{ "hexValue": "30", "id": 160852, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "46555:1:237", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }], "expression": { "id": 160850, "name": "_checkpointExposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160832, "src": "46531:19:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "id": 160851, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "46551:3:237", "memberName": "max", "nodeType": "MemberAccess", "referencedDeclaration": 19571, "src": "46531:23:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_int256_$_t_int256_$returns$_t_int256_$attached_to$_t_int256_$", "typeString": "function (int256,int256) pure returns (int256)" } }, "id": 160853, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "46531:26:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 160849, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "46523:7:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_uint256_$", "typeString": "type(uint256)" }, "typeName": { "id": 160848, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "46523:7:237", "typeDescriptions": {} } }, "id": 160854, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "46523:35:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160855, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "46559:7:237", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "46523:43:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160858, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "46523:106:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "46483:146:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [{ "expression": { "id": 160863, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160828, "src": "46677:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160864, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "46685:15:237", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159581, "src": "46677:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 160860, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160828, "src": "46648:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160861, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "46656:12:237", "memberName": "longExposure", "nodeType": "MemberAccess", "referencedDeclaration": 159577, "src": "46648:20:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160862, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "46669:7:237", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "46648:28:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160865, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "46648:53:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "46483:218:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 160867, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160828, "src": "46720:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160868, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "46728:20:237", "memberName": "minimumShareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159585, "src": "46720:28:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "46483:265:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 160843, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160828, "src": "46438:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160844, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "46446:15:237", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159581, "src": "46438:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160845, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "46462:7:237", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "46438:31:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160870, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "46438:320:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "46422:336:237" }, { "expression": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160894, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160882, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160874, "name": "estimatePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160838, "src": "46818:13:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160880, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160878, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "46879:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 160879, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160830, "src": "46885:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "46879:16:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 160875, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160828, "src": "46854:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160876, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "46862:8:237", "memberName": "curveFee", "nodeType": "MemberAccess", "referencedDeclaration": 159587, "src": "46854:16:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160877, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "46871:7:237", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "46854:24:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160881, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "46854:42:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "46818:78:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160892, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160890, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "47002:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 160891, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160830, "src": "47008:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "47002:16:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "expression": { "id": 160886, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160828, "src": "46951:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160887, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "46959:8:237", "memberName": "curveFee", "nodeType": "MemberAccess", "referencedDeclaration": 159587, "src": "46951:16:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 160883, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160828, "src": "46919:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160884, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "46927:15:237", "memberName": "governanceLPFee", "nodeType": "MemberAccess", "referencedDeclaration": 159591, "src": "46919:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160885, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "46943:7:237", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "46919:31:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160888, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "46919:49:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160889, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "46969:7:237", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "46919:57:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160893, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "46919:121:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "46818:222:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160872, "name": "guess", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160842, "src": "46787:5:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160873, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "46793:7:237", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "46787:13:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160895, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "46787:267:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 160836, "id": 160896, "nodeType": "Return", "src": "46768:286:237" }] }, "documentation": { "id": 160825, "nodeType": "StructuredDocumentation", "src": "44744:1446:237", "text": "@dev Gets an initial guess for the absolute max short. This is a\n      conservative guess that will be less than the true absolute max\n      short, which is what we need to start Newton's method.\n      To calculate our guess, we assume an unrealistically good realized\n      price $p_r$ for opening the short. This allows us to approximate\n      $P(x) \\approx \\tfrac{1}{c} \\cdot p_r \\cdot x$. Plugging this\n      into our solvency function $s(x)$, we get an approximation of our\n      solvency as:\n      $$\n      S(x) \\approx (z_0 - \\tfrac{1}{c} \\cdot (\n                       p_r - \\phi_{c} \\cdot (1 - p) + \\phi_{g} \\cdot \\phi_{c} \\cdot (1 - p)\n                   ) \\cdot x) - \\tfrac{e_0 - max(e_{c}, 0)}{c} - z_{min}\n      $$\n      Setting this equal to zero, we can solve for our initial guess:\n      $$\n      x = \\frac{c \\cdot (s_0 + \\tfrac{max(e_{c}, 0)}{c})}{\n              p_r - \\phi_{c} \\cdot (1 - p) + \\phi_{g} \\cdot \\phi_{c} \\cdot (1 - p)\n          }\n      $$\n @param _params Information about the market state and pool configuration\n        used to compute the maximum trade.\n @param _spotPrice The spot price.\n @param _checkpointExposure The exposure from the current checkpoint.\n @return The initial guess for the max short calculation." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateMaxShortGuess", "nameLocation": "46204:22:237", "parameters": { "id": 160833, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160828, "mutability": "mutable", "name": "_params", "nameLocation": "46258:7:237", "nodeType": "VariableDeclaration", "scope": 160898, "src": "46236:29:237", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" }, "typeName": { "id": 160827, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 160826, "name": "MaxTradeParams", "nameLocations": ["46236:14:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 159592, "src": "46236:14:237" }, "referencedDeclaration": 159592, "src": "46236:14:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_storage_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" } }, "visibility": "internal" }, { "constant": false, "id": 160830, "mutability": "mutable", "name": "_spotPrice", "nameLocation": "46283:10:237", "nodeType": "VariableDeclaration", "scope": 160898, "src": "46275:18:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160829, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "46275:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160832, "mutability": "mutable", "name": "_checkpointExposure", "nameLocation": "46310:19:237", "nodeType": "VariableDeclaration", "scope": 160898, "src": "46303:26:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" }, "typeName": { "id": 160831, "name": "int256", "nodeType": "ElementaryTypeName", "src": "46303:6:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "visibility": "internal" }], "src": "46226:109:237" }, "returnParameters": { "id": 160836, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160835, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 160898, "src": "46359:7:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160834, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "46359:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "46358:9:237" }, "scope": 161566, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 161015, "nodeType": "FunctionDefinition", "src": "48824:1941:237", "nodes": [], "body": { "id": 161014, "nodeType": "Block", "src": "49079:1686:237", "nodes": [], "statements": [{ "assignments": [160918, 160920], "declarations": [{ "constant": false, "id": 160918, "mutability": "mutable", "name": "shareAmount", "nameLocation": "49334:11:237", "nodeType": "VariableDeclaration", "scope": 161014, "src": "49326:19:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160917, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "49326:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160920, "mutability": "mutable", "name": "success", "nameLocation": "49352:7:237", "nodeType": "VariableDeclaration", "scope": 161014, "src": "49347:12:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "typeName": { "id": 160919, "name": "bool", "nodeType": "ElementaryTypeName", "src": "49347:4:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "visibility": "internal" }], "id": 160936, "initialValue": { "arguments": [{ "id": 160923, "name": "_effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160906, "src": "49447:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160924, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160902, "src": "49488:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160925, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "49496:12:237", "memberName": "bondReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159573, "src": "49488:20:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160926, "name": "_shortAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160904, "src": "49526:12:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160930, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160927, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "49556:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 160928, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160902, "src": "49562:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160929, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "49570:11:237", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159579, "src": "49562:19:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "49556:25:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160931, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160902, "src": "49599:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160932, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "49607:15:237", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159581, "src": "49599:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160933, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160902, "src": "49640:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160934, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "49648:22:237", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159583, "src": "49640:30:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160921, "name": "YieldSpaceMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 23422, "src": "49363:14:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_YieldSpaceMath_$23422_$", "typeString": "type(library YieldSpaceMath)" } }, "id": 160922, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "49391:38:237", "memberName": "calculateSharesOutGivenBondsInDownSafe", "nodeType": "MemberAccess", "referencedDeclaration": 23049, "src": "49363:66:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$_t_bool_$", "typeString": "function (uint256,uint256,uint256,uint256,uint256,uint256) pure returns (uint256,bool)" } }, "id": 160935, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "49363:321:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "nodeType": "VariableDeclarationStatement", "src": "49325:359:237" }, { "condition": { "id": 160938, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "UnaryOperation", "operator": "!", "prefix": true, "src": "49698:8:237", "subExpression": { "id": 160937, "name": "success", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160920, "src": "49699:7:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "id": 160944, "nodeType": "IfStatement", "src": "49694:56:237", "trueBody": { "id": 160943, "nodeType": "Block", "src": "49708:42:237", "statements": [{ "expression": { "components": [{ "hexValue": "30", "id": 160939, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "49730:1:237", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }, { "hexValue": "66616c7365", "id": 160940, "isConstant": false, "isLValue": false, "isPure": true, "kind": "bool", "lValueRequested": false, "nodeType": "Literal", "src": "49733:5:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "value": "false" }], "id": 160941, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "TupleExpression", "src": "49729:10:237", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_rational_0_by_1_$_t_bool_$", "typeString": "tuple(int_const 0,bool)" } }, "functionReturnParameters": 160916, "id": 160942, "nodeType": "Return", "src": "49722:17:237" }] } }, { "assignments": [160946], "declarations": [{ "constant": false, "id": 160946, "mutability": "mutable", "name": "shareReserves", "nameLocation": "49834:13:237", "nodeType": "VariableDeclaration", "scope": 161014, "src": "49826:21:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160945, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "49826:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160973, "initialValue": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160972, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "expression": { "id": 160947, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160902, "src": "49850:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160948, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "49858:13:237", "memberName": "shareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159569, "src": "49850:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160970, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160949, "name": "shareAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160918, "src": "49887:11:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [{ "expression": { "id": 160967, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160902, "src": "50309:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160968, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "50317:15:237", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159581, "src": "50309:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160964, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "arguments": [{ "id": 160951, "name": "_shortAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160904, "src": "49962:12:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160952, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160908, "src": "49996:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160953, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160902, "src": "50028:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160954, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "50036:8:237", "memberName": "curveFee", "nodeType": "MemberAccess", "referencedDeclaration": 159587, "src": "50028:16:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 160950, "name": "calculateShortCurveFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161189, "src": "49918:22:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 160955, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "49918:144:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [{ "id": 160957, "name": "_shortAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160904, "src": "50138:12:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160958, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160908, "src": "50176:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160959, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160902, "src": "50212:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160960, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "50220:8:237", "memberName": "curveFee", "nodeType": "MemberAccess", "referencedDeclaration": 159587, "src": "50212:16:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160961, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160902, "src": "50254:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160962, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "50262:15:237", "memberName": "governanceLPFee", "nodeType": "MemberAccess", "referencedDeclaration": 159591, "src": "50254:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 160956, "name": "calculateShortGovernanceFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161213, "src": "50085:27:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256,uint256) pure returns (uint256)" } }, "id": 160963, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "50085:214:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "49918:381:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 160965, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "49917:383:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160966, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "50301:7:237", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "49917:391:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160969, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "49917:416:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "49887:446:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 160971, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "49886:448:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "49850:484:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "49826:508:237" }, { "assignments": [160975], "declarations": [{ "constant": false, "id": 160975, "mutability": "mutable", "name": "exposure", "nameLocation": "50352:8:237", "nodeType": "VariableDeclaration", "scope": 161014, "src": "50344:16:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160974, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "50344:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160991, "initialValue": { "arguments": [{ "expression": { "id": 160988, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160902, "src": "50461:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160989, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "50469:15:237", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159581, "src": "50461:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160985, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "expression": { "id": 160976, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160902, "src": "50364:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160977, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "50372:12:237", "memberName": "longExposure", "nodeType": "MemberAccess", "referencedDeclaration": 159577, "src": "50364:20:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [{ "arguments": [{ "hexValue": "30", "id": 160982, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "50431:1:237", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }], "expression": { "id": 160980, "name": "_checkpointExposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160910, "src": "50407:19:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "id": 160981, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "50427:3:237", "memberName": "max", "nodeType": "MemberAccess", "referencedDeclaration": 19571, "src": "50407:23:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_int256_$_t_int256_$returns$_t_int256_$attached_to$_t_int256_$", "typeString": "function (int256,int256) pure returns (int256)" } }, "id": 160983, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "50407:26:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 160979, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "50399:7:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_uint256_$", "typeString": "type(uint256)" }, "typeName": { "id": 160978, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "50399:7:237", "typeDescriptions": {} } }, "id": 160984, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "50399:35:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "50364:70:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 160986, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "50363:72:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160987, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "50436:7:237", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "50363:80:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160990, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "50363:135:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "50344:154:237" }, { "condition": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160997, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160992, "name": "shareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160946, "src": "50512:13:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": ">=", "rightExpression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160996, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160993, "name": "exposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160975, "src": "50529:8:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "expression": { "id": 160994, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160902, "src": "50540:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160995, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "50548:20:237", "memberName": "minimumShareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159585, "src": "50540:28:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "50529:39:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "50512:56:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "falseBody": { "id": 161012, "nodeType": "Block", "src": "50717:42:237", "statements": [{ "expression": { "components": [{ "hexValue": "30", "id": 161008, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "50739:1:237", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }, { "hexValue": "66616c7365", "id": 161009, "isConstant": false, "isLValue": false, "isPure": true, "kind": "bool", "lValueRequested": false, "nodeType": "Literal", "src": "50742:5:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "value": "false" }], "id": 161010, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "TupleExpression", "src": "50738:10:237", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_rational_0_by_1_$_t_bool_$", "typeString": "tuple(int_const 0,bool)" } }, "functionReturnParameters": 160916, "id": 161011, "nodeType": "Return", "src": "50731:17:237" }] }, "id": 161013, "nodeType": "IfStatement", "src": "50508:251:237", "trueBody": { "id": 161007, "nodeType": "Block", "src": "50570:141:237", "statements": [{ "expression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 161003, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 161000, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160998, "name": "shareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160946, "src": "50609:13:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 160999, "name": "exposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160975, "src": "50625:8:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "50609:24:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 161001, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160902, "src": "50636:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 161002, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "50644:20:237", "memberName": "minimumShareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159585, "src": "50636:28:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "50609:55:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "hexValue": "74727565", "id": 161004, "isConstant": false, "isLValue": false, "isPure": true, "kind": "bool", "lValueRequested": false, "nodeType": "Literal", "src": "50682:4:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "value": "true" }], "id": 161005, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "50591:109:237", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "functionReturnParameters": 160916, "id": 161006, "nodeType": "Return", "src": "50584:116:237" }] } }] }, "documentation": { "id": 160899, "nodeType": "StructuredDocumentation", "src": "47067:1752:237", "text": "@dev Gets the pool's solvency after opening a short.\n      We can express the pool's solvency after opening a short of $x$\n      bonds as:\n      $$\n      s(x) = z(x) - \\tfrac{e(x)}{c} - z_{min}\n      $$\n      where $z(x)$ represents the pool's share reserves after opening the\n      short:\n      $$\n      z(x) = z_0 - \\left(\n                 P(x) - \\left( \\tfrac{c(x)}{c} - \\tfrac{g(x)}{c} \\right)\n             \\right)\n      $$\n      and $e(x)$ represents the pool's exposure after opening the short:\n      $$\n      e(x) = e_0 - min(x, max(e_{c}, 0))\n      $$\n      We simplify our $e(x)$ formula by noting that the max short is only\n      constrained by solvency when $x > max(e_{c}, 0)$ since $x$ grows\n      faster than\n      $P(x) - \\tfrac{\\phi_{c}}{c} \\cdot \\left( 1 - p \\right) \\cdot x$.\n      With this in mind, $min(x, max(e_{c}, 0)) = max(e_{c}, 0)$\n      whenever solvency is actually a constraint, so we can write:\n      $$\n      e(x) = e_0 - max(e_{c}, 0)\n      $$\n @param _params Information about the market state and pool configuration\n        used to compute the maximum trade.\n @param _shortAmount The short amount.\n @param _effectiveShareReserves The effective share reserves.\n @param _spotPrice The spot price.\n @param _checkpointExposure The exposure in the current checkpoint.\n @return The pool's solvency after a short is opened.\n @return A flag indicating whether or not the derivative was\n         successfully calculated." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateSolvencyAfterShort", "nameLocation": "48833:27:237", "parameters": { "id": 160911, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160902, "mutability": "mutable", "name": "_params", "nameLocation": "48892:7:237", "nodeType": "VariableDeclaration", "scope": 161015, "src": "48870:29:237", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" }, "typeName": { "id": 160901, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 160900, "name": "MaxTradeParams", "nameLocations": ["48870:14:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 159592, "src": "48870:14:237" }, "referencedDeclaration": 159592, "src": "48870:14:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_storage_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" } }, "visibility": "internal" }, { "constant": false, "id": 160904, "mutability": "mutable", "name": "_shortAmount", "nameLocation": "48917:12:237", "nodeType": "VariableDeclaration", "scope": 161015, "src": "48909:20:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160903, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "48909:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160906, "mutability": "mutable", "name": "_effectiveShareReserves", "nameLocation": "48947:23:237", "nodeType": "VariableDeclaration", "scope": 161015, "src": "48939:31:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160905, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "48939:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160908, "mutability": "mutable", "name": "_spotPrice", "nameLocation": "48988:10:237", "nodeType": "VariableDeclaration", "scope": 161015, "src": "48980:18:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160907, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "48980:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160910, "mutability": "mutable", "name": "_checkpointExposure", "nameLocation": "49015:19:237", "nodeType": "VariableDeclaration", "scope": 161015, "src": "49008:26:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" }, "typeName": { "id": 160909, "name": "int256", "nodeType": "ElementaryTypeName", "src": "49008:6:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "visibility": "internal" }], "src": "48860:180:237" }, "returnParameters": { "id": 160916, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160913, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 161015, "src": "49064:7:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160912, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "49064:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160915, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 161015, "src": "49073:4:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "typeName": { "id": 160914, "name": "bool", "nodeType": "ElementaryTypeName", "src": "49073:4:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "visibility": "internal" }], "src": "49063:15:237" }, "scope": 161566, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 161077, "nodeType": "FunctionDefinition", "src": "51649:699:237", "nodes": [], "body": { "id": 161076, "nodeType": "Block", "src": "51878:470:237", "nodes": [], "statements": [{ "assignments": [161033], "declarations": [{ "constant": false, "id": 161033, "mutability": "mutable", "name": "lhs", "nameLocation": "51896:3:237", "nodeType": "VariableDeclaration", "scope": 161076, "src": "51888:11:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 161032, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "51888:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 161039, "initialValue": { "arguments": [{ "id": 161035, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161019, "src": "51949:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, { "id": 161036, "name": "_shortAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161021, "src": "51970:12:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 161037, "name": "_effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161025, "src": "51996:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 161034, "name": "calculateShortPrincipalDerivative", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161166, "src": "51902:33:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_MaxTradeParams_$159592_memory_ptr_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (struct HyperdriveUtils.MaxTradeParams memory,uint256,uint256) pure returns (uint256)" } }, "id": 161038, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "51902:127:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "51888:141:237" }, { "assignments": [161041], "declarations": [{ "constant": false, "id": 161041, "mutability": "mutable", "name": "rhs", "nameLocation": "52047:3:237", "nodeType": "VariableDeclaration", "scope": 161076, "src": "52039:11:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 161040, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "52039:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 161059, "initialValue": { "arguments": [{ "expression": { "id": 161056, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161019, "src": "52195:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 161057, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "52203:15:237", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159581, "src": "52195:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 161053, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 161050, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "52143:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 161051, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161019, "src": "52149:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 161052, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "52157:15:237", "memberName": "governanceLPFee", "nodeType": "MemberAccess", "referencedDeclaration": 159591, "src": "52149:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "52143:29:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 161047, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 161045, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "52104:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 161046, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161023, "src": "52110:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "52104:16:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 161042, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161019, "src": "52053:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 161043, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "52074:8:237", "memberName": "curveFee", "nodeType": "MemberAccess", "referencedDeclaration": 159587, "src": "52053:29:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 161044, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "52096:7:237", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "52053:50:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 161048, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "52053:68:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 161049, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "52135:7:237", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "52053:89:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 161054, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "52053:120:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 161055, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "52187:7:237", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "52053:141:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 161058, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "52053:166:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "52039:180:237" }, { "condition": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 161062, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 161060, "name": "lhs", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161033, "src": "52233:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": ">=", "rightExpression": { "id": 161061, "name": "rhs", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161041, "src": "52240:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "52233:10:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "falseBody": { "id": 161074, "nodeType": "Block", "src": "52300:42:237", "statements": [{ "expression": { "components": [{ "hexValue": "30", "id": 161070, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "52322:1:237", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }, { "hexValue": "66616c7365", "id": 161071, "isConstant": false, "isLValue": false, "isPure": true, "kind": "bool", "lValueRequested": false, "nodeType": "Literal", "src": "52325:5:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "value": "false" }], "id": 161072, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "TupleExpression", "src": "52321:10:237", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_rational_0_by_1_$_t_bool_$", "typeString": "tuple(int_const 0,bool)" } }, "functionReturnParameters": 161031, "id": 161073, "nodeType": "Return", "src": "52314:17:237" }] }, "id": 161075, "nodeType": "IfStatement", "src": "52229:113:237", "trueBody": { "id": 161069, "nodeType": "Block", "src": "52245:49:237", "statements": [{ "expression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 161065, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 161063, "name": "lhs", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161033, "src": "52267:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 161064, "name": "rhs", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161041, "src": "52273:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "52267:9:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "hexValue": "74727565", "id": 161066, "isConstant": false, "isLValue": false, "isPure": true, "kind": "bool", "lValueRequested": false, "nodeType": "Literal", "src": "52278:4:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "value": "true" }], "id": 161067, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "52266:17:237", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "functionReturnParameters": 161031, "id": 161068, "nodeType": "Return", "src": "52259:24:237" }] } }] }, "documentation": { "id": 161016, "nodeType": "StructuredDocumentation", "src": "50771:873:237", "text": "@dev Gets the derivative of the pool's solvency w.r.t. the short amount.\n      The derivative is calculated as:\n      \\begin{aligned}\n      s'(x) &= z'(x) - 0 - 0\n            &= 0 - \\left( P'(x) - \\frac{(c'(x) - g'(x))}{c} \\right)\n            &= -P'(x) + \\frac{\n                   \\phi_{c} \\cdot (1 - p) \\cdot (1 - \\phi_{g})\n               }{c}\n      \\end{aligned}\n      Since solvency decreases as the short amount increases, we negate\n      the derivative. This avoids issues with the fixed point library\n      which doesn't support negative values.\n @return The derivative of the solvency after short function w.r.t. the\n         bond amount.\n @return A flag indicating whether or not the derivative was\n         successfully calculated." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateSolvencyAfterShortDerivative", "nameLocation": "51658:37:237", "parameters": { "id": 161026, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 161019, "mutability": "mutable", "name": "_params", "nameLocation": "51727:7:237", "nodeType": "VariableDeclaration", "scope": 161077, "src": "51705:29:237", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" }, "typeName": { "id": 161018, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 161017, "name": "MaxTradeParams", "nameLocations": ["51705:14:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 159592, "src": "51705:14:237" }, "referencedDeclaration": 159592, "src": "51705:14:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_storage_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" } }, "visibility": "internal" }, { "constant": false, "id": 161021, "mutability": "mutable", "name": "_shortAmount", "nameLocation": "51752:12:237", "nodeType": "VariableDeclaration", "scope": 161077, "src": "51744:20:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 161020, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "51744:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 161023, "mutability": "mutable", "name": "_spotPrice", "nameLocation": "51782:10:237", "nodeType": "VariableDeclaration", "scope": 161077, "src": "51774:18:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 161022, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "51774:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 161025, "mutability": "mutable", "name": "_effectiveShareReserves", "nameLocation": "51810:23:237", "nodeType": "VariableDeclaration", "scope": 161077, "src": "51802:31:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 161024, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "51802:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "51695:144:237" }, "returnParameters": { "id": 161031, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 161028, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 161077, "src": "51863:7:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 161027, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "51863:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 161030, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 161077, "src": "51872:4:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "typeName": { "id": 161029, "name": "bool", "nodeType": "ElementaryTypeName", "src": "51872:4:237", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "visibility": "internal" }], "src": "51862:15:237" }, "scope": 161566, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 161166, "nodeType": "FunctionDefinition", "src": "53015:1033:237", "nodes": [], "body": { "id": 161165, "nodeType": "Block", "src": "53206:842:237", "nodes": [], "statements": [{ "assignments": [161091], "declarations": [{ "constant": false, "id": 161091, "mutability": "mutable", "name": "k_", "nameLocation": "53224:2:237", "nodeType": "VariableDeclaration", "scope": 161165, "src": "53216:10:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 161090, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "53216:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 161106, "initialValue": { "arguments": [{ "id": 161094, "name": "_effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161085, "src": "53263:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 161095, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161081, "src": "53300:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 161096, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "53308:12:237", "memberName": "bondReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159573, "src": "53300:20:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 161100, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 161097, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "53334:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 161098, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161081, "src": "53340:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 161099, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "53348:11:237", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159579, "src": "53340:19:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "53334:25:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 161101, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161081, "src": "53373:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 161102, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "53381:15:237", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159581, "src": "53373:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 161103, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161081, "src": "53410:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 161104, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "53418:22:237", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159583, "src": "53410:30:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 161092, "name": "YieldSpaceMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 23422, "src": "53229:14:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_YieldSpaceMath_$23422_$", "typeString": "type(library YieldSpaceMath)" } }, "id": 161093, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "53244:5:237", "memberName": "kDown", "nodeType": "MemberAccess", "referencedDeclaration": 23421, "src": "53229:20:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256,uint256,uint256) pure returns (uint256)" } }, "id": 161105, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "53229:221:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "53216:234:237" }, { "assignments": [161108], "declarations": [{ "constant": false, "id": 161108, "mutability": "mutable", "name": "lhs", "nameLocation": "53468:3:237", "nodeType": "VariableDeclaration", "scope": 161165, "src": "53460:11:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 161107, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "53460:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 161125, "initialValue": { "arguments": [{ "arguments": [{ "arguments": [{ "expression": { "id": 161120, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161081, "src": "53588:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 161121, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "53596:11:237", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159579, "src": "53588:19:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 161117, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "expression": { "id": 161114, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161081, "src": "53547:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 161115, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "53555:12:237", "memberName": "bondReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159573, "src": "53547:20:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "id": 161116, "name": "_shortAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161083, "src": "53570:12:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "53547:35:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 161118, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "53546:37:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 161119, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "53584:3:237", "memberName": "pow", "nodeType": "MemberAccess", "referencedDeclaration": 18977, "src": "53546:41:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 161122, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "53546:62:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 161111, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161081, "src": "53499:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 161112, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "53507:15:237", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159581, "src": "53499:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 161113, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "53523:5:237", "memberName": "mulUp", "nodeType": "MemberAccess", "referencedDeclaration": 18902, "src": "53499:29:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 161123, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "53499:123:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 161109, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "53474:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 161110, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "53478:7:237", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "53474:11:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 161124, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "53474:158:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "53460:172:237" }, { "assignments": [161127], "declarations": [{ "constant": false, "id": 161127, "mutability": "mutable", "name": "rhs", "nameLocation": "53650:3:237", "nodeType": "VariableDeclaration", "scope": 161165, "src": "53642:11:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 161126, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "53642:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 161159, "initialValue": { "arguments": [{ "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 161156, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 161153, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "53981:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 161154, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161081, "src": "53987:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 161155, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "53995:11:237", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159579, "src": "53987:19:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "53981:25:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 161150, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161081, "src": "53955:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 161151, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "53963:11:237", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159579, "src": "53955:19:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 161152, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "53975:5:237", "memberName": "divUp", "nodeType": "MemberAccess", "referencedDeclaration": 18920, "src": "53955:25:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 161157, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "53955:52:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 161147, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 161135, "name": "k_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161091, "src": "53784:2:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 161145, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 161142, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "53876:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 161143, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161081, "src": "53882:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 161144, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "53890:11:237", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159579, "src": "53882:19:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "53876:25:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 161139, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "expression": { "id": 161136, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161081, "src": "53810:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 161137, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "53818:12:237", "memberName": "bondReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159573, "src": "53810:20:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "id": 161138, "name": "_shortAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161083, "src": "53833:12:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "53810:35:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 161140, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "53809:37:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 161141, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "53847:3:237", "memberName": "pow", "nodeType": "MemberAccess", "referencedDeclaration": 18977, "src": "53809:41:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 161146, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "53809:114:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "53784:139:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "expression": { "id": 161131, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161081, "src": "53721:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 161132, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "53729:15:237", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159581, "src": "53721:23:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 161128, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161081, "src": "53656:7:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 161129, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "53677:22:237", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159583, "src": "53656:43:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 161130, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "53713:7:237", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "53656:64:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 161133, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "53656:89:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 161134, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "53759:7:237", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "53656:110:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 161148, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "53656:281:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 161149, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "53951:3:237", "memberName": "pow", "nodeType": "MemberAccess", "referencedDeclaration": 18977, "src": "53656:298:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 161158, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "53656:352:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "53642:366:237" }, { "expression": { "arguments": [{ "id": 161162, "name": "rhs", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161127, "src": "54037:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 161160, "name": "lhs", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161108, "src": "54025:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 161161, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "54029:7:237", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "54025:11:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 161163, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "54025:16:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 161089, "id": 161164, "nodeType": "Return", "src": "54018:23:237" }] }, "documentation": { "id": 161078, "nodeType": "StructuredDocumentation", "src": "52354:656:237", "text": "@dev Gets the derivative of the short principal $P(x)$ w.r.t. the amount\n      of bonds that are shorted $x$.\n      The derivative is calculated as:\n      $$\n      P'(x) = \\tfrac{1}{c} \\cdot (y + x)^{-t_s} \\cdot \\left(\n                  \\tfrac{\\mu}{c} \\cdot (k - (y + x)^{1 - t_s})\n              \\right)^{\\tfrac{t_s}{1 - t_s}}\n      $$\n @param _params The max long calculation parameters.\n @param _shortAmount The base amount.\n @param _effectiveShareReserves The effective share reserves.\n @return The derivative of the short principal w.r.t. the bond amount." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateShortPrincipalDerivative", "nameLocation": "53024:33:237", "parameters": { "id": 161086, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 161081, "mutability": "mutable", "name": "_params", "nameLocation": "53089:7:237", "nodeType": "VariableDeclaration", "scope": 161166, "src": "53067:29:237", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" }, "typeName": { "id": 161080, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 161079, "name": "MaxTradeParams", "nameLocations": ["53067:14:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 159592, "src": "53067:14:237" }, "referencedDeclaration": 159592, "src": "53067:14:237", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159592_storage_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" } }, "visibility": "internal" }, { "constant": false, "id": 161083, "mutability": "mutable", "name": "_shortAmount", "nameLocation": "53114:12:237", "nodeType": "VariableDeclaration", "scope": 161166, "src": "53106:20:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 161082, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "53106:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 161085, "mutability": "mutable", "name": "_effectiveShareReserves", "nameLocation": "53144:23:237", "nodeType": "VariableDeclaration", "scope": 161166, "src": "53136:31:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 161084, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "53136:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "53057:116:237" }, "returnParameters": { "id": 161089, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 161088, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 161166, "src": "53197:7:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 161087, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "53197:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "53196:9:237" }, "scope": 161566, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 161189, "nodeType": "FunctionDefinition", "src": "54296:234:237", "nodes": [], "body": { "id": 161188, "nodeType": "Block", "src": "54450:80:237", "nodes": [], "statements": [{ "expression": { "arguments": [{ "id": 161185, "name": "_bondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161169, "src": "54511:11:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 161182, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 161180, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "54485:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 161181, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161171, "src": "54491:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "54485:16:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 161178, "name": "_curveFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161173, "src": "54467:9:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 161179, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "54477:7:237", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "54467:17:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 161183, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "54467:35:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 161184, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "54503:7:237", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "54467:43:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 161186, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "54467:56:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 161177, "id": 161187, "nodeType": "Return", "src": "54460:63:237" }] }, "documentation": { "id": 161167, "nodeType": "StructuredDocumentation", "src": "54054:237:237", "text": "@dev Gets the curve fee paid by the trader when they open a short.\n @param _bondAmount The bond amount.\n @param _spotPrice The spot price.\n @param _curveFee The curve fee parameter.\n @return The curve fee." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateShortCurveFee", "nameLocation": "54305:22:237", "parameters": { "id": 161174, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 161169, "mutability": "mutable", "name": "_bondAmount", "nameLocation": "54345:11:237", "nodeType": "VariableDeclaration", "scope": 161189, "src": "54337:19:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 161168, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "54337:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 161171, "mutability": "mutable", "name": "_spotPrice", "nameLocation": "54374:10:237", "nodeType": "VariableDeclaration", "scope": 161189, "src": "54366:18:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 161170, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "54366:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 161173, "mutability": "mutable", "name": "_curveFee", "nameLocation": "54402:9:237", "nodeType": "VariableDeclaration", "scope": 161189, "src": "54394:17:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 161172, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "54394:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "54327:90:237" }, "returnParameters": { "id": 161177, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 161176, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 161189, "src": "54441:7:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 161175, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "54441:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "54440:9:237" }, "scope": 161566, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 161213, "nodeType": "FunctionDefinition", "src": "54850:343:237", "nodes": [], "body": { "id": 161212, "nodeType": "Block", "src": "55043:150:237", "nodes": [], "statements": [{ "expression": { "arguments": [{ "arguments": [{ "id": 161206, "name": "_bondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161192, "src": "55137:11:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 161207, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161194, "src": "55150:10:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 161208, "name": "_curveFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161196, "src": "55162:9:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 161205, "name": "calculateShortCurveFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161189, "src": "55114:22:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 161209, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "55114:58:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 161203, "name": "_governanceLPFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161198, "src": "55072:16:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 161204, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "55089:7:237", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "55072:24:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 161210, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "55072:114:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 161202, "id": 161211, "nodeType": "Return", "src": "55053:133:237" }] }, "documentation": { "id": 161190, "nodeType": "StructuredDocumentation", "src": "54536:309:237", "text": "@dev Gets the governance fee paid by the trader when they open a short.\n @param _bondAmount The bond amount.\n @param _spotPrice The spot price.\n @param _curveFee The curve fee parameter.\n @param _governanceLPFee The governance fee parameter.\n @return The governance fee." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateShortGovernanceFee", "nameLocation": "54859:27:237", "parameters": { "id": 161199, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 161192, "mutability": "mutable", "name": "_bondAmount", "nameLocation": "54904:11:237", "nodeType": "VariableDeclaration", "scope": 161213, "src": "54896:19:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 161191, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "54896:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 161194, "mutability": "mutable", "name": "_spotPrice", "nameLocation": "54933:10:237", "nodeType": "VariableDeclaration", "scope": 161213, "src": "54925:18:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 161193, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "54925:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 161196, "mutability": "mutable", "name": "_curveFee", "nameLocation": "54961:9:237", "nodeType": "VariableDeclaration", "scope": 161213, "src": "54953:17:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 161195, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "54953:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 161198, "mutability": "mutable", "name": "_governanceLPFee", "nameLocation": "54988:16:237", "nodeType": "VariableDeclaration", "scope": 161213, "src": "54980:24:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 161197, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "54980:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "54886:124:237" }, "returnParameters": { "id": 161202, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 161201, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 161213, "src": "55034:7:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 161200, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "55034:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "55033:9:237" }, "scope": 161566, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 161288, "nodeType": "FunctionDefinition", "src": "55221:1367:237", "nodes": [], "body": { "id": 161287, "nodeType": "Block", "src": "55347:1241:237", "nodes": [], "statements": [{ "assignments": [161227], "declarations": [{ "constant": false, "id": 161227, "mutability": "mutable", "name": "poolConfig", "nameLocation": "55387:10:237", "nodeType": "VariableDeclaration", "scope": 161287, "src": "55357:40:237", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig" }, "typeName": { "id": 161226, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 161225, "name": "IHyperdrive.PoolConfig", "nameLocations": ["55357:11:237", "55369:10:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 10934, "src": "55357:22:237" }, "referencedDeclaration": 10934, "src": "55357:22:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_storage_ptr", "typeString": "struct IHyperdrive.PoolConfig" } }, "visibility": "internal" }], "id": 161231, "initialValue": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 161228, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161217, "src": "55400:10:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "id": 161229, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "55411:13:237", "memberName": "getPoolConfig", "nodeType": "MemberAccess", "referencedDeclaration": 11941, "src": "55400:24:237", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolConfig_$10934_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolConfig memory)" } }, "id": 161230, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "55400:26:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "nodeType": "VariableDeclarationStatement", "src": "55357:69:237" }, { "assignments": [161236], "declarations": [{ "constant": false, "id": 161236, "mutability": "mutable", "name": "poolInfo", "nameLocation": "55464:8:237", "nodeType": "VariableDeclaration", "scope": 161287, "src": "55436:36:237", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo" }, "typeName": { "id": 161235, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 161234, "name": "IHyperdrive.PoolInfo", "nameLocations": ["55436:11:237", "55448:8:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 10980, "src": "55436:20:237" }, "referencedDeclaration": 10980, "src": "55436:20:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_storage_ptr", "typeString": "struct IHyperdrive.PoolInfo" } }, "visibility": "internal" }], "id": 161240, "initialValue": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 161237, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161217, "src": "55475:10:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "id": 161238, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "55486:11:237", "memberName": "getPoolInfo", "nodeType": "MemberAccess", "referencedDeclaration": 11948, "src": "55475:22:237", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolInfo_$10980_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolInfo memory)" } }, "id": 161239, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "55475:24:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "nodeType": "VariableDeclarationStatement", "src": "55436:63:237" }, { "expression": { "arguments": [{ "expression": { "id": 161243, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161236, "src": "55587:8:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 161244, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "55596:13:237", "memberName": "shareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 10937, "src": "55587:22:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 161245, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161236, "src": "55644:8:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 161246, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "55653:15:237", "memberName": "shareAdjustment", "nodeType": "MemberAccess", "referencedDeclaration": 10940, "src": "55644:24:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, { "expression": { "id": 161247, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161236, "src": "55700:8:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 161248, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "55709:12:237", "memberName": "bondReserves", "nodeType": "MemberAccess", "referencedDeclaration": 10949, "src": "55700:21:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 161249, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161236, "src": "55756:8:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 161250, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "55765:15:237", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 10955, "src": "55756:24:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 161251, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161227, "src": "55822:10:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 161252, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "55833:22:237", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 10905, "src": "55822:33:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 161253, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161227, "src": "55895:10:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 161254, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "55906:20:237", "memberName": "minimumShareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 10908, "src": "55895:31:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 161255, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161227, "src": "55970:10:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 161256, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "55981:24:237", "memberName": "minimumTransactionAmount", "nodeType": "MemberAccess", "referencedDeclaration": 10911, "src": "55970:35:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 161257, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161227, "src": "56036:10:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 161258, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "56047:11:237", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 10920, "src": "56036:22:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 161259, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161236, "src": "56094:8:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 161260, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "56103:16:237", "memberName": "longsOutstanding", "nodeType": "MemberAccess", "referencedDeclaration": 10958, "src": "56094:25:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "arguments": [{ "id": 161262, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161217, "src": "56207:10:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, { "arguments": [{ "hexValue": "31653336", "id": 161269, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "56287:4:237", "typeDescriptions": { "typeIdentifier": "t_rational_1000000000000000000000000000000000000_by_1", "typeString": "int_const 1000...(29 digits omitted)...0000" }, "value": "1e36" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_rational_1000000000000000000000000000000000000_by_1", "typeString": "int_const 1000...(29 digits omitted)...0000" }], "expression": { "arguments": [{ "expression": { "id": 161265, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161236, "src": "56247:8:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 161266, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "56256:23:237", "memberName": "longAverageMaturityTime", "nodeType": "MemberAccess", "referencedDeclaration": 10961, "src": "56247:32:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 161264, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "56239:7:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_uint256_$", "typeString": "type(uint256)" }, "typeName": { "id": 161263, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "56239:7:237", "typeDescriptions": {} } }, "id": 161267, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "56239:41:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 161268, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "56281:5:237", "memberName": "divUp", "nodeType": "MemberAccess", "referencedDeclaration": 18920, "src": "56239:47:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 161270, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "56239:53:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 161261, "name": "calculateTimeRemaining", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159065, "src": "56163:22:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_view$_t_contract$_IHyperdrive_$11143_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (contract IHyperdrive,uint256) view returns (uint256)" } }, "id": 161271, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "56163:147:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 161272, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161236, "src": "56347:8:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 161273, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "56356:17:237", "memberName": "shortsOutstanding", "nodeType": "MemberAccess", "referencedDeclaration": 10964, "src": "56347:26:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "arguments": [{ "id": 161275, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161217, "src": "56462:10:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, { "arguments": [{ "hexValue": "31653336", "id": 161282, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "56543:4:237", "typeDescriptions": { "typeIdentifier": "t_rational_1000000000000000000000000000000000000_by_1", "typeString": "int_const 1000...(29 digits omitted)...0000" }, "value": "1e36" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_rational_1000000000000000000000000000000000000_by_1", "typeString": "int_const 1000...(29 digits omitted)...0000" }], "expression": { "arguments": [{ "expression": { "id": 161278, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161236, "src": "56502:8:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 161279, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "56511:24:237", "memberName": "shortAverageMaturityTime", "nodeType": "MemberAccess", "referencedDeclaration": 10967, "src": "56502:33:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 161277, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "56494:7:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_uint256_$", "typeString": "type(uint256)" }, "typeName": { "id": 161276, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "56494:7:237", "typeDescriptions": {} } }, "id": 161280, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "56494:42:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 161281, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "56537:5:237", "memberName": "divUp", "nodeType": "MemberAccess", "referencedDeclaration": 18920, "src": "56494:48:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 161283, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "56494:54:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 161274, "name": "calculateTimeRemaining", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159065, "src": "56418:22:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_view$_t_contract$_IHyperdrive_$11143_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (contract IHyperdrive,uint256) view returns (uint256)" } }, "id": 161284, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "56418:148:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_int256", "typeString": "int256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 161241, "name": "LPMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 22264, "src": "55528:6:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_LPMath_$22264_$", "typeString": "type(library LPMath)" } }, "id": 161242, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "55535:18:237", "memberName": "PresentValueParams", "nodeType": "MemberAccess", "referencedDeclaration": 20572, "src": "55528:25:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_struct$_PresentValueParams_$20572_storage_ptr_$", "typeString": "type(struct LPMath.PresentValueParams storage pointer)" } }, "id": 161285, "isConstant": false, "isLValue": false, "isPure": false, "kind": "structConstructorCall", "lValueRequested": false, "nameLocations": ["55572:13:237", "55627:15:237", "55686:12:237", "55739:15:237", "55798:22:237", "55873:20:237", "55944:24:237", "56023:11:237", "56076:16:237", "56137:24:237", "56328:17:237", "56391:25:237"], "names": ["shareReserves", "shareAdjustment", "bondReserves", "vaultSharePrice", "initialVaultSharePrice", "minimumShareReserves", "minimumTransactionAmount", "timeStretch", "longsOutstanding", "longAverageTimeRemaining", "shortsOutstanding", "shortAverageTimeRemaining"], "nodeType": "FunctionCall", "src": "55528:1053:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PresentValueParams_$20572_memory_ptr", "typeString": "struct LPMath.PresentValueParams memory" } }, "functionReturnParameters": 161222, "id": 161286, "nodeType": "Return", "src": "55509:1072:237" }] }, "documentation": { "id": 161214, "nodeType": "StructuredDocumentation", "src": "55199:17:237", "text": "LP Utils ///" }, "implemented": true, "kind": "function", "modifiers": [], "name": "getPresentValueParams", "nameLocation": "55230:21:237", "parameters": { "id": 161218, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 161217, "mutability": "mutable", "name": "hyperdrive", "nameLocation": "55273:10:237", "nodeType": "VariableDeclaration", "scope": 161288, "src": "55261:22:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" }, "typeName": { "id": 161216, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 161215, "name": "IHyperdrive", "nameLocations": ["55261:11:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 11143, "src": "55261:11:237" }, "referencedDeclaration": 11143, "src": "55261:11:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "visibility": "internal" }], "src": "55251:38:237" }, "returnParameters": { "id": 161222, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 161221, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 161288, "src": "55313:32:237", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_PresentValueParams_$20572_memory_ptr", "typeString": "struct LPMath.PresentValueParams" }, "typeName": { "id": 161220, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 161219, "name": "LPMath.PresentValueParams", "nameLocations": ["55313:6:237", "55320:18:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 20572, "src": "55313:25:237" }, "referencedDeclaration": 20572, "src": "55313:25:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PresentValueParams_$20572_storage_ptr", "typeString": "struct LPMath.PresentValueParams" } }, "visibility": "internal" }], "src": "55312:34:237" }, "scope": 161566, "stateMutability": "view", "virtual": false, "visibility": "internal" }, { "id": 161377, "nodeType": "FunctionDefinition", "src": "56594:1628:237", "nodes": [], "body": { "id": 161376, "nodeType": "Block", "src": "56736:1486:237", "nodes": [], "statements": [{ "assignments": [161301], "declarations": [{ "constant": false, "id": 161301, "mutability": "mutable", "name": "poolInfo", "nameLocation": "56774:8:237", "nodeType": "VariableDeclaration", "scope": 161376, "src": "56746:36:237", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo" }, "typeName": { "id": 161300, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 161299, "name": "IHyperdrive.PoolInfo", "nameLocations": ["56746:11:237", "56758:8:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 10980, "src": "56746:20:237" }, "referencedDeclaration": 10980, "src": "56746:20:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_storage_ptr", "typeString": "struct IHyperdrive.PoolInfo" } }, "visibility": "internal" }], "id": 161305, "initialValue": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 161302, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161291, "src": "56785:10:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "id": 161303, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "56796:11:237", "memberName": "getPoolInfo", "nodeType": "MemberAccess", "referencedDeclaration": 11948, "src": "56785:22:237", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolInfo_$10980_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolInfo memory)" } }, "id": 161304, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "56785:24:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "nodeType": "VariableDeclarationStatement", "src": "56746:63:237" }, { "assignments": [161310], "declarations": [{ "constant": false, "id": 161310, "mutability": "mutable", "name": "presentValueParams", "nameLocation": "56852:18:237", "nodeType": "VariableDeclaration", "scope": 161376, "src": "56819:51:237", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_PresentValueParams_$20572_memory_ptr", "typeString": "struct LPMath.PresentValueParams" }, "typeName": { "id": 161309, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 161308, "name": "LPMath.PresentValueParams", "nameLocations": ["56819:6:237", "56826:18:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 20572, "src": "56819:25:237" }, "referencedDeclaration": 20572, "src": "56819:25:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PresentValueParams_$20572_storage_ptr", "typeString": "struct LPMath.PresentValueParams" } }, "visibility": "internal" }], "id": 161314, "initialValue": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 161311, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161291, "src": "56873:10:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "id": 161312, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "56897:21:237", "memberName": "getPresentValueParams", "nodeType": "MemberAccess", "referencedDeclaration": 161288, "src": "56873:45:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_view$_t_contract$_IHyperdrive_$11143_$returns$_t_struct$_PresentValueParams_$20572_memory_ptr_$attached_to$_t_contract$_IHyperdrive_$11143_$", "typeString": "function (contract IHyperdrive) view returns (struct LPMath.PresentValueParams memory)" } }, "id": 161313, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "56873:47:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PresentValueParams_$20572_memory_ptr", "typeString": "struct LPMath.PresentValueParams memory" } }, "nodeType": "VariableDeclarationStatement", "src": "56819:101:237" }, { "assignments": [161316], "declarations": [{ "constant": false, "id": 161316, "mutability": "mutable", "name": "startingPresentValue", "nameLocation": "56938:20:237", "nodeType": "VariableDeclaration", "scope": 161376, "src": "56930:28:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 161315, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "56930:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 161321, "initialValue": { "arguments": [{ "id": 161319, "name": "presentValueParams", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161310, "src": "57003:18:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PresentValueParams_$20572_memory_ptr", "typeString": "struct LPMath.PresentValueParams memory" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_PresentValueParams_$20572_memory_ptr", "typeString": "struct LPMath.PresentValueParams memory" }], "expression": { "id": 161317, "name": "LPMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 22264, "src": "56961:6:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_LPMath_$22264_$", "typeString": "type(library LPMath)" } }, "id": 161318, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "56968:21:237", "memberName": "calculatePresentValue", "nodeType": "MemberAccess", "referencedDeclaration": 20601, "src": "56961:28:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_PresentValueParams_$20572_memory_ptr_$returns$_t_uint256_$", "typeString": "function (struct LPMath.PresentValueParams memory) pure returns (uint256)" } }, "id": 161320, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "56961:70:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "56930:101:237" }, { "assignments": [161323], "declarations": [{ "constant": false, "id": 161323, "mutability": "mutable", "name": "netCurveTrade", "nameLocation": "57048:13:237", "nodeType": "VariableDeclaration", "scope": 161376, "src": "57041:20:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" }, "typeName": { "id": 161322, "name": "int256", "nodeType": "ElementaryTypeName", "src": "57041:6:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "visibility": "internal" }], "id": 161343, "initialValue": { "commonType": { "typeIdentifier": "t_int256", "typeString": "int256" }, "id": 161342, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "arguments": [{ "arguments": [{ "expression": { "id": 161329, "name": "presentValueParams", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161310, "src": "57145:18:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PresentValueParams_$20572_memory_ptr", "typeString": "struct LPMath.PresentValueParams memory" } }, "id": 161330, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "57164:24:237", "memberName": "longAverageTimeRemaining", "nodeType": "MemberAccess", "referencedDeclaration": 20567, "src": "57145:43:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 161326, "name": "presentValueParams", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161310, "src": "57084:18:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PresentValueParams_$20572_memory_ptr", "typeString": "struct LPMath.PresentValueParams memory" } }, "id": 161327, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "57103:16:237", "memberName": "longsOutstanding", "nodeType": "MemberAccess", "referencedDeclaration": 20565, "src": "57084:35:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 161328, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "57120:7:237", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "57084:43:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 161331, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "57084:118:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 161325, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "57064:6:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_int256_$", "typeString": "type(int256)" }, "typeName": { "id": 161324, "name": "int256", "nodeType": "ElementaryTypeName", "src": "57064:6:237", "typeDescriptions": {} } }, "id": 161332, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "57064:148:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [{ "arguments": [{ "expression": { "id": 161338, "name": "presentValueParams", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161310, "src": "57317:18:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PresentValueParams_$20572_memory_ptr", "typeString": "struct LPMath.PresentValueParams memory" } }, "id": 161339, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "57336:25:237", "memberName": "shortAverageTimeRemaining", "nodeType": "MemberAccess", "referencedDeclaration": 20571, "src": "57317:44:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 161335, "name": "presentValueParams", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161310, "src": "57251:18:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PresentValueParams_$20572_memory_ptr", "typeString": "struct LPMath.PresentValueParams memory" } }, "id": 161336, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "57270:17:237", "memberName": "shortsOutstanding", "nodeType": "MemberAccess", "referencedDeclaration": 20569, "src": "57251:36:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 161337, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "57288:7:237", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "57251:44:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 161340, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "57251:128:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 161334, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "57227:6:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_int256_$", "typeString": "type(int256)" }, "typeName": { "id": 161333, "name": "int256", "nodeType": "ElementaryTypeName", "src": "57227:6:237", "typeDescriptions": {} } }, "id": 161341, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "57227:166:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "src": "57064:329:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "nodeType": "VariableDeclarationStatement", "src": "57041:352:237" }, { "expression": { "arguments": [{ "id": 161346, "name": "presentValueParams", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161310, "src": "57494:18:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PresentValueParams_$20572_memory_ptr", "typeString": "struct LPMath.PresentValueParams memory" } }, { "id": 161347, "name": "startingPresentValue", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161316, "src": "57552:20:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "arguments": [{ "expression": { "id": 161350, "name": "AssetId", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18772, "src": "57655:7:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_AssetId_$18772_$", "typeString": "type(library AssetId)" } }, "id": 161351, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "memberLocation": "57663:12:237", "memberName": "_LP_ASSET_ID", "nodeType": "MemberAccess", "referencedDeclaration": 18505, "src": "57655:20:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 161348, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161291, "src": "57611:10:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "id": 161349, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "57622:11:237", "memberName": "totalSupply", "nodeType": "MemberAccess", "referencedDeclaration": 12279, "src": "57611:22:237", "typeDescriptions": { "typeIdentifier": "t_function_external_view$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256) view external returns (uint256)" } }, "id": 161352, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "57611:82:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 161360, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "arguments": [{ "expression": { "id": 161355, "name": "AssetId", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18772, "src": "57784:7:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_AssetId_$18772_$", "typeString": "type(library AssetId)" } }, "id": 161356, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "memberLocation": "57792:26:237", "memberName": "_WITHDRAWAL_SHARE_ASSET_ID", "nodeType": "MemberAccess", "referencedDeclaration": 18514, "src": "57784:34:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 161353, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161291, "src": "57740:10:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "id": 161354, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "57751:11:237", "memberName": "totalSupply", "nodeType": "MemberAccess", "referencedDeclaration": 12279, "src": "57740:22:237", "typeDescriptions": { "typeIdentifier": "t_function_external_view$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256) view external returns (uint256)" } }, "id": 161357, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "57740:96:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 161358, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161301, "src": "57839:8:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 161359, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "57848:31:237", "memberName": "withdrawalSharesReadyToWithdraw", "nodeType": "MemberAccess", "referencedDeclaration": 10970, "src": "57839:40:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "57740:139:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "arguments": [{ "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 161363, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161291, "src": "57911:10:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "id": 161364, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "57922:8:237", "memberName": "solvency", "nodeType": "MemberAccess", "referencedDeclaration": 161517, "src": "57911:19:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_view$_t_contract$_IHyperdrive_$11143_$returns$_t_int256_$attached_to$_t_contract$_IHyperdrive_$11143_$", "typeString": "function (contract IHyperdrive) view returns (int256)" } }, "id": 161365, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "57911:21:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 161362, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "57903:7:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_uint256_$", "typeString": "type(uint256)" }, "typeName": { "id": 161361, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "57903:7:237", "typeDescriptions": {} } }, "id": 161366, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "57903:30:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 161367, "name": "netCurveTrade", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161323, "src": "57966:13:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, { "expression": { "id": 161368, "name": "presentValueParams", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161310, "src": "58020:18:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PresentValueParams_$20572_memory_ptr", "typeString": "struct LPMath.PresentValueParams memory" } }, "id": 161369, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "58039:13:237", "memberName": "shareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 20549, "src": "58020:32:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 161370, "name": "presentValueParams", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161310, "src": "58095:18:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PresentValueParams_$20572_memory_ptr", "typeString": "struct LPMath.PresentValueParams memory" } }, "id": 161371, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "58114:15:237", "memberName": "shareAdjustment", "nodeType": "MemberAccess", "referencedDeclaration": 20551, "src": "58095:34:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, { "expression": { "id": 161372, "name": "presentValueParams", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161310, "src": "58169:18:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PresentValueParams_$20572_memory_ptr", "typeString": "struct LPMath.PresentValueParams memory" } }, "id": 161373, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "58188:12:237", "memberName": "bondReserves", "nodeType": "MemberAccess", "referencedDeclaration": 20553, "src": "58169:31:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_PresentValueParams_$20572_memory_ptr", "typeString": "struct LPMath.PresentValueParams memory" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_int256", "typeString": "int256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_int256", "typeString": "int256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 161344, "name": "LPMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 22264, "src": "57422:6:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_LPMath_$22264_$", "typeString": "type(library LPMath)" } }, "id": 161345, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "57429:26:237", "memberName": "DistributeExcessIdleParams", "nodeType": "MemberAccess", "referencedDeclaration": 21060, "src": "57422:33:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_struct$_DistributeExcessIdleParams_$21060_storage_ptr_$", "typeString": "type(struct LPMath.DistributeExcessIdleParams storage pointer)" } }, "id": 161374, "isConstant": false, "isLValue": false, "isPure": false, "kind": "structConstructorCall", "lValueRequested": false, "nameLocations": ["57474:18:237", "57530:20:237", "57590:19:237", "57711:27:237", "57897:4:237", "57951:13:237", "57997:21:237", "58070:23:237", "58147:20:237"], "names": ["presentValueParams", "startingPresentValue", "activeLpTotalSupply", "withdrawalSharesTotalSupply", "idle", "netCurveTrade", "originalShareReserves", "originalShareAdjustment", "originalBondReserves"], "nodeType": "FunctionCall", "src": "57422:793:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_DistributeExcessIdleParams_$21060_memory_ptr", "typeString": "struct LPMath.DistributeExcessIdleParams memory" } }, "functionReturnParameters": 161296, "id": 161375, "nodeType": "Return", "src": "57403:812:237" }] }, "implemented": true, "kind": "function", "modifiers": [], "name": "getDistributeExcessIdleParams", "nameLocation": "56603:29:237", "parameters": { "id": 161292, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 161291, "mutability": "mutable", "name": "hyperdrive", "nameLocation": "56654:10:237", "nodeType": "VariableDeclaration", "scope": 161377, "src": "56642:22:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" }, "typeName": { "id": 161290, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 161289, "name": "IHyperdrive", "nameLocations": ["56642:11:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 11143, "src": "56642:11:237" }, "referencedDeclaration": 11143, "src": "56642:11:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "visibility": "internal" }], "src": "56632:38:237" }, "returnParameters": { "id": 161296, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 161295, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 161377, "src": "56694:40:237", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_DistributeExcessIdleParams_$21060_memory_ptr", "typeString": "struct LPMath.DistributeExcessIdleParams" }, "typeName": { "id": 161294, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 161293, "name": "LPMath.DistributeExcessIdleParams", "nameLocations": ["56694:6:237", "56701:26:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 21060, "src": "56694:33:237" }, "referencedDeclaration": 21060, "src": "56694:33:237", "typeDescriptions": { "typeIdentifier": "t_struct$_DistributeExcessIdleParams_$21060_storage_ptr", "typeString": "struct LPMath.DistributeExcessIdleParams" } }, "visibility": "internal" }], "src": "56693:42:237" }, "scope": 161566, "stateMutability": "view", "virtual": false, "visibility": "internal" }, { "id": 161399, "nodeType": "FunctionDefinition", "src": "58228:276:237", "nodes": [], "body": { "id": 161398, "nodeType": "Block", "src": "58320:184:237", "nodes": [], "statements": [{ "expression": { "arguments": [{ "expression": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 161392, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161380, "src": "58456:10:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "id": 161393, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "58467:11:237", "memberName": "getPoolInfo", "nodeType": "MemberAccess", "referencedDeclaration": 11948, "src": "58456:22:237", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolInfo_$10980_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolInfo memory)" } }, "id": 161394, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "58456:24:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 161395, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "58481:15:237", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 10955, "src": "58456:40:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 161387, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161380, "src": "58395:10:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "id": 161388, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "58406:21:237", "memberName": "getPresentValueParams", "nodeType": "MemberAccess", "referencedDeclaration": 161288, "src": "58395:32:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_view$_t_contract$_IHyperdrive_$11143_$returns$_t_struct$_PresentValueParams_$20572_memory_ptr_$attached_to$_t_contract$_IHyperdrive_$11143_$", "typeString": "function (contract IHyperdrive) view returns (struct LPMath.PresentValueParams memory)" } }, "id": 161389, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "58395:34:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PresentValueParams_$20572_memory_ptr", "typeString": "struct LPMath.PresentValueParams memory" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_PresentValueParams_$20572_memory_ptr", "typeString": "struct LPMath.PresentValueParams memory" }], "expression": { "id": 161385, "name": "LPMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 22264, "src": "58349:6:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_LPMath_$22264_$", "typeString": "type(library LPMath)" } }, "id": 161386, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "58373:21:237", "memberName": "calculatePresentValue", "nodeType": "MemberAccess", "referencedDeclaration": 20601, "src": "58349:45:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_PresentValueParams_$20572_memory_ptr_$returns$_t_uint256_$", "typeString": "function (struct LPMath.PresentValueParams memory) pure returns (uint256)" } }, "id": 161390, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "58349:81:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 161391, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "58448:7:237", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "58349:106:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 161396, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "58349:148:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 161384, "id": 161397, "nodeType": "Return", "src": "58330:167:237" }] }, "implemented": true, "kind": "function", "modifiers": [], "name": "presentValue", "nameLocation": "58237:12:237", "parameters": { "id": 161381, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 161380, "mutability": "mutable", "name": "hyperdrive", "nameLocation": "58271:10:237", "nodeType": "VariableDeclaration", "scope": 161399, "src": "58259:22:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" }, "typeName": { "id": 161379, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 161378, "name": "IHyperdrive", "nameLocations": ["58259:11:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 11143, "src": "58259:11:237" }, "referencedDeclaration": 11143, "src": "58259:11:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "visibility": "internal" }], "src": "58249:38:237" }, "returnParameters": { "id": 161384, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 161383, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 161399, "src": "58311:7:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 161382, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "58311:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "58310:9:237" }, "scope": 161566, "stateMutability": "view", "virtual": false, "visibility": "internal" }, { "id": 161417, "nodeType": "FunctionDefinition", "src": "58510:177:237", "nodes": [], "body": { "id": 161416, "nodeType": "Block", "src": "58602:85:237", "nodes": [], "statements": [{ "expression": { "arguments": [{ "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 161411, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161402, "src": "58653:10:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "id": 161412, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "58664:13:237", "memberName": "lpTotalSupply", "nodeType": "MemberAccess", "referencedDeclaration": 161443, "src": "58653:24:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_view$_t_contract$_IHyperdrive_$11143_$returns$_t_uint256_$attached_to$_t_contract$_IHyperdrive_$11143_$", "typeString": "function (contract IHyperdrive) view returns (uint256)" } }, "id": 161413, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "58653:26:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 161407, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161402, "src": "58619:10:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "id": 161408, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "58630:12:237", "memberName": "presentValue", "nodeType": "MemberAccess", "referencedDeclaration": 161399, "src": "58619:23:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_view$_t_contract$_IHyperdrive_$11143_$returns$_t_uint256_$attached_to$_t_contract$_IHyperdrive_$11143_$", "typeString": "function (contract IHyperdrive) view returns (uint256)" } }, "id": 161409, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "58619:25:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 161410, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "58645:7:237", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "58619:33:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 161414, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "58619:61:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 161406, "id": 161415, "nodeType": "Return", "src": "58612:68:237" }] }, "implemented": true, "kind": "function", "modifiers": [], "name": "lpSharePrice", "nameLocation": "58519:12:237", "parameters": { "id": 161403, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 161402, "mutability": "mutable", "name": "hyperdrive", "nameLocation": "58553:10:237", "nodeType": "VariableDeclaration", "scope": 161417, "src": "58541:22:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" }, "typeName": { "id": 161401, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 161400, "name": "IHyperdrive", "nameLocations": ["58541:11:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 11143, "src": "58541:11:237" }, "referencedDeclaration": 11143, "src": "58541:11:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "visibility": "internal" }], "src": "58531:38:237" }, "returnParameters": { "id": 161406, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 161405, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 161417, "src": "58593:7:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 161404, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "58593:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "58592:9:237" }, "scope": 161566, "stateMutability": "view", "virtual": false, "visibility": "internal" }, { "id": 161443, "nodeType": "FunctionDefinition", "src": "58693:317:237", "nodes": [], "body": { "id": 161442, "nodeType": "Block", "src": "58786:224:237", "nodes": [], "statements": [{ "expression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 161440, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 161435, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "arguments": [{ "expression": { "id": 161427, "name": "AssetId", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18772, "src": "58838:7:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_AssetId_$18772_$", "typeString": "type(library AssetId)" } }, "id": 161428, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "memberLocation": "58846:12:237", "memberName": "_LP_ASSET_ID", "nodeType": "MemberAccess", "referencedDeclaration": 18505, "src": "58838:20:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 161425, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161420, "src": "58815:10:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "id": 161426, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "58826:11:237", "memberName": "totalSupply", "nodeType": "MemberAccess", "referencedDeclaration": 12279, "src": "58815:22:237", "typeDescriptions": { "typeIdentifier": "t_function_external_view$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256) view external returns (uint256)" } }, "id": 161429, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "58815:44:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "arguments": [{ "expression": { "id": 161432, "name": "AssetId", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18772, "src": "58897:7:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_AssetId_$18772_$", "typeString": "type(library AssetId)" } }, "id": 161433, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "memberLocation": "58905:26:237", "memberName": "_WITHDRAWAL_SHARE_ASSET_ID", "nodeType": "MemberAccess", "referencedDeclaration": 18514, "src": "58897:34:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 161430, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161420, "src": "58874:10:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "id": 161431, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "58885:11:237", "memberName": "totalSupply", "nodeType": "MemberAccess", "referencedDeclaration": 12279, "src": "58874:22:237", "typeDescriptions": { "typeIdentifier": "t_function_external_view$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256) view external returns (uint256)" } }, "id": 161434, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "58874:58:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "58815:117:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 161436, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161420, "src": "58947:10:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "id": 161437, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "58958:11:237", "memberName": "getPoolInfo", "nodeType": "MemberAccess", "referencedDeclaration": 11948, "src": "58947:22:237", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolInfo_$10980_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolInfo memory)" } }, "id": 161438, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "58947:24:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 161439, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "58972:31:237", "memberName": "withdrawalSharesReadyToWithdraw", "nodeType": "MemberAccess", "referencedDeclaration": 10970, "src": "58947:56:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "58815:188:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 161424, "id": 161441, "nodeType": "Return", "src": "58796:207:237" }] }, "implemented": true, "kind": "function", "modifiers": [], "name": "lpTotalSupply", "nameLocation": "58702:13:237", "parameters": { "id": 161421, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 161420, "mutability": "mutable", "name": "hyperdrive", "nameLocation": "58737:10:237", "nodeType": "VariableDeclaration", "scope": 161443, "src": "58725:22:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" }, "typeName": { "id": 161419, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 161418, "name": "IHyperdrive", "nameLocations": ["58725:11:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 11143, "src": "58725:11:237" }, "referencedDeclaration": 11143, "src": "58725:11:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "visibility": "internal" }], "src": "58715:38:237" }, "returnParameters": { "id": 161424, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 161423, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 161443, "src": "58777:7:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 161422, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "58777:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "58776:9:237" }, "scope": 161566, "stateMutability": "view", "virtual": false, "visibility": "internal" }, { "id": 161468, "nodeType": "FunctionDefinition", "src": "59016:223:237", "nodes": [], "body": { "id": 161467, "nodeType": "Block", "src": "59086:153:237", "nodes": [], "statements": [{ "expression": { "arguments": [{ "expression": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 161461, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161446, "src": "59178:10:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "id": 161462, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "59189:11:237", "memberName": "getPoolInfo", "nodeType": "MemberAccess", "referencedDeclaration": 11948, "src": "59178:22:237", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolInfo_$10980_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolInfo memory)" } }, "id": 161463, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "59178:24:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 161464, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "59203:15:237", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 10955, "src": "59178:40:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "arguments": [{ "hexValue": "30", "id": 161457, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "59149:1:237", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }], "expression": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 161453, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161446, "src": "59123:10:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "id": 161454, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "59134:8:237", "memberName": "solvency", "nodeType": "MemberAccess", "referencedDeclaration": 161517, "src": "59123:19:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_view$_t_contract$_IHyperdrive_$11143_$returns$_t_int256_$attached_to$_t_contract$_IHyperdrive_$11143_$", "typeString": "function (contract IHyperdrive) view returns (int256)" } }, "id": 161455, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "59123:21:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "id": 161456, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "59145:3:237", "memberName": "max", "nodeType": "MemberAccess", "referencedDeclaration": 19571, "src": "59123:25:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_int256_$_t_int256_$returns$_t_int256_$attached_to$_t_int256_$", "typeString": "function (int256,int256) pure returns (int256)" } }, "id": 161458, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "59123:28:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 161452, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "59115:7:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_uint256_$", "typeString": "type(uint256)" }, "typeName": { "id": 161451, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "59115:7:237", "typeDescriptions": {} } }, "id": 161459, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "59115:37:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 161460, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "59153:7:237", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "59115:45:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 161465, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "59115:117:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 161450, "id": 161466, "nodeType": "Return", "src": "59096:136:237" }] }, "implemented": true, "kind": "function", "modifiers": [], "name": "idle", "nameLocation": "59025:4:237", "parameters": { "id": 161447, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 161446, "mutability": "mutable", "name": "hyperdrive", "nameLocation": "59042:10:237", "nodeType": "VariableDeclaration", "scope": 161468, "src": "59030:22:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" }, "typeName": { "id": 161445, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 161444, "name": "IHyperdrive", "nameLocations": ["59030:11:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 11143, "src": "59030:11:237" }, "referencedDeclaration": 11143, "src": "59030:11:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "visibility": "internal" }], "src": "59029:24:237" }, "returnParameters": { "id": 161450, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 161449, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 161468, "src": "59077:7:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 161448, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "59077:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "59076:9:237" }, "scope": 161566, "stateMutability": "view", "virtual": false, "visibility": "internal" }, { "id": 161517, "nodeType": "FunctionDefinition", "src": "59245:399:237", "nodes": [], "body": { "id": 161516, "nodeType": "Block", "src": "59318:326:237", "nodes": [], "statements": [{ "assignments": [161480], "declarations": [{ "constant": false, "id": 161480, "mutability": "mutable", "name": "config", "nameLocation": "59358:6:237", "nodeType": "VariableDeclaration", "scope": 161516, "src": "59328:36:237", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig" }, "typeName": { "id": 161479, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 161478, "name": "IHyperdrive.PoolConfig", "nameLocations": ["59328:11:237", "59340:10:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 10934, "src": "59328:22:237" }, "referencedDeclaration": 10934, "src": "59328:22:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_storage_ptr", "typeString": "struct IHyperdrive.PoolConfig" } }, "visibility": "internal" }], "id": 161484, "initialValue": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 161481, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161471, "src": "59367:10:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "id": 161482, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "59378:13:237", "memberName": "getPoolConfig", "nodeType": "MemberAccess", "referencedDeclaration": 11941, "src": "59367:24:237", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolConfig_$10934_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolConfig memory)" } }, "id": 161483, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "59367:26:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "nodeType": "VariableDeclarationStatement", "src": "59328:65:237" }, { "assignments": [161489], "declarations": [{ "constant": false, "id": 161489, "mutability": "mutable", "name": "info", "nameLocation": "59431:4:237", "nodeType": "VariableDeclaration", "scope": 161516, "src": "59403:32:237", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo" }, "typeName": { "id": 161488, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 161487, "name": "IHyperdrive.PoolInfo", "nameLocations": ["59403:11:237", "59415:8:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 10980, "src": "59403:20:237" }, "referencedDeclaration": 10980, "src": "59403:20:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_storage_ptr", "typeString": "struct IHyperdrive.PoolInfo" } }, "visibility": "internal" }], "id": 161493, "initialValue": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 161490, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161471, "src": "59438:10:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "id": 161491, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "59449:11:237", "memberName": "getPoolInfo", "nodeType": "MemberAccess", "referencedDeclaration": 11948, "src": "59438:22:237", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolInfo_$10980_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolInfo memory)" } }, "id": 161492, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "59438:24:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "nodeType": "VariableDeclarationStatement", "src": "59403:59:237" }, { "expression": { "commonType": { "typeIdentifier": "t_int256", "typeString": "int256" }, "id": 161514, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "commonType": { "typeIdentifier": "t_int256", "typeString": "int256" }, "id": 161508, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "arguments": [{ "expression": { "id": 161496, "name": "info", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161489, "src": "59498:4:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 161497, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "59503:13:237", "memberName": "shareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 10937, "src": "59498:18:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 161495, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "59491:6:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_int256_$", "typeString": "type(int256)" }, "typeName": { "id": 161494, "name": "int256", "nodeType": "ElementaryTypeName", "src": "59491:6:237", "typeDescriptions": {} } }, "id": 161498, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "59491:26:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [{ "arguments": [{ "expression": { "id": 161504, "name": "info", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161489, "src": "59565:4:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 161505, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "59570:15:237", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 10955, "src": "59565:20:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 161501, "name": "info", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161489, "src": "59539:4:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 161502, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "59544:12:237", "memberName": "longExposure", "nodeType": "MemberAccess", "referencedDeclaration": 10979, "src": "59539:17:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 161503, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "59557:7:237", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "59539:25:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 161506, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "59539:47:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 161500, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "59532:6:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_int256_$", "typeString": "type(int256)" }, "typeName": { "id": 161499, "name": "int256", "nodeType": "ElementaryTypeName", "src": "59532:6:237", "typeDescriptions": {} } }, "id": 161507, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "59532:55:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "src": "59491:96:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [{ "expression": { "id": 161511, "name": "config", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161480, "src": "59609:6:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 161512, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "59616:20:237", "memberName": "minimumShareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 10908, "src": "59609:27:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 161510, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "59602:6:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_int256_$", "typeString": "type(int256)" }, "typeName": { "id": 161509, "name": "int256", "nodeType": "ElementaryTypeName", "src": "59602:6:237", "typeDescriptions": {} } }, "id": 161513, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "59602:35:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "src": "59491:146:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "functionReturnParameters": 161475, "id": 161515, "nodeType": "Return", "src": "59472:165:237" }] }, "implemented": true, "kind": "function", "modifiers": [], "name": "solvency", "nameLocation": "59254:8:237", "parameters": { "id": 161472, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 161471, "mutability": "mutable", "name": "hyperdrive", "nameLocation": "59275:10:237", "nodeType": "VariableDeclaration", "scope": 161517, "src": "59263:22:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" }, "typeName": { "id": 161470, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 161469, "name": "IHyperdrive", "nameLocations": ["59263:11:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 11143, "src": "59263:11:237" }, "referencedDeclaration": 11143, "src": "59263:11:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "visibility": "internal" }], "src": "59262:24:237" }, "returnParameters": { "id": 161475, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 161474, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 161517, "src": "59310:6:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" }, "typeName": { "id": 161473, "name": "int256", "nodeType": "ElementaryTypeName", "src": "59310:6:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "visibility": "internal" }], "src": "59309:8:237" }, "scope": 161566, "stateMutability": "view", "virtual": false, "visibility": "internal" }, { "id": 161565, "nodeType": "FunctionDefinition", "src": "59650:607:237", "nodes": [], "body": { "id": 161564, "nodeType": "Block", "src": "59717:540:237", "nodes": [], "statements": [{ "assignments": [161529], "declarations": [{ "constant": false, "id": 161529, "mutability": "mutable", "name": "config", "nameLocation": "59757:6:237", "nodeType": "VariableDeclaration", "scope": 161564, "src": "59727:36:237", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig" }, "typeName": { "id": 161528, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 161527, "name": "IHyperdrive.PoolConfig", "nameLocations": ["59727:11:237", "59739:10:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 10934, "src": "59727:22:237" }, "referencedDeclaration": 10934, "src": "59727:22:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_storage_ptr", "typeString": "struct IHyperdrive.PoolConfig" } }, "visibility": "internal" }], "id": 161533, "initialValue": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 161530, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161520, "src": "59766:10:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "id": 161531, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "59777:13:237", "memberName": "getPoolConfig", "nodeType": "MemberAccess", "referencedDeclaration": 11941, "src": "59766:24:237", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolConfig_$10934_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolConfig memory)" } }, "id": 161532, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "59766:26:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "nodeType": "VariableDeclarationStatement", "src": "59727:65:237" }, { "assignments": [161538], "declarations": [{ "constant": false, "id": 161538, "mutability": "mutable", "name": "info", "nameLocation": "59830:4:237", "nodeType": "VariableDeclaration", "scope": 161564, "src": "59802:32:237", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo" }, "typeName": { "id": 161537, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 161536, "name": "IHyperdrive.PoolInfo", "nameLocations": ["59802:11:237", "59814:8:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 10980, "src": "59802:20:237" }, "referencedDeclaration": 10980, "src": "59802:20:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_storage_ptr", "typeString": "struct IHyperdrive.PoolInfo" } }, "visibility": "internal" }], "id": 161542, "initialValue": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 161539, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161520, "src": "59837:10:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "id": 161540, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "59848:11:237", "memberName": "getPoolInfo", "nodeType": "MemberAccess", "referencedDeclaration": 11948, "src": "59837:22:237", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolInfo_$10980_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolInfo memory)" } }, "id": 161541, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "59837:24:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "nodeType": "VariableDeclarationStatement", "src": "59802:59:237" }, { "expression": { "arguments": [{ "arguments": [{ "expression": { "id": 161547, "name": "info", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161538, "src": "59996:4:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 161548, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "60001:13:237", "memberName": "shareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 10937, "src": "59996:18:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 161549, "name": "info", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161538, "src": "60036:4:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 161550, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "60041:15:237", "memberName": "shareAdjustment", "nodeType": "MemberAccess", "referencedDeclaration": 10940, "src": "60036:20:237", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_int256", "typeString": "int256" }], "expression": { "id": 161545, "name": "HyperdriveMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20320, "src": "59928:14:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_HyperdriveMath_$20320_$", "typeString": "type(library HyperdriveMath)" } }, "id": 161546, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "59943:31:237", "memberName": "calculateEffectiveShareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 19763, "src": "59928:46:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_int256_$returns$_t_uint256_$", "typeString": "function (uint256,int256) pure returns (uint256)" } }, "id": 161551, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "59928:146:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 161552, "name": "info", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161538, "src": "60092:4:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 161553, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "60097:12:237", "memberName": "bondReserves", "nodeType": "MemberAccess", "referencedDeclaration": 10949, "src": "60092:17:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 161557, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 161554, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "60127:3:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 161555, "name": "config", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161529, "src": "60133:6:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 161556, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "60140:11:237", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 10920, "src": "60133:18:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "60127:24:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 161558, "name": "info", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161538, "src": "60169:4:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10980_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 161559, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "60174:15:237", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 10955, "src": "60169:20:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 161560, "name": "config", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161529, "src": "60207:6:237", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10934_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 161561, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "60214:22:237", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 10905, "src": "60207:29:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 161543, "name": "YieldSpaceMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 23422, "src": "59890:14:237", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_YieldSpaceMath_$23422_$", "typeString": "type(library YieldSpaceMath)" } }, "id": 161544, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "59905:5:237", "memberName": "kDown", "nodeType": "MemberAccess", "referencedDeclaration": 23421, "src": "59890:20:237", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256,uint256,uint256) pure returns (uint256)" } }, "id": 161562, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "59890:360:237", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 161524, "id": 161563, "nodeType": "Return", "src": "59871:379:237" }] }, "implemented": true, "kind": "function", "modifiers": [], "name": "k", "nameLocation": "59659:1:237", "parameters": { "id": 161521, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 161520, "mutability": "mutable", "name": "hyperdrive", "nameLocation": "59673:10:237", "nodeType": "VariableDeclaration", "scope": 161565, "src": "59661:22:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" }, "typeName": { "id": 161519, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 161518, "name": "IHyperdrive", "nameLocations": ["59661:11:237"], "nodeType": "IdentifierPath", "referencedDeclaration": 11143, "src": "59661:11:237" }, "referencedDeclaration": 11143, "src": "59661:11:237", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11143", "typeString": "contract IHyperdrive" } }, "visibility": "internal" }], "src": "59660:24:237" }, "returnParameters": { "id": 161524, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 161523, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 161565, "src": "59708:7:237", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 161522, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "59708:7:237", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "59707:9:237" }, "scope": 161566, "stateMutability": "view", "virtual": false, "visibility": "internal" }], "abstract": false, "baseContracts": [], "canonicalName": "HyperdriveUtils", "contractDependencies": [], "contractKind": "library", "fullyImplemented": true, "linearizedBaseContracts": [161566], "name": "HyperdriveUtils", "nameLocation": "505:15:237", "scope": 161567, "usedErrors": [], "usedEvents": [] }], "license": "Apache-2.0" }, "id": 237 };
