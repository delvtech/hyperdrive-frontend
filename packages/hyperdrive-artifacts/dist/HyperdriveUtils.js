export const HyperdriveUtils = { "abi": [], "bytecode": { "object": "0x60566037600b82828239805160001a607314602a57634e487b7160e01b600052600060045260246000fd5b30600052607381538281f3fe73000000000000000000000000000000000000000030146080604052600080fdfea26469706673582212200fbe85dfad0636cff96ed95b1a0deab698833ba52fa90f9d86180c510cef48e064736f6c63430008140033", "sourceMap": "497:59762:233:-:0;;;;;;;;;;;;;;;-1:-1:-1;;;497:59762:233;;;;;;;;;;;;;;;;;", "linkReferences": {} }, "deployedBytecode": { "object": "0x73000000000000000000000000000000000000000030146080604052600080fdfea26469706673582212200fbe85dfad0636cff96ed95b1a0deab698833ba52fa90f9d86180c510cef48e064736f6c63430008140033", "sourceMap": "497:59762:233:-:0;;;;;;;;", "linkReferences": {} }, "methodIdentifiers": {}, "rawMetadata": "{\"compiler\":{\"version\":\"0.8.20+commit.a1b79de6\"},\"language\":\"Solidity\",\"output\":{\"abi\":[],\"devdoc\":{\"kind\":\"dev\",\"methods\":{},\"version\":1},\"userdoc\":{\"kind\":\"user\",\"methods\":{},\"version\":1}},\"settings\":{\"compilationTarget\":{\"test/utils/HyperdriveUtils.sol\":\"HyperdriveUtils\"},\"evmVersion\":\"paris\",\"libraries\":{},\"metadata\":{\"bytecodeHash\":\"ipfs\"},\"optimizer\":{\"enabled\":true,\"runs\":200},\"remappings\":[\":@openzeppelin/contracts/=lib/openzeppelin-contracts/contracts/\",\":aave-v3-core/=lib/aave-v3-core/\",\":ds-test/=lib/forge-std/lib/ds-test/src/\",\":erc4626-tests/=lib/openzeppelin-contracts/lib/erc4626-tests/\",\":forge-std/=lib/forge-std/src/\",\":openzeppelin-contracts/=lib/openzeppelin-contracts/\",\":openzeppelin/=lib/openzeppelin-contracts/contracts/\",\":solmate/=lib/solmate/src/\"]},\"sources\":{\"contracts/src/interfaces/IERC20.sol\":{\"keccak256\":\"0x5f446a4987d57c64380d44c234ee079172e98bed9595ec067eb519898c3117d9\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://a3245994c58110716f5099c07e5cb270137356d288044f03c713d29c36e207ac\",\"dweb:/ipfs/QmYdn52sGRQKXfSyL8ieSz8HysG6R5kLJWsNwEnyX1e22p\"]},\"contracts/src/interfaces/IHyperdrive.sol\":{\"keccak256\":\"0xb8ee04f3090b498966970e210f7de0f982f6445628556f2f176385423d8c5952\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://db789f03faa935c6e3b0882b6e873e8f683c9c8841a4b128366dcbe7321911bf\",\"dweb:/ipfs/QmSQh1cX79nApuSAfJbVN99dmEaE4CK9QwWfEGcwhJMBLK\"]},\"contracts/src/interfaces/IHyperdriveCore.sol\":{\"keccak256\":\"0x68adcd293ff25711add1698b6024faa45beec01eb044bd0103d3020aa96d856e\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://0e0f5e35a7d2c656e249394d25896e5adfb9af3e210c01b9ef5fa81d25a45e24\",\"dweb:/ipfs/QmbLASezHPWHcbodqSfw3Qh9NzqekqVPM8FhCXKGTCXL1h\"]},\"contracts/src/interfaces/IHyperdriveEvents.sol\":{\"keccak256\":\"0x812ccb32dff907e8614c89a65196eec239eceb3e63f9f14dde2b2269c75a67c0\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://da5f2ce974bfcd8185342c121c879ba5aef23e1e4e7b36cf9fcba68296b8892c\",\"dweb:/ipfs/QmSho3PWs9bzejTYYjySuXcH9tVP4xFnkbUmSzQA54g8eG\"]},\"contracts/src/interfaces/IHyperdriveRead.sol\":{\"keccak256\":\"0x5922cbd86a7267c8fd19e3dc7a6f2636bad2b3330c28bca8e66adc7cd8ce2b55\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://ced8bce3f3c15a9f0bcdd11ba16e69651179edd6b16e267936788f4ab4d6eabf\",\"dweb:/ipfs/QmcoZPj4h2ym6r13KDU7JG2GoVdDWa1GwfKL2jjFRsp8H6\"]},\"contracts/src/interfaces/IMultiToken.sol\":{\"keccak256\":\"0xf5f82b8223e0c1bfcf4f73566a909ba07a9266960dfe2335c1494e06debbbe3f\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://920cf3fd66132a1e98a6a5708ad9a3bb047f4df8848119ab382b51094c1290a7\",\"dweb:/ipfs/QmWL3SyG8L91Coe9DsHz3Ke9tGMvYBf2NgRRDr3Fg5xFzp\"]},\"contracts/src/interfaces/IMultiTokenCore.sol\":{\"keccak256\":\"0x5c27315743bb6ef8a121ecf72cb24d5c144786dedb6526ef010f580eb872e501\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://3e102c51bac9c82766c9826d97dc780a05a2bf64703b070757a7531a0851a1ae\",\"dweb:/ipfs/QmXYwbzPbiznj5AeDiX7NNfRE9xyhSx1huTMfMFndrUZWs\"]},\"contracts/src/interfaces/IMultiTokenEvents.sol\":{\"keccak256\":\"0x165f79e628b1975343f979549f3fdb5073a29aeecb03861f41d165961ee39fdb\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://3c0751cf322944d080a7a6692897807d0cef798268689afc1f6c8f91182a4222\",\"dweb:/ipfs/QmQVWtCgphU9sjqD2q6F6ww62uXDSWZx5KJVj6jFJpXeDK\"]},\"contracts/src/interfaces/IMultiTokenMetadata.sol\":{\"keccak256\":\"0xcc21ad6d3d4e3de354fbc25a472d940e5e2af0b48766404f9efecdac600d72ca\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://b48fa111a773c820fe578efdd737d164e3957930ed46f3f304c6a8602a7e26a3\",\"dweb:/ipfs/QmcA7bjBC6ZBvYyojZZx3eKpugHmSrAAA14p14bQugiVKG\"]},\"contracts/src/interfaces/IMultiTokenRead.sol\":{\"keccak256\":\"0xac84dd306f29ae9d6becf764d93545c33f7c37737bb1aeb714c85930d0c074a0\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://d9082a16d5a736ab7ce5670be4f2475ea5c5fdae8ad7096ed9663f84eed96b11\",\"dweb:/ipfs/QmUTH8dZaQJt56UsT7N2aCUCKmjQYj7Ah53rRXk6DuVNUR\"]},\"contracts/src/libraries/AssetId.sol\":{\"keccak256\":\"0x3031a1ec376be333eebe0062c474a22d7f970cb02de62ab6823c6918c0a7f83b\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://6c80cc2fd8b7908b6420ebb21cb99266c93e01d6cdd9d1a41f8847493849b131\",\"dweb:/ipfs/QmeMehWbF2RwQaf6c6yaj5KHjXboDRpzBCtvFnLW4BXBbc\"]},\"contracts/src/libraries/Errors.sol\":{\"keccak256\":\"0x45f48f5b8caec5b751850b7266abd84c7400debfbad0f112847582bb052058b0\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://46c85e0c750cdb752bec5d67a8a0bc8df071d934c568c880d08a5120a1a11d88\",\"dweb:/ipfs/Qmc2L1ePB1gqBwUiaAUeoG6hvoPtS2hdY6rhEXzX1SfB41\"]},\"contracts/src/libraries/FixedPointMath.sol\":{\"keccak256\":\"0x631f6529908f62f71775f8c6120afdca3a836fb24fa9fa4701cad54f4a9da076\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://2baf6ad8917a3fbb6d040334451f6b4f6936b00518c4cd308b9c6fa11569b2bd\",\"dweb:/ipfs/QmXD16vk6MRxmPRqy8ZXSpRA5XxhSf1pnsQH32ARDJTk8L\"]},\"contracts/src/libraries/HyperdriveMath.sol\":{\"keccak256\":\"0xcf305dde8aa320d1e1b767734ce8edce456af537525d40e30d5345f09f6e34ab\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://056c9a563f1a9e0133e17463497ad19be517d35b770170122edea50ca9fbe002\",\"dweb:/ipfs/QmS6dkVRHzdbv7etumcCtNtm9GuXDCjqZxxhtYfP6keAAY\"]},\"contracts/src/libraries/LPMath.sol\":{\"keccak256\":\"0x5b3c0d159b1945a14227028d835e011bf740e007f664cba049ece1b6ab963067\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://d8f4fef22462dabc799b2f8124440a7cc57076f7ceecb46219c69b09f50baf5f\",\"dweb:/ipfs/Qmcw9iC1RZt4Nh7dGH1yR7vUi6qZHJf6ReAvF2uLFHESqZ\"]},\"contracts/src/libraries/SafeCast.sol\":{\"keccak256\":\"0xc5282be69c8c85c1a1bbbf1554a501c17599f4b84119339b660018ae90eb7148\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://fd29b570d1e3205d25939b1c0e78e98ae34747a8118703fc5b2c9690791b26c8\",\"dweb:/ipfs/QmSdecxKRE66cgEipikK5uS4mUJxz2FgfncCk9iXvkdjG8\"]},\"contracts/src/libraries/YieldSpaceMath.sol\":{\"keccak256\":\"0x4a9c91313bed7cda6ef503af23c9f777008b5258e9cb2176eab6acc52be79891\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://88da1f5502a12fe1024be90f6a6ea08556cc1f2660ab8cbeb5e07640abb7711c\",\"dweb:/ipfs/QmVQoG9TyrAsVYcgvgZfgA5pQk8V8wvS4BewGNP4B3Txyy\"]},\"test/utils/HyperdriveUtils.sol\":{\"keccak256\":\"0x764719deaf8b833fc87b8436d166030eaa05832bf3d5e259172f431778666e04\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://04c4bd84c0d60f9a7c68604cbe76d0cc88170bb569298749bc97d40b197f62f6\",\"dweb:/ipfs/QmQV6zkCCvLkbta2vDzjbMXKUzYDrAhcEyFA7QSRTVZJ1P\"]}},\"version\":1}", "metadata": { "compiler": { "version": "0.8.20+commit.a1b79de6" }, "language": "Solidity", "output": { "abi": [], "devdoc": { "kind": "dev", "methods": {}, "version": 1 }, "userdoc": { "kind": "user", "methods": {}, "version": 1 } }, "settings": { "remappings": ["@openzeppelin/contracts/=lib/openzeppelin-contracts/contracts/", "aave-v3-core/=lib/aave-v3-core/", "ds-test/=lib/forge-std/lib/ds-test/src/", "erc4626-tests/=lib/openzeppelin-contracts/lib/erc4626-tests/", "forge-std/=lib/forge-std/src/", "openzeppelin-contracts/=lib/openzeppelin-contracts/", "openzeppelin/=lib/openzeppelin-contracts/contracts/", "solmate/=lib/solmate/src/"], "optimizer": { "enabled": true, "runs": 200 }, "metadata": { "bytecodeHash": "ipfs" }, "compilationTarget": { "test/utils/HyperdriveUtils.sol": "HyperdriveUtils" }, "libraries": {} }, "sources": { "contracts/src/interfaces/IERC20.sol": { "keccak256": "0x5f446a4987d57c64380d44c234ee079172e98bed9595ec067eb519898c3117d9", "urls": ["bzz-raw://a3245994c58110716f5099c07e5cb270137356d288044f03c713d29c36e207ac", "dweb:/ipfs/QmYdn52sGRQKXfSyL8ieSz8HysG6R5kLJWsNwEnyX1e22p"], "license": "Apache-2.0" }, "contracts/src/interfaces/IHyperdrive.sol": { "keccak256": "0xb8ee04f3090b498966970e210f7de0f982f6445628556f2f176385423d8c5952", "urls": ["bzz-raw://db789f03faa935c6e3b0882b6e873e8f683c9c8841a4b128366dcbe7321911bf", "dweb:/ipfs/QmSQh1cX79nApuSAfJbVN99dmEaE4CK9QwWfEGcwhJMBLK"], "license": "Apache-2.0" }, "contracts/src/interfaces/IHyperdriveCore.sol": { "keccak256": "0x68adcd293ff25711add1698b6024faa45beec01eb044bd0103d3020aa96d856e", "urls": ["bzz-raw://0e0f5e35a7d2c656e249394d25896e5adfb9af3e210c01b9ef5fa81d25a45e24", "dweb:/ipfs/QmbLASezHPWHcbodqSfw3Qh9NzqekqVPM8FhCXKGTCXL1h"], "license": "Apache-2.0" }, "contracts/src/interfaces/IHyperdriveEvents.sol": { "keccak256": "0x812ccb32dff907e8614c89a65196eec239eceb3e63f9f14dde2b2269c75a67c0", "urls": ["bzz-raw://da5f2ce974bfcd8185342c121c879ba5aef23e1e4e7b36cf9fcba68296b8892c", "dweb:/ipfs/QmSho3PWs9bzejTYYjySuXcH9tVP4xFnkbUmSzQA54g8eG"], "license": "Apache-2.0" }, "contracts/src/interfaces/IHyperdriveRead.sol": { "keccak256": "0x5922cbd86a7267c8fd19e3dc7a6f2636bad2b3330c28bca8e66adc7cd8ce2b55", "urls": ["bzz-raw://ced8bce3f3c15a9f0bcdd11ba16e69651179edd6b16e267936788f4ab4d6eabf", "dweb:/ipfs/QmcoZPj4h2ym6r13KDU7JG2GoVdDWa1GwfKL2jjFRsp8H6"], "license": "Apache-2.0" }, "contracts/src/interfaces/IMultiToken.sol": { "keccak256": "0xf5f82b8223e0c1bfcf4f73566a909ba07a9266960dfe2335c1494e06debbbe3f", "urls": ["bzz-raw://920cf3fd66132a1e98a6a5708ad9a3bb047f4df8848119ab382b51094c1290a7", "dweb:/ipfs/QmWL3SyG8L91Coe9DsHz3Ke9tGMvYBf2NgRRDr3Fg5xFzp"], "license": "Apache-2.0" }, "contracts/src/interfaces/IMultiTokenCore.sol": { "keccak256": "0x5c27315743bb6ef8a121ecf72cb24d5c144786dedb6526ef010f580eb872e501", "urls": ["bzz-raw://3e102c51bac9c82766c9826d97dc780a05a2bf64703b070757a7531a0851a1ae", "dweb:/ipfs/QmXYwbzPbiznj5AeDiX7NNfRE9xyhSx1huTMfMFndrUZWs"], "license": "Apache-2.0" }, "contracts/src/interfaces/IMultiTokenEvents.sol": { "keccak256": "0x165f79e628b1975343f979549f3fdb5073a29aeecb03861f41d165961ee39fdb", "urls": ["bzz-raw://3c0751cf322944d080a7a6692897807d0cef798268689afc1f6c8f91182a4222", "dweb:/ipfs/QmQVWtCgphU9sjqD2q6F6ww62uXDSWZx5KJVj6jFJpXeDK"], "license": "Apache-2.0" }, "contracts/src/interfaces/IMultiTokenMetadata.sol": { "keccak256": "0xcc21ad6d3d4e3de354fbc25a472d940e5e2af0b48766404f9efecdac600d72ca", "urls": ["bzz-raw://b48fa111a773c820fe578efdd737d164e3957930ed46f3f304c6a8602a7e26a3", "dweb:/ipfs/QmcA7bjBC6ZBvYyojZZx3eKpugHmSrAAA14p14bQugiVKG"], "license": "Apache-2.0" }, "contracts/src/interfaces/IMultiTokenRead.sol": { "keccak256": "0xac84dd306f29ae9d6becf764d93545c33f7c37737bb1aeb714c85930d0c074a0", "urls": ["bzz-raw://d9082a16d5a736ab7ce5670be4f2475ea5c5fdae8ad7096ed9663f84eed96b11", "dweb:/ipfs/QmUTH8dZaQJt56UsT7N2aCUCKmjQYj7Ah53rRXk6DuVNUR"], "license": "Apache-2.0" }, "contracts/src/libraries/AssetId.sol": { "keccak256": "0x3031a1ec376be333eebe0062c474a22d7f970cb02de62ab6823c6918c0a7f83b", "urls": ["bzz-raw://6c80cc2fd8b7908b6420ebb21cb99266c93e01d6cdd9d1a41f8847493849b131", "dweb:/ipfs/QmeMehWbF2RwQaf6c6yaj5KHjXboDRpzBCtvFnLW4BXBbc"], "license": "Apache-2.0" }, "contracts/src/libraries/Errors.sol": { "keccak256": "0x45f48f5b8caec5b751850b7266abd84c7400debfbad0f112847582bb052058b0", "urls": ["bzz-raw://46c85e0c750cdb752bec5d67a8a0bc8df071d934c568c880d08a5120a1a11d88", "dweb:/ipfs/Qmc2L1ePB1gqBwUiaAUeoG6hvoPtS2hdY6rhEXzX1SfB41"], "license": "Apache-2.0" }, "contracts/src/libraries/FixedPointMath.sol": { "keccak256": "0x631f6529908f62f71775f8c6120afdca3a836fb24fa9fa4701cad54f4a9da076", "urls": ["bzz-raw://2baf6ad8917a3fbb6d040334451f6b4f6936b00518c4cd308b9c6fa11569b2bd", "dweb:/ipfs/QmXD16vk6MRxmPRqy8ZXSpRA5XxhSf1pnsQH32ARDJTk8L"], "license": "Apache-2.0" }, "contracts/src/libraries/HyperdriveMath.sol": { "keccak256": "0xcf305dde8aa320d1e1b767734ce8edce456af537525d40e30d5345f09f6e34ab", "urls": ["bzz-raw://056c9a563f1a9e0133e17463497ad19be517d35b770170122edea50ca9fbe002", "dweb:/ipfs/QmS6dkVRHzdbv7etumcCtNtm9GuXDCjqZxxhtYfP6keAAY"], "license": "Apache-2.0" }, "contracts/src/libraries/LPMath.sol": { "keccak256": "0x5b3c0d159b1945a14227028d835e011bf740e007f664cba049ece1b6ab963067", "urls": ["bzz-raw://d8f4fef22462dabc799b2f8124440a7cc57076f7ceecb46219c69b09f50baf5f", "dweb:/ipfs/Qmcw9iC1RZt4Nh7dGH1yR7vUi6qZHJf6ReAvF2uLFHESqZ"], "license": "Apache-2.0" }, "contracts/src/libraries/SafeCast.sol": { "keccak256": "0xc5282be69c8c85c1a1bbbf1554a501c17599f4b84119339b660018ae90eb7148", "urls": ["bzz-raw://fd29b570d1e3205d25939b1c0e78e98ae34747a8118703fc5b2c9690791b26c8", "dweb:/ipfs/QmSdecxKRE66cgEipikK5uS4mUJxz2FgfncCk9iXvkdjG8"], "license": "Apache-2.0" }, "contracts/src/libraries/YieldSpaceMath.sol": { "keccak256": "0x4a9c91313bed7cda6ef503af23c9f777008b5258e9cb2176eab6acc52be79891", "urls": ["bzz-raw://88da1f5502a12fe1024be90f6a6ea08556cc1f2660ab8cbeb5e07640abb7711c", "dweb:/ipfs/QmVQoG9TyrAsVYcgvgZfgA5pQk8V8wvS4BewGNP4B3Txyy"], "license": "Apache-2.0" }, "test/utils/HyperdriveUtils.sol": { "keccak256": "0x764719deaf8b833fc87b8436d166030eaa05832bf3d5e259172f431778666e04", "urls": ["bzz-raw://04c4bd84c0d60f9a7c68604cbe76d0cc88170bb569298749bc97d40b197f62f6", "dweb:/ipfs/QmQV6zkCCvLkbta2vDzjbMXKUzYDrAhcEyFA7QSRTVZJ1P"], "license": "Apache-2.0" } }, "version": 1 }, "ast": { "absolutePath": "test/utils/HyperdriveUtils.sol", "id": 161326, "exportedSymbols": { "AssetId": [18642], "FixedPointMath": [19442], "HyperdriveMath": [20190], "HyperdriveUtils": [161325], "IHyperdrive": [11076], "LPMath": [22134], "ONE": [18676], "YieldSpaceMath": [23292] }, "nodeType": "SourceUnit", "src": "39:60221:233", "nodes": [{ "id": 158743, "nodeType": "PragmaDirective", "src": "39:23:233", "nodes": [], "literals": ["solidity", "0.8", ".20"] }, { "id": 158745, "nodeType": "ImportDirective", "src": "64:71:233", "nodes": [], "absolutePath": "contracts/src/interfaces/IHyperdrive.sol", "file": "contracts/src/interfaces/IHyperdrive.sol", "nameLocation": "-1:-1:-1", "scope": 161326, "sourceUnit": 11077, "symbolAliases": [{ "foreign": { "id": 158744, "name": "IHyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 11076, "src": "73:11:233", "typeDescriptions": {} }, "nameLocation": "-1:-1:-1" }], "unitAlias": "" }, { "id": 158747, "nodeType": "ImportDirective", "src": "136:62:233", "nodes": [], "absolutePath": "contracts/src/libraries/AssetId.sol", "file": "contracts/src/libraries/AssetId.sol", "nameLocation": "-1:-1:-1", "scope": 161326, "sourceUnit": 18643, "symbolAliases": [{ "foreign": { "id": 158746, "name": "AssetId", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18642, "src": "145:7:233", "typeDescriptions": {} }, "nameLocation": "-1:-1:-1" }], "unitAlias": "" }, { "id": 158750, "nodeType": "ImportDirective", "src": "199:81:233", "nodes": [], "absolutePath": "contracts/src/libraries/FixedPointMath.sol", "file": "contracts/src/libraries/FixedPointMath.sol", "nameLocation": "-1:-1:-1", "scope": 161326, "sourceUnit": 19443, "symbolAliases": [{ "foreign": { "id": 158748, "name": "FixedPointMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19442, "src": "208:14:233", "typeDescriptions": {} }, "nameLocation": "-1:-1:-1" }, { "foreign": { "id": 158749, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "224:3:233", "typeDescriptions": {} }, "nameLocation": "-1:-1:-1" }], "unitAlias": "" }, { "id": 158752, "nodeType": "ImportDirective", "src": "281:76:233", "nodes": [], "absolutePath": "contracts/src/libraries/HyperdriveMath.sol", "file": "contracts/src/libraries/HyperdriveMath.sol", "nameLocation": "-1:-1:-1", "scope": 161326, "sourceUnit": 20191, "symbolAliases": [{ "foreign": { "id": 158751, "name": "HyperdriveMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20190, "src": "290:14:233", "typeDescriptions": {} }, "nameLocation": "-1:-1:-1" }], "unitAlias": "" }, { "id": 158754, "nodeType": "ImportDirective", "src": "358:60:233", "nodes": [], "absolutePath": "contracts/src/libraries/LPMath.sol", "file": "contracts/src/libraries/LPMath.sol", "nameLocation": "-1:-1:-1", "scope": 161326, "sourceUnit": 22135, "symbolAliases": [{ "foreign": { "id": 158753, "name": "LPMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 22134, "src": "367:6:233", "typeDescriptions": {} }, "nameLocation": "-1:-1:-1" }], "unitAlias": "" }, { "id": 158756, "nodeType": "ImportDirective", "src": "419:76:233", "nodes": [], "absolutePath": "contracts/src/libraries/YieldSpaceMath.sol", "file": "contracts/src/libraries/YieldSpaceMath.sol", "nameLocation": "-1:-1:-1", "scope": 161326, "sourceUnit": 23293, "symbolAliases": [{ "foreign": { "id": 158755, "name": "YieldSpaceMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 23292, "src": "428:14:233", "typeDescriptions": {} }, "nameLocation": "-1:-1:-1" }], "unitAlias": "" }, { "id": 161325, "nodeType": "ContractDefinition", "src": "497:59762:233", "nodes": [{ "id": 158758, "nodeType": "UsingForDirective", "src": "527:28:233", "nodes": [], "global": false, "libraryName": { "id": 158757, "name": "HyperdriveUtils", "nameLocations": ["533:15:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 161325, "src": "533:15:233" } }, { "id": 158761, "nodeType": "UsingForDirective", "src": "560:33:233", "nodes": [], "global": false, "libraryName": { "id": 158759, "name": "FixedPointMath", "nameLocations": ["566:14:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 19442, "src": "566:14:233" }, "typeName": { "id": 158760, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "585:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } } }, { "id": 158764, "nodeType": "UsingForDirective", "src": "598:32:233", "nodes": [], "global": false, "libraryName": { "id": 158762, "name": "FixedPointMath", "nameLocations": ["604:14:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 19442, "src": "604:14:233" }, "typeName": { "id": 158763, "name": "int256", "nodeType": "ElementaryTypeName", "src": "623:6:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } } }, { "id": 158786, "nodeType": "FunctionDefinition", "src": "664:227:233", "nodes": [], "body": { "id": 158785, "nodeType": "Block", "src": "760:131:233", "nodes": [], "statements": [{ "expression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 158783, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "expression": { "id": 158773, "name": "block", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": -4, "src": "789:5:233", "typeDescriptions": { "typeIdentifier": "t_magic_block", "typeString": "block" } }, "id": 158774, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "795:9:233", "memberName": "timestamp", "nodeType": "MemberAccess", "src": "789:15:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 158781, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "expression": { "id": 158775, "name": "block", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": -4, "src": "820:5:233", "typeDescriptions": { "typeIdentifier": "t_magic_block", "typeString": "block" } }, "id": 158776, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "826:9:233", "memberName": "timestamp", "nodeType": "MemberAccess", "src": "820:15:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "%", "rightExpression": { "expression": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 158777, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158768, "src": "838:10:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "id": 158778, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "849:13:233", "memberName": "getPoolConfig", "nodeType": "MemberAccess", "referencedDeclaration": 11874, "src": "838:24:233", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolConfig_$10867_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolConfig memory)" } }, "id": 158779, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "838:26:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 158780, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "865:18:233", "memberName": "checkpointDuration", "nodeType": "MemberAccess", "referencedDeclaration": 10850, "src": "838:45:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "820:63:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 158782, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "819:65:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "789:95:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 158772, "id": 158784, "nodeType": "Return", "src": "770:114:233" }] }, "documentation": { "id": 158765, "nodeType": "StructuredDocumentation", "src": "636:23:233", "text": "Time Utilities ///" }, "implemented": true, "kind": "function", "modifiers": [], "name": "latestCheckpoint", "nameLocation": "673:16:233", "parameters": { "id": 158769, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 158768, "mutability": "mutable", "name": "hyperdrive", "nameLocation": "711:10:233", "nodeType": "VariableDeclaration", "scope": 158786, "src": "699:22:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" }, "typeName": { "id": 158767, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 158766, "name": "IHyperdrive", "nameLocations": ["699:11:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 11076, "src": "699:11:233" }, "referencedDeclaration": 11076, "src": "699:11:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "visibility": "internal" }], "src": "689:38:233" }, "returnParameters": { "id": 158772, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 158771, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 158786, "src": "751:7:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 158770, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "751:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "750:9:233" }, "scope": 161325, "stateMutability": "view", "virtual": false, "visibility": "internal" }, { "id": 158824, "nodeType": "FunctionDefinition", "src": "897:447:233", "nodes": [], "body": { "id": 158823, "nodeType": "Block", "src": "1045:299:233", "nodes": [], "statements": [{ "expression": { "id": 158809, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 158796, "name": "timeRemaining", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158794, "src": "1055:13:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "condition": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 158801, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 158797, "name": "_maturityTime", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158791, "src": "1071:13:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": ">", "rightExpression": { "arguments": [{ "id": 158799, "name": "_hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158789, "src": "1104:11:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" }], "id": 158798, "name": "latestCheckpoint", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158786, "src": "1087:16:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_view$_t_contract$_IHyperdrive_$11076_$returns$_t_uint256_$", "typeString": "function (contract IHyperdrive) view returns (uint256)" } }, "id": 158800, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "1087:29:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "1071:45:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "falseExpression": { "hexValue": "30", "id": 158807, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "1191:1:233", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }, "id": 158808, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "Conditional", "src": "1071:121:233", "trueExpression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 158806, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 158802, "name": "_maturityTime", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158791, "src": "1131:13:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [{ "id": 158804, "name": "_hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158789, "src": "1164:11:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" }], "id": 158803, "name": "latestCheckpoint", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158786, "src": "1147:16:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_view$_t_contract$_IHyperdrive_$11076_$returns$_t_uint256_$", "typeString": "function (contract IHyperdrive) view returns (uint256)" } }, "id": 158805, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "1147:29:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "1131:45:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "1055:137:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 158810, "nodeType": "ExpressionStatement", "src": "1055:137:233" }, { "expression": { "id": 158819, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 158811, "name": "timeRemaining", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158794, "src": "1202:13:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "expression": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 158814, "name": "_hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158789, "src": "1253:11:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "id": 158815, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "1265:13:233", "memberName": "getPoolConfig", "nodeType": "MemberAccess", "referencedDeclaration": 11874, "src": "1253:25:233", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolConfig_$10867_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolConfig memory)" } }, "id": 158816, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "1253:27:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 158817, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "1281:16:233", "memberName": "positionDuration", "nodeType": "MemberAccess", "referencedDeclaration": 10847, "src": "1253:44:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 158812, "name": "timeRemaining", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158794, "src": "1218:13:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 158813, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "1232:7:233", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "1218:21:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 158818, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "1218:89:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "1202:105:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 158820, "nodeType": "ExpressionStatement", "src": "1202:105:233" }, { "expression": { "id": 158821, "name": "timeRemaining", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158794, "src": "1324:13:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 158795, "id": 158822, "nodeType": "Return", "src": "1317:20:233" }] }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateTimeRemaining", "nameLocation": "906:22:233", "parameters": { "id": 158792, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 158789, "mutability": "mutable", "name": "_hyperdrive", "nameLocation": "950:11:233", "nodeType": "VariableDeclaration", "scope": 158824, "src": "938:23:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" }, "typeName": { "id": 158788, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 158787, "name": "IHyperdrive", "nameLocations": ["938:11:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 11076, "src": "938:11:233" }, "referencedDeclaration": 11076, "src": "938:11:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "visibility": "internal" }, { "constant": false, "id": 158791, "mutability": "mutable", "name": "_maturityTime", "nameLocation": "979:13:233", "nodeType": "VariableDeclaration", "scope": 158824, "src": "971:21:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 158790, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "971:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "928:70:233" }, "returnParameters": { "id": 158795, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 158794, "mutability": "mutable", "name": "timeRemaining", "nameLocation": "1030:13:233", "nodeType": "VariableDeclaration", "scope": 158824, "src": "1022:21:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 158793, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "1022:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "1021:23:233" }, "scope": 161325, "stateMutability": "view", "virtual": false, "visibility": "internal" }, { "id": 158842, "nodeType": "FunctionDefinition", "src": "1350:237:233", "nodes": [], "body": { "id": 158841, "nodeType": "Block", "src": "1463:124:233", "nodes": [], "statements": [{ "expression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 158839, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "arguments": [{ "id": 158833, "name": "_hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158827, "src": "1509:11:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" }], "id": 158832, "name": "latestCheckpoint", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158786, "src": "1492:16:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_view$_t_contract$_IHyperdrive_$11076_$returns$_t_uint256_$", "typeString": "function (contract IHyperdrive) view returns (uint256)" } }, "id": 158834, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "1492:29:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "expression": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 158835, "name": "_hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158827, "src": "1536:11:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "id": 158836, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "1548:13:233", "memberName": "getPoolConfig", "nodeType": "MemberAccess", "referencedDeclaration": 11874, "src": "1536:25:233", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolConfig_$10867_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolConfig memory)" } }, "id": 158837, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "1536:27:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 158838, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "1564:16:233", "memberName": "positionDuration", "nodeType": "MemberAccess", "referencedDeclaration": 10847, "src": "1536:44:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "1492:88:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 158831, "id": 158840, "nodeType": "Return", "src": "1473:107:233" }] }, "implemented": true, "kind": "function", "modifiers": [], "name": "maturityTimeFromLatestCheckpoint", "nameLocation": "1359:32:233", "parameters": { "id": 158828, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 158827, "mutability": "mutable", "name": "_hyperdrive", "nameLocation": "1413:11:233", "nodeType": "VariableDeclaration", "scope": 158842, "src": "1401:23:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" }, "typeName": { "id": 158826, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 158825, "name": "IHyperdrive", "nameLocations": ["1401:11:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 11076, "src": "1401:11:233" }, "referencedDeclaration": 11076, "src": "1401:11:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "visibility": "internal" }], "src": "1391:39:233" }, "returnParameters": { "id": 158831, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 158830, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 158842, "src": "1454:7:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 158829, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "1454:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "1453:9:233" }, "scope": 161325, "stateMutability": "view", "virtual": false, "visibility": "internal" }, { "id": 158887, "nodeType": "FunctionDefinition", "src": "1627:638:233", "nodes": [], "body": { "id": 158886, "nodeType": "Block", "src": "1726:539:233", "nodes": [], "statements": [{ "assignments": [158855], "declarations": [{ "constant": false, "id": 158855, "mutability": "mutable", "name": "poolConfig", "nameLocation": "1766:10:233", "nodeType": "VariableDeclaration", "scope": 158886, "src": "1736:40:233", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig" }, "typeName": { "id": 158854, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 158853, "name": "IHyperdrive.PoolConfig", "nameLocations": ["1736:11:233", "1748:10:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 10867, "src": "1736:22:233" }, "referencedDeclaration": 10867, "src": "1736:22:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_storage_ptr", "typeString": "struct IHyperdrive.PoolConfig" } }, "visibility": "internal" }], "id": 158859, "initialValue": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 158856, "name": "_hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158846, "src": "1779:11:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "id": 158857, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "1791:13:233", "memberName": "getPoolConfig", "nodeType": "MemberAccess", "referencedDeclaration": 11874, "src": "1779:25:233", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolConfig_$10867_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolConfig memory)" } }, "id": 158858, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "1779:27:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "nodeType": "VariableDeclarationStatement", "src": "1736:70:233" }, { "assignments": [158864], "declarations": [{ "constant": false, "id": 158864, "mutability": "mutable", "name": "poolInfo", "nameLocation": "1844:8:233", "nodeType": "VariableDeclaration", "scope": 158886, "src": "1816:36:233", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo" }, "typeName": { "id": 158863, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 158862, "name": "IHyperdrive.PoolInfo", "nameLocations": ["1816:11:233", "1828:8:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 10913, "src": "1816:20:233" }, "referencedDeclaration": 10913, "src": "1816:20:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_storage_ptr", "typeString": "struct IHyperdrive.PoolInfo" } }, "visibility": "internal" }], "id": 158868, "initialValue": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 158865, "name": "_hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158846, "src": "1855:11:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "id": 158866, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "1867:11:233", "memberName": "getPoolInfo", "nodeType": "MemberAccess", "referencedDeclaration": 11881, "src": "1855:23:233", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolInfo_$10913_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolInfo memory)" } }, "id": 158867, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "1855:25:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "nodeType": "VariableDeclarationStatement", "src": "1816:64:233" }, { "expression": { "arguments": [{ "arguments": [{ "expression": { "id": 158873, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158864, "src": "2028:8:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 158874, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "2037:13:233", "memberName": "shareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 10870, "src": "2028:22:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 158875, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158864, "src": "2072:8:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 158876, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "2081:15:233", "memberName": "shareAdjustment", "nodeType": "MemberAccess", "referencedDeclaration": 10873, "src": "2072:24:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_int256", "typeString": "int256" }], "expression": { "id": 158871, "name": "HyperdriveMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20190, "src": "1960:14:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_HyperdriveMath_$20190_$", "typeString": "type(library HyperdriveMath)" } }, "id": 158872, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "1975:31:233", "memberName": "calculateEffectiveShareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 19633, "src": "1960:46:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_int256_$returns$_t_uint256_$", "typeString": "function (uint256,int256) pure returns (uint256)" } }, "id": 158877, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "1960:154:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 158878, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158864, "src": "2132:8:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 158879, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "2141:12:233", "memberName": "bondReserves", "nodeType": "MemberAccess", "referencedDeclaration": 10882, "src": "2132:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 158880, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158855, "src": "2171:10:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 158881, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "2182:22:233", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 10838, "src": "2171:33:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 158882, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158855, "src": "2222:10:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 158883, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "2233:11:233", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 10853, "src": "2222:22:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 158869, "name": "HyperdriveMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20190, "src": "1909:14:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_HyperdriveMath_$20190_$", "typeString": "type(library HyperdriveMath)" } }, "id": 158870, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "1924:18:233", "memberName": "calculateSpotPrice", "nodeType": "MemberAccess", "referencedDeclaration": 19560, "src": "1909:33:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256,uint256) pure returns (uint256)" } }, "id": 158884, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "1909:349:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 158850, "id": 158885, "nodeType": "Return", "src": "1890:368:233" }] }, "documentation": { "id": 158843, "nodeType": "StructuredDocumentation", "src": "1593:29:233", "text": "Price and Rate Utils ///" }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateSpotPrice", "nameLocation": "1636:18:233", "parameters": { "id": 158847, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 158846, "mutability": "mutable", "name": "_hyperdrive", "nameLocation": "1676:11:233", "nodeType": "VariableDeclaration", "scope": 158887, "src": "1664:23:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" }, "typeName": { "id": 158845, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 158844, "name": "IHyperdrive", "nameLocations": ["1664:11:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 11076, "src": "1664:11:233" }, "referencedDeclaration": 11076, "src": "1664:11:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "visibility": "internal" }], "src": "1654:39:233" }, "returnParameters": { "id": 158850, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 158849, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 158887, "src": "1717:7:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 158848, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "1717:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "1716:9:233" }, "scope": 161325, "stateMutability": "view", "virtual": false, "visibility": "internal" }, { "id": 158933, "nodeType": "FunctionDefinition", "src": "2271:679:233", "nodes": [], "body": { "id": 158932, "nodeType": "Block", "src": "2368:582:233", "nodes": [], "statements": [{ "assignments": [158899], "declarations": [{ "constant": false, "id": 158899, "mutability": "mutable", "name": "poolConfig", "nameLocation": "2408:10:233", "nodeType": "VariableDeclaration", "scope": 158932, "src": "2378:40:233", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig" }, "typeName": { "id": 158898, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 158897, "name": "IHyperdrive.PoolConfig", "nameLocations": ["2378:11:233", "2390:10:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 10867, "src": "2378:22:233" }, "referencedDeclaration": 10867, "src": "2378:22:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_storage_ptr", "typeString": "struct IHyperdrive.PoolConfig" } }, "visibility": "internal" }], "id": 158903, "initialValue": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 158900, "name": "_hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158890, "src": "2421:11:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "id": 158901, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "2433:13:233", "memberName": "getPoolConfig", "nodeType": "MemberAccess", "referencedDeclaration": 11874, "src": "2421:25:233", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolConfig_$10867_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolConfig memory)" } }, "id": 158902, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "2421:27:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "nodeType": "VariableDeclarationStatement", "src": "2378:70:233" }, { "assignments": [158908], "declarations": [{ "constant": false, "id": 158908, "mutability": "mutable", "name": "poolInfo", "nameLocation": "2486:8:233", "nodeType": "VariableDeclaration", "scope": 158932, "src": "2458:36:233", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo" }, "typeName": { "id": 158907, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 158906, "name": "IHyperdrive.PoolInfo", "nameLocations": ["2458:11:233", "2470:8:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 10913, "src": "2458:20:233" }, "referencedDeclaration": 10913, "src": "2458:20:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_storage_ptr", "typeString": "struct IHyperdrive.PoolInfo" } }, "visibility": "internal" }], "id": 158912, "initialValue": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 158909, "name": "_hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158890, "src": "2497:11:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "id": 158910, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "2509:11:233", "memberName": "getPoolInfo", "nodeType": "MemberAccess", "referencedDeclaration": 11881, "src": "2497:23:233", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolInfo_$10913_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolInfo memory)" } }, "id": 158911, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "2497:25:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "nodeType": "VariableDeclarationStatement", "src": "2458:64:233" }, { "expression": { "arguments": [{ "arguments": [{ "expression": { "id": 158917, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158908, "src": "2668:8:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 158918, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "2677:13:233", "memberName": "shareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 10870, "src": "2668:22:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 158919, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158908, "src": "2712:8:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 158920, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "2721:15:233", "memberName": "shareAdjustment", "nodeType": "MemberAccess", "referencedDeclaration": 10873, "src": "2712:24:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_int256", "typeString": "int256" }], "expression": { "id": 158915, "name": "HyperdriveMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20190, "src": "2600:14:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_HyperdriveMath_$20190_$", "typeString": "type(library HyperdriveMath)" } }, "id": 158916, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "2615:31:233", "memberName": "calculateEffectiveShareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 19633, "src": "2600:46:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_int256_$returns$_t_uint256_$", "typeString": "function (uint256,int256) pure returns (uint256)" } }, "id": 158921, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "2600:154:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 158922, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158908, "src": "2772:8:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 158923, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "2781:12:233", "memberName": "bondReserves", "nodeType": "MemberAccess", "referencedDeclaration": 10882, "src": "2772:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 158924, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158899, "src": "2811:10:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 158925, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "2822:22:233", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 10838, "src": "2811:33:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 158926, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158899, "src": "2862:10:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 158927, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "2873:16:233", "memberName": "positionDuration", "nodeType": "MemberAccess", "referencedDeclaration": 10847, "src": "2862:27:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 158928, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158899, "src": "2907:10:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 158929, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "2918:11:233", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 10853, "src": "2907:22:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 158913, "name": "HyperdriveMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20190, "src": "2551:14:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_HyperdriveMath_$20190_$", "typeString": "type(library HyperdriveMath)" } }, "id": 158914, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "2566:16:233", "memberName": "calculateSpotAPR", "nodeType": "MemberAccess", "referencedDeclaration": 19598, "src": "2551:31:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256,uint256,uint256) pure returns (uint256)" } }, "id": 158930, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "2551:392:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 158894, "id": 158931, "nodeType": "Return", "src": "2532:411:233" }] }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateSpotAPR", "nameLocation": "2280:16:233", "parameters": { "id": 158891, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 158890, "mutability": "mutable", "name": "_hyperdrive", "nameLocation": "2318:11:233", "nodeType": "VariableDeclaration", "scope": 158933, "src": "2306:23:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" }, "typeName": { "id": 158889, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 158888, "name": "IHyperdrive", "nameLocations": ["2306:11:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 11076, "src": "2306:11:233" }, "referencedDeclaration": 11076, "src": "2306:11:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "visibility": "internal" }], "src": "2296:39:233" }, "returnParameters": { "id": 158894, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 158893, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 158933, "src": "2359:7:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 158892, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "2359:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "2358:9:233" }, "scope": 161325, "stateMutability": "view", "virtual": false, "visibility": "internal" }, { "id": 158967, "nodeType": "FunctionDefinition", "src": "2956:603:233", "nodes": [], "body": { "id": 158966, "nodeType": "Block", "src": "3120:439:233", "nodes": [], "statements": [{ "expression": { "arguments": [{ "commonType": { "typeIdentifier": "t_bool", "typeString": "bool" }, "id": 158951, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 158947, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 158945, "name": "timeRemaining", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158939, "src": "3324:13:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "<=", "rightExpression": { "hexValue": "31653138", "id": 158946, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "3341:4:233", "typeDescriptions": { "typeIdentifier": "t_rational_1000000000000000000_by_1", "typeString": "int_const 1000000000000000000" }, "value": "1e18" }, "src": "3324:21:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "nodeType": "BinaryOperation", "operator": "&&", "rightExpression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 158950, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 158948, "name": "timeRemaining", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158939, "src": "3349:13:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": ">", "rightExpression": { "hexValue": "30", "id": 158949, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "3365:1:233", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }, "src": "3349:17:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "src": "3324:42:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, { "hexValue": "457870656374696e67204e6f726d616c697a656454696d6552656d61696e696e67", "id": 158952, "isConstant": false, "isLValue": false, "isPure": true, "kind": "string", "lValueRequested": false, "nodeType": "Literal", "src": "3380:35:233", "typeDescriptions": { "typeIdentifier": "t_stringliteral_f6bed8350536a611c3f5aa1607d036e667248cfc544b671ec115b04e29d87c30", "typeString": "literal_string \"Expecting NormalizedTimeRemaining\"" }, "value": "Expecting NormalizedTimeRemaining" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_bool", "typeString": "bool" }, { "typeIdentifier": "t_stringliteral_f6bed8350536a611c3f5aa1607d036e667248cfc544b671ec115b04e29d87c30", "typeString": "literal_string \"Expecting NormalizedTimeRemaining\"" }], "id": 158944, "name": "require", "nodeType": "Identifier", "overloadedDeclarations": [-18, -18], "referencedDeclaration": -18, "src": "3303:7:233", "typeDescriptions": { "typeIdentifier": "t_function_require_pure$_t_bool_$_t_string_memory_ptr_$returns$__$", "typeString": "function (bool,string memory) pure" } }, "id": 158953, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "3303:122:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_tuple$__$", "typeString": "tuple()" } }, "id": 158954, "nodeType": "ExpressionStatement", "src": "3303:122:233" }, { "expression": { "arguments": [{ "arguments": [{ "id": 158962, "name": "timeRemaining", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158939, "src": "3524:13:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 158960, "name": "baseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158935, "src": "3505:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 158961, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "3516:7:233", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "3505:18:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 158963, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "3505:33:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 158957, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 158955, "name": "bondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158937, "src": "3455:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 158956, "name": "baseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158935, "src": "3468:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "3455:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 158958, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "3454:25:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 158959, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "3480:7:233", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "3454:33:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 158964, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "3454:98:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 158943, "id": 158965, "nodeType": "Return", "src": "3435:117:233" }] }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateAPRFromRealizedPrice", "nameLocation": "2965:29:233", "parameters": { "id": 158940, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 158935, "mutability": "mutable", "name": "baseAmount", "nameLocation": "3012:10:233", "nodeType": "VariableDeclaration", "scope": 158967, "src": "3004:18:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 158934, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "3004:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 158937, "mutability": "mutable", "name": "bondAmount", "nameLocation": "3040:10:233", "nodeType": "VariableDeclaration", "scope": 158967, "src": "3032:18:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 158936, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "3032:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 158939, "mutability": "mutable", "name": "timeRemaining", "nameLocation": "3068:13:233", "nodeType": "VariableDeclaration", "scope": 158967, "src": "3060:21:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 158938, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "3060:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "2994:93:233" }, "returnParameters": { "id": 158943, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 158942, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 158967, "src": "3111:7:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 158941, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "3111:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "3110:9:233" }, "scope": 161325, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 159040, "nodeType": "FunctionDefinition", "src": "3957:602:233", "nodes": [], "body": { "id": 159039, "nodeType": "Block", "src": "4123:436:233", "nodes": [], "statements": [{ "assignments": [158982], "declarations": [{ "constant": false, "id": 158982, "mutability": "mutable", "name": "normalizedTime", "nameLocation": "4188:14:233", "nodeType": "VariableDeclaration", "scope": 159039, "src": "4180:22:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 158981, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "4180:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 158987, "initialValue": { "arguments": [{ "hexValue": "333635", "id": 158985, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "4219:8:233", "subdenomination": "days", "typeDescriptions": { "typeIdentifier": "t_rational_31536000_by_1", "typeString": "int_const 31536000" }, "value": "365" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_rational_31536000_by_1", "typeString": "int_const 31536000" }], "expression": { "id": 158983, "name": "_time", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158974, "src": "4205:5:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 158984, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "4211:7:233", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "4205:13:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 158986, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "4205:23:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "4180:48:233" }, { "expression": { "id": 159021, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 158988, "name": "interest", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158979, "src": "4238:8:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "condition": { "commonType": { "typeIdentifier": "t_int256", "typeString": "int256" }, "id": 158991, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 158989, "name": "_apr", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158972, "src": "4249:4:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "nodeType": "BinaryOperation", "operator": ">=", "rightExpression": { "hexValue": "30", "id": 158990, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "4257:1:233", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }, "src": "4249:9:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "falseExpression": { "id": 159019, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "UnaryOperation", "operator": "-", "prefix": true, "src": "4353:97:233", "subExpression": { "arguments": [{ "arguments": [{ "arguments": [{ "id": 159015, "name": "normalizedTime", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158982, "src": "4420:14:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "id": 159012, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "UnaryOperation", "operator": "-", "prefix": true, "src": "4405:5:233", "subExpression": { "id": 159011, "name": "_apr", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158972, "src": "4406:4:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 159010, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "4397:7:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_uint256_$", "typeString": "type(uint256)" }, "typeName": { "id": 159009, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "4397:7:233", "typeDescriptions": {} } }, "id": 159013, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "4397:14:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159014, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "4412:7:233", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "4397:22:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159016, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "4397:38:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159007, "name": "_principal", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158970, "src": "4378:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159008, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "4389:7:233", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "4378:18:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159017, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "4378:58:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159006, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "4354:6:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_int256_$", "typeString": "type(int256)" }, "typeName": { "id": 159005, "name": "int256", "nodeType": "ElementaryTypeName", "src": "4354:6:233", "typeDescriptions": {} } }, "id": 159018, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "4354:96:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "id": 159020, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "Conditional", "src": "4249:201:233", "trueExpression": { "arguments": [{ "arguments": [{ "arguments": [{ "id": 159001, "name": "normalizedTime", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158982, "src": "4321:14:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "id": 158998, "name": "_apr", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158972, "src": "4307:4:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 158997, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "4299:7:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_uint256_$", "typeString": "type(uint256)" }, "typeName": { "id": 158996, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "4299:7:233", "typeDescriptions": {} } }, "id": 158999, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "4299:13:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159000, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "4313:7:233", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "4299:21:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159002, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "4299:37:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 158994, "name": "_principal", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158970, "src": "4280:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 158995, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "4291:7:233", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "4280:18:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159003, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "4280:57:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 158993, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "4273:6:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_int256_$", "typeString": "type(int256)" }, "typeName": { "id": 158992, "name": "int256", "nodeType": "ElementaryTypeName", "src": "4273:6:233", "typeDescriptions": {} } }, "id": 159004, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "4273:65:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "src": "4238:212:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "id": 159022, "nodeType": "ExpressionStatement", "src": "4238:212:233" }, { "expression": { "id": 159033, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 159023, "name": "totalAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158977, "src": "4460:11:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "commonType": { "typeIdentifier": "t_int256", "typeString": "int256" }, "id": 159031, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "arguments": [{ "id": 159028, "name": "_principal", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158970, "src": "4489:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159027, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "4482:6:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_int256_$", "typeString": "type(int256)" }, "typeName": { "id": 159026, "name": "int256", "nodeType": "ElementaryTypeName", "src": "4482:6:233", "typeDescriptions": {} } }, "id": 159029, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "4482:18:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "id": 159030, "name": "interest", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158979, "src": "4503:8:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "src": "4482:29:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 159025, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "4474:7:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_uint256_$", "typeString": "type(uint256)" }, "typeName": { "id": 159024, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "4474:7:233", "typeDescriptions": {} } }, "id": 159032, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "4474:38:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "4460:52:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159034, "nodeType": "ExpressionStatement", "src": "4460:52:233" }, { "expression": { "components": [{ "id": 159035, "name": "totalAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158977, "src": "4530:11:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159036, "name": "interest", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158979, "src": "4543:8:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "id": 159037, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "4529:23:233", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_int256_$", "typeString": "tuple(uint256,int256)" } }, "functionReturnParameters": 158980, "id": 159038, "nodeType": "Return", "src": "4522:30:233" }] }, "documentation": { "id": 158968, "nodeType": "StructuredDocumentation", "src": "3565:387:233", "text": "@dev Calculates the non-compounded interest over a period.\n @param _principal The principal amount that will accrue interest.\n @param _apr Annual percentage rate\n @param _time Amount of time in seconds over which interest accrues.\n @return totalAmount The total amount of capital after interest accrues.\n @return interest The interest that accrued." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateInterest", "nameLocation": "3966:17:233", "parameters": { "id": 158975, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 158970, "mutability": "mutable", "name": "_principal", "nameLocation": "4001:10:233", "nodeType": "VariableDeclaration", "scope": 159040, "src": "3993:18:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 158969, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "3993:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 158972, "mutability": "mutable", "name": "_apr", "nameLocation": "4028:4:233", "nodeType": "VariableDeclaration", "scope": 159040, "src": "4021:11:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" }, "typeName": { "id": 158971, "name": "int256", "nodeType": "ElementaryTypeName", "src": "4021:6:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "visibility": "internal" }, { "constant": false, "id": 158974, "mutability": "mutable", "name": "_time", "nameLocation": "4050:5:233", "nodeType": "VariableDeclaration", "scope": 159040, "src": "4042:13:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 158973, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "4042:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "3983:78:233" }, "returnParameters": { "id": 158980, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 158977, "mutability": "mutable", "name": "totalAmount", "nameLocation": "4093:11:233", "nodeType": "VariableDeclaration", "scope": 159040, "src": "4085:19:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 158976, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "4085:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 158979, "mutability": "mutable", "name": "interest", "nameLocation": "4113:8:233", "nodeType": "VariableDeclaration", "scope": 159040, "src": "4106:15:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" }, "typeName": { "id": 158978, "name": "int256", "nodeType": "ElementaryTypeName", "src": "4106:6:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "visibility": "internal" }], "src": "4084:38:233" }, "scope": 161325, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 159153, "nodeType": "FunctionDefinition", "src": "4992:1056:233", "nodes": [], "body": { "id": 159152, "nodeType": "Block", "src": "5167:881:233", "nodes": [], "statements": [{ "assignments": [159055], "declarations": [{ "constant": false, "id": 159055, "mutability": "mutable", "name": "normalizedTime", "nameLocation": "5232:14:233", "nodeType": "VariableDeclaration", "scope": 159152, "src": "5224:22:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159054, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "5224:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 159060, "initialValue": { "arguments": [{ "hexValue": "333635", "id": 159058, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "5263:8:233", "subdenomination": "days", "typeDescriptions": { "typeIdentifier": "t_rational_31536000_by_1", "typeString": "int_const 31536000" }, "value": "365" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_rational_31536000_by_1", "typeString": "int_const 31536000" }], "expression": { "id": 159056, "name": "_time", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159047, "src": "5249:5:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159057, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "5255:7:233", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "5249:13:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159059, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "5249:23:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "5224:48:233" }, { "assignments": [159062], "declarations": [{ "constant": false, "id": 159062, "mutability": "mutable", "name": "rt", "nameLocation": "5290:2:233", "nodeType": "VariableDeclaration", "scope": 159152, "src": "5282:10:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159061, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "5282:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 159076, "initialValue": { "arguments": [{ "id": 159074, "name": "normalizedTime", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159055, "src": "5352:14:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "condition": { "commonType": { "typeIdentifier": "t_int256", "typeString": "int256" }, "id": 159067, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159065, "name": "_rate", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159045, "src": "5303:5:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "nodeType": "BinaryOperation", "operator": "<", "rightExpression": { "hexValue": "30", "id": 159066, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "5311:1:233", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }, "src": "5303:9:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "falseExpression": { "id": 159070, "name": "_rate", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159045, "src": "5324:5:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "id": 159071, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "Conditional", "src": "5303:26:233", "trueExpression": { "id": 159069, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "UnaryOperation", "operator": "-", "prefix": true, "src": "5315:6:233", "subExpression": { "id": 159068, "name": "_rate", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159045, "src": "5316:5:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 159064, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "5295:7:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_uint256_$", "typeString": "type(uint256)" }, "typeName": { "id": 159063, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "5295:7:233", "typeDescriptions": {} } }, "id": 159072, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "5295:35:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159073, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "5331:7:233", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "5295:43:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159075, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "5295:81:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "5282:94:233" }, { "condition": { "commonType": { "typeIdentifier": "t_int256", "typeString": "int256" }, "id": 159079, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159077, "name": "_rate", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159045, "src": "5391:5:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "nodeType": "BinaryOperation", "operator": ">", "rightExpression": { "hexValue": "30", "id": 159078, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "5399:1:233", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }, "src": "5391:9:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "falseBody": { "condition": { "commonType": { "typeIdentifier": "t_int256", "typeString": "int256" }, "id": 159112, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159110, "name": "_rate", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159045, "src": "5641:5:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "nodeType": "BinaryOperation", "operator": "<", "rightExpression": { "hexValue": "30", "id": 159111, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "5649:1:233", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }, "src": "5641:9:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "id": 159146, "nodeType": "IfStatement", "src": "5637:373:233", "trueBody": { "id": 159145, "nodeType": "Block", "src": "5652:358:233", "statements": [{ "expression": { "id": 159127, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 159113, "name": "totalAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159050, "src": "5787:11:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "arguments": [{ "arguments": [{ "arguments": [{ "id": 159122, "name": "rt", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159062, "src": "5871:2:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159121, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "5864:6:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_int256_$", "typeString": "type(int256)" }, "typeName": { "id": 159120, "name": "int256", "nodeType": "ElementaryTypeName", "src": "5864:6:233", "typeDescriptions": {} } }, "id": 159123, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "5864:10:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_int256", "typeString": "int256" }], "expression": { "id": 159118, "name": "FixedPointMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19442, "src": "5845:14:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_FixedPointMath_$19442_$", "typeString": "type(library FixedPointMath)" } }, "id": 159119, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "5860:3:233", "memberName": "exp", "nodeType": "MemberAccess", "referencedDeclaration": 19044, "src": "5845:18:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_int256_$returns$_t_int256_$", "typeString": "function (int256) pure returns (int256)" } }, "id": 159124, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "5845:30:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 159117, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "5837:7:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_uint256_$", "typeString": "type(uint256)" }, "typeName": { "id": 159116, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "5837:7:233", "typeDescriptions": {} } }, "id": 159125, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "5837:39:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159114, "name": "_principal", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159043, "src": "5801:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159115, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "5812:7:233", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "5801:18:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159126, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "5801:89:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "5787:103:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159128, "nodeType": "ExpressionStatement", "src": "5787:103:233" }, { "expression": { "id": 159139, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 159129, "name": "interest", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159052, "src": "5904:8:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "commonType": { "typeIdentifier": "t_int256", "typeString": "int256" }, "id": 159138, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "arguments": [{ "id": 159132, "name": "totalAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159050, "src": "5922:11:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159131, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "5915:6:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_int256_$", "typeString": "type(int256)" }, "typeName": { "id": 159130, "name": "int256", "nodeType": "ElementaryTypeName", "src": "5915:6:233", "typeDescriptions": {} } }, "id": 159133, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "5915:19:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [{ "id": 159136, "name": "_principal", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159043, "src": "5944:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159135, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "5937:6:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_int256_$", "typeString": "type(int256)" }, "typeName": { "id": 159134, "name": "int256", "nodeType": "ElementaryTypeName", "src": "5937:6:233", "typeDescriptions": {} } }, "id": 159137, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "5937:18:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "src": "5915:40:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "src": "5904:51:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "id": 159140, "nodeType": "ExpressionStatement", "src": "5904:51:233" }, { "expression": { "components": [{ "id": 159141, "name": "totalAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159050, "src": "5977:11:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159142, "name": "interest", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159052, "src": "5990:8:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "id": 159143, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "5976:23:233", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_int256_$", "typeString": "tuple(uint256,int256)" } }, "functionReturnParameters": 159053, "id": 159144, "nodeType": "Return", "src": "5969:30:233" }] } }, "id": 159147, "nodeType": "IfStatement", "src": "5387:623:233", "trueBody": { "id": 159109, "nodeType": "Block", "src": "5402:229:233", "statements": [{ "expression": { "id": 159094, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 159080, "name": "totalAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159050, "src": "5416:11:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "arguments": [{ "arguments": [{ "arguments": [{ "id": 159089, "name": "rt", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159062, "src": "5500:2:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159088, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "5493:6:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_int256_$", "typeString": "type(int256)" }, "typeName": { "id": 159087, "name": "int256", "nodeType": "ElementaryTypeName", "src": "5493:6:233", "typeDescriptions": {} } }, "id": 159090, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "5493:10:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_int256", "typeString": "int256" }], "expression": { "id": 159085, "name": "FixedPointMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19442, "src": "5474:14:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_FixedPointMath_$19442_$", "typeString": "type(library FixedPointMath)" } }, "id": 159086, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "5489:3:233", "memberName": "exp", "nodeType": "MemberAccess", "referencedDeclaration": 19044, "src": "5474:18:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_int256_$returns$_t_int256_$", "typeString": "function (int256) pure returns (int256)" } }, "id": 159091, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "5474:30:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 159084, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "5466:7:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_uint256_$", "typeString": "type(uint256)" }, "typeName": { "id": 159083, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "5466:7:233", "typeDescriptions": {} } }, "id": 159092, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "5466:39:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159081, "name": "_principal", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159043, "src": "5430:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159082, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "5441:7:233", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "5430:18:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159093, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "5430:89:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "5416:103:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159095, "nodeType": "ExpressionStatement", "src": "5416:103:233" }, { "expression": { "id": 159103, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 159096, "name": "interest", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159052, "src": "5533:8:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159101, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159099, "name": "totalAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159050, "src": "5551:11:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 159100, "name": "_principal", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159043, "src": "5565:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "5551:24:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159098, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "5544:6:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_int256_$", "typeString": "type(int256)" }, "typeName": { "id": 159097, "name": "int256", "nodeType": "ElementaryTypeName", "src": "5544:6:233", "typeDescriptions": {} } }, "id": 159102, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "5544:32:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "src": "5533:43:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "id": 159104, "nodeType": "ExpressionStatement", "src": "5533:43:233" }, { "expression": { "components": [{ "id": 159105, "name": "totalAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159050, "src": "5598:11:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159106, "name": "interest", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159052, "src": "5611:8:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "id": 159107, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "5597:23:233", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_int256_$", "typeString": "tuple(uint256,int256)" } }, "functionReturnParameters": 159053, "id": 159108, "nodeType": "Return", "src": "5590:30:233" }] } }, { "expression": { "components": [{ "id": 159148, "name": "_principal", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159043, "src": "6027:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "hexValue": "30", "id": 159149, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "6039:1:233", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }], "id": 159150, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "6026:15:233", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_rational_0_by_1_$", "typeString": "tuple(uint256,int_const 0)" } }, "functionReturnParameters": 159053, "id": 159151, "nodeType": "Return", "src": "6019:22:233" }] }, "documentation": { "id": 159041, "nodeType": "StructuredDocumentation", "src": "4565:422:233", "text": "@dev Calculates principal + compounded rate of interest over a period\n      principal * e ^ (rate * time)\n @param _principal The initial amount interest will be accrued on\n @param _rate Interest rate\n @param _time Number of seconds compounding will occur for\n @return totalAmount The total amount of capital after interest accrues.\n @return interest The interest that accrued." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateCompoundInterest", "nameLocation": "5001:25:233", "parameters": { "id": 159048, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159043, "mutability": "mutable", "name": "_principal", "nameLocation": "5044:10:233", "nodeType": "VariableDeclaration", "scope": 159153, "src": "5036:18:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159042, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "5036:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159045, "mutability": "mutable", "name": "_rate", "nameLocation": "5071:5:233", "nodeType": "VariableDeclaration", "scope": 159153, "src": "5064:12:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" }, "typeName": { "id": 159044, "name": "int256", "nodeType": "ElementaryTypeName", "src": "5064:6:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "visibility": "internal" }, { "constant": false, "id": 159047, "mutability": "mutable", "name": "_time", "nameLocation": "5094:5:233", "nodeType": "VariableDeclaration", "scope": 159153, "src": "5086:13:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159046, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "5086:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "5026:79:233" }, "returnParameters": { "id": 159053, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159050, "mutability": "mutable", "name": "totalAmount", "nameLocation": "5137:11:233", "nodeType": "VariableDeclaration", "scope": 159153, "src": "5129:19:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159049, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "5129:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159052, "mutability": "mutable", "name": "interest", "nameLocation": "5157:8:233", "nodeType": "VariableDeclaration", "scope": 159153, "src": "5150:15:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" }, "typeName": { "id": 159051, "name": "int256", "nodeType": "ElementaryTypeName", "src": "5150:6:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "visibility": "internal" }], "src": "5128:38:233" }, "scope": 161325, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 159227, "nodeType": "FunctionDefinition", "src": "6347:1230:233", "nodes": [], "body": { "id": 159226, "nodeType": "Block", "src": "6487:1090:233", "nodes": [], "statements": [{ "assignments": [159168], "declarations": [{ "constant": false, "id": 159168, "mutability": "mutable", "name": "poolConfig", "nameLocation": "6527:10:233", "nodeType": "VariableDeclaration", "scope": 159226, "src": "6497:40:233", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig" }, "typeName": { "id": 159167, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 159166, "name": "IHyperdrive.PoolConfig", "nameLocations": ["6497:11:233", "6509:10:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 10867, "src": "6497:22:233" }, "referencedDeclaration": 10867, "src": "6497:22:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_storage_ptr", "typeString": "struct IHyperdrive.PoolConfig" } }, "visibility": "internal" }], "id": 159172, "initialValue": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 159169, "name": "_hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159157, "src": "6540:11:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "id": 159170, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "6552:13:233", "memberName": "getPoolConfig", "nodeType": "MemberAccess", "referencedDeclaration": 11874, "src": "6540:25:233", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolConfig_$10867_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolConfig memory)" } }, "id": 159171, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "6540:27:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "nodeType": "VariableDeclarationStatement", "src": "6497:70:233" }, { "assignments": [159177], "declarations": [{ "constant": false, "id": 159177, "mutability": "mutable", "name": "poolInfo", "nameLocation": "6605:8:233", "nodeType": "VariableDeclaration", "scope": 159226, "src": "6577:36:233", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo" }, "typeName": { "id": 159176, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 159175, "name": "IHyperdrive.PoolInfo", "nameLocations": ["6577:11:233", "6589:8:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 10913, "src": "6577:20:233" }, "referencedDeclaration": 10913, "src": "6577:20:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_storage_ptr", "typeString": "struct IHyperdrive.PoolInfo" } }, "visibility": "internal" }], "id": 159181, "initialValue": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 159178, "name": "_hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159157, "src": "6616:11:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "id": 159179, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "6628:11:233", "memberName": "getPoolInfo", "nodeType": "MemberAccess", "referencedDeclaration": 11881, "src": "6616:23:233", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolInfo_$10913_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolInfo memory)" } }, "id": 159180, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "6616:25:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "nodeType": "VariableDeclarationStatement", "src": "6577:64:233" }, { "expression": { "id": 159222, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "components": [{ "id": 159182, "name": "baseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159162, "src": "6652:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, null], "id": 159183, "isConstant": false, "isInlineArray": false, "isLValue": true, "isPure": false, "lValueRequested": true, "nodeType": "TupleExpression", "src": "6651:14:233", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$__$", "typeString": "tuple(uint256,)" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "arguments": [{ "expression": { "id": 159186, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159177, "src": "6746:8:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 159187, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "6755:13:233", "memberName": "shareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 10870, "src": "6746:22:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159188, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159177, "src": "6803:8:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 159189, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "6812:15:233", "memberName": "shareAdjustment", "nodeType": "MemberAccess", "referencedDeclaration": 10873, "src": "6803:24:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, { "expression": { "id": 159190, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159177, "src": "6859:8:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 159191, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "6868:12:233", "memberName": "bondReserves", "nodeType": "MemberAccess", "referencedDeclaration": 10882, "src": "6859:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159192, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159177, "src": "6916:8:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 159193, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "6925:16:233", "memberName": "longsOutstanding", "nodeType": "MemberAccess", "referencedDeclaration": 10891, "src": "6916:25:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159194, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159177, "src": "6973:8:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 159195, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "6982:12:233", "memberName": "longExposure", "nodeType": "MemberAccess", "referencedDeclaration": 10912, "src": "6973:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159196, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159168, "src": "7025:10:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 159197, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "7036:11:233", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 10853, "src": "7025:22:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159198, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159177, "src": "7082:8:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 159199, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "7091:15:233", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 10888, "src": "7082:24:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159200, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159168, "src": "7148:10:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 159201, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "7159:22:233", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 10838, "src": "7148:33:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159202, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159168, "src": "7221:10:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 159203, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "7232:20:233", "memberName": "minimumShareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 10841, "src": "7221:31:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "expression": { "id": 159204, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159168, "src": "7280:10:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 159205, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "7291:4:233", "memberName": "fees", "nodeType": "MemberAccess", "referencedDeclaration": 10866, "src": "7280:15:233", "typeDescriptions": { "typeIdentifier": "t_struct$_Fees_$10786_memory_ptr", "typeString": "struct IHyperdrive.Fees memory" } }, "id": 159206, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "7296:5:233", "memberName": "curve", "nodeType": "MemberAccess", "referencedDeclaration": 10776, "src": "7280:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "expression": { "id": 159207, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159168, "src": "7328:10:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 159208, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "7339:4:233", "memberName": "fees", "nodeType": "MemberAccess", "referencedDeclaration": 10866, "src": "7328:15:233", "typeDescriptions": { "typeIdentifier": "t_struct$_Fees_$10786_memory_ptr", "typeString": "struct IHyperdrive.Fees memory" } }, "id": 159209, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "7344:4:233", "memberName": "flat", "nodeType": "MemberAccess", "referencedDeclaration": 10779, "src": "7328:20:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "expression": { "id": 159210, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159168, "src": "7383:10:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 159211, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "7394:4:233", "memberName": "fees", "nodeType": "MemberAccess", "referencedDeclaration": 10866, "src": "7383:15:233", "typeDescriptions": { "typeIdentifier": "t_struct$_Fees_$10786_memory_ptr", "typeString": "struct IHyperdrive.Fees memory" } }, "id": 159212, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "7399:12:233", "memberName": "governanceLP", "nodeType": "MemberAccess", "referencedDeclaration": 10782, "src": "7383:28:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_int256", "typeString": "int256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159185, "name": "MaxTradeParams", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159351, "src": "6698:14:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_struct$_MaxTradeParams_$159351_storage_ptr_$", "typeString": "type(struct HyperdriveUtils.MaxTradeParams storage pointer)" } }, "id": 159213, "isConstant": false, "isLValue": false, "isPure": false, "kind": "structConstructorCall", "lValueRequested": false, "nameLocations": ["6731:13:233", "6786:15:233", "6845:12:233", "6898:16:233", "6959:12:233", "7012:11:233", "7065:15:233", "7124:22:233", "7199:20:233", "7270:8:233", "7319:7:233", "7366:15:233"], "names": ["shareReserves", "shareAdjustment", "bondReserves", "longsOutstanding", "longExposure", "timeStretch", "vaultSharePrice", "initialVaultSharePrice", "minimumShareReserves", "curveFee", "flatFee", "governanceLPFee"], "nodeType": "FunctionCall", "src": "6698:728:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, { "arguments": [{ "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 159216, "name": "_hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159157, "src": "7474:11:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "id": 159217, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "7486:16:233", "memberName": "latestCheckpoint", "nodeType": "MemberAccess", "referencedDeclaration": 158786, "src": "7474:28:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_view$_t_contract$_IHyperdrive_$11076_$returns$_t_uint256_$attached_to$_t_contract$_IHyperdrive_$11076_$", "typeString": "function (contract IHyperdrive) view returns (uint256)" } }, "id": 159218, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "7474:30:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159214, "name": "_hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159157, "src": "7440:11:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "id": 159215, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "7452:21:233", "memberName": "getCheckpointExposure", "nodeType": "MemberAccess", "referencedDeclaration": 11860, "src": "7440:33:233", "typeDescriptions": { "typeIdentifier": "t_function_external_view$_t_uint256_$returns$_t_int256_$", "typeString": "function (uint256) view external returns (int256)" } }, "id": 159219, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "7440:65:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, { "id": 159220, "name": "_maxIterations", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159159, "src": "7519:14:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" }, { "typeIdentifier": "t_int256", "typeString": "int256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159184, "name": "calculateMaxLong", "nodeType": "Identifier", "overloadedDeclarations": [159227, 159242, 159544], "referencedDeclaration": 159544, "src": "6668:16:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_MaxTradeParams_$159351_memory_ptr_$_t_int256_$_t_uint256_$returns$_t_uint256_$_t_uint256_$", "typeString": "function (struct HyperdriveUtils.MaxTradeParams memory,int256,uint256) pure returns (uint256,uint256)" } }, "id": 159221, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "6668:875:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_uint256_$", "typeString": "tuple(uint256,uint256)" } }, "src": "6651:892:233", "typeDescriptions": { "typeIdentifier": "t_tuple$__$", "typeString": "tuple()" } }, "id": 159223, "nodeType": "ExpressionStatement", "src": "6651:892:233" }, { "expression": { "id": 159224, "name": "baseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159162, "src": "7560:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 159163, "id": 159225, "nodeType": "Return", "src": "7553:17:233" }] }, "documentation": { "id": 159154, "nodeType": "StructuredDocumentation", "src": "6079:263:233", "text": "@dev Calculates the maximum amount of longs that can be opened.\n @param _hyperdrive A Hyperdrive instance.\n @param _maxIterations The maximum number of iterations to use.\n @return baseAmount The cost of buying the maximum amount of longs." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateMaxLong", "nameLocation": "6356:16:233", "parameters": { "id": 159160, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159157, "mutability": "mutable", "name": "_hyperdrive", "nameLocation": "6394:11:233", "nodeType": "VariableDeclaration", "scope": 159227, "src": "6382:23:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" }, "typeName": { "id": 159156, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 159155, "name": "IHyperdrive", "nameLocations": ["6382:11:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 11076, "src": "6382:11:233" }, "referencedDeclaration": 11076, "src": "6382:11:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "visibility": "internal" }, { "constant": false, "id": 159159, "mutability": "mutable", "name": "_maxIterations", "nameLocation": "6423:14:233", "nodeType": "VariableDeclaration", "scope": 159227, "src": "6415:22:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159158, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "6415:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "6372:71:233" }, "returnParameters": { "id": 159163, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159162, "mutability": "mutable", "name": "baseAmount", "nameLocation": "6475:10:233", "nodeType": "VariableDeclaration", "scope": 159227, "src": "6467:18:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159161, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "6467:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "6466:20:233" }, "scope": 161325, "stateMutability": "view", "virtual": false, "visibility": "internal" }, { "id": 159242, "nodeType": "FunctionDefinition", "src": "7780:164:233", "nodes": [], "body": { "id": 159241, "nodeType": "Block", "src": "7888:56:233", "nodes": [], "statements": [{ "expression": { "arguments": [{ "id": 159237, "name": "_hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159231, "src": "7922:11:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, { "hexValue": "37", "id": 159238, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "7935:1:233", "typeDescriptions": { "typeIdentifier": "t_rational_7_by_1", "typeString": "int_const 7" }, "value": "7" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" }, { "typeIdentifier": "t_rational_7_by_1", "typeString": "int_const 7" }], "id": 159236, "name": "calculateMaxLong", "nodeType": "Identifier", "overloadedDeclarations": [159227, 159242, 159544], "referencedDeclaration": 159227, "src": "7905:16:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_view$_t_contract$_IHyperdrive_$11076_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (contract IHyperdrive,uint256) view returns (uint256)" } }, "id": 159239, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "7905:32:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 159235, "id": 159240, "nodeType": "Return", "src": "7898:39:233" }] }, "documentation": { "id": 159228, "nodeType": "StructuredDocumentation", "src": "7583:192:233", "text": "@dev Calculates the maximum amount of longs that can be opened.\n @param _hyperdrive A Hyperdrive instance.\n @return baseAmount The cost of buying the maximum amount of longs." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateMaxLong", "nameLocation": "7789:16:233", "parameters": { "id": 159232, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159231, "mutability": "mutable", "name": "_hyperdrive", "nameLocation": "7827:11:233", "nodeType": "VariableDeclaration", "scope": 159242, "src": "7815:23:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" }, "typeName": { "id": 159230, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 159229, "name": "IHyperdrive", "nameLocations": ["7815:11:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 11076, "src": "7815:11:233" }, "referencedDeclaration": 11076, "src": "7815:11:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "visibility": "internal" }], "src": "7805:39:233" }, "returnParameters": { "id": 159235, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159234, "mutability": "mutable", "name": "baseAmount", "nameLocation": "7876:10:233", "nodeType": "VariableDeclaration", "scope": 159242, "src": "7868:18:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159233, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "7868:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "7867:20:233" }, "scope": 161325, "stateMutability": "view", "virtual": false, "visibility": "internal" }, { "id": 159311, "nodeType": "FunctionDefinition", "src": "8209:1302:233", "nodes": [], "body": { "id": 159310, "nodeType": "Block", "src": "8339:1172:233", "nodes": [], "statements": [{ "assignments": [159257], "declarations": [{ "constant": false, "id": 159257, "mutability": "mutable", "name": "poolConfig", "nameLocation": "8379:10:233", "nodeType": "VariableDeclaration", "scope": 159310, "src": "8349:40:233", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig" }, "typeName": { "id": 159256, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 159255, "name": "IHyperdrive.PoolConfig", "nameLocations": ["8349:11:233", "8361:10:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 10867, "src": "8349:22:233" }, "referencedDeclaration": 10867, "src": "8349:22:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_storage_ptr", "typeString": "struct IHyperdrive.PoolConfig" } }, "visibility": "internal" }], "id": 159261, "initialValue": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 159258, "name": "_hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159246, "src": "8392:11:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "id": 159259, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "8404:13:233", "memberName": "getPoolConfig", "nodeType": "MemberAccess", "referencedDeclaration": 11874, "src": "8392:25:233", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolConfig_$10867_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolConfig memory)" } }, "id": 159260, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "8392:27:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "nodeType": "VariableDeclarationStatement", "src": "8349:70:233" }, { "assignments": [159266], "declarations": [{ "constant": false, "id": 159266, "mutability": "mutable", "name": "poolInfo", "nameLocation": "8457:8:233", "nodeType": "VariableDeclaration", "scope": 159310, "src": "8429:36:233", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo" }, "typeName": { "id": 159265, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 159264, "name": "IHyperdrive.PoolInfo", "nameLocations": ["8429:11:233", "8441:8:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 10913, "src": "8429:20:233" }, "referencedDeclaration": 10913, "src": "8429:20:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_storage_ptr", "typeString": "struct IHyperdrive.PoolInfo" } }, "visibility": "internal" }], "id": 159270, "initialValue": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 159267, "name": "_hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159246, "src": "8468:11:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "id": 159268, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "8480:11:233", "memberName": "getPoolInfo", "nodeType": "MemberAccess", "referencedDeclaration": 11881, "src": "8468:23:233", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolInfo_$10913_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolInfo memory)" } }, "id": 159269, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "8468:25:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "nodeType": "VariableDeclarationStatement", "src": "8429:64:233" }, { "expression": { "arguments": [{ "arguments": [{ "expression": { "id": 159273, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159266, "src": "8609:8:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 159274, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "8618:13:233", "memberName": "shareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 10870, "src": "8609:22:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159275, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159266, "src": "8670:8:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 159276, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "8679:15:233", "memberName": "shareAdjustment", "nodeType": "MemberAccess", "referencedDeclaration": 10873, "src": "8670:24:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, { "expression": { "id": 159277, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159266, "src": "8730:8:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 159278, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "8739:12:233", "memberName": "bondReserves", "nodeType": "MemberAccess", "referencedDeclaration": 10882, "src": "8730:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159279, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159266, "src": "8791:8:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 159280, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "8800:16:233", "memberName": "longsOutstanding", "nodeType": "MemberAccess", "referencedDeclaration": 10891, "src": "8791:25:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159281, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159266, "src": "8852:8:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 159282, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "8861:12:233", "memberName": "longExposure", "nodeType": "MemberAccess", "referencedDeclaration": 10912, "src": "8852:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159283, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159257, "src": "8908:10:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 159284, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "8919:11:233", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 10853, "src": "8908:22:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159285, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159266, "src": "8969:8:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 159286, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "8978:15:233", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 10888, "src": "8969:24:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159287, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159257, "src": "9039:10:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 159288, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "9050:22:233", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 10838, "src": "9039:33:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159289, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159257, "src": "9116:10:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 159290, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "9127:20:233", "memberName": "minimumShareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 10841, "src": "9116:31:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "expression": { "id": 159291, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159257, "src": "9179:10:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 159292, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "9190:4:233", "memberName": "fees", "nodeType": "MemberAccess", "referencedDeclaration": 10866, "src": "9179:15:233", "typeDescriptions": { "typeIdentifier": "t_struct$_Fees_$10786_memory_ptr", "typeString": "struct IHyperdrive.Fees memory" } }, "id": 159293, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "9195:5:233", "memberName": "curve", "nodeType": "MemberAccess", "referencedDeclaration": 10776, "src": "9179:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "expression": { "id": 159294, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159257, "src": "9231:10:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 159295, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "9242:4:233", "memberName": "fees", "nodeType": "MemberAccess", "referencedDeclaration": 10866, "src": "9231:15:233", "typeDescriptions": { "typeIdentifier": "t_struct$_Fees_$10786_memory_ptr", "typeString": "struct IHyperdrive.Fees memory" } }, "id": 159296, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "9247:4:233", "memberName": "flat", "nodeType": "MemberAccess", "referencedDeclaration": 10779, "src": "9231:20:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "expression": { "id": 159297, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159257, "src": "9290:10:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 159298, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "9301:4:233", "memberName": "fees", "nodeType": "MemberAccess", "referencedDeclaration": 10866, "src": "9290:15:233", "typeDescriptions": { "typeIdentifier": "t_struct$_Fees_$10786_memory_ptr", "typeString": "struct IHyperdrive.Fees memory" } }, "id": 159299, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "9306:12:233", "memberName": "governanceLP", "nodeType": "MemberAccess", "referencedDeclaration": 10782, "src": "9290:28:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_int256", "typeString": "int256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159272, "name": "MaxTradeParams", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159351, "src": "8557:14:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_struct$_MaxTradeParams_$159351_storage_ptr_$", "typeString": "type(struct HyperdriveUtils.MaxTradeParams storage pointer)" } }, "id": 159300, "isConstant": false, "isLValue": false, "isPure": false, "kind": "structConstructorCall", "lValueRequested": false, "nameLocations": ["8594:13:233", "8653:15:233", "8716:12:233", "8773:16:233", "8838:12:233", "8895:11:233", "8952:15:233", "9015:22:233", "9094:20:233", "9169:8:233", "9222:7:233", "9273:15:233"], "names": ["shareReserves", "shareAdjustment", "bondReserves", "longsOutstanding", "longExposure", "timeStretch", "vaultSharePrice", "initialVaultSharePrice", "minimumShareReserves", "curveFee", "flatFee", "governanceLPFee"], "nodeType": "FunctionCall", "src": "8557:780:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, { "arguments": [{ "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 159303, "name": "_hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159246, "src": "9410:11:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "id": 159304, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "9422:16:233", "memberName": "latestCheckpoint", "nodeType": "MemberAccess", "referencedDeclaration": 158786, "src": "9410:28:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_view$_t_contract$_IHyperdrive_$11076_$returns$_t_uint256_$attached_to$_t_contract$_IHyperdrive_$11076_$", "typeString": "function (contract IHyperdrive) view returns (uint256)" } }, "id": 159305, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "9410:30:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159301, "name": "_hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159246, "src": "9355:11:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "id": 159302, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "9367:21:233", "memberName": "getCheckpointExposure", "nodeType": "MemberAccess", "referencedDeclaration": 11860, "src": "9355:33:233", "typeDescriptions": { "typeIdentifier": "t_function_external_view$_t_uint256_$returns$_t_int256_$", "typeString": "function (uint256) view external returns (int256)" } }, "id": 159306, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "9355:103:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, { "id": 159307, "name": "_maxIterations", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159248, "src": "9476:14:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" }, { "typeIdentifier": "t_int256", "typeString": "int256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159271, "name": "calculateMaxShort", "nodeType": "Identifier", "overloadedDeclarations": [159311, 159326, 160474], "referencedDeclaration": 160474, "src": "8522:17:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_MaxTradeParams_$159351_memory_ptr_$_t_int256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (struct HyperdriveUtils.MaxTradeParams memory,int256,uint256) pure returns (uint256)" } }, "id": 159308, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "8522:982:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 159252, "id": 159309, "nodeType": "Return", "src": "8503:1001:233" }] }, "documentation": { "id": 159243, "nodeType": "StructuredDocumentation", "src": "7950:254:233", "text": "@dev Calculates the maximum amount of shorts that can be opened.\n @param _hyperdrive A Hyperdrive instance.\n @param _maxIterations The maximum number of iterations to use.\n @return The maximum amount of bonds that can be shorted." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateMaxShort", "nameLocation": "8218:17:233", "parameters": { "id": 159249, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159246, "mutability": "mutable", "name": "_hyperdrive", "nameLocation": "8257:11:233", "nodeType": "VariableDeclaration", "scope": 159311, "src": "8245:23:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" }, "typeName": { "id": 159245, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 159244, "name": "IHyperdrive", "nameLocations": ["8245:11:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 11076, "src": "8245:11:233" }, "referencedDeclaration": 11076, "src": "8245:11:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "visibility": "internal" }, { "constant": false, "id": 159248, "mutability": "mutable", "name": "_maxIterations", "nameLocation": "8286:14:233", "nodeType": "VariableDeclaration", "scope": 159311, "src": "8278:22:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159247, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "8278:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "8235:71:233" }, "returnParameters": { "id": 159252, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159251, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 159311, "src": "8330:7:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159250, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "8330:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "8329:9:233" }, "scope": 161325, "stateMutability": "view", "virtual": false, "visibility": "internal" }, { "id": 159326, "nodeType": "FunctionDefinition", "src": "9705:155:233", "nodes": [], "body": { "id": 159325, "nodeType": "Block", "src": "9803:57:233", "nodes": [], "statements": [{ "expression": { "arguments": [{ "id": 159321, "name": "_hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159315, "src": "9838:11:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, { "hexValue": "37", "id": 159322, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "9851:1:233", "typeDescriptions": { "typeIdentifier": "t_rational_7_by_1", "typeString": "int_const 7" }, "value": "7" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" }, { "typeIdentifier": "t_rational_7_by_1", "typeString": "int_const 7" }], "id": 159320, "name": "calculateMaxShort", "nodeType": "Identifier", "overloadedDeclarations": [159311, 159326, 160474], "referencedDeclaration": 159311, "src": "9820:17:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_view$_t_contract$_IHyperdrive_$11076_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (contract IHyperdrive,uint256) view returns (uint256)" } }, "id": 159323, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "9820:33:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 159319, "id": 159324, "nodeType": "Return", "src": "9813:40:233" }] }, "documentation": { "id": 159312, "nodeType": "StructuredDocumentation", "src": "9517:183:233", "text": "@dev Calculates the maximum amount of shorts that can be opened.\n @param _hyperdrive A Hyperdrive instance.\n @return The maximum amount of bonds that can be shorted." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateMaxShort", "nameLocation": "9714:17:233", "parameters": { "id": 159316, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159315, "mutability": "mutable", "name": "_hyperdrive", "nameLocation": "9753:11:233", "nodeType": "VariableDeclaration", "scope": 159326, "src": "9741:23:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" }, "typeName": { "id": 159314, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 159313, "name": "IHyperdrive", "nameLocations": ["9741:11:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 11076, "src": "9741:11:233" }, "referencedDeclaration": 11076, "src": "9741:11:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "visibility": "internal" }], "src": "9731:39:233" }, "returnParameters": { "id": 159319, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159318, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 159326, "src": "9794:7:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159317, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "9794:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "9793:9:233" }, "scope": 161325, "stateMutability": "view", "virtual": false, "visibility": "internal" }, { "id": 159351, "nodeType": "StructDefinition", "src": "9866:410:233", "nodes": [], "canonicalName": "HyperdriveUtils.MaxTradeParams", "members": [{ "constant": false, "id": 159328, "mutability": "mutable", "name": "shareReserves", "nameLocation": "9906:13:233", "nodeType": "VariableDeclaration", "scope": 159351, "src": "9898:21:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159327, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "9898:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159330, "mutability": "mutable", "name": "shareAdjustment", "nameLocation": "9936:15:233", "nodeType": "VariableDeclaration", "scope": 159351, "src": "9929:22:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" }, "typeName": { "id": 159329, "name": "int256", "nodeType": "ElementaryTypeName", "src": "9929:6:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "visibility": "internal" }, { "constant": false, "id": 159332, "mutability": "mutable", "name": "bondReserves", "nameLocation": "9969:12:233", "nodeType": "VariableDeclaration", "scope": 159351, "src": "9961:20:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159331, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "9961:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159334, "mutability": "mutable", "name": "longsOutstanding", "nameLocation": "9999:16:233", "nodeType": "VariableDeclaration", "scope": 159351, "src": "9991:24:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159333, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "9991:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159336, "mutability": "mutable", "name": "longExposure", "nameLocation": "10033:12:233", "nodeType": "VariableDeclaration", "scope": 159351, "src": "10025:20:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159335, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "10025:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159338, "mutability": "mutable", "name": "timeStretch", "nameLocation": "10063:11:233", "nodeType": "VariableDeclaration", "scope": 159351, "src": "10055:19:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159337, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "10055:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159340, "mutability": "mutable", "name": "vaultSharePrice", "nameLocation": "10092:15:233", "nodeType": "VariableDeclaration", "scope": 159351, "src": "10084:23:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159339, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "10084:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159342, "mutability": "mutable", "name": "initialVaultSharePrice", "nameLocation": "10125:22:233", "nodeType": "VariableDeclaration", "scope": 159351, "src": "10117:30:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159341, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "10117:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159344, "mutability": "mutable", "name": "minimumShareReserves", "nameLocation": "10165:20:233", "nodeType": "VariableDeclaration", "scope": 159351, "src": "10157:28:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159343, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "10157:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159346, "mutability": "mutable", "name": "curveFee", "nameLocation": "10203:8:233", "nodeType": "VariableDeclaration", "scope": 159351, "src": "10195:16:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159345, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "10195:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159348, "mutability": "mutable", "name": "flatFee", "nameLocation": "10229:7:233", "nodeType": "VariableDeclaration", "scope": 159351, "src": "10221:15:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159347, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "10221:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159350, "mutability": "mutable", "name": "governanceLPFee", "nameLocation": "10254:15:233", "nodeType": "VariableDeclaration", "scope": 159351, "src": "10246:23:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159349, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "10246:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "name": "MaxTradeParams", "nameLocation": "9873:14:233", "scope": 161325, "visibility": "public" }, { "id": 159544, "nodeType": "FunctionDefinition", "src": "10963:5032:233", "nodes": [], "body": { "id": 159543, "nodeType": "Block", "src": "11171:4824:233", "nodes": [], "statements": [{ "assignments": [159367], "declarations": [{ "constant": false, "id": 159367, "mutability": "mutable", "name": "effectiveShareReserves", "nameLocation": "11330:22:233", "nodeType": "VariableDeclaration", "scope": 159543, "src": "11322:30:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159366, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "11322:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 159375, "initialValue": { "arguments": [{ "expression": { "id": 159370, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159355, "src": "11432:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159371, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "11440:13:233", "memberName": "shareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159328, "src": "11432:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159372, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159355, "src": "11471:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159373, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "11479:15:233", "memberName": "shareAdjustment", "nodeType": "MemberAccess", "referencedDeclaration": 159330, "src": "11471:23:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_int256", "typeString": "int256" }], "expression": { "id": 159368, "name": "HyperdriveMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20190, "src": "11355:14:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_HyperdriveMath_$20190_$", "typeString": "type(library HyperdriveMath)" } }, "id": 159369, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "11383:31:233", "memberName": "calculateEffectiveShareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 19633, "src": "11355:59:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_int256_$returns$_t_uint256_$", "typeString": "function (uint256,int256) pure returns (uint256)" } }, "id": 159374, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "11355:153:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "11322:186:233" }, { "assignments": [159377], "declarations": [{ "constant": false, "id": 159377, "mutability": "mutable", "name": "spotPrice", "nameLocation": "11526:9:233", "nodeType": "VariableDeclaration", "scope": 159543, "src": "11518:17:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159376, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "11518:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 159388, "initialValue": { "arguments": [{ "id": 159380, "name": "effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159367, "src": "11585:22:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159381, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159355, "src": "11621:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159382, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "11629:12:233", "memberName": "bondReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159332, "src": "11621:20:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159383, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159355, "src": "11655:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159384, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "11663:22:233", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159342, "src": "11655:30:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159385, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159355, "src": "11699:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159386, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "11707:11:233", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159338, "src": "11699:19:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159378, "name": "HyperdriveMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20190, "src": "11538:14:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_HyperdriveMath_$20190_$", "typeString": "type(library HyperdriveMath)" } }, "id": 159379, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "11553:18:233", "memberName": "calculateSpotPrice", "nodeType": "MemberAccess", "referencedDeclaration": 19560, "src": "11538:33:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256,uint256) pure returns (uint256)" } }, "id": 159387, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "11538:190:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "11518:210:233" }, { "assignments": [159390], "declarations": [{ "constant": false, "id": 159390, "mutability": "mutable", "name": "absoluteMaxBaseAmount", "nameLocation": "11746:21:233", "nodeType": "VariableDeclaration", "scope": 159543, "src": "11738:29:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159389, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "11738:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 159391, "nodeType": "VariableDeclarationStatement", "src": "11738:29:233" }, { "assignments": [159393], "declarations": [{ "constant": false, "id": 159393, "mutability": "mutable", "name": "absoluteMaxBondAmount", "nameLocation": "11785:21:233", "nodeType": "VariableDeclaration", "scope": 159543, "src": "11777:29:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159392, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "11777:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 159394, "nodeType": "VariableDeclarationStatement", "src": "11777:29:233" }, { "id": 159422, "nodeType": "Block", "src": "11816:608:233", "statements": [{ "expression": { "id": 159403, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "components": [{ "id": 159395, "name": "absoluteMaxBaseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159390, "src": "11848:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159396, "name": "absoluteMaxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159393, "src": "11887:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 159397, "isConstant": false, "isInlineArray": false, "isLValue": true, "isPure": false, "lValueRequested": true, "nodeType": "TupleExpression", "src": "11830:92:233", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_uint256_$", "typeString": "tuple(uint256,uint256)" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 159399, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159355, "src": "11967:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, { "id": 159400, "name": "effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159367, "src": "11992:22:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159401, "name": "spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159377, "src": "12032:9:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159398, "name": "calculateAbsoluteMaxLong", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159738, "src": "11925:24:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_MaxTradeParams_$159351_memory_ptr_$_t_uint256_$_t_uint256_$returns$_t_uint256_$_t_uint256_$", "typeString": "function (struct HyperdriveUtils.MaxTradeParams memory,uint256,uint256) pure returns (uint256,uint256)" } }, "id": 159402, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "11925:130:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_uint256_$", "typeString": "tuple(uint256,uint256)" } }, "src": "11830:225:233", "typeDescriptions": { "typeIdentifier": "t_tuple$__$", "typeString": "tuple()" } }, "id": 159404, "nodeType": "ExpressionStatement", "src": "11830:225:233" }, { "assignments": [null, 159406], "declarations": [null, { "constant": false, "id": 159406, "mutability": "mutable", "name": "isSolvent_", "nameLocation": "12077:10:233", "nodeType": "VariableDeclaration", "scope": 159422, "src": "12072:15:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "typeName": { "id": 159405, "name": "bool", "nodeType": "ElementaryTypeName", "src": "12072:4:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "visibility": "internal" }], "id": 159414, "initialValue": { "arguments": [{ "id": 159408, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159355, "src": "12135:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, { "id": 159409, "name": "_checkpointExposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159357, "src": "12160:19:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, { "id": 159410, "name": "absoluteMaxBaseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159390, "src": "12197:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159411, "name": "absoluteMaxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159393, "src": "12236:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159412, "name": "spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159377, "src": "12275:9:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" }, { "typeIdentifier": "t_int256", "typeString": "int256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159407, "name": "calculateSolvencyAfterLong", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160006, "src": "12091:26:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_MaxTradeParams_$159351_memory_ptr_$_t_int256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$_t_bool_$", "typeString": "function (struct HyperdriveUtils.MaxTradeParams memory,int256,uint256,uint256,uint256) pure returns (uint256,bool)" } }, "id": 159413, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "12091:207:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "nodeType": "VariableDeclarationStatement", "src": "12069:229:233" }, { "condition": { "id": 159415, "name": "isSolvent_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159406, "src": "12316:10:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "id": 159421, "nodeType": "IfStatement", "src": "12312:102:233", "trueBody": { "id": 159420, "nodeType": "Block", "src": "12328:86:233", "statements": [{ "expression": { "components": [{ "id": 159416, "name": "absoluteMaxBaseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159390, "src": "12354:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159417, "name": "absoluteMaxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159393, "src": "12377:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 159418, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "12353:46:233", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_uint256_$", "typeString": "tuple(uint256,uint256)" } }, "functionReturnParameters": 159365, "id": 159419, "nodeType": "Return", "src": "12346:53:233" }] } }] }, { "expression": { "id": 159430, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 159423, "name": "maxBaseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159362, "src": "13303:13:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 159425, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159355, "src": "13354:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, { "id": 159426, "name": "absoluteMaxBaseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159390, "src": "13375:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159427, "name": "_checkpointExposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159357, "src": "13410:19:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, { "id": 159428, "name": "spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159377, "src": "13443:9:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_int256", "typeString": "int256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159424, "name": "calculateMaxLongGuess", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159807, "src": "13319:21:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_MaxTradeParams_$159351_memory_ptr_$_t_uint256_$_t_int256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (struct HyperdriveUtils.MaxTradeParams memory,uint256,int256,uint256) pure returns (uint256)" } }, "id": 159429, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "13319:143:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "13303:159:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159431, "nodeType": "ExpressionStatement", "src": "13303:159:233" }, { "expression": { "id": 159439, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 159432, "name": "maxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159364, "src": "13472:13:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 159434, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159355, "src": "13521:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, { "id": 159435, "name": "maxBaseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159362, "src": "13542:13:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159436, "name": "effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159367, "src": "13569:22:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159437, "name": "spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159377, "src": "13605:9:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159433, "name": "calculateLongAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160115, "src": "13488:19:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_MaxTradeParams_$159351_memory_ptr_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (struct HyperdriveUtils.MaxTradeParams memory,uint256,uint256,uint256) pure returns (uint256)" } }, "id": 159438, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "13488:136:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "13472:152:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159440, "nodeType": "ExpressionStatement", "src": "13472:152:233" }, { "assignments": [159442, 159444], "declarations": [{ "constant": false, "id": 159442, "mutability": "mutable", "name": "solvency_", "nameLocation": "13643:9:233", "nodeType": "VariableDeclaration", "scope": 159543, "src": "13635:17:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159441, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "13635:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159444, "mutability": "mutable", "name": "success", "nameLocation": "13659:7:233", "nodeType": "VariableDeclaration", "scope": 159543, "src": "13654:12:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "typeName": { "id": 159443, "name": "bool", "nodeType": "ElementaryTypeName", "src": "13654:4:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "visibility": "internal" }], "id": 159452, "initialValue": { "arguments": [{ "id": 159446, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159355, "src": "13710:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, { "id": 159447, "name": "_checkpointExposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159357, "src": "13731:19:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, { "id": 159448, "name": "maxBaseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159362, "src": "13764:13:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159449, "name": "maxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159364, "src": "13791:13:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159450, "name": "spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159377, "src": "13818:9:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" }, { "typeIdentifier": "t_int256", "typeString": "int256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159445, "name": "calculateSolvencyAfterLong", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160006, "src": "13670:26:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_MaxTradeParams_$159351_memory_ptr_$_t_int256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$_t_bool_$", "typeString": "function (struct HyperdriveUtils.MaxTradeParams memory,int256,uint256,uint256,uint256) pure returns (uint256,bool)" } }, "id": 159451, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "13670:167:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "nodeType": "VariableDeclarationStatement", "src": "13634:203:233" }, { "expression": { "arguments": [{ "id": 159454, "name": "success", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159444, "src": "13855:7:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, { "hexValue": "496e697469616c20677565737320696e206063616c63756c6174654d61784c6f6e676020697320696e736f6c76656e742e", "id": 159455, "isConstant": false, "isLValue": false, "isPure": true, "kind": "string", "lValueRequested": false, "nodeType": "Literal", "src": "13864:51:233", "typeDescriptions": { "typeIdentifier": "t_stringliteral_4e6d63cecf3a70a5745c0f55ea1d84484c3dcb5e4cec0df8dd19ed87d5edc294", "typeString": "literal_string \"Initial guess in `calculateMaxLong` is insolvent.\"" }, "value": "Initial guess in `calculateMaxLong` is insolvent." }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_bool", "typeString": "bool" }, { "typeIdentifier": "t_stringliteral_4e6d63cecf3a70a5745c0f55ea1d84484c3dcb5e4cec0df8dd19ed87d5edc294", "typeString": "literal_string \"Initial guess in `calculateMaxLong` is insolvent.\"" }], "id": 159453, "name": "require", "nodeType": "Identifier", "overloadedDeclarations": [-18, -18], "referencedDeclaration": -18, "src": "13847:7:233", "typeDescriptions": { "typeIdentifier": "t_function_require_pure$_t_bool_$_t_string_memory_ptr_$returns$__$", "typeString": "function (bool,string memory) pure" } }, "id": 159456, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "13847:69:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_tuple$__$", "typeString": "tuple()" } }, "id": 159457, "nodeType": "ExpressionStatement", "src": "13847:69:233" }, { "body": { "id": 159537, "nodeType": "Block", "src": "13971:1970:233", "statements": [{ "expression": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159471, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159469, "name": "maxBaseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159362, "src": "14195:13:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "<", "rightExpression": { "id": 159470, "name": "absoluteMaxBaseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159390, "src": "14211:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "14195:37:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, { "hexValue": "52656163686564206162736f6c757465206d617820626f6e6420616d6f756e7420696e20606765745f6d61785f6c6f6e67602e", "id": 159472, "isConstant": false, "isLValue": false, "isPure": true, "kind": "string", "lValueRequested": false, "nodeType": "Literal", "src": "14250:53:233", "typeDescriptions": { "typeIdentifier": "t_stringliteral_f73cbb65781b5d25c319ac55965af78a368c7603f407050cca4d559a6b41dbaf", "typeString": "literal_string \"Reached absolute max bond amount in `get_max_long`.\"" }, "value": "Reached absolute max bond amount in `get_max_long`." }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_bool", "typeString": "bool" }, { "typeIdentifier": "t_stringliteral_f73cbb65781b5d25c319ac55965af78a368c7603f407050cca4d559a6b41dbaf", "typeString": "literal_string \"Reached absolute max bond amount in `get_max_long`.\"" }], "id": 159468, "name": "require", "nodeType": "Identifier", "overloadedDeclarations": [-18, -18], "referencedDeclaration": -18, "src": "14170:7:233", "typeDescriptions": { "typeIdentifier": "t_function_require_pure$_t_bool_$_t_string_memory_ptr_$returns$__$", "typeString": "function (bool,string memory) pure" } }, "id": 159473, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "14170:147:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_tuple$__$", "typeString": "tuple()" } }, "id": 159474, "nodeType": "ExpressionStatement", "src": "14170:147:233" }, { "assignments": [159476], "declarations": [{ "constant": false, "id": 159476, "mutability": "mutable", "name": "derivative", "nameLocation": "14888:10:233", "nodeType": "VariableDeclaration", "scope": 159537, "src": "14880:18:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159475, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "14880:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 159477, "nodeType": "VariableDeclarationStatement", "src": "14880:18:233" }, { "expression": { "id": 159487, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "components": [{ "id": 159478, "name": "derivative", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159476, "src": "14913:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159479, "name": "success", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159444, "src": "14925:7:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }], "id": 159480, "isConstant": false, "isInlineArray": false, "isLValue": true, "isPure": false, "lValueRequested": true, "nodeType": "TupleExpression", "src": "14912:21:233", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 159482, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159355, "src": "14990:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, { "id": 159483, "name": "maxBaseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159362, "src": "15015:13:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159484, "name": "effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159367, "src": "15046:22:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159485, "name": "spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159377, "src": "15086:9:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159481, "name": "calculateSolvencyAfterLongDerivative", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160070, "src": "14936:36:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_MaxTradeParams_$159351_memory_ptr_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$_t_bool_$", "typeString": "function (struct HyperdriveUtils.MaxTradeParams memory,uint256,uint256,uint256) pure returns (uint256,bool)" } }, "id": 159486, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "14936:173:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "src": "14912:197:233", "typeDescriptions": { "typeIdentifier": "t_tuple$__$", "typeString": "tuple()" } }, "id": 159488, "nodeType": "ExpressionStatement", "src": "14912:197:233" }, { "condition": { "id": 159490, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "UnaryOperation", "operator": "!", "prefix": true, "src": "15127:8:233", "subExpression": { "id": 159489, "name": "success", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159444, "src": "15128:7:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "id": 159493, "nodeType": "IfStatement", "src": "15123:52:233", "trueBody": { "id": 159492, "nodeType": "Block", "src": "15137:38:233", "statements": [{ "id": 159491, "nodeType": "Break", "src": "15155:5:233" }] } }, { "assignments": [159495], "declarations": [{ "constant": false, "id": 159495, "mutability": "mutable", "name": "possibleMaxBaseAmount", "nameLocation": "15196:21:233", "nodeType": "VariableDeclaration", "scope": 159537, "src": "15188:29:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159494, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "15188:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 159502, "initialValue": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159501, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159496, "name": "maxBaseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159362, "src": "15220:13:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "arguments": [{ "id": 159499, "name": "derivative", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159476, "src": "15270:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159497, "name": "solvency_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159442, "src": "15252:9:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159498, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "15262:7:233", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "15252:17:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159500, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "15252:29:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "15220:61:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "15188:93:233" }, { "assignments": [159504], "declarations": [{ "constant": false, "id": 159504, "mutability": "mutable", "name": "possibleMaxBondAmount", "nameLocation": "15303:21:233", "nodeType": "VariableDeclaration", "scope": 159537, "src": "15295:29:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159503, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "15295:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 159511, "initialValue": { "arguments": [{ "id": 159506, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159355, "src": "15364:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, { "id": 159507, "name": "possibleMaxBaseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159495, "src": "15389:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159508, "name": "effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159367, "src": "15428:22:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159509, "name": "spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159377, "src": "15468:9:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159505, "name": "calculateLongAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160115, "src": "15327:19:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_MaxTradeParams_$159351_memory_ptr_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (struct HyperdriveUtils.MaxTradeParams memory,uint256,uint256,uint256) pure returns (uint256)" } }, "id": 159510, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "15327:164:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "15295:196:233" }, { "expression": { "id": 159522, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "components": [{ "id": 159512, "name": "solvency_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159442, "src": "15506:9:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159513, "name": "success", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159444, "src": "15517:7:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }], "id": 159514, "isConstant": false, "isInlineArray": false, "isLValue": true, "isPure": false, "lValueRequested": true, "nodeType": "TupleExpression", "src": "15505:20:233", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 159516, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159355, "src": "15572:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, { "id": 159517, "name": "_checkpointExposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159357, "src": "15597:19:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, { "id": 159518, "name": "possibleMaxBaseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159495, "src": "15634:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159519, "name": "possibleMaxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159504, "src": "15673:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159520, "name": "spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159377, "src": "15712:9:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" }, { "typeIdentifier": "t_int256", "typeString": "int256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159515, "name": "calculateSolvencyAfterLong", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160006, "src": "15528:26:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_MaxTradeParams_$159351_memory_ptr_$_t_int256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$_t_bool_$", "typeString": "function (struct HyperdriveUtils.MaxTradeParams memory,int256,uint256,uint256,uint256) pure returns (uint256,bool)" } }, "id": 159521, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "15528:207:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "src": "15505:230:233", "typeDescriptions": { "typeIdentifier": "t_tuple$__$", "typeString": "tuple()" } }, "id": 159523, "nodeType": "ExpressionStatement", "src": "15505:230:233" }, { "condition": { "id": 159524, "name": "success", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159444, "src": "15753:7:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "falseBody": { "id": 159535, "nodeType": "Block", "src": "15893:38:233", "statements": [{ "id": 159534, "nodeType": "Break", "src": "15911:5:233" }] }, "id": 159536, "nodeType": "IfStatement", "src": "15749:182:233", "trueBody": { "id": 159533, "nodeType": "Block", "src": "15762:125:233", "statements": [{ "expression": { "id": 159527, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 159525, "name": "maxBaseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159362, "src": "15780:13:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "id": 159526, "name": "possibleMaxBaseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159495, "src": "15796:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "15780:37:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159528, "nodeType": "ExpressionStatement", "src": "15780:37:233" }, { "expression": { "id": 159531, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 159529, "name": "maxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159364, "src": "15835:13:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "id": 159530, "name": "possibleMaxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159504, "src": "15851:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "15835:37:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159532, "nodeType": "ExpressionStatement", "src": "15835:37:233" }] } }] }, "condition": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159464, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159462, "name": "i", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159459, "src": "13946:1:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "<", "rightExpression": { "id": 159463, "name": "_maxIterations", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159359, "src": "13950:14:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "13946:18:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "id": 159538, "initializationExpression": { "assignments": [159459], "declarations": [{ "constant": false, "id": 159459, "mutability": "mutable", "name": "i", "nameLocation": "13939:1:233", "nodeType": "VariableDeclaration", "scope": 159538, "src": "13931:9:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159458, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "13931:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 159461, "initialValue": { "hexValue": "30", "id": 159460, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "13943:1:233", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }, "nodeType": "VariableDeclarationStatement", "src": "13931:13:233" }, "loopExpression": { "expression": { "id": 159466, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "UnaryOperation", "operator": "++", "prefix": true, "src": "13966:3:233", "subExpression": { "id": 159465, "name": "i", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159459, "src": "13968:1:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159467, "nodeType": "ExpressionStatement", "src": "13966:3:233" }, "nodeType": "ForStatement", "src": "13926:2015:233" }, { "expression": { "components": [{ "id": 159539, "name": "maxBaseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159362, "src": "15959:13:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159540, "name": "maxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159364, "src": "15974:13:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 159541, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "15958:30:233", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_uint256_$", "typeString": "tuple(uint256,uint256)" } }, "functionReturnParameters": 159365, "id": 159542, "nodeType": "Return", "src": "15951:37:233" }] }, "documentation": { "id": 159352, "nodeType": "StructuredDocumentation", "src": "10282:676:233", "text": "@dev Gets the max long that can be opened given a budget.\n      We start by calculating the long that brings the pool's spot price\n      to 1. If we are solvent at this point, then we're done. Otherwise,\n      we approach the max long iteratively using Newton's method.\n @param _params The parameters for the max long calculation.\n @param _checkpointExposure The exposure in the checkpoint.\n @param _maxIterations The maximum number of iterations to use in the\n                       Newton's method loop.\n @return maxBaseAmount The maximum base amount.\n @return maxBondAmount The maximum bond amount." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateMaxLong", "nameLocation": "10972:16:233", "parameters": { "id": 159360, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159355, "mutability": "mutable", "name": "_params", "nameLocation": "11020:7:233", "nodeType": "VariableDeclaration", "scope": 159544, "src": "10998:29:233", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" }, "typeName": { "id": 159354, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 159353, "name": "MaxTradeParams", "nameLocations": ["10998:14:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 159351, "src": "10998:14:233" }, "referencedDeclaration": 159351, "src": "10998:14:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_storage_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" } }, "visibility": "internal" }, { "constant": false, "id": 159357, "mutability": "mutable", "name": "_checkpointExposure", "nameLocation": "11044:19:233", "nodeType": "VariableDeclaration", "scope": 159544, "src": "11037:26:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" }, "typeName": { "id": 159356, "name": "int256", "nodeType": "ElementaryTypeName", "src": "11037:6:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "visibility": "internal" }, { "constant": false, "id": 159359, "mutability": "mutable", "name": "_maxIterations", "nameLocation": "11081:14:233", "nodeType": "VariableDeclaration", "scope": 159544, "src": "11073:22:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159358, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "11073:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "10988:113:233" }, "returnParameters": { "id": 159365, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159362, "mutability": "mutable", "name": "maxBaseAmount", "nameLocation": "11133:13:233", "nodeType": "VariableDeclaration", "scope": 159544, "src": "11125:21:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159361, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "11125:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159364, "mutability": "mutable", "name": "maxBondAmount", "nameLocation": "11156:13:233", "nodeType": "VariableDeclaration", "scope": 159544, "src": "11148:21:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159363, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "11148:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "11124:46:233" }, "scope": 161325, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 159738, "nodeType": "FunctionDefinition", "src": "16597:3723:233", "nodes": [], "body": { "id": 159737, "nodeType": "Block", "src": "16858:3462:233", "nodes": [], "statements": [{ "assignments": [159560], "declarations": [{ "constant": false, "id": 159560, "mutability": "mutable", "name": "inner", "nameLocation": "18026:5:233", "nodeType": "VariableDeclaration", "scope": 159737, "src": "18018:13:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159559, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "18018:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 159561, "nodeType": "VariableDeclarationStatement", "src": "18018:13:233" }, { "id": 159655, "nodeType": "Block", "src": "18041:822:233", "statements": [{ "assignments": [159563], "declarations": [{ "constant": false, "id": 159563, "mutability": "mutable", "name": "k_", "nameLocation": "18063:2:233", "nodeType": "VariableDeclaration", "scope": 159655, "src": "18055:10:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159562, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "18055:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 159578, "initialValue": { "arguments": [{ "id": 159566, "name": "_effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159550, "src": "18106:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159567, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159548, "src": "18147:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159568, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "18155:12:233", "memberName": "bondReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159332, "src": "18147:20:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159572, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159569, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "18185:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 159570, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159548, "src": "18191:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159571, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "18199:11:233", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159338, "src": "18191:19:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "18185:25:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159573, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159548, "src": "18228:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159574, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "18236:15:233", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159340, "src": "18228:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159575, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159548, "src": "18269:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159576, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "18277:22:233", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159342, "src": "18269:30:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159564, "name": "YieldSpaceMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 23292, "src": "18068:14:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_YieldSpaceMath_$23292_$", "typeString": "type(library YieldSpaceMath)" } }, "id": 159565, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "18083:5:233", "memberName": "kDown", "nodeType": "MemberAccess", "referencedDeclaration": 23291, "src": "18068:20:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256,uint256,uint256) pure returns (uint256)" } }, "id": 159577, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "18068:245:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "18055:258:233" }, { "expression": { "id": 159596, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 159579, "name": "inner", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159560, "src": "18327:5:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159594, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159591, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "18410:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 159592, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159548, "src": "18416:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159593, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "18424:7:233", "memberName": "flatFee", "nodeType": "MemberAccess", "referencedDeclaration": 159348, "src": "18416:15:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "18410:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159588, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "arguments": [{ "id": 159585, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159552, "src": "18368:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159583, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "18358:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159584, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "18362:5:233", "memberName": "divUp", "nodeType": "MemberAccess", "referencedDeclaration": 18790, "src": "18358:9:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159586, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "18358:21:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 159587, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "18382:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "18358:27:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 159580, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159548, "src": "18335:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159581, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "18343:8:233", "memberName": "curveFee", "nodeType": "MemberAccess", "referencedDeclaration": 159346, "src": "18335:16:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159582, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "18352:5:233", "memberName": "mulUp", "nodeType": "MemberAccess", "referencedDeclaration": 18772, "src": "18335:22:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159589, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "18335:51:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159590, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "18387:5:233", "memberName": "mulUp", "nodeType": "MemberAccess", "referencedDeclaration": 18772, "src": "18335:57:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159595, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "18335:110:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "18327:118:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159597, "nodeType": "ExpressionStatement", "src": "18327:118:233" }, { "expression": { "id": 159609, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 159598, "name": "inner", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159560, "src": "18459:5:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159607, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159604, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "18487:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 159605, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159548, "src": "18493:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159606, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "18501:7:233", "memberName": "flatFee", "nodeType": "MemberAccess", "referencedDeclaration": 159348, "src": "18493:15:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "18487:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159601, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159599, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "18468:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "id": 159600, "name": "inner", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159560, "src": "18474:5:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "18468:11:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 159602, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "18467:13:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159603, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "18481:5:233", "memberName": "divUp", "nodeType": "MemberAccess", "referencedDeclaration": 18790, "src": "18467:19:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159608, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "18467:42:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "18459:50:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159610, "nodeType": "ExpressionStatement", "src": "18459:50:233" }, { "expression": { "id": 159624, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 159611, "name": "inner", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159560, "src": "18523:5:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "arguments": [{ "expression": { "id": 159620, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159548, "src": "18594:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159621, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "18602:11:233", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159338, "src": "18594:19:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159617, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159614, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "18559:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 159615, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159548, "src": "18565:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159616, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "18573:11:233", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159338, "src": "18565:19:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "18559:25:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 159618, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "18558:27:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159619, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "18586:7:233", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "18558:35:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159622, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "18558:56:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159612, "name": "inner", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159560, "src": "18531:5:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159613, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "18537:3:233", "memberName": "pow", "nodeType": "MemberAccess", "referencedDeclaration": 18847, "src": "18531:9:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159623, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "18531:97:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "18523:105:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159625, "nodeType": "ExpressionStatement", "src": "18523:105:233" }, { "expression": { "id": 159633, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 159626, "name": "inner", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159560, "src": "18642:5:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "+=", "rightHandSide": { "arguments": [{ "expression": { "id": 159630, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159548, "src": "18698:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159631, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "18706:22:233", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159342, "src": "18698:30:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 159627, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159548, "src": "18651:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159628, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "18659:15:233", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159340, "src": "18651:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159629, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "18675:5:233", "memberName": "divUp", "nodeType": "MemberAccess", "referencedDeclaration": 18790, "src": "18651:29:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159632, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "18651:91:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "18642:100:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159634, "nodeType": "ExpressionStatement", "src": "18642:100:233" }, { "expression": { "id": 159640, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 159635, "name": "inner", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159560, "src": "18756:5:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 159638, "name": "inner", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159560, "src": "18775:5:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159636, "name": "k_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159563, "src": "18764:2:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159637, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "18767:7:233", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "18764:10:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159639, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "18764:17:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "18756:25:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159641, "nodeType": "ExpressionStatement", "src": "18756:25:233" }, { "expression": { "id": 159653, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 159642, "name": "inner", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159560, "src": "18795:5:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159650, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159647, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "18825:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 159648, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159548, "src": "18831:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159649, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "18839:11:233", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159338, "src": "18831:19:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "18825:25:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159645, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "18813:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159646, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "18817:7:233", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "18813:11:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159651, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "18813:38:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159643, "name": "inner", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159560, "src": "18803:5:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159644, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "18809:3:233", "memberName": "pow", "nodeType": "MemberAccess", "referencedDeclaration": 18847, "src": "18803:9:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159652, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "18803:49:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "18795:57:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159654, "nodeType": "ExpressionStatement", "src": "18795:57:233" }] }, { "assignments": [159657], "declarations": [{ "constant": false, "id": 159657, "mutability": "mutable", "name": "targetShareReserves", "nameLocation": "18880:19:233", "nodeType": "VariableDeclaration", "scope": 159737, "src": "18872:27:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159656, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "18872:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 159663, "initialValue": { "arguments": [{ "expression": { "id": 159660, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159548, "src": "18929:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159661, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "18937:22:233", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159342, "src": "18929:30:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159658, "name": "inner", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159560, "src": "18902:5:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159659, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "18908:7:233", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "18902:13:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159662, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "18902:67:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "18872:97:233" }, { "assignments": [159665], "declarations": [{ "constant": false, "id": 159665, "mutability": "mutable", "name": "targetBondReserves", "nameLocation": "19332:18:233", "nodeType": "VariableDeclaration", "scope": 159737, "src": "19324:26:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159664, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "19324:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 159666, "nodeType": "VariableDeclarationStatement", "src": "19324:26:233" }, { "id": 159710, "nodeType": "Block", "src": "19360:356:233", "statements": [{ "assignments": [159668], "declarations": [{ "constant": false, "id": 159668, "mutability": "mutable", "name": "feeAdjustment", "nameLocation": "19382:13:233", "nodeType": "VariableDeclaration", "scope": 159710, "src": "19374:21:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159667, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "19374:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 159685, "initialValue": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159683, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159680, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "19513:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 159681, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159548, "src": "19519:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159682, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "19527:7:233", "memberName": "flatFee", "nodeType": "MemberAccess", "referencedDeclaration": 159348, "src": "19519:15:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "19513:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159677, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "arguments": [{ "id": 159674, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159552, "src": "19469:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159672, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "19457:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159673, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "19461:7:233", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "19457:11:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159675, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "19457:23:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 159676, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "19483:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "19457:29:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 159669, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159548, "src": "19398:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159670, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "19423:8:233", "memberName": "curveFee", "nodeType": "MemberAccess", "referencedDeclaration": 159346, "src": "19398:33:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159671, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "19449:7:233", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "19398:58:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159678, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "19398:89:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159679, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "19505:7:233", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "19398:114:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159684, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "19398:137:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "19374:161:233" }, { "expression": { "id": 159708, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 159686, "name": "targetBondReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159665, "src": "19549:18:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 159706, "name": "inner", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159560, "src": "19699:5:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "arguments": [{ "expression": { "id": 159701, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159548, "src": "19669:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159702, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "19677:11:233", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159338, "src": "19669:19:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159699, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "19659:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159700, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "19663:5:233", "memberName": "divUp", "nodeType": "MemberAccess", "referencedDeclaration": 18790, "src": "19659:9:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159703, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "19659:30:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "components": [{ "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159695, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159692, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "19618:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 159693, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159548, "src": "19624:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159694, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "19632:7:233", "memberName": "flatFee", "nodeType": "MemberAccess", "referencedDeclaration": 159348, "src": "19624:15:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "19618:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159689, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159687, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "19589:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "id": 159688, "name": "feeAdjustment", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159668, "src": "19595:13:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "19589:19:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 159690, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "19588:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159691, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "19610:7:233", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "19588:29:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159696, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "19588:52:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 159697, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "19570:84:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159698, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "19655:3:233", "memberName": "pow", "nodeType": "MemberAccess", "referencedDeclaration": 18847, "src": "19570:88:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159704, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "19570:120:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159705, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "19691:7:233", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "19570:128:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159707, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "19570:135:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "19549:156:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159709, "nodeType": "ExpressionStatement", "src": "19549:156:233" }] }, { "expression": { "id": 159720, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 159711, "name": "absoluteMaxBaseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159555, "src": "19839:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "expression": { "id": 159717, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159548, "src": "19932:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159718, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "19940:15:233", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159340, "src": "19932:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159714, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159712, "name": "targetShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159657, "src": "19864:19:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 159713, "name": "_effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159550, "src": "19886:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "19864:45:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 159715, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "19863:47:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159716, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "19924:7:233", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "19863:68:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159719, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "19863:93:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "19839:117:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159721, "nodeType": "ExpressionStatement", "src": "19839:117:233" }, { "expression": { "id": 159735, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 159722, "name": "absoluteMaxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159557, "src": "20083:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159734, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159726, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "expression": { "id": 159723, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159548, "src": "20120:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159724, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "20128:12:233", "memberName": "bondReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159332, "src": "20120:20:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 159725, "name": "targetBondReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159665, "src": "20143:18:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "20120:41:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 159727, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "20119:43:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [{ "id": 159729, "name": "absoluteMaxBaseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159555, "src": "20216:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159730, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159552, "src": "20255:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159731, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159548, "src": "20283:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159732, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "20291:8:233", "memberName": "curveFee", "nodeType": "MemberAccess", "referencedDeclaration": 159346, "src": "20283:16:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159728, "name": "calculateLongCurveFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160265, "src": "20177:21:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 159733, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "20177:136:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "20119:194:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "20083:230:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159736, "nodeType": "ExpressionStatement", "src": "20083:230:233" }] }, "documentation": { "id": 159545, "nodeType": "StructuredDocumentation", "src": "16001:591:233", "text": "@dev Calculates the largest long that can be opened without buying bonds\n      at a negative interest rate. This calculation does not take\n      Hyperdrive's solvency constraints into account and shouldn't be\n      used directly.\n @param _params The parameters for the max long calculation.\n @param _effectiveShareReserves The pool's effective share reserves.\n @param _spotPrice The pool's spot price.\n @return absoluteMaxBaseAmount The absolute maximum base amount.\n @return absoluteMaxBondAmount The absolute maximum bond amount." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateAbsoluteMaxLong", "nameLocation": "16606:24:233", "parameters": { "id": 159553, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159548, "mutability": "mutable", "name": "_params", "nameLocation": "16662:7:233", "nodeType": "VariableDeclaration", "scope": 159738, "src": "16640:29:233", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" }, "typeName": { "id": 159547, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 159546, "name": "MaxTradeParams", "nameLocations": ["16640:14:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 159351, "src": "16640:14:233" }, "referencedDeclaration": 159351, "src": "16640:14:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_storage_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" } }, "visibility": "internal" }, { "constant": false, "id": 159550, "mutability": "mutable", "name": "_effectiveShareReserves", "nameLocation": "16687:23:233", "nodeType": "VariableDeclaration", "scope": 159738, "src": "16679:31:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159549, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "16679:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159552, "mutability": "mutable", "name": "_spotPrice", "nameLocation": "16728:10:233", "nodeType": "VariableDeclaration", "scope": 159738, "src": "16720:18:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159551, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "16720:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "16630:114:233" }, "returnParameters": { "id": 159558, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159555, "mutability": "mutable", "name": "absoluteMaxBaseAmount", "nameLocation": "16800:21:233", "nodeType": "VariableDeclaration", "scope": 159738, "src": "16792:29:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159554, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "16792:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159557, "mutability": "mutable", "name": "absoluteMaxBondAmount", "nameLocation": "16831:21:233", "nodeType": "VariableDeclaration", "scope": 159738, "src": "16823:29:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159556, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "16823:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "16791:62:233" }, "scope": 161325, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 159807, "nodeType": "FunctionDefinition", "src": "20970:1484:233", "nodes": [], "body": { "id": 159806, "nodeType": "Block", "src": "21182:1272:233", "nodes": [], "statements": [{ "assignments": [159754], "declarations": [{ "constant": false, "id": 159754, "mutability": "mutable", "name": "guess", "nameLocation": "21313:5:233", "nodeType": "VariableDeclaration", "scope": 159806, "src": "21305:13:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159753, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "21305:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 159761, "initialValue": { "arguments": [{ "id": 159756, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159742, "src": "21359:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, { "id": 159757, "name": "_checkpointExposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159746, "src": "21380:19:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, { "id": 159758, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159748, "src": "21413:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159759, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159748, "src": "21437:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" }, { "typeIdentifier": "t_int256", "typeString": "int256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159755, "name": "calculateMaxLongEstimate", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159898, "src": "21321:24:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_MaxTradeParams_$159351_memory_ptr_$_t_int256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (struct HyperdriveUtils.MaxTradeParams memory,int256,uint256,uint256) pure returns (uint256)" } }, "id": 159760, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "21321:136:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "21305:152:233" }, { "assignments": [159763], "declarations": [{ "constant": false, "id": 159763, "mutability": "mutable", "name": "t", "nameLocation": "21909:1:233", "nodeType": "VariableDeclaration", "scope": 159806, "src": "21901:9:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159762, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "21901:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 159780, "initialValue": { "arguments": [{ "hexValue": "302e38653138", "id": 159778, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "22040:6:233", "typeDescriptions": { "typeIdentifier": "t_rational_800000000000000000_by_1", "typeString": "int_const 800000000000000000" }, "value": "0.8e18" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_rational_800000000000000000_by_1", "typeString": "int_const 800000000000000000" }], "expression": { "arguments": [{ "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159774, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159771, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "21991:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 159772, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159742, "src": "21997:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159773, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "22005:11:233", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159338, "src": "21997:19:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "21991:25:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159769, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "21981:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159770, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "21985:5:233", "memberName": "divUp", "nodeType": "MemberAccess", "referencedDeclaration": 18790, "src": "21981:9:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159775, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "21981:36:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "id": 159766, "name": "_absoluteMaxBaseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159744, "src": "21940:22:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159764, "name": "guess", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159754, "src": "21913:5:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159765, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "21932:7:233", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "21913:26:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159767, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "21913:50:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159768, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "21977:3:233", "memberName": "pow", "nodeType": "MemberAccess", "referencedDeclaration": 18847, "src": "21913:67:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159776, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "21913:105:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159777, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "22032:7:233", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "21913:126:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159779, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "21913:134:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "21901:146:233" }, { "assignments": [159782], "declarations": [{ "constant": false, "id": 159782, "mutability": "mutable", "name": "estimateSpotPrice", "nameLocation": "22065:17:233", "nodeType": "VariableDeclaration", "scope": 159806, "src": "22057:25:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159781, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "22057:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 159794, "initialValue": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159793, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159787, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159785, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "22104:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 159786, "name": "t", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159763, "src": "22110:1:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "22104:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159783, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159748, "src": "22085:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159784, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "22096:7:233", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "22085:18:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159788, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "22085:27:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "arguments": [{ "id": 159791, "name": "t", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159763, "src": "22139:1:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159789, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "22127:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159790, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "22131:7:233", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "22127:11:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159792, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "22127:14:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "22085:56:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "22057:84:233" }, { "expression": { "id": 159802, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 159795, "name": "guess", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159754, "src": "22273:5:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 159797, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159742, "src": "22319:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, { "id": 159798, "name": "_checkpointExposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159746, "src": "22340:19:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, { "id": 159799, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159748, "src": "22373:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159800, "name": "estimateSpotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159782, "src": "22397:17:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" }, { "typeIdentifier": "t_int256", "typeString": "int256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159796, "name": "calculateMaxLongEstimate", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159898, "src": "22281:24:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_MaxTradeParams_$159351_memory_ptr_$_t_int256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (struct HyperdriveUtils.MaxTradeParams memory,int256,uint256,uint256) pure returns (uint256)" } }, "id": 159801, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "22281:143:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "22273:151:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159803, "nodeType": "ExpressionStatement", "src": "22273:151:233" }, { "expression": { "id": 159804, "name": "guess", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159754, "src": "22442:5:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 159752, "id": 159805, "nodeType": "Return", "src": "22435:12:233" }] }, "documentation": { "id": 159739, "nodeType": "StructuredDocumentation", "src": "20326:639:233", "text": "@dev Calculates an initial guess of the max long that can be opened.\n      This is a reasonable estimate that is guaranteed to be less than\n      the true max long. We use this to get a reasonable starting point\n      for Newton's method.\n @param _params The max long calculation parameters.\n @param _absoluteMaxBaseAmount The absolute max base amount that can be\n        used to open a long.\n @param _checkpointExposure The exposure in the checkpoint.\n @param _spotPrice The spot price of the pool.\n @return A conservative estimate of the max long that the pool can open." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateMaxLongGuess", "nameLocation": "20979:21:233", "parameters": { "id": 159749, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159742, "mutability": "mutable", "name": "_params", "nameLocation": "21032:7:233", "nodeType": "VariableDeclaration", "scope": 159807, "src": "21010:29:233", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" }, "typeName": { "id": 159741, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 159740, "name": "MaxTradeParams", "nameLocations": ["21010:14:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 159351, "src": "21010:14:233" }, "referencedDeclaration": 159351, "src": "21010:14:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_storage_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" } }, "visibility": "internal" }, { "constant": false, "id": 159744, "mutability": "mutable", "name": "_absoluteMaxBaseAmount", "nameLocation": "21057:22:233", "nodeType": "VariableDeclaration", "scope": 159807, "src": "21049:30:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159743, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "21049:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159746, "mutability": "mutable", "name": "_checkpointExposure", "nameLocation": "21096:19:233", "nodeType": "VariableDeclaration", "scope": 159807, "src": "21089:26:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" }, "typeName": { "id": 159745, "name": "int256", "nodeType": "ElementaryTypeName", "src": "21089:6:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "visibility": "internal" }, { "constant": false, "id": 159748, "mutability": "mutable", "name": "_spotPrice", "nameLocation": "21133:10:233", "nodeType": "VariableDeclaration", "scope": 159807, "src": "21125:18:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159747, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "21125:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "21000:149:233" }, "returnParameters": { "id": 159752, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159751, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 159807, "src": "21173:7:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159750, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "21173:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "21172:9:233" }, "scope": 161325, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 159898, "nodeType": "FunctionDefinition", "src": "24388:947:233", "nodes": [], "body": { "id": 159897, "nodeType": "Block", "src": "24595:740:233", "nodes": [], "statements": [{ "assignments": [159823], "declarations": [{ "constant": false, "id": 159823, "mutability": "mutable", "name": "checkpointExposure", "nameLocation": "24613:18:233", "nodeType": "VariableDeclaration", "scope": 159897, "src": "24605:26:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159822, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "24605:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 159832, "initialValue": { "arguments": [{ "id": 159830, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "UnaryOperation", "operator": "-", "prefix": true, "src": "24642:27:233", "subExpression": { "arguments": [{ "hexValue": "30", "id": 159828, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "24667:1:233", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }], "expression": { "id": 159826, "name": "_checkpointExposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159813, "src": "24643:19:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "id": 159827, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "24663:3:233", "memberName": "min", "nodeType": "MemberAccess", "referencedDeclaration": 19423, "src": "24643:23:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_int256_$_t_int256_$returns$_t_int256_$attached_to$_t_int256_$", "typeString": "function (int256,int256) pure returns (int256)" } }, "id": 159829, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "24643:26:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 159825, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "24634:7:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_uint256_$", "typeString": "type(uint256)" }, "typeName": { "id": 159824, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "24634:7:233", "typeDescriptions": {} } }, "id": 159831, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "24634:36:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "24605:65:233" }, { "assignments": [159834], "declarations": [{ "constant": false, "id": 159834, "mutability": "mutable", "name": "estimate", "nameLocation": "24688:8:233", "nodeType": "VariableDeclaration", "scope": 159897, "src": "24680:16:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159833, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "24680:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 159859, "initialValue": { "arguments": [{ "expression": { "id": 159855, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159811, "src": "24928:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159856, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "24936:15:233", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159340, "src": "24928:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "hexValue": "32653138", "id": 159857, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "24969:4:233", "typeDescriptions": { "typeIdentifier": "t_rational_2000000000000000000_by_1", "typeString": "int_const 2000000000000000000" }, "value": "2e18" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_rational_2000000000000000000_by_1", "typeString": "int_const 2000000000000000000" }], "expression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159852, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159849, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159842, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "expression": { "id": 159835, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159811, "src": "24700:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159836, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "24708:13:233", "memberName": "shareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159328, "src": "24700:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "arguments": [{ "expression": { "id": 159839, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159811, "src": "24763:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159840, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "24771:15:233", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159340, "src": "24763:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159837, "name": "checkpointExposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159823, "src": "24736:18:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159838, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "24755:7:233", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "24736:26:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159841, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "24736:51:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "24700:87:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [{ "expression": { "id": 159846, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159811, "src": "24831:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159847, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "24839:15:233", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159340, "src": "24831:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 159843, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159811, "src": "24802:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159844, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "24810:12:233", "memberName": "longExposure", "nodeType": "MemberAccess", "referencedDeclaration": 159336, "src": "24802:20:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159845, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "24823:7:233", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "24802:28:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159848, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "24802:53:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "24700:155:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 159850, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159811, "src": "24870:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159851, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "24878:20:233", "memberName": "minimumShareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159344, "src": "24870:28:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "24700:198:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 159853, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "24699:200:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159854, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "24900:10:233", "memberName": "mulDivDown", "nodeType": "MemberAccess", "referencedDeclaration": 18704, "src": "24699:211:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 159858, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "24699:288:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "24680:307:233" }, { "expression": { "id": 159893, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 159860, "name": "estimate", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159834, "src": "24997:8:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159891, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159880, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159878, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "arguments": [{ "id": 159865, "name": "_estimatePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159817, "src": "25050:14:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159863, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "25038:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159864, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "25042:7:233", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "25038:11:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159866, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "25038:27:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159876, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159874, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "25163:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 159875, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159815, "src": "25169:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "25163:16:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "expression": { "id": 159870, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159811, "src": "25116:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159871, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "25124:8:233", "memberName": "curveFee", "nodeType": "MemberAccess", "referencedDeclaration": 159346, "src": "25116:16:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 159867, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159811, "src": "25084:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159868, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "25092:15:233", "memberName": "governanceLPFee", "nodeType": "MemberAccess", "referencedDeclaration": 159350, "src": "25084:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159869, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "25108:7:233", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "25084:31:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159872, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "25084:49:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159873, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "25134:7:233", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "25084:57:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159877, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "25084:113:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "25038:159:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 159879, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "25216:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "25038:181:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159889, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "arguments": [{ "id": 159886, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159815, "src": "25275:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159884, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "25263:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159885, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "25267:7:233", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "25263:11:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159887, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "25263:23:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 159888, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "25289:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "25263:29:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 159881, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159811, "src": "25238:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159882, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "25246:8:233", "memberName": "curveFee", "nodeType": "MemberAccess", "referencedDeclaration": 159346, "src": "25238:16:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159883, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "25255:7:233", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "25238:24:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159890, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "25238:55:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "25038:255:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159861, "name": "estimate", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159834, "src": "25008:8:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159862, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "25017:7:233", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "25008:16:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159892, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "25008:295:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "24997:306:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159894, "nodeType": "ExpressionStatement", "src": "24997:306:233" }, { "expression": { "id": 159895, "name": "estimate", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159834, "src": "25320:8:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 159821, "id": 159896, "nodeType": "Return", "src": "25313:15:233" }] }, "documentation": { "id": 159808, "nodeType": "StructuredDocumentation", "src": "22460:1923:233", "text": "@dev Estimates the max long based on the pool's current solvency and a\n      conservative price estimate, $p_r$.\n      We can use our estimate price $p_r$ to approximate $y(x)$ as\n      $y(x) \\approx p_r^{-1} \\cdot x - c(x)$. Plugging this into our\n      solvency function $s(x)$, we can calculate the share reserves and\n      exposure after opening a long with $x$ base as:\n      \\begin{aligned}\n      z(x) &= z_0 + \\tfrac{x - g(x)}{c} - z_{min} \\\\\n      e(x) &= e_0 + min(exposure_{c}, 0) + 2 \\cdot y(x) - x + g(x) \\\\\n           &= e_0 + min(exposure_{c}, 0) + 2 \\cdot p_r^{-1} \\cdot x -\n                  2 \\cdot c(x) - x + g(x)\n      \\end{aligned}\n      We debit and negative checkpoint exposure from $e_0$ since the\n      global exposure doesn't take into account the negative exposure\n      from non-netted shorts in the checkpoint. These formulas allow us\n      to calculate the approximate ending solvency of:\n      $$\n      s(x) \\approx z(x) - \\tfrac{e(x)}{c} - z_{min}\n      $$\n      If we let the initial solvency be given by $s_0$, we can solve for\n      $x$ as:\n      $$\n      x = \\frac{c}{2} \\cdot \\frac{s_0 + min(exposure_{c}, 0)}{\n              p_r^{-1} +\n              \\phi_{g} \\cdot \\phi_{c} \\cdot \\left( 1 - p \\right) -\n              1 -\n              \\phi_{c} \\cdot \\left( p^{-1} - 1 \\right)\n          }\n      $$\n @param _params The max long calculation parameters.\n @param _checkpointExposure The exposure in the checkpoint.\n @param _spotPrice The spot price of the pool.\n @param _estimatePrice The estimated realized price the max long will pay.\n @return A conservative estimate of the max long that the pool can open." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateMaxLongEstimate", "nameLocation": "24397:24:233", "parameters": { "id": 159818, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159811, "mutability": "mutable", "name": "_params", "nameLocation": "24453:7:233", "nodeType": "VariableDeclaration", "scope": 159898, "src": "24431:29:233", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" }, "typeName": { "id": 159810, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 159809, "name": "MaxTradeParams", "nameLocations": ["24431:14:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 159351, "src": "24431:14:233" }, "referencedDeclaration": 159351, "src": "24431:14:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_storage_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" } }, "visibility": "internal" }, { "constant": false, "id": 159813, "mutability": "mutable", "name": "_checkpointExposure", "nameLocation": "24477:19:233", "nodeType": "VariableDeclaration", "scope": 159898, "src": "24470:26:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" }, "typeName": { "id": 159812, "name": "int256", "nodeType": "ElementaryTypeName", "src": "24470:6:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "visibility": "internal" }, { "constant": false, "id": 159815, "mutability": "mutable", "name": "_spotPrice", "nameLocation": "24514:10:233", "nodeType": "VariableDeclaration", "scope": 159898, "src": "24506:18:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159814, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "24506:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159817, "mutability": "mutable", "name": "_estimatePrice", "nameLocation": "24542:14:233", "nodeType": "VariableDeclaration", "scope": 159898, "src": "24534:22:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159816, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "24534:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "24421:141:233" }, "returnParameters": { "id": 159821, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159820, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 159898, "src": "24586:7:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159819, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "24586:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "24585:9:233" }, "scope": 161325, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 160006, "nodeType": "FunctionDefinition", "src": "27211:1307:233", "nodes": [], "body": { "id": 160005, "nodeType": "Block", "src": "27452:1066:233", "nodes": [], "statements": [{ "assignments": [159918], "declarations": [{ "constant": false, "id": 159918, "mutability": "mutable", "name": "governanceFee", "nameLocation": "27470:13:233", "nodeType": "VariableDeclaration", "scope": 160005, "src": "27462:21:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159917, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "27462:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 159927, "initialValue": { "arguments": [{ "id": 159920, "name": "_baseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159906, "src": "27526:11:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 159921, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159910, "src": "27551:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159922, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159902, "src": "27575:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159923, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "27583:8:233", "memberName": "curveFee", "nodeType": "MemberAccess", "referencedDeclaration": 159346, "src": "27575:16:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 159924, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159902, "src": "27605:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159925, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "27613:15:233", "memberName": "governanceLPFee", "nodeType": "MemberAccess", "referencedDeclaration": 159350, "src": "27605:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 159919, "name": "calculateLongGovernanceFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160292, "src": "27486:26:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256,uint256) pure returns (uint256)" } }, "id": 159926, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "27486:152:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "27462:176:233" }, { "assignments": [159929], "declarations": [{ "constant": false, "id": 159929, "mutability": "mutable", "name": "shareReserves", "nameLocation": "27656:13:233", "nodeType": "VariableDeclaration", "scope": 160005, "src": "27648:21:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159928, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "27648:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 159944, "initialValue": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159943, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159937, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "expression": { "id": 159930, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159902, "src": "27672:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159931, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "27680:13:233", "memberName": "shareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159328, "src": "27672:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "arguments": [{ "expression": { "id": 159934, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159902, "src": "27728:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159935, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "27736:15:233", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159340, "src": "27728:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159932, "name": "_baseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159906, "src": "27708:11:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159933, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "27720:7:233", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "27708:19:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159936, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "27708:44:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "27672:80:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [{ "expression": { "id": 159940, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159902, "src": "27789:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159941, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "27797:15:233", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159340, "src": "27789:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159938, "name": "governanceFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159918, "src": "27767:13:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159939, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "27781:7:233", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "27767:21:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159942, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "27767:46:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "27672:141:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "27648:165:233" }, { "assignments": [159946], "declarations": [{ "constant": false, "id": 159946, "mutability": "mutable", "name": "exposure", "nameLocation": "27831:8:233", "nodeType": "VariableDeclaration", "scope": 160005, "src": "27823:16:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159945, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "27823:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 159951, "initialValue": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159950, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "expression": { "id": 159947, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159902, "src": "27842:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159948, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "27850:12:233", "memberName": "longExposure", "nodeType": "MemberAccess", "referencedDeclaration": 159336, "src": "27842:20:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "id": 159949, "name": "_bondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159908, "src": "27865:11:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "27842:34:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "27823:53:233" }, { "assignments": [159953], "declarations": [{ "constant": false, "id": 159953, "mutability": "mutable", "name": "checkpointExposure", "nameLocation": "27894:18:233", "nodeType": "VariableDeclaration", "scope": 160005, "src": "27886:26:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159952, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "27886:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 159962, "initialValue": { "arguments": [{ "id": 159960, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "UnaryOperation", "operator": "-", "prefix": true, "src": "27923:27:233", "subExpression": { "arguments": [{ "hexValue": "30", "id": 159958, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "27948:1:233", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }], "expression": { "id": 159956, "name": "_checkpointExposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159904, "src": "27924:19:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "id": 159957, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "27944:3:233", "memberName": "min", "nodeType": "MemberAccess", "referencedDeclaration": 19423, "src": "27924:23:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_int256_$_t_int256_$returns$_t_int256_$attached_to$_t_int256_$", "typeString": "function (int256,int256) pure returns (int256)" } }, "id": 159959, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "27924:26:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 159955, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "27915:7:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_uint256_$", "typeString": "type(uint256)" }, "typeName": { "id": 159954, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "27915:7:233", "typeDescriptions": {} } }, "id": 159961, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "27915:36:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "27886:65:233" }, { "condition": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159978, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159969, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159963, "name": "shareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159929, "src": "27978:13:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "arguments": [{ "expression": { "id": 159966, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159902, "src": "28037:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159967, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "28045:15:233", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159340, "src": "28037:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159964, "name": "checkpointExposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159953, "src": "28010:18:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159965, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "28029:7:233", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "28010:26:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159968, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "28010:51:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "27978:83:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": ">=", "rightExpression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159977, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "arguments": [{ "expression": { "id": 159972, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159902, "src": "28094:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159973, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "28102:15:233", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159340, "src": "28094:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159970, "name": "exposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159946, "src": "28077:8:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159971, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "28086:7:233", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "28077:16:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159974, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "28077:41:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "expression": { "id": 159975, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159902, "src": "28137:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159976, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "28145:20:233", "memberName": "minimumShareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159344, "src": "28137:28:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "28077:88:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "27978:187:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "falseBody": { "id": 160003, "nodeType": "Block", "src": "28470:42:233", "statements": [{ "expression": { "components": [{ "hexValue": "30", "id": 159999, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "28492:1:233", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }, { "hexValue": "66616c7365", "id": 160000, "isConstant": false, "isLValue": false, "isPure": true, "kind": "bool", "lValueRequested": false, "nodeType": "Literal", "src": "28495:5:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "value": "false" }], "id": 160001, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "TupleExpression", "src": "28491:10:233", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_rational_0_by_1_$_t_bool_$", "typeString": "tuple(int_const 0,bool)" } }, "functionReturnParameters": 159916, "id": 160002, "nodeType": "Return", "src": "28484:17:233" }] }, "id": 160004, "nodeType": "IfStatement", "src": "27961:551:233", "trueBody": { "id": 159998, "nodeType": "Block", "src": "28176:288:233", "statements": [{ "expression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159994, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159991, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 159985, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 159979, "name": "shareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159929, "src": "28215:13:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "arguments": [{ "expression": { "id": 159982, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159902, "src": "28278:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159983, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "28286:15:233", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159340, "src": "28278:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159980, "name": "checkpointExposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159953, "src": "28251:18:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159981, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "28270:7:233", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "28251:26:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159984, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "28251:51:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "28215:87:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [{ "expression": { "id": 159988, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159902, "src": "28342:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159989, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "28350:15:233", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159340, "src": "28342:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 159986, "name": "exposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159946, "src": "28325:8:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 159987, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "28334:7:233", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "28325:16:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 159990, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "28325:41:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "28215:151:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 159992, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 159902, "src": "28389:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 159993, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "28397:20:233", "memberName": "minimumShareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159344, "src": "28389:28:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "28215:202:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "hexValue": "74727565", "id": 159995, "isConstant": false, "isLValue": false, "isPure": true, "kind": "bool", "lValueRequested": false, "nodeType": "Literal", "src": "28435:4:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "value": "true" }], "id": 159996, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "28197:256:233", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "functionReturnParameters": 159916, "id": 159997, "nodeType": "Return", "src": "28190:263:233" }] } }] }, "documentation": { "id": 159899, "nodeType": "StructuredDocumentation", "src": "25341:1865:233", "text": "@dev Gets the solvency of the pool $S(x)$ after a long is opened with a\n      base amount $x$.\n      Since longs can net out with shorts in this checkpoint, we decrease\n      the global exposure variable by any negative exposure we have\n      in the checkpoint. The pool's solvency is calculated as:\n      $$\n      s = z - \\tfrac{exposure + min(exposure_{checkpoint}, 0)}{c} - z_{min}\n      $$\n      When a long is opened, the share reserves $z$ increase by:\n      $$\n      \\Delta z = \\tfrac{x - g(x)}{c}\n      $$\n      Opening the long increases the non-netted longs by the bond amount.\n      From this, the change in the exposure is given by:\n      $$\n      \\Delta exposure = y(x)\n      $$\n      From this, we can calculate $S(x)$ as:\n      $$\n      S(x) = \\left( z + \\Delta z \\right) - \\left(\n                 \\tfrac{\n                     exposure +\n                     min(exposure_{checkpoint}, 0) +\n                     \\Delta exposure\n                 }{c}\n             \\right) - z_{min}\n      $$\n      It's possible that the pool is insolvent after opening a long. In\n      this case, we return `None` since the fixed point library can't\n      represent negative numbers.\n @param _params The max long calculation parameters.\n @param _checkpointExposure The exposure in the checkpoint.\n @param _baseAmount The base amount.\n @param _bondAmount The bond amount.\n @param _spotPrice The spot price.\n @return The solvency of the pool.\n @return A flag indicating that the pool is solvent if true and insolvent\n         if false." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateSolvencyAfterLong", "nameLocation": "27220:26:233", "parameters": { "id": 159911, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159902, "mutability": "mutable", "name": "_params", "nameLocation": "27278:7:233", "nodeType": "VariableDeclaration", "scope": 160006, "src": "27256:29:233", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" }, "typeName": { "id": 159901, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 159900, "name": "MaxTradeParams", "nameLocations": ["27256:14:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 159351, "src": "27256:14:233" }, "referencedDeclaration": 159351, "src": "27256:14:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_storage_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" } }, "visibility": "internal" }, { "constant": false, "id": 159904, "mutability": "mutable", "name": "_checkpointExposure", "nameLocation": "27302:19:233", "nodeType": "VariableDeclaration", "scope": 160006, "src": "27295:26:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" }, "typeName": { "id": 159903, "name": "int256", "nodeType": "ElementaryTypeName", "src": "27295:6:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "visibility": "internal" }, { "constant": false, "id": 159906, "mutability": "mutable", "name": "_baseAmount", "nameLocation": "27339:11:233", "nodeType": "VariableDeclaration", "scope": 160006, "src": "27331:19:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159905, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "27331:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159908, "mutability": "mutable", "name": "_bondAmount", "nameLocation": "27368:11:233", "nodeType": "VariableDeclaration", "scope": 160006, "src": "27360:19:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159907, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "27360:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159910, "mutability": "mutable", "name": "_spotPrice", "nameLocation": "27397:10:233", "nodeType": "VariableDeclaration", "scope": 160006, "src": "27389:18:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159909, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "27389:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "27246:167:233" }, "returnParameters": { "id": 159916, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 159913, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 160006, "src": "27437:7:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 159912, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "27437:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 159915, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 160006, "src": "27446:4:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "typeName": { "id": 159914, "name": "bool", "nodeType": "ElementaryTypeName", "src": "27446:4:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "visibility": "internal" }], "src": "27436:15:233" }, "scope": 161325, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 160070, "nodeType": "FunctionDefinition", "src": "29903:929:233", "nodes": [], "body": { "id": 160069, "nodeType": "Block", "src": "30149:683:233", "nodes": [], "statements": [{ "expression": { "id": 160032, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "components": [{ "id": 160023, "name": "derivative", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160019, "src": "30315:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160024, "name": "success", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160021, "src": "30327:7:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }], "id": 160025, "isConstant": false, "isInlineArray": false, "isLValue": true, "isPure": false, "lValueRequested": true, "nodeType": "TupleExpression", "src": "30314:21:233", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 160027, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160010, "src": "30381:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, { "id": 160028, "name": "_baseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160012, "src": "30402:11:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160029, "name": "_effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160014, "src": "30427:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160030, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160016, "src": "30464:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 160026, "name": "calculateLongAmountDerivative", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160239, "src": "30338:29:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_MaxTradeParams_$159351_memory_ptr_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$_t_bool_$", "typeString": "function (struct HyperdriveUtils.MaxTradeParams memory,uint256,uint256,uint256) pure returns (uint256,bool)" } }, "id": 160031, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "30338:146:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "src": "30314:170:233", "typeDescriptions": { "typeIdentifier": "t_tuple$__$", "typeString": "tuple()" } }, "id": 160033, "nodeType": "ExpressionStatement", "src": "30314:170:233" }, { "condition": { "id": 160035, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "UnaryOperation", "operator": "!", "prefix": true, "src": "30498:8:233", "subExpression": { "id": 160034, "name": "success", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160021, "src": "30499:7:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "id": 160041, "nodeType": "IfStatement", "src": "30494:58:233", "trueBody": { "id": 160040, "nodeType": "Block", "src": "30508:44:233", "statements": [{ "expression": { "components": [{ "hexValue": "30", "id": 160036, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "30530:1:233", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }, { "id": 160037, "name": "success", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160021, "src": "30533:7:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }], "id": 160038, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "30529:12:233", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_rational_0_by_1_$_t_bool_$", "typeString": "tuple(int_const 0,bool)" } }, "functionReturnParameters": 160022, "id": 160039, "nodeType": "Return", "src": "30522:19:233" }] } }, { "expression": { "id": 160054, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 160042, "name": "derivative", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160019, "src": "30606:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "+=", "rightHandSide": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160052, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160050, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "30691:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 160051, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160016, "src": "30697:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "30691:16:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "expression": { "id": 160046, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160010, "src": "30652:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160047, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "30660:8:233", "memberName": "curveFee", "nodeType": "MemberAccess", "referencedDeclaration": 159346, "src": "30652:16:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 160043, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160010, "src": "30620:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160044, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "30628:15:233", "memberName": "governanceLPFee", "nodeType": "MemberAccess", "referencedDeclaration": 159350, "src": "30620:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160045, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "30644:7:233", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "30620:31:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160048, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "30620:49:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160049, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "30670:7:233", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "30620:57:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160053, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "30620:97:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "30606:111:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160055, "nodeType": "ExpressionStatement", "src": "30606:111:233" }, { "expression": { "id": 160058, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 160056, "name": "derivative", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160019, "src": "30727:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "-=", "rightHandSide": { "id": 160057, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "30741:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "30727:17:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160059, "nodeType": "ExpressionStatement", "src": "30727:17:233" }, { "expression": { "components": [{ "arguments": [{ "hexValue": "31653138", "id": 160062, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "30785:4:233", "typeDescriptions": { "typeIdentifier": "t_rational_1000000000000000000_by_1", "typeString": "int_const 1000000000000000000" }, "value": "1e18" }, { "expression": { "id": 160063, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160010, "src": "30791:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160064, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "30799:15:233", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159340, "src": "30791:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_rational_1000000000000000000_by_1", "typeString": "int_const 1000000000000000000" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160060, "name": "derivative", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160019, "src": "30763:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160061, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "30774:10:233", "memberName": "mulDivDown", "nodeType": "MemberAccess", "referencedDeclaration": 18704, "src": "30763:21:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 160065, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "30763:52:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160066, "name": "success", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160021, "src": "30817:7:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }], "id": 160067, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "30762:63:233", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "functionReturnParameters": 160022, "id": 160068, "nodeType": "Return", "src": "30755:70:233" }] }, "documentation": { "id": 160007, "nodeType": "StructuredDocumentation", "src": "28524:1374:233", "text": "@dev Gets the negation of the derivative of the pool's solvency with\n      respect to the base amount that the long pays.\n      The derivative of the pool's solvency $S(x)$ with respect to the\n      base amount that the long pays is given by:\n      $$\n      S'(x) = \\tfrac{1}{c} \\cdot \\left(\n                  1 - y'(x) - \\phi_{g} \\cdot p \\cdot c'(x)\n              \\right) \\\\\n            = \\tfrac{1}{c} \\cdot \\left(\n                  1 - y'(x) - \\phi_{g} \\cdot \\phi_{c} \\cdot \\left(\n                      1 - p\n                  \\right)\n              \\right)\n      $$\n      This derivative is negative since solvency decreases as more longs\n      are opened. We use the negation of the derivative to stay in the\n      positive domain, which allows us to use the fixed point library.\n @param _params The max long calculation parameters.\n @param _baseAmount The base amount.\n @param _effectiveShareReserves The effective share reserves.\n @param _spotPrice The spot price.\n @return derivative The negation of the derivative of the pool's solvency\n         w.r.t the base amount.\n @return success A flag indicating whether or not the derivative was\n         successfully calculated." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateSolvencyAfterLongDerivative", "nameLocation": "29912:36:233", "parameters": { "id": 160017, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160010, "mutability": "mutable", "name": "_params", "nameLocation": "29980:7:233", "nodeType": "VariableDeclaration", "scope": 160070, "src": "29958:29:233", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" }, "typeName": { "id": 160009, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 160008, "name": "MaxTradeParams", "nameLocations": ["29958:14:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 159351, "src": "29958:14:233" }, "referencedDeclaration": 159351, "src": "29958:14:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_storage_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" } }, "visibility": "internal" }, { "constant": false, "id": 160012, "mutability": "mutable", "name": "_baseAmount", "nameLocation": "30005:11:233", "nodeType": "VariableDeclaration", "scope": 160070, "src": "29997:19:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160011, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "29997:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160014, "mutability": "mutable", "name": "_effectiveShareReserves", "nameLocation": "30034:23:233", "nodeType": "VariableDeclaration", "scope": 160070, "src": "30026:31:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160013, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "30026:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160016, "mutability": "mutable", "name": "_spotPrice", "nameLocation": "30075:10:233", "nodeType": "VariableDeclaration", "scope": 160070, "src": "30067:18:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160015, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "30067:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "29948:143:233" }, "returnParameters": { "id": 160022, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160019, "mutability": "mutable", "name": "derivative", "nameLocation": "30123:10:233", "nodeType": "VariableDeclaration", "scope": 160070, "src": "30115:18:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160018, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "30115:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160021, "mutability": "mutable", "name": "success", "nameLocation": "30140:7:233", "nodeType": "VariableDeclaration", "scope": 160070, "src": "30135:12:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "typeName": { "id": 160020, "name": "bool", "nodeType": "ElementaryTypeName", "src": "30135:4:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "visibility": "internal" }], "src": "30114:34:233" }, "scope": 161325, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 160115, "nodeType": "FunctionDefinition", "src": "31845:645:233", "nodes": [], "body": { "id": 160114, "nodeType": "Block", "src": "32049:441:233", "nodes": [], "statements": [{ "assignments": [160086], "declarations": [{ "constant": false, "id": 160086, "mutability": "mutable", "name": "longAmount", "nameLocation": "32067:10:233", "nodeType": "VariableDeclaration", "scope": 160114, "src": "32059:18:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160085, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "32059:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160104, "initialValue": { "arguments": [{ "id": 160089, "name": "_effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160078, "src": "32126:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160090, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160074, "src": "32163:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160091, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "32171:12:233", "memberName": "bondReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159332, "src": "32163:20:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "arguments": [{ "expression": { "id": 160094, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160074, "src": "32217:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160095, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "32225:15:233", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159340, "src": "32217:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160092, "name": "_baseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160076, "src": "32197:11:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160093, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "32209:7:233", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "32197:19:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160096, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "32197:44:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160097, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160074, "src": "32255:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160098, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "32263:11:233", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159338, "src": "32255:19:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160099, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160074, "src": "32288:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160100, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "32296:15:233", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159340, "src": "32288:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160101, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160074, "src": "32325:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160102, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "32333:22:233", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159342, "src": "32325:30:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160087, "name": "HyperdriveMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20190, "src": "32080:14:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_HyperdriveMath_$20190_$", "typeString": "type(library HyperdriveMath)" } }, "id": 160088, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "32095:17:233", "memberName": "calculateOpenLong", "nodeType": "MemberAccess", "referencedDeclaration": 19928, "src": "32080:32:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256,uint256,uint256,uint256) pure returns (uint256)" } }, "id": 160103, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "32080:285:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "32059:306:233" }, { "expression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160112, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160105, "name": "longAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160086, "src": "32394:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [{ "id": 160107, "name": "_baseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160076, "src": "32441:11:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160108, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160080, "src": "32454:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160109, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160074, "src": "32466:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160110, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "32474:8:233", "memberName": "curveFee", "nodeType": "MemberAccess", "referencedDeclaration": 159346, "src": "32466:16:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 160106, "name": "calculateLongCurveFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160265, "src": "32419:21:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 160111, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "32419:64:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "32394:89:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 160084, "id": 160113, "nodeType": "Return", "src": "32375:108:233" }] }, "documentation": { "id": 160071, "nodeType": "StructuredDocumentation", "src": "30838:1002:233", "text": "@dev Gets the long amount that will be opened for a given base amount.\n      The long amount $y(x)$ that a trader will receive is given by:\n      $$\n      y(x) = y_{*}(x) - c(x)\n      $$\n      Where $y_{*}(x)$ is the amount of long that would be opened if there\n      was no curve fee and [$c(x)$](long_curve_fee) is the curve fee.\n      $y_{*}(x)$ is given by:\n      $$\n      y_{*}(x) = y - \\left(\n                     k - \\tfrac{c}{\\mu} \\cdot \\left(\n                         \\mu \\cdot \\left( z - \\zeta + \\tfrac{x}{c}\n                     \\right) \\right)^{1 - t_s}\n                 \\right)^{\\tfrac{1}{1 - t_s}}\n      $$\n @param _params The max long calculation parameters.\n @param _baseAmount The base amount.\n @param _effectiveShareReserves The effective share reserves.\n @param _spotPrice The spot price.\n @return The long amount." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateLongAmount", "nameLocation": "31854:19:233", "parameters": { "id": 160081, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160074, "mutability": "mutable", "name": "_params", "nameLocation": "31905:7:233", "nodeType": "VariableDeclaration", "scope": 160115, "src": "31883:29:233", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" }, "typeName": { "id": 160073, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 160072, "name": "MaxTradeParams", "nameLocations": ["31883:14:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 159351, "src": "31883:14:233" }, "referencedDeclaration": 159351, "src": "31883:14:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_storage_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" } }, "visibility": "internal" }, { "constant": false, "id": 160076, "mutability": "mutable", "name": "_baseAmount", "nameLocation": "31930:11:233", "nodeType": "VariableDeclaration", "scope": 160115, "src": "31922:19:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160075, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "31922:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160078, "mutability": "mutable", "name": "_effectiveShareReserves", "nameLocation": "31959:23:233", "nodeType": "VariableDeclaration", "scope": 160115, "src": "31951:31:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160077, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "31951:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160080, "mutability": "mutable", "name": "_spotPrice", "nameLocation": "32000:10:233", "nodeType": "VariableDeclaration", "scope": 160115, "src": "31992:18:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160079, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "31992:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "31873:143:233" }, "returnParameters": { "id": 160084, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160083, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 160115, "src": "32040:7:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160082, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "32040:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "32039:9:233" }, "scope": 161325, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 160239, "nodeType": "FunctionDefinition", "src": "33928:1494:233", "nodes": [], "body": { "id": 160238, "nodeType": "Block", "src": "34159:1263:233", "nodes": [], "statements": [{ "assignments": [160133], "declarations": [{ "constant": false, "id": 160133, "mutability": "mutable", "name": "shareAmount", "nameLocation": "34230:11:233", "nodeType": "VariableDeclaration", "scope": 160238, "src": "34222:19:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160132, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "34222:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160139, "initialValue": { "arguments": [{ "expression": { "id": 160136, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160119, "src": "34264:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160137, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "34272:15:233", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159340, "src": "34264:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160134, "name": "_baseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160121, "src": "34244:11:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160135, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "34256:7:233", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "34244:19:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160138, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "34244:44:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "34222:66:233" }, { "assignments": [160141], "declarations": [{ "constant": false, "id": 160141, "mutability": "mutable", "name": "inner", "nameLocation": "34306:5:233", "nodeType": "VariableDeclaration", "scope": 160238, "src": "34298:13:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160140, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "34298:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160149, "initialValue": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160147, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160145, "name": "_effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160123, "src": "34366:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "id": 160146, "name": "shareAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160133, "src": "34392:11:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "34366:37:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 160142, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160119, "src": "34314:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160143, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "34322:22:233", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159342, "src": "34314:30:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160144, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "34345:7:233", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "34314:38:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160148, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "34314:99:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "34298:115:233" }, { "assignments": [160151], "declarations": [{ "constant": false, "id": 160151, "mutability": "mutable", "name": "k_", "nameLocation": "34431:2:233", "nodeType": "VariableDeclaration", "scope": 160238, "src": "34423:10:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160150, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "34423:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160166, "initialValue": { "arguments": [{ "id": 160154, "name": "_effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160123, "src": "34470:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160155, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160119, "src": "34507:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160156, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "34515:12:233", "memberName": "bondReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159332, "src": "34507:20:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160160, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160157, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "34541:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 160158, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160119, "src": "34547:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160159, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "34555:11:233", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159338, "src": "34547:19:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "34541:25:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160161, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160119, "src": "34580:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160162, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "34588:15:233", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159340, "src": "34580:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160163, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160119, "src": "34617:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160164, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "34625:22:233", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159342, "src": "34617:30:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160152, "name": "YieldSpaceMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 23292, "src": "34436:14:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_YieldSpaceMath_$23292_$", "typeString": "type(library YieldSpaceMath)" } }, "id": 160153, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "34451:5:233", "memberName": "kDown", "nodeType": "MemberAccess", "referencedDeclaration": 23291, "src": "34436:20:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256,uint256,uint256) pure returns (uint256)" } }, "id": 160165, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "34436:221:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "34423:234:233" }, { "expression": { "id": 160176, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 160167, "name": "derivative", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160128, "src": "34667:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "arguments": [{ "expression": { "id": 160172, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160119, "src": "34702:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160173, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "34710:11:233", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159338, "src": "34702:19:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160170, "name": "inner", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160141, "src": "34692:5:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160171, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "34698:3:233", "memberName": "pow", "nodeType": "MemberAccess", "referencedDeclaration": 18847, "src": "34692:9:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160174, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "34692:30:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160168, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "34680:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160169, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "34684:7:233", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "34680:11:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160175, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "34680:43:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "34667:56:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160177, "nodeType": "ExpressionStatement", "src": "34667:56:233" }, { "assignments": [160179], "declarations": [{ "constant": false, "id": 160179, "mutability": "mutable", "name": "rhs", "nameLocation": "34919:3:233", "nodeType": "VariableDeclaration", "scope": 160238, "src": "34911:11:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160178, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "34911:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160191, "initialValue": { "arguments": [{ "arguments": [{ "expression": { "id": 160185, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160119, "src": "34983:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160186, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "34991:11:233", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159338, "src": "34983:19:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160183, "name": "inner", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160141, "src": "34973:5:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160184, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "34979:3:233", "memberName": "pow", "nodeType": "MemberAccess", "referencedDeclaration": 18847, "src": "34973:9:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160187, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "34973:30:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160188, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160119, "src": "35017:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160189, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "35025:22:233", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159342, "src": "35017:30:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 160180, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160119, "src": "34925:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160181, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "34933:15:233", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159340, "src": "34925:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160182, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "34949:10:233", "memberName": "mulDivDown", "nodeType": "MemberAccess", "referencedDeclaration": 18704, "src": "34925:34:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 160190, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "34925:132:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "34911:146:233" }, { "condition": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160194, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160192, "name": "k_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160151, "src": "35071:2:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "<", "rightExpression": { "id": 160193, "name": "rhs", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160179, "src": "35076:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "35071:8:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "id": 160200, "nodeType": "IfStatement", "src": "35067:56:233", "trueBody": { "id": 160199, "nodeType": "Block", "src": "35081:42:233", "statements": [{ "expression": { "components": [{ "hexValue": "30", "id": 160195, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "35103:1:233", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }, { "hexValue": "66616c7365", "id": 160196, "isConstant": false, "isLValue": false, "isPure": true, "kind": "bool", "lValueRequested": false, "nodeType": "Literal", "src": "35106:5:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "value": "false" }], "id": 160197, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "TupleExpression", "src": "35102:10:233", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_rational_0_by_1_$_t_bool_$", "typeString": "tuple(int_const 0,bool)" } }, "functionReturnParameters": 160131, "id": 160198, "nodeType": "Return", "src": "35095:17:233" }] } }, { "expression": { "id": 160219, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 160201, "name": "derivative", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160128, "src": "35132:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "arguments": [{ "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160215, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160212, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "35218:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 160213, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160119, "src": "35224:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160214, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "35232:11:233", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159338, "src": "35224:19:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "35218:25:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 160209, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160119, "src": "35192:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160210, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "35200:11:233", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159338, "src": "35192:19:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160211, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "35212:5:233", "memberName": "divUp", "nodeType": "MemberAccess", "referencedDeclaration": 18790, "src": "35192:25:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160216, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "35192:52:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160206, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160204, "name": "k_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160151, "src": "35178:2:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 160205, "name": "rhs", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160179, "src": "35183:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "35178:8:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 160207, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "35177:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160208, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "35188:3:233", "memberName": "pow", "nodeType": "MemberAccess", "referencedDeclaration": 18847, "src": "35177:14:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160217, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "35177:68:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160202, "name": "derivative", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160128, "src": "35145:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160203, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "35156:7:233", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "35145:18:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160218, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "35145:110:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "35132:123:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160220, "nodeType": "ExpressionStatement", "src": "35132:123:233" }, { "expression": { "id": 160232, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 160221, "name": "derivative", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160128, "src": "35310:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "-=", "rightHandSide": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160230, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "arguments": [{ "id": 160227, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160125, "src": "35361:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160225, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "35349:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160226, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "35353:7:233", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "35349:11:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160228, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "35349:23:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 160229, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "35375:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "35349:29:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 160222, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160119, "src": "35324:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160223, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "35332:8:233", "memberName": "curveFee", "nodeType": "MemberAccess", "referencedDeclaration": 159346, "src": "35324:16:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160224, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "35341:7:233", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "35324:24:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160231, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "35324:55:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "35310:69:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160233, "nodeType": "ExpressionStatement", "src": "35310:69:233" }, { "expression": { "components": [{ "id": 160234, "name": "derivative", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160128, "src": "35398:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "hexValue": "74727565", "id": 160235, "isConstant": false, "isLValue": false, "isPure": true, "kind": "bool", "lValueRequested": false, "nodeType": "Literal", "src": "35410:4:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "value": "true" }], "id": 160236, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "35397:18:233", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "functionReturnParameters": 160131, "id": 160237, "nodeType": "Return", "src": "35390:25:233" }] }, "documentation": { "id": 160116, "nodeType": "StructuredDocumentation", "src": "32496:1427:233", "text": "@dev Gets the derivative of [long_amount](long_amount) with respect to\n      the base amount.\n      We calculate the derivative of the long amount $y(x)$ as:\n      $$\n      y'(x) = y_{*}'(x) - c'(x)\n      $$\n      Where $y_{*}'(x)$ is the derivative of $y_{*}(x)$ and $c'(x)$ is the\n      derivative of [$c(x)$](long_curve_fee). $y_{*}'(x)$ is given by:\n      $$\n      y_{*}'(x) = \\left( \\mu \\cdot (z - \\zeta + \\tfrac{x}{c}) \\right)^{-t_s}\n                  \\left(\n                      k - \\tfrac{c}{\\mu} \\cdot\n                      \\left(\n                          \\mu \\cdot (z - \\zeta + \\tfrac{x}{c}\n                      \\right)^{1 - t_s}\n                  \\right)^{\\tfrac{t_s}{1 - t_s}}\n      $$\n      and $c'(x)$ is given by:\n      $$\n      c'(x) = \\phi_{c} \\cdot \\left( \\tfrac{1}{p} - 1 \\right)\n      $$\n @param _params The max long calculation parameters.\n @param _baseAmount The base amount.\n @param _spotPrice The spot price.\n @param _effectiveShareReserves The effective share reserves.\n @return derivative The derivative of the long amount w.r.t. the base\n         amount.\n @return A flag indicating whether or not the derivative was\n         successfully calculated." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateLongAmountDerivative", "nameLocation": "33937:29:233", "parameters": { "id": 160126, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160119, "mutability": "mutable", "name": "_params", "nameLocation": "33998:7:233", "nodeType": "VariableDeclaration", "scope": 160239, "src": "33976:29:233", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" }, "typeName": { "id": 160118, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 160117, "name": "MaxTradeParams", "nameLocations": ["33976:14:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 159351, "src": "33976:14:233" }, "referencedDeclaration": 159351, "src": "33976:14:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_storage_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" } }, "visibility": "internal" }, { "constant": false, "id": 160121, "mutability": "mutable", "name": "_baseAmount", "nameLocation": "34023:11:233", "nodeType": "VariableDeclaration", "scope": 160239, "src": "34015:19:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160120, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "34015:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160123, "mutability": "mutable", "name": "_effectiveShareReserves", "nameLocation": "34052:23:233", "nodeType": "VariableDeclaration", "scope": 160239, "src": "34044:31:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160122, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "34044:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160125, "mutability": "mutable", "name": "_spotPrice", "nameLocation": "34093:10:233", "nodeType": "VariableDeclaration", "scope": 160239, "src": "34085:18:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160124, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "34085:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "33966:143:233" }, "returnParameters": { "id": 160131, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160128, "mutability": "mutable", "name": "derivative", "nameLocation": "34141:10:233", "nodeType": "VariableDeclaration", "scope": 160239, "src": "34133:18:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160127, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "34133:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160130, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 160239, "src": "34153:4:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "typeName": { "id": 160129, "name": "bool", "nodeType": "ElementaryTypeName", "src": "34153:4:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "visibility": "internal" }], "src": "34132:26:233" }, "scope": 161325, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 160265, "nodeType": "FunctionDefinition", "src": "35831:330:233", "nodes": [], "body": { "id": 160264, "nodeType": "Block", "src": "35984:177:233", "nodes": [], "statements": [{ "expression": { "arguments": [{ "id": 160261, "name": "_baseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160242, "src": "36129:11:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160258, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "arguments": [{ "id": 160255, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160244, "src": "36085:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160253, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "36073:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160254, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "36077:7:233", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "36073:11:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160256, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "36073:23:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 160257, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "36099:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "36073:29:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160251, "name": "_curveFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160246, "src": "36055:9:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160252, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "36065:7:233", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "36055:17:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160259, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "36055:48:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160260, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "36104:7:233", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "36055:56:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160262, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "36055:99:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 160250, "id": 160263, "nodeType": "Return", "src": "36036:118:233" }] }, "documentation": { "id": 160240, "nodeType": "StructuredDocumentation", "src": "35428:398:233", "text": "@dev Gets the curve fee paid by longs for a given base amount.\n      The curve fee $c(x)$ paid by longs is given by:\n      $$\n      c(x) = \\phi_{c} \\cdot \\left( \\tfrac{1}{p} - 1 \\right) \\cdot x\n      $$\n @param _baseAmount The base amount, $x$.\n @param _spotPrice The spot price, $p$.\n @param _curveFee The curve fee, $\\phi_{c}$." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateLongCurveFee", "nameLocation": "35840:21:233", "parameters": { "id": 160247, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160242, "mutability": "mutable", "name": "_baseAmount", "nameLocation": "35879:11:233", "nodeType": "VariableDeclaration", "scope": 160265, "src": "35871:19:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160241, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "35871:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160244, "mutability": "mutable", "name": "_spotPrice", "nameLocation": "35908:10:233", "nodeType": "VariableDeclaration", "scope": 160265, "src": "35900:18:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160243, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "35900:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160246, "mutability": "mutable", "name": "_curveFee", "nameLocation": "35936:9:233", "nodeType": "VariableDeclaration", "scope": 160265, "src": "35928:17:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160245, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "35928:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "35861:90:233" }, "returnParameters": { "id": 160250, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160249, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 160265, "src": "35975:7:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160248, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "35975:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "35974:9:233" }, "scope": 161325, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 160292, "nodeType": "FunctionDefinition", "src": "36742:361:233", "nodes": [], "body": { "id": 160291, "nodeType": "Block", "src": "36934:169:233", "nodes": [], "statements": [{ "expression": { "arguments": [{ "arguments": [{ "id": 160285, "name": "_baseAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160268, "src": "37047:11:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160286, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160270, "src": "37060:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160287, "name": "_curveFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160272, "src": "37072:9:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 160284, "name": "calculateLongCurveFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160265, "src": "37025:21:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 160288, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "37025:57:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "id": 160281, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160270, "src": "36988:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160279, "name": "_governanceLPFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160274, "src": "36963:16:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160280, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "36980:7:233", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "36963:24:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160282, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "36963:36:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160283, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "37000:7:233", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "36963:44:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160289, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "36963:133:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 160278, "id": 160290, "nodeType": "Return", "src": "36944:152:233" }] }, "documentation": { "id": 160266, "nodeType": "StructuredDocumentation", "src": "36167:570:233", "text": "@dev Gets the governance fee paid by longs for a given base amount.\n      Unlike the [curve fee](long_curve_fee) which is paid in bonds, the\n      governance fee is paid in base. The governance fee $g(x)$ paid by\n      longs is given by:\n      $$\n      g(x) = \\phi_{g} \\cdot p \\cdot c(x)\n      $$\n @param _baseAmount The base amount, $x$.\n @param _spotPrice The spot price, $p$.\n @param _curveFee The curve fee, $\\phi_{c}$.\n @param _governanceLPFee The governance fee, $\\phi_{g}$." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateLongGovernanceFee", "nameLocation": "36751:26:233", "parameters": { "id": 160275, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160268, "mutability": "mutable", "name": "_baseAmount", "nameLocation": "36795:11:233", "nodeType": "VariableDeclaration", "scope": 160292, "src": "36787:19:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160267, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "36787:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160270, "mutability": "mutable", "name": "_spotPrice", "nameLocation": "36824:10:233", "nodeType": "VariableDeclaration", "scope": 160292, "src": "36816:18:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160269, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "36816:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160272, "mutability": "mutable", "name": "_curveFee", "nameLocation": "36852:9:233", "nodeType": "VariableDeclaration", "scope": 160292, "src": "36844:17:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160271, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "36844:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160274, "mutability": "mutable", "name": "_governanceLPFee", "nameLocation": "36879:16:233", "nodeType": "VariableDeclaration", "scope": 160292, "src": "36871:24:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160273, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "36871:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "36777:124:233" }, "returnParameters": { "id": 160278, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160277, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 160292, "src": "36925:7:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160276, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "36925:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "36924:9:233" }, "scope": 161325, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 160300, "nodeType": "StructDefinition", "src": "37243:107:233", "nodes": [], "canonicalName": "HyperdriveUtils.MaxShortInternal", "documentation": { "id": 160293, "nodeType": "StructuredDocumentation", "src": "37109:129:233", "text": "@dev A struct used to hold extra variables in the max short calculation\n      function to avoid stack-too-deep errors." }, "members": [{ "constant": false, "id": 160295, "mutability": "mutable", "name": "solvency", "nameLocation": "37285:8:233", "nodeType": "VariableDeclaration", "scope": 160300, "src": "37277:16:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160294, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "37277:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160297, "mutability": "mutable", "name": "derivative", "nameLocation": "37311:10:233", "nodeType": "VariableDeclaration", "scope": 160300, "src": "37303:18:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160296, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "37303:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160299, "mutability": "mutable", "name": "success", "nameLocation": "37336:7:233", "nodeType": "VariableDeclaration", "scope": 160300, "src": "37331:12:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "typeName": { "id": 160298, "name": "bool", "nodeType": "ElementaryTypeName", "src": "37331:4:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "visibility": "internal" }], "name": "MaxShortInternal", "nameLocation": "37250:16:233", "scope": 161325, "visibility": "public" }, { "id": 160474, "nodeType": "FunctionDefinition", "src": "37638:4492:233", "nodes": [], "body": { "id": 160473, "nodeType": "Block", "src": "37810:4320:233", "nodes": [], "statements": [{ "assignments": [160315], "declarations": [{ "constant": false, "id": 160315, "mutability": "mutable", "name": "internal_", "nameLocation": "38101:9:233", "nodeType": "VariableDeclaration", "scope": 160473, "src": "38077:33:233", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxShortInternal_$160300_memory_ptr", "typeString": "struct HyperdriveUtils.MaxShortInternal" }, "typeName": { "id": 160314, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 160313, "name": "MaxShortInternal", "nameLocations": ["38077:16:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 160300, "src": "38077:16:233" }, "referencedDeclaration": 160300, "src": "38077:16:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxShortInternal_$160300_storage_ptr", "typeString": "struct HyperdriveUtils.MaxShortInternal" } }, "visibility": "internal" }], "id": 160316, "nodeType": "VariableDeclarationStatement", "src": "38077:33:233" }, { "assignments": [160318], "declarations": [{ "constant": false, "id": 160318, "mutability": "mutable", "name": "effectiveShareReserves", "nameLocation": "38128:22:233", "nodeType": "VariableDeclaration", "scope": 160473, "src": "38120:30:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160317, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "38120:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160326, "initialValue": { "arguments": [{ "expression": { "id": 160321, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160304, "src": "38230:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160322, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "38238:13:233", "memberName": "shareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159328, "src": "38230:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160323, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160304, "src": "38269:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160324, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "38277:15:233", "memberName": "shareAdjustment", "nodeType": "MemberAccess", "referencedDeclaration": 159330, "src": "38269:23:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_int256", "typeString": "int256" }], "expression": { "id": 160319, "name": "HyperdriveMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20190, "src": "38153:14:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_HyperdriveMath_$20190_$", "typeString": "type(library HyperdriveMath)" } }, "id": 160320, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "38181:31:233", "memberName": "calculateEffectiveShareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 19633, "src": "38153:59:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_int256_$returns$_t_uint256_$", "typeString": "function (uint256,int256) pure returns (uint256)" } }, "id": 160325, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "38153:153:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "38120:186:233" }, { "assignments": [160328], "declarations": [{ "constant": false, "id": 160328, "mutability": "mutable", "name": "spotPrice", "nameLocation": "38324:9:233", "nodeType": "VariableDeclaration", "scope": 160473, "src": "38316:17:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160327, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "38316:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160339, "initialValue": { "arguments": [{ "id": 160331, "name": "effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160318, "src": "38383:22:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160332, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160304, "src": "38419:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160333, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "38427:12:233", "memberName": "bondReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159332, "src": "38419:20:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160334, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160304, "src": "38453:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160335, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "38461:22:233", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159342, "src": "38453:30:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160336, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160304, "src": "38497:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160337, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "38505:11:233", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159338, "src": "38497:19:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160329, "name": "HyperdriveMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20190, "src": "38336:14:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_HyperdriveMath_$20190_$", "typeString": "type(library HyperdriveMath)" } }, "id": 160330, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "38351:18:233", "memberName": "calculateSpotPrice", "nodeType": "MemberAccess", "referencedDeclaration": 19560, "src": "38336:33:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256,uint256) pure returns (uint256)" } }, "id": 160338, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "38336:190:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "38316:210:233" }, { "assignments": [160341], "declarations": [{ "constant": false, "id": 160341, "mutability": "mutable", "name": "absoluteMaxBondAmount", "nameLocation": "38544:21:233", "nodeType": "VariableDeclaration", "scope": 160473, "src": "38536:29:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160340, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "38536:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160346, "initialValue": { "arguments": [{ "id": 160343, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160304, "src": "38609:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, { "id": 160344, "name": "effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160318, "src": "38630:22:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 160342, "name": "calculateMaxShortUpperBound", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160583, "src": "38568:27:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_MaxTradeParams_$159351_memory_ptr_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (struct HyperdriveUtils.MaxTradeParams memory,uint256) pure returns (uint256)" } }, "id": 160345, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "38568:94:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "38536:126:233" }, { "expression": { "id": 160360, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "components": [{ "expression": { "id": 160347, "name": "internal_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160315, "src": "38673:9:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxShortInternal_$160300_memory_ptr", "typeString": "struct HyperdriveUtils.MaxShortInternal memory" } }, "id": 160349, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": true, "memberLocation": "38683:8:233", "memberName": "solvency", "nodeType": "MemberAccess", "referencedDeclaration": 160295, "src": "38673:18:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160350, "name": "internal_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160315, "src": "38693:9:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxShortInternal_$160300_memory_ptr", "typeString": "struct HyperdriveUtils.MaxShortInternal memory" } }, "id": 160351, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": true, "memberLocation": "38703:7:233", "memberName": "success", "nodeType": "MemberAccess", "referencedDeclaration": 160299, "src": "38693:17:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }], "id": 160352, "isConstant": false, "isInlineArray": false, "isLValue": true, "isPure": false, "lValueRequested": true, "nodeType": "TupleExpression", "src": "38672:39:233", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 160354, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160304, "src": "38755:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, { "id": 160355, "name": "absoluteMaxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160341, "src": "38776:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160356, "name": "effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160318, "src": "38811:22:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160357, "name": "spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160328, "src": "38847:9:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160358, "name": "_checkpointExposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160306, "src": "38870:19:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 160353, "name": "calculateSolvencyAfterShort", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160774, "src": "38714:27:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_MaxTradeParams_$159351_memory_ptr_$_t_uint256_$_t_uint256_$_t_uint256_$_t_int256_$returns$_t_uint256_$_t_bool_$", "typeString": "function (struct HyperdriveUtils.MaxTradeParams memory,uint256,uint256,uint256,int256) pure returns (uint256,bool)" } }, "id": 160359, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "38714:185:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "src": "38672:227:233", "typeDescriptions": { "typeIdentifier": "t_tuple$__$", "typeString": "tuple()" } }, "id": 160361, "nodeType": "ExpressionStatement", "src": "38672:227:233" }, { "condition": { "expression": { "id": 160362, "name": "internal_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160315, "src": "38913:9:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxShortInternal_$160300_memory_ptr", "typeString": "struct HyperdriveUtils.MaxShortInternal memory" } }, "id": 160363, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "38923:7:233", "memberName": "success", "nodeType": "MemberAccess", "referencedDeclaration": 160299, "src": "38913:17:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "id": 160367, "nodeType": "IfStatement", "src": "38909:76:233", "trueBody": { "id": 160366, "nodeType": "Block", "src": "38932:53:233", "statements": [{ "expression": { "id": 160364, "name": "absoluteMaxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160341, "src": "38953:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 160312, "id": 160365, "nodeType": "Return", "src": "38946:28:233" }] } }, { "assignments": [160369], "declarations": [{ "constant": false, "id": 160369, "mutability": "mutable", "name": "maxBondAmount", "nameLocation": "39887:13:233", "nodeType": "VariableDeclaration", "scope": 160473, "src": "39879:21:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160368, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "39879:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160375, "initialValue": { "arguments": [{ "id": 160371, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160304, "src": "39939:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, { "id": 160372, "name": "spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160328, "src": "39960:9:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160373, "name": "_checkpointExposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160306, "src": "39983:19:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 160370, "name": "calculateMaxShortGuess", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160657, "src": "39903:22:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_MaxTradeParams_$159351_memory_ptr_$_t_uint256_$_t_int256_$returns$_t_uint256_$", "typeString": "function (struct HyperdriveUtils.MaxTradeParams memory,uint256,int256) pure returns (uint256)" } }, "id": 160374, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "39903:109:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "39879:133:233" }, { "expression": { "id": 160389, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "components": [{ "expression": { "id": 160376, "name": "internal_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160315, "src": "40023:9:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxShortInternal_$160300_memory_ptr", "typeString": "struct HyperdriveUtils.MaxShortInternal memory" } }, "id": 160378, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": true, "memberLocation": "40033:8:233", "memberName": "solvency", "nodeType": "MemberAccess", "referencedDeclaration": 160295, "src": "40023:18:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160379, "name": "internal_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160315, "src": "40043:9:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxShortInternal_$160300_memory_ptr", "typeString": "struct HyperdriveUtils.MaxShortInternal memory" } }, "id": 160380, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": true, "memberLocation": "40053:7:233", "memberName": "success", "nodeType": "MemberAccess", "referencedDeclaration": 160299, "src": "40043:17:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }], "id": 160381, "isConstant": false, "isInlineArray": false, "isLValue": true, "isPure": false, "lValueRequested": true, "nodeType": "TupleExpression", "src": "40022:39:233", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 160383, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160304, "src": "40105:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, { "id": 160384, "name": "maxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160369, "src": "40126:13:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160385, "name": "effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160318, "src": "40153:22:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160386, "name": "spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160328, "src": "40189:9:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160387, "name": "_checkpointExposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160306, "src": "40212:19:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 160382, "name": "calculateSolvencyAfterShort", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160774, "src": "40064:27:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_MaxTradeParams_$159351_memory_ptr_$_t_uint256_$_t_uint256_$_t_uint256_$_t_int256_$returns$_t_uint256_$_t_bool_$", "typeString": "function (struct HyperdriveUtils.MaxTradeParams memory,uint256,uint256,uint256,int256) pure returns (uint256,bool)" } }, "id": 160388, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "40064:177:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "src": "40022:219:233", "typeDescriptions": { "typeIdentifier": "t_tuple$__$", "typeString": "tuple()" } }, "id": 160390, "nodeType": "ExpressionStatement", "src": "40022:219:233" }, { "expression": { "arguments": [{ "expression": { "id": 160392, "name": "internal_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160315, "src": "40272:9:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxShortInternal_$160300_memory_ptr", "typeString": "struct HyperdriveUtils.MaxShortInternal memory" } }, "id": 160393, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "40282:7:233", "memberName": "success", "nodeType": "MemberAccess", "referencedDeclaration": 160299, "src": "40272:17:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, { "hexValue": "496e697469616c20677565737320696e206063616c63756c6174654d617853686f72746020697320696e736f6c76656e74", "id": 160394, "isConstant": false, "isLValue": false, "isPure": true, "kind": "string", "lValueRequested": false, "nodeType": "Literal", "src": "40303:51:233", "typeDescriptions": { "typeIdentifier": "t_stringliteral_69d37a589c0b0e15423d2257480eeb8ca78f6563e04484f780925f7fdf966b65", "typeString": "literal_string \"Initial guess in `calculateMaxShort` is insolvent\"" }, "value": "Initial guess in `calculateMaxShort` is insolvent" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_bool", "typeString": "bool" }, { "typeIdentifier": "t_stringliteral_69d37a589c0b0e15423d2257480eeb8ca78f6563e04484f780925f7fdf966b65", "typeString": "literal_string \"Initial guess in `calculateMaxShort` is insolvent\"" }], "id": 160391, "name": "require", "nodeType": "Identifier", "overloadedDeclarations": [-18, -18], "referencedDeclaration": -18, "src": "40251:7:233", "typeDescriptions": { "typeIdentifier": "t_function_require_pure$_t_bool_$_t_string_memory_ptr_$returns$__$", "typeString": "function (bool,string memory) pure" } }, "id": 160395, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "40251:113:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_tuple$__$", "typeString": "tuple()" } }, "id": 160396, "nodeType": "ExpressionStatement", "src": "40251:113:233" }, { "body": { "id": 160469, "nodeType": "Block", "src": "40419:1674:233", "statements": [{ "expression": { "id": 160419, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "components": [{ "expression": { "id": 160407, "name": "internal_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160315, "src": "40922:9:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxShortInternal_$160300_memory_ptr", "typeString": "struct HyperdriveUtils.MaxShortInternal memory" } }, "id": 160409, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": true, "memberLocation": "40932:10:233", "memberName": "derivative", "nodeType": "MemberAccess", "referencedDeclaration": 160297, "src": "40922:20:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160410, "name": "internal_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160315, "src": "40960:9:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxShortInternal_$160300_memory_ptr", "typeString": "struct HyperdriveUtils.MaxShortInternal memory" } }, "id": 160411, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": true, "memberLocation": "40970:7:233", "memberName": "success", "nodeType": "MemberAccess", "referencedDeclaration": 160299, "src": "40960:17:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }], "id": 160412, "isConstant": false, "isInlineArray": false, "isLValue": true, "isPure": false, "lValueRequested": true, "nodeType": "TupleExpression", "src": "40904:87:233", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 160414, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160304, "src": "41049:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, { "id": 160415, "name": "maxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160369, "src": "41074:13:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160416, "name": "spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160328, "src": "41105:9:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160417, "name": "effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160318, "src": "41132:22:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 160413, "name": "calculateSolvencyAfterShortDerivative", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160836, "src": "40994:37:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_MaxTradeParams_$159351_memory_ptr_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$_t_bool_$", "typeString": "function (struct HyperdriveUtils.MaxTradeParams memory,uint256,uint256,uint256) pure returns (uint256,bool)" } }, "id": 160418, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "40994:174:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "src": "40904:264:233", "typeDescriptions": { "typeIdentifier": "t_tuple$__$", "typeString": "tuple()" } }, "id": 160420, "nodeType": "ExpressionStatement", "src": "40904:264:233" }, { "condition": { "id": 160423, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "UnaryOperation", "operator": "!", "prefix": true, "src": "41186:18:233", "subExpression": { "expression": { "id": 160421, "name": "internal_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160315, "src": "41187:9:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxShortInternal_$160300_memory_ptr", "typeString": "struct HyperdriveUtils.MaxShortInternal memory" } }, "id": 160422, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "41197:7:233", "memberName": "success", "nodeType": "MemberAccess", "referencedDeclaration": 160299, "src": "41187:17:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "id": 160426, "nodeType": "IfStatement", "src": "41182:62:233", "trueBody": { "id": 160425, "nodeType": "Block", "src": "41206:38:233", "statements": [{ "id": 160424, "nodeType": "Break", "src": "41224:5:233" }] } }, { "assignments": [160428], "declarations": [{ "constant": false, "id": 160428, "mutability": "mutable", "name": "possibleMaxBondAmount", "nameLocation": "41265:21:233", "nodeType": "VariableDeclaration", "scope": 160469, "src": "41257:29:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160427, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "41257:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160437, "initialValue": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160436, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160429, "name": "maxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160369, "src": "41289:13:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "arguments": [{ "expression": { "id": 160433, "name": "internal_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160315, "src": "41348:9:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxShortInternal_$160300_memory_ptr", "typeString": "struct HyperdriveUtils.MaxShortInternal memory" } }, "id": 160434, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "41358:10:233", "memberName": "derivative", "nodeType": "MemberAccess", "referencedDeclaration": 160297, "src": "41348:20:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 160430, "name": "internal_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160315, "src": "41321:9:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxShortInternal_$160300_memory_ptr", "typeString": "struct HyperdriveUtils.MaxShortInternal memory" } }, "id": 160431, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "41331:8:233", "memberName": "solvency", "nodeType": "MemberAccess", "referencedDeclaration": 160295, "src": "41321:18:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160432, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "41340:7:233", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "41321:26:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160435, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "41321:48:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "41289:80:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "41257:112:233" }, { "condition": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160440, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160438, "name": "possibleMaxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160428, "src": "41387:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": ">", "rightExpression": { "id": 160439, "name": "absoluteMaxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160341, "src": "41411:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "41387:45:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "id": 160443, "nodeType": "IfStatement", "src": "41383:89:233", "trueBody": { "id": 160442, "nodeType": "Block", "src": "41434:38:233", "statements": [{ "id": 160441, "nodeType": "Break", "src": "41452:5:233" }] } }, { "expression": { "id": 160457, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "components": [{ "expression": { "id": 160444, "name": "internal_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160315, "src": "41653:9:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxShortInternal_$160300_memory_ptr", "typeString": "struct HyperdriveUtils.MaxShortInternal memory" } }, "id": 160446, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": true, "memberLocation": "41663:8:233", "memberName": "solvency", "nodeType": "MemberAccess", "referencedDeclaration": 160295, "src": "41653:18:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160447, "name": "internal_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160315, "src": "41689:9:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxShortInternal_$160300_memory_ptr", "typeString": "struct HyperdriveUtils.MaxShortInternal memory" } }, "id": 160448, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": true, "memberLocation": "41699:7:233", "memberName": "success", "nodeType": "MemberAccess", "referencedDeclaration": 160299, "src": "41689:17:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }], "id": 160449, "isConstant": false, "isInlineArray": false, "isLValue": true, "isPure": false, "lValueRequested": true, "nodeType": "TupleExpression", "src": "41635:85:233", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 160451, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160304, "src": "41768:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, { "id": 160452, "name": "possibleMaxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160428, "src": "41793:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160453, "name": "effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160318, "src": "41832:22:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160454, "name": "spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160328, "src": "41872:9:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160455, "name": "_checkpointExposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160306, "src": "41899:19:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 160450, "name": "calculateSolvencyAfterShort", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160774, "src": "41723:27:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_MaxTradeParams_$159351_memory_ptr_$_t_uint256_$_t_uint256_$_t_uint256_$_t_int256_$returns$_t_uint256_$_t_bool_$", "typeString": "function (struct HyperdriveUtils.MaxTradeParams memory,uint256,uint256,uint256,int256) pure returns (uint256,bool)" } }, "id": 160456, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "41723:209:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "src": "41635:297:233", "typeDescriptions": { "typeIdentifier": "t_tuple$__$", "typeString": "tuple()" } }, "id": 160458, "nodeType": "ExpressionStatement", "src": "41635:297:233" }, { "condition": { "expression": { "id": 160459, "name": "internal_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160315, "src": "41950:9:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxShortInternal_$160300_memory_ptr", "typeString": "struct HyperdriveUtils.MaxShortInternal memory" } }, "id": 160460, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "41960:7:233", "memberName": "success", "nodeType": "MemberAccess", "referencedDeclaration": 160299, "src": "41950:17:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "falseBody": { "id": 160467, "nodeType": "Block", "src": "42045:38:233", "statements": [{ "id": 160466, "nodeType": "Break", "src": "42063:5:233" }] }, "id": 160468, "nodeType": "IfStatement", "src": "41946:137:233", "trueBody": { "id": 160465, "nodeType": "Block", "src": "41969:70:233", "statements": [{ "expression": { "id": 160463, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 160461, "name": "maxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160369, "src": "41987:13:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "id": 160462, "name": "possibleMaxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160428, "src": "42003:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "41987:37:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160464, "nodeType": "ExpressionStatement", "src": "41987:37:233" }] } }] }, "condition": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160403, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160401, "name": "i", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160398, "src": "40394:1:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "<", "rightExpression": { "id": 160402, "name": "_maxIterations", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160308, "src": "40398:14:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "40394:18:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "id": 160470, "initializationExpression": { "assignments": [160398], "declarations": [{ "constant": false, "id": 160398, "mutability": "mutable", "name": "i", "nameLocation": "40387:1:233", "nodeType": "VariableDeclaration", "scope": 160470, "src": "40379:9:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160397, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "40379:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160400, "initialValue": { "hexValue": "30", "id": 160399, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "40391:1:233", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }, "nodeType": "VariableDeclarationStatement", "src": "40379:13:233" }, "loopExpression": { "expression": { "id": 160405, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "UnaryOperation", "operator": "++", "prefix": true, "src": "40414:3:233", "subExpression": { "id": 160404, "name": "i", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160398, "src": "40416:1:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160406, "nodeType": "ExpressionStatement", "src": "40414:3:233" }, "nodeType": "ForStatement", "src": "40374:1719:233" }, { "expression": { "id": 160471, "name": "maxBondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160369, "src": "42110:13:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 160312, "id": 160472, "nodeType": "Return", "src": "42103:20:233" }] }, "documentation": { "id": 160301, "nodeType": "StructuredDocumentation", "src": "37356:277:233", "text": "@dev Gets the absolute max short that can be opened without violating\n      the pool's solvency constraints.\n @param _checkpointExposure The long exposure in the current checkpoint.\n @return The maximum amount of shares that can be used to open shorts." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateMaxShort", "nameLocation": "37647:17:233", "parameters": { "id": 160309, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160304, "mutability": "mutable", "name": "_params", "nameLocation": "37696:7:233", "nodeType": "VariableDeclaration", "scope": 160474, "src": "37674:29:233", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" }, "typeName": { "id": 160303, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 160302, "name": "MaxTradeParams", "nameLocations": ["37674:14:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 159351, "src": "37674:14:233" }, "referencedDeclaration": 159351, "src": "37674:14:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_storage_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" } }, "visibility": "internal" }, { "constant": false, "id": 160306, "mutability": "mutable", "name": "_checkpointExposure", "nameLocation": "37720:19:233", "nodeType": "VariableDeclaration", "scope": 160474, "src": "37713:26:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" }, "typeName": { "id": 160305, "name": "int256", "nodeType": "ElementaryTypeName", "src": "37713:6:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "visibility": "internal" }, { "constant": false, "id": 160308, "mutability": "mutable", "name": "_maxIterations", "nameLocation": "37757:14:233", "nodeType": "VariableDeclaration", "scope": 160474, "src": "37749:22:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160307, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "37749:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "37664:113:233" }, "returnParameters": { "id": 160312, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160311, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 160474, "src": "37801:7:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160310, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "37801:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "37800:9:233" }, "scope": 161325, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 160583, "nodeType": "FunctionDefinition", "src": "42555:2183:233", "nodes": [], "body": { "id": 160582, "nodeType": "Block", "src": "42710:2028:233", "nodes": [], "statements": [{ "assignments": [160486], "declarations": [{ "constant": false, "id": 160486, "mutability": "mutable", "name": "optimalShareReserves", "nameLocation": "42952:20:233", "nodeType": "VariableDeclaration", "scope": 160582, "src": "42944:28:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160485, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "42944:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160498, "initialValue": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160497, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "expression": { "id": 160487, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160478, "src": "42975:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160488, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "42983:20:233", "memberName": "minimumShareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159344, "src": "42975:28:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "arguments": [{ "arguments": [{ "hexValue": "30", "id": 160494, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "43054:1:233", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }], "expression": { "expression": { "id": 160491, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160478, "src": "43026:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160492, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "43034:15:233", "memberName": "shareAdjustment", "nodeType": "MemberAccess", "referencedDeclaration": 159330, "src": "43026:23:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "id": 160493, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "43050:3:233", "memberName": "max", "nodeType": "MemberAccess", "referencedDeclaration": 19441, "src": "43026:27:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_int256_$_t_int256_$returns$_t_int256_$attached_to$_t_int256_$", "typeString": "function (int256,int256) pure returns (int256)" } }, "id": 160495, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "43026:30:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 160490, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "43018:7:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_uint256_$", "typeString": "type(uint256)" }, "typeName": { "id": 160489, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "43018:7:233", "typeDescriptions": {} } }, "id": 160496, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "43018:39:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "42975:82:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "42944:113:233" }, { "assignments": [160500], "declarations": [{ "constant": false, "id": 160500, "mutability": "mutable", "name": "k_", "nameLocation": "43469:2:233", "nodeType": "VariableDeclaration", "scope": 160582, "src": "43461:10:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160499, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "43461:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160515, "initialValue": { "arguments": [{ "id": 160503, "name": "_effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160480, "src": "43508:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160504, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160478, "src": "43545:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160505, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "43553:12:233", "memberName": "bondReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159332, "src": "43545:20:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160509, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160506, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "43579:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 160507, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160478, "src": "43585:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160508, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "43593:11:233", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159338, "src": "43585:19:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "43579:25:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160510, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160478, "src": "43618:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160511, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "43626:15:233", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159340, "src": "43618:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160512, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160478, "src": "43655:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160513, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "43663:22:233", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159342, "src": "43655:30:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160501, "name": "YieldSpaceMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 23292, "src": "43474:14:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_YieldSpaceMath_$23292_$", "typeString": "type(library YieldSpaceMath)" } }, "id": 160502, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "43489:5:233", "memberName": "kDown", "nodeType": "MemberAccess", "referencedDeclaration": 23291, "src": "43474:20:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256,uint256,uint256) pure returns (uint256)" } }, "id": 160514, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "43474:221:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "43461:234:233" }, { "assignments": [160517], "declarations": [{ "constant": false, "id": 160517, "mutability": "mutable", "name": "optimalBondReserves", "nameLocation": "43713:19:233", "nodeType": "VariableDeclaration", "scope": 160582, "src": "43705:27:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160516, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "43705:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160544, "initialValue": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160543, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160518, "name": "k_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160500, "src": "43735:2:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [{ "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160540, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160537, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "44164:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 160538, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160478, "src": "44170:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160539, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "44178:11:233", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159338, "src": "44170:19:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "44164:25:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "arguments": [{ "id": 160531, "name": "optimalShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160486, "src": "44017:20:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160532, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160478, "src": "44067:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160533, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "44075:15:233", "memberName": "shareAdjustment", "nodeType": "MemberAccess", "referencedDeclaration": 159330, "src": "44067:23:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_int256", "typeString": "int256" }], "expression": { "id": 160529, "name": "HyperdriveMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20190, "src": "43941:14:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_HyperdriveMath_$20190_$", "typeString": "type(library HyperdriveMath)" } }, "id": 160530, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "43956:31:233", "memberName": "calculateEffectiveShareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 19633, "src": "43941:46:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_int256_$returns$_t_uint256_$", "typeString": "function (uint256,int256) pure returns (uint256)" } }, "id": 160534, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "43941:175:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 160526, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160478, "src": "43837:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160527, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "43866:22:233", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159342, "src": "43837:51:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160528, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "43910:5:233", "memberName": "mulUp", "nodeType": "MemberAccess", "referencedDeclaration": 18772, "src": "43837:78:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160535, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "43837:301:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160536, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "44160:3:233", "memberName": "pow", "nodeType": "MemberAccess", "referencedDeclaration": 18847, "src": "43837:326:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160541, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "43837:353:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "expression": { "id": 160522, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160478, "src": "43782:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160523, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "43790:22:233", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159342, "src": "43782:30:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 160519, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160478, "src": "43752:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160520, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "43760:15:233", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159340, "src": "43752:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160521, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "43776:5:233", "memberName": "divUp", "nodeType": "MemberAccess", "referencedDeclaration": 18790, "src": "43752:29:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160524, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "43752:61:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160525, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "43814:5:233", "memberName": "mulUp", "nodeType": "MemberAccess", "referencedDeclaration": 18772, "src": "43752:67:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160542, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "43752:452:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "43735:469:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "43705:499:233" }, { "condition": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160547, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160545, "name": "optimalBondReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160517, "src": "44218:19:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": ">=", "rightExpression": { "id": 160546, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "44241:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "44218:26:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "falseBody": { "id": 160575, "nodeType": "Block", "src": "44464:208:233", "statements": [{ "expression": { "id": 160573, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 160562, "name": "optimalBondReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160517, "src": "44548:19:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160570, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160567, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "44621:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 160568, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160478, "src": "44627:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160569, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "44635:11:233", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159338, "src": "44627:19:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "44621:25:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160565, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "44611:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160566, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "44615:5:233", "memberName": "divUp", "nodeType": "MemberAccess", "referencedDeclaration": 18790, "src": "44611:9:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160571, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "44611:36:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160563, "name": "optimalBondReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160517, "src": "44570:19:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160564, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "44590:3:233", "memberName": "pow", "nodeType": "MemberAccess", "referencedDeclaration": 18847, "src": "44570:23:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160572, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "44570:91:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "44548:113:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160574, "nodeType": "ExpressionStatement", "src": "44548:113:233" }] }, "id": 160576, "nodeType": "IfStatement", "src": "44214:458:233", "trueBody": { "id": 160561, "nodeType": "Block", "src": "44246:212:233", "statements": [{ "expression": { "id": 160559, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 160548, "name": "optimalBondReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160517, "src": "44332:19:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160556, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160553, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "44407:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 160554, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160478, "src": "44413:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160555, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "44421:11:233", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159338, "src": "44413:19:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "44407:25:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160551, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "44395:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160552, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "44399:7:233", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "44395:11:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160557, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "44395:38:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160549, "name": "optimalBondReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160517, "src": "44354:19:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160550, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "44374:3:233", "memberName": "pow", "nodeType": "MemberAccess", "referencedDeclaration": 18847, "src": "44354:23:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160558, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "44354:93:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "44332:115:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160560, "nodeType": "ExpressionStatement", "src": "44332:115:233" }] } }, { "expression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160580, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160577, "name": "optimalBondReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160517, "src": "44689:19:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 160578, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160478, "src": "44711:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160579, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "44719:12:233", "memberName": "bondReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159332, "src": "44711:20:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "44689:42:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 160484, "id": 160581, "nodeType": "Return", "src": "44682:49:233" }] }, "documentation": { "id": 160475, "nodeType": "StructuredDocumentation", "src": "42136:414:233", "text": "@dev Calculates the max short that can be opened on the YieldSpace curve\n      without considering solvency constraints.\n @param _params Information about the market state and pool configuration\n        used to compute the maximum trade.\n @param _effectiveShareReserves The effective share reserves.\n @return The max short YieldSpace can support without considering solvency." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateMaxShortUpperBound", "nameLocation": "42564:27:233", "parameters": { "id": 160481, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160478, "mutability": "mutable", "name": "_params", "nameLocation": "42623:7:233", "nodeType": "VariableDeclaration", "scope": 160583, "src": "42601:29:233", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" }, "typeName": { "id": 160477, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 160476, "name": "MaxTradeParams", "nameLocations": ["42601:14:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 159351, "src": "42601:14:233" }, "referencedDeclaration": 159351, "src": "42601:14:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_storage_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" } }, "visibility": "internal" }, { "constant": false, "id": 160480, "mutability": "mutable", "name": "_effectiveShareReserves", "nameLocation": "42648:23:233", "nodeType": "VariableDeclaration", "scope": 160583, "src": "42640:31:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160479, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "42640:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "42591:86:233" }, "returnParameters": { "id": 160484, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160483, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 160583, "src": "42701:7:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160482, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "42701:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "42700:9:233" }, "scope": 161325, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 160657, "nodeType": "FunctionDefinition", "src": "46195:866:233", "nodes": [], "body": { "id": 160656, "nodeType": "Block", "src": "46368:693:233", "nodes": [], "statements": [{ "assignments": [160597], "declarations": [{ "constant": false, "id": 160597, "mutability": "mutable", "name": "estimatePrice", "nameLocation": "46386:13:233", "nodeType": "VariableDeclaration", "scope": 160656, "src": "46378:21:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160596, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "46378:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160599, "initialValue": { "id": 160598, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160589, "src": "46402:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "46378:34:233" }, { "assignments": [160601], "declarations": [{ "constant": false, "id": 160601, "mutability": "mutable", "name": "guess", "nameLocation": "46430:5:233", "nodeType": "VariableDeclaration", "scope": 160656, "src": "46422:13:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160600, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "46422:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160630, "initialValue": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160628, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160625, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160618, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "expression": { "id": 160605, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160587, "src": "46483:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160606, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "46491:13:233", "memberName": "shareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159328, "src": "46483:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "arguments": [{ "expression": { "id": 160615, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160587, "src": "46588:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160616, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "46596:15:233", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159340, "src": "46588:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "arguments": [{ "hexValue": "30", "id": 160611, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "46555:1:233", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }], "expression": { "id": 160609, "name": "_checkpointExposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160591, "src": "46531:19:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "id": 160610, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "46551:3:233", "memberName": "max", "nodeType": "MemberAccess", "referencedDeclaration": 19441, "src": "46531:23:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_int256_$_t_int256_$returns$_t_int256_$attached_to$_t_int256_$", "typeString": "function (int256,int256) pure returns (int256)" } }, "id": 160612, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "46531:26:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 160608, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "46523:7:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_uint256_$", "typeString": "type(uint256)" }, "typeName": { "id": 160607, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "46523:7:233", "typeDescriptions": {} } }, "id": 160613, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "46523:35:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160614, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "46559:7:233", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "46523:43:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160617, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "46523:106:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "46483:146:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [{ "expression": { "id": 160622, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160587, "src": "46677:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160623, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "46685:15:233", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159340, "src": "46677:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 160619, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160587, "src": "46648:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160620, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "46656:12:233", "memberName": "longExposure", "nodeType": "MemberAccess", "referencedDeclaration": 159336, "src": "46648:20:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160621, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "46669:7:233", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "46648:28:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160624, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "46648:53:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "46483:218:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 160626, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160587, "src": "46720:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160627, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "46728:20:233", "memberName": "minimumShareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159344, "src": "46720:28:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "46483:265:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 160602, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160587, "src": "46438:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160603, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "46446:15:233", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159340, "src": "46438:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160604, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "46462:7:233", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "46438:31:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160629, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "46438:320:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "46422:336:233" }, { "expression": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160653, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160641, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160633, "name": "estimatePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160597, "src": "46818:13:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160639, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160637, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "46879:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 160638, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160589, "src": "46885:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "46879:16:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 160634, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160587, "src": "46854:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160635, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "46862:8:233", "memberName": "curveFee", "nodeType": "MemberAccess", "referencedDeclaration": 159346, "src": "46854:16:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160636, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "46871:7:233", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "46854:24:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160640, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "46854:42:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "46818:78:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160651, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160649, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "47002:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 160650, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160589, "src": "47008:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "47002:16:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "expression": { "id": 160645, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160587, "src": "46951:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160646, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "46959:8:233", "memberName": "curveFee", "nodeType": "MemberAccess", "referencedDeclaration": 159346, "src": "46951:16:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 160642, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160587, "src": "46919:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160643, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "46927:15:233", "memberName": "governanceLPFee", "nodeType": "MemberAccess", "referencedDeclaration": 159350, "src": "46919:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160644, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "46943:7:233", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "46919:31:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160647, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "46919:49:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160648, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "46969:7:233", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "46919:57:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160652, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "46919:121:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "46818:222:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160631, "name": "guess", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160601, "src": "46787:5:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160632, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "46793:7:233", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "46787:13:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160654, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "46787:267:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 160595, "id": 160655, "nodeType": "Return", "src": "46768:286:233" }] }, "documentation": { "id": 160584, "nodeType": "StructuredDocumentation", "src": "44744:1446:233", "text": "@dev Gets an initial guess for the absolute max short. This is a\n      conservative guess that will be less than the true absolute max\n      short, which is what we need to start Newton's method.\n      To calculate our guess, we assume an unrealistically good realized\n      price $p_r$ for opening the short. This allows us to approximate\n      $P(x) \\approx \\tfrac{1}{c} \\cdot p_r \\cdot x$. Plugging this\n      into our solvency function $s(x)$, we get an approximation of our\n      solvency as:\n      $$\n      S(x) \\approx (z_0 - \\tfrac{1}{c} \\cdot (\n                       p_r - \\phi_{c} \\cdot (1 - p) + \\phi_{g} \\cdot \\phi_{c} \\cdot (1 - p)\n                   ) \\cdot x) - \\tfrac{e_0 - max(e_{c}, 0)}{c} - z_{min}\n      $$\n      Setting this equal to zero, we can solve for our initial guess:\n      $$\n      x = \\frac{c \\cdot (s_0 + \\tfrac{max(e_{c}, 0)}{c})}{\n              p_r - \\phi_{c} \\cdot (1 - p) + \\phi_{g} \\cdot \\phi_{c} \\cdot (1 - p)\n          }\n      $$\n @param _params Information about the market state and pool configuration\n        used to compute the maximum trade.\n @param _spotPrice The spot price.\n @param _checkpointExposure The exposure from the current checkpoint.\n @return The initial guess for the max short calculation." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateMaxShortGuess", "nameLocation": "46204:22:233", "parameters": { "id": 160592, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160587, "mutability": "mutable", "name": "_params", "nameLocation": "46258:7:233", "nodeType": "VariableDeclaration", "scope": 160657, "src": "46236:29:233", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" }, "typeName": { "id": 160586, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 160585, "name": "MaxTradeParams", "nameLocations": ["46236:14:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 159351, "src": "46236:14:233" }, "referencedDeclaration": 159351, "src": "46236:14:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_storage_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" } }, "visibility": "internal" }, { "constant": false, "id": 160589, "mutability": "mutable", "name": "_spotPrice", "nameLocation": "46283:10:233", "nodeType": "VariableDeclaration", "scope": 160657, "src": "46275:18:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160588, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "46275:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160591, "mutability": "mutable", "name": "_checkpointExposure", "nameLocation": "46310:19:233", "nodeType": "VariableDeclaration", "scope": 160657, "src": "46303:26:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" }, "typeName": { "id": 160590, "name": "int256", "nodeType": "ElementaryTypeName", "src": "46303:6:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "visibility": "internal" }], "src": "46226:109:233" }, "returnParameters": { "id": 160595, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160594, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 160657, "src": "46359:7:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160593, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "46359:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "46358:9:233" }, "scope": 161325, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 160774, "nodeType": "FunctionDefinition", "src": "48824:1941:233", "nodes": [], "body": { "id": 160773, "nodeType": "Block", "src": "49079:1686:233", "nodes": [], "statements": [{ "assignments": [160677, 160679], "declarations": [{ "constant": false, "id": 160677, "mutability": "mutable", "name": "shareAmount", "nameLocation": "49334:11:233", "nodeType": "VariableDeclaration", "scope": 160773, "src": "49326:19:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160676, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "49326:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160679, "mutability": "mutable", "name": "success", "nameLocation": "49352:7:233", "nodeType": "VariableDeclaration", "scope": 160773, "src": "49347:12:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "typeName": { "id": 160678, "name": "bool", "nodeType": "ElementaryTypeName", "src": "49347:4:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "visibility": "internal" }], "id": 160695, "initialValue": { "arguments": [{ "id": 160682, "name": "_effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160665, "src": "49447:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160683, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160661, "src": "49488:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160684, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "49496:12:233", "memberName": "bondReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159332, "src": "49488:20:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160685, "name": "_shortAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160663, "src": "49526:12:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160689, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160686, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "49556:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 160687, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160661, "src": "49562:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160688, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "49570:11:233", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159338, "src": "49562:19:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "49556:25:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160690, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160661, "src": "49599:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160691, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "49607:15:233", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159340, "src": "49599:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160692, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160661, "src": "49640:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160693, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "49648:22:233", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159342, "src": "49640:30:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160680, "name": "YieldSpaceMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 23292, "src": "49363:14:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_YieldSpaceMath_$23292_$", "typeString": "type(library YieldSpaceMath)" } }, "id": 160681, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "49391:38:233", "memberName": "calculateSharesOutGivenBondsInDownSafe", "nodeType": "MemberAccess", "referencedDeclaration": 22919, "src": "49363:66:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$_t_bool_$", "typeString": "function (uint256,uint256,uint256,uint256,uint256,uint256) pure returns (uint256,bool)" } }, "id": 160694, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "49363:321:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "nodeType": "VariableDeclarationStatement", "src": "49325:359:233" }, { "condition": { "id": 160697, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "UnaryOperation", "operator": "!", "prefix": true, "src": "49698:8:233", "subExpression": { "id": 160696, "name": "success", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160679, "src": "49699:7:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "id": 160703, "nodeType": "IfStatement", "src": "49694:56:233", "trueBody": { "id": 160702, "nodeType": "Block", "src": "49708:42:233", "statements": [{ "expression": { "components": [{ "hexValue": "30", "id": 160698, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "49730:1:233", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }, { "hexValue": "66616c7365", "id": 160699, "isConstant": false, "isLValue": false, "isPure": true, "kind": "bool", "lValueRequested": false, "nodeType": "Literal", "src": "49733:5:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "value": "false" }], "id": 160700, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "TupleExpression", "src": "49729:10:233", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_rational_0_by_1_$_t_bool_$", "typeString": "tuple(int_const 0,bool)" } }, "functionReturnParameters": 160675, "id": 160701, "nodeType": "Return", "src": "49722:17:233" }] } }, { "assignments": [160705], "declarations": [{ "constant": false, "id": 160705, "mutability": "mutable", "name": "shareReserves", "nameLocation": "49834:13:233", "nodeType": "VariableDeclaration", "scope": 160773, "src": "49826:21:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160704, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "49826:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160732, "initialValue": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160731, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "expression": { "id": 160706, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160661, "src": "49850:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160707, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "49858:13:233", "memberName": "shareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159328, "src": "49850:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160729, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160708, "name": "shareAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160677, "src": "49887:11:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [{ "expression": { "id": 160726, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160661, "src": "50309:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160727, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "50317:15:233", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159340, "src": "50309:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160723, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "arguments": [{ "id": 160710, "name": "_shortAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160663, "src": "49962:12:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160711, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160667, "src": "49996:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160712, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160661, "src": "50028:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160713, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "50036:8:233", "memberName": "curveFee", "nodeType": "MemberAccess", "referencedDeclaration": 159346, "src": "50028:16:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 160709, "name": "calculateShortCurveFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160948, "src": "49918:22:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 160714, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "49918:144:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [{ "id": 160716, "name": "_shortAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160663, "src": "50138:12:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160717, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160667, "src": "50176:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160718, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160661, "src": "50212:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160719, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "50220:8:233", "memberName": "curveFee", "nodeType": "MemberAccess", "referencedDeclaration": 159346, "src": "50212:16:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160720, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160661, "src": "50254:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160721, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "50262:15:233", "memberName": "governanceLPFee", "nodeType": "MemberAccess", "referencedDeclaration": 159350, "src": "50254:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 160715, "name": "calculateShortGovernanceFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160972, "src": "50085:27:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256,uint256) pure returns (uint256)" } }, "id": 160722, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "50085:214:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "49918:381:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 160724, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "49917:383:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160725, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "50301:7:233", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "49917:391:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160728, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "49917:416:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "49887:446:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 160730, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "49886:448:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "49850:484:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "49826:508:233" }, { "assignments": [160734], "declarations": [{ "constant": false, "id": 160734, "mutability": "mutable", "name": "exposure", "nameLocation": "50352:8:233", "nodeType": "VariableDeclaration", "scope": 160773, "src": "50344:16:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160733, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "50344:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160750, "initialValue": { "arguments": [{ "expression": { "id": 160747, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160661, "src": "50461:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160748, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "50469:15:233", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159340, "src": "50461:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160744, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "expression": { "id": 160735, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160661, "src": "50364:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160736, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "50372:12:233", "memberName": "longExposure", "nodeType": "MemberAccess", "referencedDeclaration": 159336, "src": "50364:20:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [{ "arguments": [{ "hexValue": "30", "id": 160741, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "50431:1:233", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }], "expression": { "id": 160739, "name": "_checkpointExposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160669, "src": "50407:19:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "id": 160740, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "50427:3:233", "memberName": "max", "nodeType": "MemberAccess", "referencedDeclaration": 19441, "src": "50407:23:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_int256_$_t_int256_$returns$_t_int256_$attached_to$_t_int256_$", "typeString": "function (int256,int256) pure returns (int256)" } }, "id": 160742, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "50407:26:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 160738, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "50399:7:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_uint256_$", "typeString": "type(uint256)" }, "typeName": { "id": 160737, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "50399:7:233", "typeDescriptions": {} } }, "id": 160743, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "50399:35:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "50364:70:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 160745, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "50363:72:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160746, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "50436:7:233", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "50363:80:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160749, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "50363:135:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "50344:154:233" }, { "condition": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160756, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160751, "name": "shareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160705, "src": "50512:13:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": ">=", "rightExpression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160755, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160752, "name": "exposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160734, "src": "50529:8:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "expression": { "id": 160753, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160661, "src": "50540:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160754, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "50548:20:233", "memberName": "minimumShareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159344, "src": "50540:28:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "50529:39:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "50512:56:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "falseBody": { "id": 160771, "nodeType": "Block", "src": "50717:42:233", "statements": [{ "expression": { "components": [{ "hexValue": "30", "id": 160767, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "50739:1:233", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }, { "hexValue": "66616c7365", "id": 160768, "isConstant": false, "isLValue": false, "isPure": true, "kind": "bool", "lValueRequested": false, "nodeType": "Literal", "src": "50742:5:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "value": "false" }], "id": 160769, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "TupleExpression", "src": "50738:10:233", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_rational_0_by_1_$_t_bool_$", "typeString": "tuple(int_const 0,bool)" } }, "functionReturnParameters": 160675, "id": 160770, "nodeType": "Return", "src": "50731:17:233" }] }, "id": 160772, "nodeType": "IfStatement", "src": "50508:251:233", "trueBody": { "id": 160766, "nodeType": "Block", "src": "50570:141:233", "statements": [{ "expression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160762, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160759, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160757, "name": "shareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160705, "src": "50609:13:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 160758, "name": "exposure", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160734, "src": "50625:8:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "50609:24:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 160760, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160661, "src": "50636:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160761, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "50644:20:233", "memberName": "minimumShareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159344, "src": "50636:28:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "50609:55:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "hexValue": "74727565", "id": 160763, "isConstant": false, "isLValue": false, "isPure": true, "kind": "bool", "lValueRequested": false, "nodeType": "Literal", "src": "50682:4:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "value": "true" }], "id": 160764, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "50591:109:233", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "functionReturnParameters": 160675, "id": 160765, "nodeType": "Return", "src": "50584:116:233" }] } }] }, "documentation": { "id": 160658, "nodeType": "StructuredDocumentation", "src": "47067:1752:233", "text": "@dev Gets the pool's solvency after opening a short.\n      We can express the pool's solvency after opening a short of $x$\n      bonds as:\n      $$\n      s(x) = z(x) - \\tfrac{e(x)}{c} - z_{min}\n      $$\n      where $z(x)$ represents the pool's share reserves after opening the\n      short:\n      $$\n      z(x) = z_0 - \\left(\n                 P(x) - \\left( \\tfrac{c(x)}{c} - \\tfrac{g(x)}{c} \\right)\n             \\right)\n      $$\n      and $e(x)$ represents the pool's exposure after opening the short:\n      $$\n      e(x) = e_0 - min(x, max(e_{c}, 0))\n      $$\n      We simplify our $e(x)$ formula by noting that the max short is only\n      constrained by solvency when $x > max(e_{c}, 0)$ since $x$ grows\n      faster than\n      $P(x) - \\tfrac{\\phi_{c}}{c} \\cdot \\left( 1 - p \\right) \\cdot x$.\n      With this in mind, $min(x, max(e_{c}, 0)) = max(e_{c}, 0)$\n      whenever solvency is actually a constraint, so we can write:\n      $$\n      e(x) = e_0 - max(e_{c}, 0)\n      $$\n @param _params Information about the market state and pool configuration\n        used to compute the maximum trade.\n @param _shortAmount The short amount.\n @param _effectiveShareReserves The effective share reserves.\n @param _spotPrice The spot price.\n @param _checkpointExposure The exposure in the current checkpoint.\n @return The pool's solvency after a short is opened.\n @return A flag indicating whether or not the derivative was\n         successfully calculated." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateSolvencyAfterShort", "nameLocation": "48833:27:233", "parameters": { "id": 160670, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160661, "mutability": "mutable", "name": "_params", "nameLocation": "48892:7:233", "nodeType": "VariableDeclaration", "scope": 160774, "src": "48870:29:233", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" }, "typeName": { "id": 160660, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 160659, "name": "MaxTradeParams", "nameLocations": ["48870:14:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 159351, "src": "48870:14:233" }, "referencedDeclaration": 159351, "src": "48870:14:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_storage_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" } }, "visibility": "internal" }, { "constant": false, "id": 160663, "mutability": "mutable", "name": "_shortAmount", "nameLocation": "48917:12:233", "nodeType": "VariableDeclaration", "scope": 160774, "src": "48909:20:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160662, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "48909:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160665, "mutability": "mutable", "name": "_effectiveShareReserves", "nameLocation": "48947:23:233", "nodeType": "VariableDeclaration", "scope": 160774, "src": "48939:31:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160664, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "48939:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160667, "mutability": "mutable", "name": "_spotPrice", "nameLocation": "48988:10:233", "nodeType": "VariableDeclaration", "scope": 160774, "src": "48980:18:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160666, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "48980:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160669, "mutability": "mutable", "name": "_checkpointExposure", "nameLocation": "49015:19:233", "nodeType": "VariableDeclaration", "scope": 160774, "src": "49008:26:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" }, "typeName": { "id": 160668, "name": "int256", "nodeType": "ElementaryTypeName", "src": "49008:6:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "visibility": "internal" }], "src": "48860:180:233" }, "returnParameters": { "id": 160675, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160672, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 160774, "src": "49064:7:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160671, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "49064:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160674, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 160774, "src": "49073:4:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "typeName": { "id": 160673, "name": "bool", "nodeType": "ElementaryTypeName", "src": "49073:4:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "visibility": "internal" }], "src": "49063:15:233" }, "scope": 161325, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 160836, "nodeType": "FunctionDefinition", "src": "51649:699:233", "nodes": [], "body": { "id": 160835, "nodeType": "Block", "src": "51878:470:233", "nodes": [], "statements": [{ "assignments": [160792], "declarations": [{ "constant": false, "id": 160792, "mutability": "mutable", "name": "lhs", "nameLocation": "51896:3:233", "nodeType": "VariableDeclaration", "scope": 160835, "src": "51888:11:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160791, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "51888:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160798, "initialValue": { "arguments": [{ "id": 160794, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160778, "src": "51949:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, { "id": 160795, "name": "_shortAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160780, "src": "51970:12:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160796, "name": "_effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160784, "src": "51996:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 160793, "name": "calculateShortPrincipalDerivative", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160925, "src": "51902:33:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_MaxTradeParams_$159351_memory_ptr_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (struct HyperdriveUtils.MaxTradeParams memory,uint256,uint256) pure returns (uint256)" } }, "id": 160797, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "51902:127:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "51888:141:233" }, { "assignments": [160800], "declarations": [{ "constant": false, "id": 160800, "mutability": "mutable", "name": "rhs", "nameLocation": "52047:3:233", "nodeType": "VariableDeclaration", "scope": 160835, "src": "52039:11:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160799, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "52039:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160818, "initialValue": { "arguments": [{ "expression": { "id": 160815, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160778, "src": "52195:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160816, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "52203:15:233", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159340, "src": "52195:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160812, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160809, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "52143:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 160810, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160778, "src": "52149:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160811, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "52157:15:233", "memberName": "governanceLPFee", "nodeType": "MemberAccess", "referencedDeclaration": 159350, "src": "52149:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "52143:29:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160806, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160804, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "52104:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 160805, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160782, "src": "52110:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "52104:16:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 160801, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160778, "src": "52053:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160802, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "52074:8:233", "memberName": "curveFee", "nodeType": "MemberAccess", "referencedDeclaration": 159346, "src": "52053:29:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160803, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "52096:7:233", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "52053:50:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160807, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "52053:68:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160808, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "52135:7:233", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "52053:89:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160813, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "52053:120:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160814, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "52187:7:233", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "52053:141:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160817, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "52053:166:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "52039:180:233" }, { "condition": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160821, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160819, "name": "lhs", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160792, "src": "52233:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": ">=", "rightExpression": { "id": 160820, "name": "rhs", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160800, "src": "52240:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "52233:10:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "falseBody": { "id": 160833, "nodeType": "Block", "src": "52300:42:233", "statements": [{ "expression": { "components": [{ "hexValue": "30", "id": 160829, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "52322:1:233", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }, { "hexValue": "66616c7365", "id": 160830, "isConstant": false, "isLValue": false, "isPure": true, "kind": "bool", "lValueRequested": false, "nodeType": "Literal", "src": "52325:5:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "value": "false" }], "id": 160831, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "TupleExpression", "src": "52321:10:233", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_rational_0_by_1_$_t_bool_$", "typeString": "tuple(int_const 0,bool)" } }, "functionReturnParameters": 160790, "id": 160832, "nodeType": "Return", "src": "52314:17:233" }] }, "id": 160834, "nodeType": "IfStatement", "src": "52229:113:233", "trueBody": { "id": 160828, "nodeType": "Block", "src": "52245:49:233", "statements": [{ "expression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160824, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160822, "name": "lhs", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160792, "src": "52267:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 160823, "name": "rhs", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160800, "src": "52273:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "52267:9:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "hexValue": "74727565", "id": 160825, "isConstant": false, "isLValue": false, "isPure": true, "kind": "bool", "lValueRequested": false, "nodeType": "Literal", "src": "52278:4:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "value": "true" }], "id": 160826, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "52266:17:233", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "functionReturnParameters": 160790, "id": 160827, "nodeType": "Return", "src": "52259:24:233" }] } }] }, "documentation": { "id": 160775, "nodeType": "StructuredDocumentation", "src": "50771:873:233", "text": "@dev Gets the derivative of the pool's solvency w.r.t. the short amount.\n      The derivative is calculated as:\n      \\begin{aligned}\n      s'(x) &= z'(x) - 0 - 0\n            &= 0 - \\left( P'(x) - \\frac{(c'(x) - g'(x))}{c} \\right)\n            &= -P'(x) + \\frac{\n                   \\phi_{c} \\cdot (1 - p) \\cdot (1 - \\phi_{g})\n               }{c}\n      \\end{aligned}\n      Since solvency decreases as the short amount increases, we negate\n      the derivative. This avoids issues with the fixed point library\n      which doesn't support negative values.\n @return The derivative of the solvency after short function w.r.t. the\n         bond amount.\n @return A flag indicating whether or not the derivative was\n         successfully calculated." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateSolvencyAfterShortDerivative", "nameLocation": "51658:37:233", "parameters": { "id": 160785, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160778, "mutability": "mutable", "name": "_params", "nameLocation": "51727:7:233", "nodeType": "VariableDeclaration", "scope": 160836, "src": "51705:29:233", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" }, "typeName": { "id": 160777, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 160776, "name": "MaxTradeParams", "nameLocations": ["51705:14:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 159351, "src": "51705:14:233" }, "referencedDeclaration": 159351, "src": "51705:14:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_storage_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" } }, "visibility": "internal" }, { "constant": false, "id": 160780, "mutability": "mutable", "name": "_shortAmount", "nameLocation": "51752:12:233", "nodeType": "VariableDeclaration", "scope": 160836, "src": "51744:20:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160779, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "51744:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160782, "mutability": "mutable", "name": "_spotPrice", "nameLocation": "51782:10:233", "nodeType": "VariableDeclaration", "scope": 160836, "src": "51774:18:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160781, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "51774:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160784, "mutability": "mutable", "name": "_effectiveShareReserves", "nameLocation": "51810:23:233", "nodeType": "VariableDeclaration", "scope": 160836, "src": "51802:31:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160783, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "51802:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "51695:144:233" }, "returnParameters": { "id": 160790, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160787, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 160836, "src": "51863:7:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160786, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "51863:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160789, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 160836, "src": "51872:4:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "typeName": { "id": 160788, "name": "bool", "nodeType": "ElementaryTypeName", "src": "51872:4:233", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "visibility": "internal" }], "src": "51862:15:233" }, "scope": 161325, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 160925, "nodeType": "FunctionDefinition", "src": "53015:1033:233", "nodes": [], "body": { "id": 160924, "nodeType": "Block", "src": "53206:842:233", "nodes": [], "statements": [{ "assignments": [160850], "declarations": [{ "constant": false, "id": 160850, "mutability": "mutable", "name": "k_", "nameLocation": "53224:2:233", "nodeType": "VariableDeclaration", "scope": 160924, "src": "53216:10:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160849, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "53216:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160865, "initialValue": { "arguments": [{ "id": 160853, "name": "_effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160844, "src": "53263:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160854, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160840, "src": "53300:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160855, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "53308:12:233", "memberName": "bondReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159332, "src": "53300:20:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160859, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160856, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "53334:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 160857, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160840, "src": "53340:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160858, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "53348:11:233", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159338, "src": "53340:19:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "53334:25:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160860, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160840, "src": "53373:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160861, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "53381:15:233", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159340, "src": "53373:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 160862, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160840, "src": "53410:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160863, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "53418:22:233", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159342, "src": "53410:30:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160851, "name": "YieldSpaceMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 23292, "src": "53229:14:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_YieldSpaceMath_$23292_$", "typeString": "type(library YieldSpaceMath)" } }, "id": 160852, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "53244:5:233", "memberName": "kDown", "nodeType": "MemberAccess", "referencedDeclaration": 23291, "src": "53229:20:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256,uint256,uint256) pure returns (uint256)" } }, "id": 160864, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "53229:221:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "53216:234:233" }, { "assignments": [160867], "declarations": [{ "constant": false, "id": 160867, "mutability": "mutable", "name": "lhs", "nameLocation": "53468:3:233", "nodeType": "VariableDeclaration", "scope": 160924, "src": "53460:11:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160866, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "53460:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160884, "initialValue": { "arguments": [{ "arguments": [{ "arguments": [{ "expression": { "id": 160879, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160840, "src": "53588:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160880, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "53596:11:233", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159338, "src": "53588:19:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160876, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "expression": { "id": 160873, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160840, "src": "53547:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160874, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "53555:12:233", "memberName": "bondReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159332, "src": "53547:20:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "id": 160875, "name": "_shortAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160842, "src": "53570:12:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "53547:35:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 160877, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "53546:37:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160878, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "53584:3:233", "memberName": "pow", "nodeType": "MemberAccess", "referencedDeclaration": 18847, "src": "53546:41:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160881, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "53546:62:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 160870, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160840, "src": "53499:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160871, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "53507:15:233", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159340, "src": "53499:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160872, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "53523:5:233", "memberName": "mulUp", "nodeType": "MemberAccess", "referencedDeclaration": 18772, "src": "53499:29:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160882, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "53499:123:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160868, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "53474:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160869, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "53478:7:233", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "53474:11:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160883, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "53474:158:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "53460:172:233" }, { "assignments": [160886], "declarations": [{ "constant": false, "id": 160886, "mutability": "mutable", "name": "rhs", "nameLocation": "53650:3:233", "nodeType": "VariableDeclaration", "scope": 160924, "src": "53642:11:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160885, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "53642:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 160918, "initialValue": { "arguments": [{ "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160915, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160912, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "53981:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 160913, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160840, "src": "53987:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160914, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "53995:11:233", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159338, "src": "53987:19:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "53981:25:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 160909, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160840, "src": "53955:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160910, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "53963:11:233", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159338, "src": "53955:19:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160911, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "53975:5:233", "memberName": "divUp", "nodeType": "MemberAccess", "referencedDeclaration": 18790, "src": "53955:25:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160916, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "53955:52:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160906, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160894, "name": "k_", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160850, "src": "53784:2:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160904, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160901, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "53876:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 160902, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160840, "src": "53882:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160903, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "53890:11:233", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 159338, "src": "53882:19:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "53876:25:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160898, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "expression": { "id": 160895, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160840, "src": "53810:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160896, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "53818:12:233", "memberName": "bondReserves", "nodeType": "MemberAccess", "referencedDeclaration": 159332, "src": "53810:20:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "id": 160897, "name": "_shortAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160842, "src": "53833:12:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "53810:35:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 160899, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "53809:37:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160900, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "53847:3:233", "memberName": "pow", "nodeType": "MemberAccess", "referencedDeclaration": 18847, "src": "53809:41:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160905, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "53809:114:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "53784:139:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "expression": { "id": 160890, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160840, "src": "53721:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160891, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "53729:15:233", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159340, "src": "53721:23:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 160887, "name": "_params", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160840, "src": "53656:7:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams memory" } }, "id": 160888, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "53677:22:233", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 159342, "src": "53656:43:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160889, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "53713:7:233", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "53656:64:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160892, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "53656:89:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160893, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "53759:7:233", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "53656:110:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160907, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "53656:281:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160908, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "53951:3:233", "memberName": "pow", "nodeType": "MemberAccess", "referencedDeclaration": 18847, "src": "53656:298:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160917, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "53656:352:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "53642:366:233" }, { "expression": { "arguments": [{ "id": 160921, "name": "rhs", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160886, "src": "54037:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160919, "name": "lhs", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160867, "src": "54025:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160920, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "54029:7:233", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "54025:11:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160922, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "54025:16:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 160848, "id": 160923, "nodeType": "Return", "src": "54018:23:233" }] }, "documentation": { "id": 160837, "nodeType": "StructuredDocumentation", "src": "52354:656:233", "text": "@dev Gets the derivative of the short principal $P(x)$ w.r.t. the amount\n      of bonds that are shorted $x$.\n      The derivative is calculated as:\n      $$\n      P'(x) = \\tfrac{1}{c} \\cdot (y + x)^{-t_s} \\cdot \\left(\n                  \\tfrac{\\mu}{c} \\cdot (k - (y + x)^{1 - t_s})\n              \\right)^{\\tfrac{t_s}{1 - t_s}}\n      $$\n @param _params The max long calculation parameters.\n @param _shortAmount The base amount.\n @param _effectiveShareReserves The effective share reserves.\n @return The derivative of the short principal w.r.t. the bond amount." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateShortPrincipalDerivative", "nameLocation": "53024:33:233", "parameters": { "id": 160845, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160840, "mutability": "mutable", "name": "_params", "nameLocation": "53089:7:233", "nodeType": "VariableDeclaration", "scope": 160925, "src": "53067:29:233", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_memory_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" }, "typeName": { "id": 160839, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 160838, "name": "MaxTradeParams", "nameLocations": ["53067:14:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 159351, "src": "53067:14:233" }, "referencedDeclaration": 159351, "src": "53067:14:233", "typeDescriptions": { "typeIdentifier": "t_struct$_MaxTradeParams_$159351_storage_ptr", "typeString": "struct HyperdriveUtils.MaxTradeParams" } }, "visibility": "internal" }, { "constant": false, "id": 160842, "mutability": "mutable", "name": "_shortAmount", "nameLocation": "53114:12:233", "nodeType": "VariableDeclaration", "scope": 160925, "src": "53106:20:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160841, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "53106:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160844, "mutability": "mutable", "name": "_effectiveShareReserves", "nameLocation": "53144:23:233", "nodeType": "VariableDeclaration", "scope": 160925, "src": "53136:31:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160843, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "53136:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "53057:116:233" }, "returnParameters": { "id": 160848, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160847, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 160925, "src": "53197:7:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160846, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "53197:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "53196:9:233" }, "scope": 161325, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 160948, "nodeType": "FunctionDefinition", "src": "54296:234:233", "nodes": [], "body": { "id": 160947, "nodeType": "Block", "src": "54450:80:233", "nodes": [], "statements": [{ "expression": { "arguments": [{ "id": 160944, "name": "_bondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160928, "src": "54511:11:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 160941, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 160939, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "54485:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 160940, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160930, "src": "54491:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "54485:16:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160937, "name": "_curveFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160932, "src": "54467:9:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160938, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "54477:7:233", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "54467:17:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160942, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "54467:35:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160943, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "54503:7:233", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "54467:43:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160945, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "54467:56:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 160936, "id": 160946, "nodeType": "Return", "src": "54460:63:233" }] }, "documentation": { "id": 160926, "nodeType": "StructuredDocumentation", "src": "54054:237:233", "text": "@dev Gets the curve fee paid by the trader when they open a short.\n @param _bondAmount The bond amount.\n @param _spotPrice The spot price.\n @param _curveFee The curve fee parameter.\n @return The curve fee." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateShortCurveFee", "nameLocation": "54305:22:233", "parameters": { "id": 160933, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160928, "mutability": "mutable", "name": "_bondAmount", "nameLocation": "54345:11:233", "nodeType": "VariableDeclaration", "scope": 160948, "src": "54337:19:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160927, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "54337:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160930, "mutability": "mutable", "name": "_spotPrice", "nameLocation": "54374:10:233", "nodeType": "VariableDeclaration", "scope": 160948, "src": "54366:18:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160929, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "54366:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160932, "mutability": "mutable", "name": "_curveFee", "nameLocation": "54402:9:233", "nodeType": "VariableDeclaration", "scope": 160948, "src": "54394:17:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160931, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "54394:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "54327:90:233" }, "returnParameters": { "id": 160936, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160935, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 160948, "src": "54441:7:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160934, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "54441:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "54440:9:233" }, "scope": 161325, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 160972, "nodeType": "FunctionDefinition", "src": "54850:343:233", "nodes": [], "body": { "id": 160971, "nodeType": "Block", "src": "55043:150:233", "nodes": [], "statements": [{ "expression": { "arguments": [{ "arguments": [{ "id": 160965, "name": "_bondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160951, "src": "55137:11:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160966, "name": "_spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160953, "src": "55150:10:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 160967, "name": "_curveFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160955, "src": "55162:9:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 160964, "name": "calculateShortCurveFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160948, "src": "55114:22:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 160968, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "55114:58:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 160962, "name": "_governanceLPFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160957, "src": "55072:16:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 160963, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "55089:7:233", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "55072:24:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 160969, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "55072:114:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 160961, "id": 160970, "nodeType": "Return", "src": "55053:133:233" }] }, "documentation": { "id": 160949, "nodeType": "StructuredDocumentation", "src": "54536:309:233", "text": "@dev Gets the governance fee paid by the trader when they open a short.\n @param _bondAmount The bond amount.\n @param _spotPrice The spot price.\n @param _curveFee The curve fee parameter.\n @param _governanceLPFee The governance fee parameter.\n @return The governance fee." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateShortGovernanceFee", "nameLocation": "54859:27:233", "parameters": { "id": 160958, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160951, "mutability": "mutable", "name": "_bondAmount", "nameLocation": "54904:11:233", "nodeType": "VariableDeclaration", "scope": 160972, "src": "54896:19:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160950, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "54896:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160953, "mutability": "mutable", "name": "_spotPrice", "nameLocation": "54933:10:233", "nodeType": "VariableDeclaration", "scope": 160972, "src": "54925:18:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160952, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "54925:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160955, "mutability": "mutable", "name": "_curveFee", "nameLocation": "54961:9:233", "nodeType": "VariableDeclaration", "scope": 160972, "src": "54953:17:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160954, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "54953:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 160957, "mutability": "mutable", "name": "_governanceLPFee", "nameLocation": "54988:16:233", "nodeType": "VariableDeclaration", "scope": 160972, "src": "54980:24:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160956, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "54980:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "54886:124:233" }, "returnParameters": { "id": 160961, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160960, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 160972, "src": "55034:7:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 160959, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "55034:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "55033:9:233" }, "scope": 161325, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 161047, "nodeType": "FunctionDefinition", "src": "55221:1367:233", "nodes": [], "body": { "id": 161046, "nodeType": "Block", "src": "55347:1241:233", "nodes": [], "statements": [{ "assignments": [160986], "declarations": [{ "constant": false, "id": 160986, "mutability": "mutable", "name": "poolConfig", "nameLocation": "55387:10:233", "nodeType": "VariableDeclaration", "scope": 161046, "src": "55357:40:233", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig" }, "typeName": { "id": 160985, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 160984, "name": "IHyperdrive.PoolConfig", "nameLocations": ["55357:11:233", "55369:10:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 10867, "src": "55357:22:233" }, "referencedDeclaration": 10867, "src": "55357:22:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_storage_ptr", "typeString": "struct IHyperdrive.PoolConfig" } }, "visibility": "internal" }], "id": 160990, "initialValue": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 160987, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160976, "src": "55400:10:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "id": 160988, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "55411:13:233", "memberName": "getPoolConfig", "nodeType": "MemberAccess", "referencedDeclaration": 11874, "src": "55400:24:233", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolConfig_$10867_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolConfig memory)" } }, "id": 160989, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "55400:26:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "nodeType": "VariableDeclarationStatement", "src": "55357:69:233" }, { "assignments": [160995], "declarations": [{ "constant": false, "id": 160995, "mutability": "mutable", "name": "poolInfo", "nameLocation": "55464:8:233", "nodeType": "VariableDeclaration", "scope": 161046, "src": "55436:36:233", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo" }, "typeName": { "id": 160994, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 160993, "name": "IHyperdrive.PoolInfo", "nameLocations": ["55436:11:233", "55448:8:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 10913, "src": "55436:20:233" }, "referencedDeclaration": 10913, "src": "55436:20:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_storage_ptr", "typeString": "struct IHyperdrive.PoolInfo" } }, "visibility": "internal" }], "id": 160999, "initialValue": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 160996, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160976, "src": "55475:10:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "id": 160997, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "55486:11:233", "memberName": "getPoolInfo", "nodeType": "MemberAccess", "referencedDeclaration": 11881, "src": "55475:22:233", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolInfo_$10913_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolInfo memory)" } }, "id": 160998, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "55475:24:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "nodeType": "VariableDeclarationStatement", "src": "55436:63:233" }, { "expression": { "arguments": [{ "expression": { "id": 161002, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160995, "src": "55587:8:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 161003, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "55596:13:233", "memberName": "shareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 10870, "src": "55587:22:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 161004, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160995, "src": "55644:8:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 161005, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "55653:15:233", "memberName": "shareAdjustment", "nodeType": "MemberAccess", "referencedDeclaration": 10873, "src": "55644:24:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, { "expression": { "id": 161006, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160995, "src": "55700:8:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 161007, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "55709:12:233", "memberName": "bondReserves", "nodeType": "MemberAccess", "referencedDeclaration": 10882, "src": "55700:21:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 161008, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160995, "src": "55756:8:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 161009, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "55765:15:233", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 10888, "src": "55756:24:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 161010, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160986, "src": "55822:10:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 161011, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "55833:22:233", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 10838, "src": "55822:33:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 161012, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160986, "src": "55895:10:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 161013, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "55906:20:233", "memberName": "minimumShareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 10841, "src": "55895:31:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 161014, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160986, "src": "55970:10:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 161015, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "55981:24:233", "memberName": "minimumTransactionAmount", "nodeType": "MemberAccess", "referencedDeclaration": 10844, "src": "55970:35:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 161016, "name": "poolConfig", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160986, "src": "56036:10:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 161017, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "56047:11:233", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 10853, "src": "56036:22:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 161018, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160995, "src": "56094:8:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 161019, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "56103:16:233", "memberName": "longsOutstanding", "nodeType": "MemberAccess", "referencedDeclaration": 10891, "src": "56094:25:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "arguments": [{ "id": 161021, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160976, "src": "56207:10:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, { "arguments": [{ "hexValue": "31653336", "id": 161028, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "56287:4:233", "typeDescriptions": { "typeIdentifier": "t_rational_1000000000000000000000000000000000000_by_1", "typeString": "int_const 1000...(29 digits omitted)...0000" }, "value": "1e36" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_rational_1000000000000000000000000000000000000_by_1", "typeString": "int_const 1000...(29 digits omitted)...0000" }], "expression": { "arguments": [{ "expression": { "id": 161024, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160995, "src": "56247:8:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 161025, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "56256:23:233", "memberName": "longAverageMaturityTime", "nodeType": "MemberAccess", "referencedDeclaration": 10894, "src": "56247:32:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 161023, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "56239:7:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_uint256_$", "typeString": "type(uint256)" }, "typeName": { "id": 161022, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "56239:7:233", "typeDescriptions": {} } }, "id": 161026, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "56239:41:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 161027, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "56281:5:233", "memberName": "divUp", "nodeType": "MemberAccess", "referencedDeclaration": 18790, "src": "56239:47:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 161029, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "56239:53:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 161020, "name": "calculateTimeRemaining", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158824, "src": "56163:22:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_view$_t_contract$_IHyperdrive_$11076_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (contract IHyperdrive,uint256) view returns (uint256)" } }, "id": 161030, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "56163:147:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 161031, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160995, "src": "56347:8:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 161032, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "56356:17:233", "memberName": "shortsOutstanding", "nodeType": "MemberAccess", "referencedDeclaration": 10897, "src": "56347:26:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "arguments": [{ "id": 161034, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160976, "src": "56462:10:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, { "arguments": [{ "hexValue": "31653336", "id": 161041, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "56543:4:233", "typeDescriptions": { "typeIdentifier": "t_rational_1000000000000000000000000000000000000_by_1", "typeString": "int_const 1000...(29 digits omitted)...0000" }, "value": "1e36" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_rational_1000000000000000000000000000000000000_by_1", "typeString": "int_const 1000...(29 digits omitted)...0000" }], "expression": { "arguments": [{ "expression": { "id": 161037, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 160995, "src": "56502:8:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 161038, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "56511:24:233", "memberName": "shortAverageMaturityTime", "nodeType": "MemberAccess", "referencedDeclaration": 10900, "src": "56502:33:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 161036, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "56494:7:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_uint256_$", "typeString": "type(uint256)" }, "typeName": { "id": 161035, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "56494:7:233", "typeDescriptions": {} } }, "id": 161039, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "56494:42:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 161040, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "56537:5:233", "memberName": "divUp", "nodeType": "MemberAccess", "referencedDeclaration": 18790, "src": "56494:48:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 161042, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "56494:54:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 161033, "name": "calculateTimeRemaining", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 158824, "src": "56418:22:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_view$_t_contract$_IHyperdrive_$11076_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (contract IHyperdrive,uint256) view returns (uint256)" } }, "id": 161043, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "56418:148:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_int256", "typeString": "int256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 161000, "name": "LPMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 22134, "src": "55528:6:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_LPMath_$22134_$", "typeString": "type(library LPMath)" } }, "id": 161001, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "55535:18:233", "memberName": "PresentValueParams", "nodeType": "MemberAccess", "referencedDeclaration": 20442, "src": "55528:25:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_struct$_PresentValueParams_$20442_storage_ptr_$", "typeString": "type(struct LPMath.PresentValueParams storage pointer)" } }, "id": 161044, "isConstant": false, "isLValue": false, "isPure": false, "kind": "structConstructorCall", "lValueRequested": false, "nameLocations": ["55572:13:233", "55627:15:233", "55686:12:233", "55739:15:233", "55798:22:233", "55873:20:233", "55944:24:233", "56023:11:233", "56076:16:233", "56137:24:233", "56328:17:233", "56391:25:233"], "names": ["shareReserves", "shareAdjustment", "bondReserves", "vaultSharePrice", "initialVaultSharePrice", "minimumShareReserves", "minimumTransactionAmount", "timeStretch", "longsOutstanding", "longAverageTimeRemaining", "shortsOutstanding", "shortAverageTimeRemaining"], "nodeType": "FunctionCall", "src": "55528:1053:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PresentValueParams_$20442_memory_ptr", "typeString": "struct LPMath.PresentValueParams memory" } }, "functionReturnParameters": 160981, "id": 161045, "nodeType": "Return", "src": "55509:1072:233" }] }, "documentation": { "id": 160973, "nodeType": "StructuredDocumentation", "src": "55199:17:233", "text": "LP Utils ///" }, "implemented": true, "kind": "function", "modifiers": [], "name": "getPresentValueParams", "nameLocation": "55230:21:233", "parameters": { "id": 160977, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160976, "mutability": "mutable", "name": "hyperdrive", "nameLocation": "55273:10:233", "nodeType": "VariableDeclaration", "scope": 161047, "src": "55261:22:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" }, "typeName": { "id": 160975, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 160974, "name": "IHyperdrive", "nameLocations": ["55261:11:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 11076, "src": "55261:11:233" }, "referencedDeclaration": 11076, "src": "55261:11:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "visibility": "internal" }], "src": "55251:38:233" }, "returnParameters": { "id": 160981, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 160980, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 161047, "src": "55313:32:233", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_PresentValueParams_$20442_memory_ptr", "typeString": "struct LPMath.PresentValueParams" }, "typeName": { "id": 160979, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 160978, "name": "LPMath.PresentValueParams", "nameLocations": ["55313:6:233", "55320:18:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 20442, "src": "55313:25:233" }, "referencedDeclaration": 20442, "src": "55313:25:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PresentValueParams_$20442_storage_ptr", "typeString": "struct LPMath.PresentValueParams" } }, "visibility": "internal" }], "src": "55312:34:233" }, "scope": 161325, "stateMutability": "view", "virtual": false, "visibility": "internal" }, { "id": 161136, "nodeType": "FunctionDefinition", "src": "56594:1628:233", "nodes": [], "body": { "id": 161135, "nodeType": "Block", "src": "56736:1486:233", "nodes": [], "statements": [{ "assignments": [161060], "declarations": [{ "constant": false, "id": 161060, "mutability": "mutable", "name": "poolInfo", "nameLocation": "56774:8:233", "nodeType": "VariableDeclaration", "scope": 161135, "src": "56746:36:233", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo" }, "typeName": { "id": 161059, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 161058, "name": "IHyperdrive.PoolInfo", "nameLocations": ["56746:11:233", "56758:8:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 10913, "src": "56746:20:233" }, "referencedDeclaration": 10913, "src": "56746:20:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_storage_ptr", "typeString": "struct IHyperdrive.PoolInfo" } }, "visibility": "internal" }], "id": 161064, "initialValue": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 161061, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161050, "src": "56785:10:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "id": 161062, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "56796:11:233", "memberName": "getPoolInfo", "nodeType": "MemberAccess", "referencedDeclaration": 11881, "src": "56785:22:233", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolInfo_$10913_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolInfo memory)" } }, "id": 161063, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "56785:24:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "nodeType": "VariableDeclarationStatement", "src": "56746:63:233" }, { "assignments": [161069], "declarations": [{ "constant": false, "id": 161069, "mutability": "mutable", "name": "presentValueParams", "nameLocation": "56852:18:233", "nodeType": "VariableDeclaration", "scope": 161135, "src": "56819:51:233", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_PresentValueParams_$20442_memory_ptr", "typeString": "struct LPMath.PresentValueParams" }, "typeName": { "id": 161068, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 161067, "name": "LPMath.PresentValueParams", "nameLocations": ["56819:6:233", "56826:18:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 20442, "src": "56819:25:233" }, "referencedDeclaration": 20442, "src": "56819:25:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PresentValueParams_$20442_storage_ptr", "typeString": "struct LPMath.PresentValueParams" } }, "visibility": "internal" }], "id": 161073, "initialValue": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 161070, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161050, "src": "56873:10:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "id": 161071, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "56897:21:233", "memberName": "getPresentValueParams", "nodeType": "MemberAccess", "referencedDeclaration": 161047, "src": "56873:45:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_view$_t_contract$_IHyperdrive_$11076_$returns$_t_struct$_PresentValueParams_$20442_memory_ptr_$attached_to$_t_contract$_IHyperdrive_$11076_$", "typeString": "function (contract IHyperdrive) view returns (struct LPMath.PresentValueParams memory)" } }, "id": 161072, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "56873:47:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PresentValueParams_$20442_memory_ptr", "typeString": "struct LPMath.PresentValueParams memory" } }, "nodeType": "VariableDeclarationStatement", "src": "56819:101:233" }, { "assignments": [161075], "declarations": [{ "constant": false, "id": 161075, "mutability": "mutable", "name": "startingPresentValue", "nameLocation": "56938:20:233", "nodeType": "VariableDeclaration", "scope": 161135, "src": "56930:28:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 161074, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "56930:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 161080, "initialValue": { "arguments": [{ "id": 161078, "name": "presentValueParams", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161069, "src": "57003:18:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PresentValueParams_$20442_memory_ptr", "typeString": "struct LPMath.PresentValueParams memory" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_PresentValueParams_$20442_memory_ptr", "typeString": "struct LPMath.PresentValueParams memory" }], "expression": { "id": 161076, "name": "LPMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 22134, "src": "56961:6:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_LPMath_$22134_$", "typeString": "type(library LPMath)" } }, "id": 161077, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "56968:21:233", "memberName": "calculatePresentValue", "nodeType": "MemberAccess", "referencedDeclaration": 20471, "src": "56961:28:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_PresentValueParams_$20442_memory_ptr_$returns$_t_uint256_$", "typeString": "function (struct LPMath.PresentValueParams memory) pure returns (uint256)" } }, "id": 161079, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "56961:70:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "56930:101:233" }, { "assignments": [161082], "declarations": [{ "constant": false, "id": 161082, "mutability": "mutable", "name": "netCurveTrade", "nameLocation": "57048:13:233", "nodeType": "VariableDeclaration", "scope": 161135, "src": "57041:20:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" }, "typeName": { "id": 161081, "name": "int256", "nodeType": "ElementaryTypeName", "src": "57041:6:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "visibility": "internal" }], "id": 161102, "initialValue": { "commonType": { "typeIdentifier": "t_int256", "typeString": "int256" }, "id": 161101, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "arguments": [{ "arguments": [{ "expression": { "id": 161088, "name": "presentValueParams", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161069, "src": "57145:18:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PresentValueParams_$20442_memory_ptr", "typeString": "struct LPMath.PresentValueParams memory" } }, "id": 161089, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "57164:24:233", "memberName": "longAverageTimeRemaining", "nodeType": "MemberAccess", "referencedDeclaration": 20437, "src": "57145:43:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 161085, "name": "presentValueParams", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161069, "src": "57084:18:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PresentValueParams_$20442_memory_ptr", "typeString": "struct LPMath.PresentValueParams memory" } }, "id": 161086, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "57103:16:233", "memberName": "longsOutstanding", "nodeType": "MemberAccess", "referencedDeclaration": 20435, "src": "57084:35:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 161087, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "57120:7:233", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "57084:43:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 161090, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "57084:118:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 161084, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "57064:6:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_int256_$", "typeString": "type(int256)" }, "typeName": { "id": 161083, "name": "int256", "nodeType": "ElementaryTypeName", "src": "57064:6:233", "typeDescriptions": {} } }, "id": 161091, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "57064:148:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [{ "arguments": [{ "expression": { "id": 161097, "name": "presentValueParams", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161069, "src": "57317:18:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PresentValueParams_$20442_memory_ptr", "typeString": "struct LPMath.PresentValueParams memory" } }, "id": 161098, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "57336:25:233", "memberName": "shortAverageTimeRemaining", "nodeType": "MemberAccess", "referencedDeclaration": 20441, "src": "57317:44:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 161094, "name": "presentValueParams", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161069, "src": "57251:18:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PresentValueParams_$20442_memory_ptr", "typeString": "struct LPMath.PresentValueParams memory" } }, "id": 161095, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "57270:17:233", "memberName": "shortsOutstanding", "nodeType": "MemberAccess", "referencedDeclaration": 20439, "src": "57251:36:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 161096, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "57288:7:233", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "57251:44:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 161099, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "57251:128:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 161093, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "57227:6:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_int256_$", "typeString": "type(int256)" }, "typeName": { "id": 161092, "name": "int256", "nodeType": "ElementaryTypeName", "src": "57227:6:233", "typeDescriptions": {} } }, "id": 161100, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "57227:166:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "src": "57064:329:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "nodeType": "VariableDeclarationStatement", "src": "57041:352:233" }, { "expression": { "arguments": [{ "id": 161105, "name": "presentValueParams", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161069, "src": "57494:18:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PresentValueParams_$20442_memory_ptr", "typeString": "struct LPMath.PresentValueParams memory" } }, { "id": 161106, "name": "startingPresentValue", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161075, "src": "57552:20:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "arguments": [{ "expression": { "id": 161109, "name": "AssetId", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18642, "src": "57655:7:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_AssetId_$18642_$", "typeString": "type(library AssetId)" } }, "id": 161110, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "memberLocation": "57663:12:233", "memberName": "_LP_ASSET_ID", "nodeType": "MemberAccess", "referencedDeclaration": 18375, "src": "57655:20:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 161107, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161050, "src": "57611:10:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "id": 161108, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "57622:11:233", "memberName": "totalSupply", "nodeType": "MemberAccess", "referencedDeclaration": 12212, "src": "57611:22:233", "typeDescriptions": { "typeIdentifier": "t_function_external_view$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256) view external returns (uint256)" } }, "id": 161111, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "57611:82:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 161119, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "arguments": [{ "expression": { "id": 161114, "name": "AssetId", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18642, "src": "57784:7:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_AssetId_$18642_$", "typeString": "type(library AssetId)" } }, "id": 161115, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "memberLocation": "57792:26:233", "memberName": "_WITHDRAWAL_SHARE_ASSET_ID", "nodeType": "MemberAccess", "referencedDeclaration": 18384, "src": "57784:34:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 161112, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161050, "src": "57740:10:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "id": 161113, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "57751:11:233", "memberName": "totalSupply", "nodeType": "MemberAccess", "referencedDeclaration": 12212, "src": "57740:22:233", "typeDescriptions": { "typeIdentifier": "t_function_external_view$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256) view external returns (uint256)" } }, "id": 161116, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "57740:96:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 161117, "name": "poolInfo", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161060, "src": "57839:8:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 161118, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "57848:31:233", "memberName": "withdrawalSharesReadyToWithdraw", "nodeType": "MemberAccess", "referencedDeclaration": 10903, "src": "57839:40:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "57740:139:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "arguments": [{ "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 161122, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161050, "src": "57911:10:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "id": 161123, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "57922:8:233", "memberName": "solvency", "nodeType": "MemberAccess", "referencedDeclaration": 161276, "src": "57911:19:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_view$_t_contract$_IHyperdrive_$11076_$returns$_t_int256_$attached_to$_t_contract$_IHyperdrive_$11076_$", "typeString": "function (contract IHyperdrive) view returns (int256)" } }, "id": 161124, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "57911:21:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 161121, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "57903:7:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_uint256_$", "typeString": "type(uint256)" }, "typeName": { "id": 161120, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "57903:7:233", "typeDescriptions": {} } }, "id": 161125, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "57903:30:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 161126, "name": "netCurveTrade", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161082, "src": "57966:13:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, { "expression": { "id": 161127, "name": "presentValueParams", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161069, "src": "58020:18:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PresentValueParams_$20442_memory_ptr", "typeString": "struct LPMath.PresentValueParams memory" } }, "id": 161128, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "58039:13:233", "memberName": "shareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 20419, "src": "58020:32:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 161129, "name": "presentValueParams", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161069, "src": "58095:18:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PresentValueParams_$20442_memory_ptr", "typeString": "struct LPMath.PresentValueParams memory" } }, "id": 161130, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "58114:15:233", "memberName": "shareAdjustment", "nodeType": "MemberAccess", "referencedDeclaration": 20421, "src": "58095:34:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, { "expression": { "id": 161131, "name": "presentValueParams", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161069, "src": "58169:18:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PresentValueParams_$20442_memory_ptr", "typeString": "struct LPMath.PresentValueParams memory" } }, "id": 161132, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "58188:12:233", "memberName": "bondReserves", "nodeType": "MemberAccess", "referencedDeclaration": 20423, "src": "58169:31:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_PresentValueParams_$20442_memory_ptr", "typeString": "struct LPMath.PresentValueParams memory" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_int256", "typeString": "int256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_int256", "typeString": "int256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 161103, "name": "LPMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 22134, "src": "57422:6:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_LPMath_$22134_$", "typeString": "type(library LPMath)" } }, "id": 161104, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "57429:26:233", "memberName": "DistributeExcessIdleParams", "nodeType": "MemberAccess", "referencedDeclaration": 20930, "src": "57422:33:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_struct$_DistributeExcessIdleParams_$20930_storage_ptr_$", "typeString": "type(struct LPMath.DistributeExcessIdleParams storage pointer)" } }, "id": 161133, "isConstant": false, "isLValue": false, "isPure": false, "kind": "structConstructorCall", "lValueRequested": false, "nameLocations": ["57474:18:233", "57530:20:233", "57590:19:233", "57711:27:233", "57897:4:233", "57951:13:233", "57997:21:233", "58070:23:233", "58147:20:233"], "names": ["presentValueParams", "startingPresentValue", "activeLpTotalSupply", "withdrawalSharesTotalSupply", "idle", "netCurveTrade", "originalShareReserves", "originalShareAdjustment", "originalBondReserves"], "nodeType": "FunctionCall", "src": "57422:793:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_DistributeExcessIdleParams_$20930_memory_ptr", "typeString": "struct LPMath.DistributeExcessIdleParams memory" } }, "functionReturnParameters": 161055, "id": 161134, "nodeType": "Return", "src": "57403:812:233" }] }, "implemented": true, "kind": "function", "modifiers": [], "name": "getDistributeExcessIdleParams", "nameLocation": "56603:29:233", "parameters": { "id": 161051, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 161050, "mutability": "mutable", "name": "hyperdrive", "nameLocation": "56654:10:233", "nodeType": "VariableDeclaration", "scope": 161136, "src": "56642:22:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" }, "typeName": { "id": 161049, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 161048, "name": "IHyperdrive", "nameLocations": ["56642:11:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 11076, "src": "56642:11:233" }, "referencedDeclaration": 11076, "src": "56642:11:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "visibility": "internal" }], "src": "56632:38:233" }, "returnParameters": { "id": 161055, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 161054, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 161136, "src": "56694:40:233", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_DistributeExcessIdleParams_$20930_memory_ptr", "typeString": "struct LPMath.DistributeExcessIdleParams" }, "typeName": { "id": 161053, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 161052, "name": "LPMath.DistributeExcessIdleParams", "nameLocations": ["56694:6:233", "56701:26:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 20930, "src": "56694:33:233" }, "referencedDeclaration": 20930, "src": "56694:33:233", "typeDescriptions": { "typeIdentifier": "t_struct$_DistributeExcessIdleParams_$20930_storage_ptr", "typeString": "struct LPMath.DistributeExcessIdleParams" } }, "visibility": "internal" }], "src": "56693:42:233" }, "scope": 161325, "stateMutability": "view", "virtual": false, "visibility": "internal" }, { "id": 161158, "nodeType": "FunctionDefinition", "src": "58228:276:233", "nodes": [], "body": { "id": 161157, "nodeType": "Block", "src": "58320:184:233", "nodes": [], "statements": [{ "expression": { "arguments": [{ "expression": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 161151, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161139, "src": "58456:10:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "id": 161152, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "58467:11:233", "memberName": "getPoolInfo", "nodeType": "MemberAccess", "referencedDeclaration": 11881, "src": "58456:22:233", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolInfo_$10913_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolInfo memory)" } }, "id": 161153, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "58456:24:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 161154, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "58481:15:233", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 10888, "src": "58456:40:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 161146, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161139, "src": "58395:10:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "id": 161147, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "58406:21:233", "memberName": "getPresentValueParams", "nodeType": "MemberAccess", "referencedDeclaration": 161047, "src": "58395:32:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_view$_t_contract$_IHyperdrive_$11076_$returns$_t_struct$_PresentValueParams_$20442_memory_ptr_$attached_to$_t_contract$_IHyperdrive_$11076_$", "typeString": "function (contract IHyperdrive) view returns (struct LPMath.PresentValueParams memory)" } }, "id": 161148, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "58395:34:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PresentValueParams_$20442_memory_ptr", "typeString": "struct LPMath.PresentValueParams memory" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_struct$_PresentValueParams_$20442_memory_ptr", "typeString": "struct LPMath.PresentValueParams memory" }], "expression": { "id": 161144, "name": "LPMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 22134, "src": "58349:6:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_LPMath_$22134_$", "typeString": "type(library LPMath)" } }, "id": 161145, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "58373:21:233", "memberName": "calculatePresentValue", "nodeType": "MemberAccess", "referencedDeclaration": 20471, "src": "58349:45:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_struct$_PresentValueParams_$20442_memory_ptr_$returns$_t_uint256_$", "typeString": "function (struct LPMath.PresentValueParams memory) pure returns (uint256)" } }, "id": 161149, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "58349:81:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 161150, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "58448:7:233", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "58349:106:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 161155, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "58349:148:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 161143, "id": 161156, "nodeType": "Return", "src": "58330:167:233" }] }, "implemented": true, "kind": "function", "modifiers": [], "name": "presentValue", "nameLocation": "58237:12:233", "parameters": { "id": 161140, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 161139, "mutability": "mutable", "name": "hyperdrive", "nameLocation": "58271:10:233", "nodeType": "VariableDeclaration", "scope": 161158, "src": "58259:22:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" }, "typeName": { "id": 161138, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 161137, "name": "IHyperdrive", "nameLocations": ["58259:11:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 11076, "src": "58259:11:233" }, "referencedDeclaration": 11076, "src": "58259:11:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "visibility": "internal" }], "src": "58249:38:233" }, "returnParameters": { "id": 161143, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 161142, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 161158, "src": "58311:7:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 161141, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "58311:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "58310:9:233" }, "scope": 161325, "stateMutability": "view", "virtual": false, "visibility": "internal" }, { "id": 161176, "nodeType": "FunctionDefinition", "src": "58510:177:233", "nodes": [], "body": { "id": 161175, "nodeType": "Block", "src": "58602:85:233", "nodes": [], "statements": [{ "expression": { "arguments": [{ "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 161170, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161161, "src": "58653:10:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "id": 161171, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "58664:13:233", "memberName": "lpTotalSupply", "nodeType": "MemberAccess", "referencedDeclaration": 161202, "src": "58653:24:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_view$_t_contract$_IHyperdrive_$11076_$returns$_t_uint256_$attached_to$_t_contract$_IHyperdrive_$11076_$", "typeString": "function (contract IHyperdrive) view returns (uint256)" } }, "id": 161172, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "58653:26:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 161166, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161161, "src": "58619:10:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "id": 161167, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "58630:12:233", "memberName": "presentValue", "nodeType": "MemberAccess", "referencedDeclaration": 161158, "src": "58619:23:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_view$_t_contract$_IHyperdrive_$11076_$returns$_t_uint256_$attached_to$_t_contract$_IHyperdrive_$11076_$", "typeString": "function (contract IHyperdrive) view returns (uint256)" } }, "id": 161168, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "58619:25:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 161169, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "58645:7:233", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "58619:33:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 161173, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "58619:61:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 161165, "id": 161174, "nodeType": "Return", "src": "58612:68:233" }] }, "implemented": true, "kind": "function", "modifiers": [], "name": "lpSharePrice", "nameLocation": "58519:12:233", "parameters": { "id": 161162, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 161161, "mutability": "mutable", "name": "hyperdrive", "nameLocation": "58553:10:233", "nodeType": "VariableDeclaration", "scope": 161176, "src": "58541:22:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" }, "typeName": { "id": 161160, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 161159, "name": "IHyperdrive", "nameLocations": ["58541:11:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 11076, "src": "58541:11:233" }, "referencedDeclaration": 11076, "src": "58541:11:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "visibility": "internal" }], "src": "58531:38:233" }, "returnParameters": { "id": 161165, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 161164, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 161176, "src": "58593:7:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 161163, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "58593:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "58592:9:233" }, "scope": 161325, "stateMutability": "view", "virtual": false, "visibility": "internal" }, { "id": 161202, "nodeType": "FunctionDefinition", "src": "58693:317:233", "nodes": [], "body": { "id": 161201, "nodeType": "Block", "src": "58786:224:233", "nodes": [], "statements": [{ "expression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 161199, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 161194, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "arguments": [{ "expression": { "id": 161186, "name": "AssetId", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18642, "src": "58838:7:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_AssetId_$18642_$", "typeString": "type(library AssetId)" } }, "id": 161187, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "memberLocation": "58846:12:233", "memberName": "_LP_ASSET_ID", "nodeType": "MemberAccess", "referencedDeclaration": 18375, "src": "58838:20:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 161184, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161179, "src": "58815:10:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "id": 161185, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "58826:11:233", "memberName": "totalSupply", "nodeType": "MemberAccess", "referencedDeclaration": 12212, "src": "58815:22:233", "typeDescriptions": { "typeIdentifier": "t_function_external_view$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256) view external returns (uint256)" } }, "id": 161188, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "58815:44:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "arguments": [{ "expression": { "id": 161191, "name": "AssetId", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18642, "src": "58897:7:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_AssetId_$18642_$", "typeString": "type(library AssetId)" } }, "id": 161192, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "memberLocation": "58905:26:233", "memberName": "_WITHDRAWAL_SHARE_ASSET_ID", "nodeType": "MemberAccess", "referencedDeclaration": 18384, "src": "58897:34:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 161189, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161179, "src": "58874:10:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "id": 161190, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "58885:11:233", "memberName": "totalSupply", "nodeType": "MemberAccess", "referencedDeclaration": 12212, "src": "58874:22:233", "typeDescriptions": { "typeIdentifier": "t_function_external_view$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256) view external returns (uint256)" } }, "id": 161193, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "58874:58:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "58815:117:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 161195, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161179, "src": "58947:10:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "id": 161196, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "58958:11:233", "memberName": "getPoolInfo", "nodeType": "MemberAccess", "referencedDeclaration": 11881, "src": "58947:22:233", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolInfo_$10913_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolInfo memory)" } }, "id": 161197, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "58947:24:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 161198, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "58972:31:233", "memberName": "withdrawalSharesReadyToWithdraw", "nodeType": "MemberAccess", "referencedDeclaration": 10903, "src": "58947:56:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "58815:188:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 161183, "id": 161200, "nodeType": "Return", "src": "58796:207:233" }] }, "implemented": true, "kind": "function", "modifiers": [], "name": "lpTotalSupply", "nameLocation": "58702:13:233", "parameters": { "id": 161180, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 161179, "mutability": "mutable", "name": "hyperdrive", "nameLocation": "58737:10:233", "nodeType": "VariableDeclaration", "scope": 161202, "src": "58725:22:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" }, "typeName": { "id": 161178, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 161177, "name": "IHyperdrive", "nameLocations": ["58725:11:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 11076, "src": "58725:11:233" }, "referencedDeclaration": 11076, "src": "58725:11:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "visibility": "internal" }], "src": "58715:38:233" }, "returnParameters": { "id": 161183, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 161182, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 161202, "src": "58777:7:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 161181, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "58777:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "58776:9:233" }, "scope": 161325, "stateMutability": "view", "virtual": false, "visibility": "internal" }, { "id": 161227, "nodeType": "FunctionDefinition", "src": "59016:223:233", "nodes": [], "body": { "id": 161226, "nodeType": "Block", "src": "59086:153:233", "nodes": [], "statements": [{ "expression": { "arguments": [{ "expression": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 161220, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161205, "src": "59178:10:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "id": 161221, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "59189:11:233", "memberName": "getPoolInfo", "nodeType": "MemberAccess", "referencedDeclaration": 11881, "src": "59178:22:233", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolInfo_$10913_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolInfo memory)" } }, "id": 161222, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "59178:24:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 161223, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "59203:15:233", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 10888, "src": "59178:40:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "arguments": [{ "hexValue": "30", "id": 161216, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "59149:1:233", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }], "expression": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 161212, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161205, "src": "59123:10:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "id": 161213, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "59134:8:233", "memberName": "solvency", "nodeType": "MemberAccess", "referencedDeclaration": 161276, "src": "59123:19:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_view$_t_contract$_IHyperdrive_$11076_$returns$_t_int256_$attached_to$_t_contract$_IHyperdrive_$11076_$", "typeString": "function (contract IHyperdrive) view returns (int256)" } }, "id": 161214, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "59123:21:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "id": 161215, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "59145:3:233", "memberName": "max", "nodeType": "MemberAccess", "referencedDeclaration": 19441, "src": "59123:25:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_int256_$_t_int256_$returns$_t_int256_$attached_to$_t_int256_$", "typeString": "function (int256,int256) pure returns (int256)" } }, "id": 161217, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "59123:28:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 161211, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "59115:7:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_uint256_$", "typeString": "type(uint256)" }, "typeName": { "id": 161210, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "59115:7:233", "typeDescriptions": {} } }, "id": 161218, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "59115:37:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 161219, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "59153:7:233", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "59115:45:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 161224, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "59115:117:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 161209, "id": 161225, "nodeType": "Return", "src": "59096:136:233" }] }, "implemented": true, "kind": "function", "modifiers": [], "name": "idle", "nameLocation": "59025:4:233", "parameters": { "id": 161206, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 161205, "mutability": "mutable", "name": "hyperdrive", "nameLocation": "59042:10:233", "nodeType": "VariableDeclaration", "scope": 161227, "src": "59030:22:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" }, "typeName": { "id": 161204, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 161203, "name": "IHyperdrive", "nameLocations": ["59030:11:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 11076, "src": "59030:11:233" }, "referencedDeclaration": 11076, "src": "59030:11:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "visibility": "internal" }], "src": "59029:24:233" }, "returnParameters": { "id": 161209, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 161208, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 161227, "src": "59077:7:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 161207, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "59077:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "59076:9:233" }, "scope": 161325, "stateMutability": "view", "virtual": false, "visibility": "internal" }, { "id": 161276, "nodeType": "FunctionDefinition", "src": "59245:399:233", "nodes": [], "body": { "id": 161275, "nodeType": "Block", "src": "59318:326:233", "nodes": [], "statements": [{ "assignments": [161239], "declarations": [{ "constant": false, "id": 161239, "mutability": "mutable", "name": "config", "nameLocation": "59358:6:233", "nodeType": "VariableDeclaration", "scope": 161275, "src": "59328:36:233", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig" }, "typeName": { "id": 161238, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 161237, "name": "IHyperdrive.PoolConfig", "nameLocations": ["59328:11:233", "59340:10:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 10867, "src": "59328:22:233" }, "referencedDeclaration": 10867, "src": "59328:22:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_storage_ptr", "typeString": "struct IHyperdrive.PoolConfig" } }, "visibility": "internal" }], "id": 161243, "initialValue": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 161240, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161230, "src": "59367:10:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "id": 161241, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "59378:13:233", "memberName": "getPoolConfig", "nodeType": "MemberAccess", "referencedDeclaration": 11874, "src": "59367:24:233", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolConfig_$10867_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolConfig memory)" } }, "id": 161242, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "59367:26:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "nodeType": "VariableDeclarationStatement", "src": "59328:65:233" }, { "assignments": [161248], "declarations": [{ "constant": false, "id": 161248, "mutability": "mutable", "name": "info", "nameLocation": "59431:4:233", "nodeType": "VariableDeclaration", "scope": 161275, "src": "59403:32:233", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo" }, "typeName": { "id": 161247, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 161246, "name": "IHyperdrive.PoolInfo", "nameLocations": ["59403:11:233", "59415:8:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 10913, "src": "59403:20:233" }, "referencedDeclaration": 10913, "src": "59403:20:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_storage_ptr", "typeString": "struct IHyperdrive.PoolInfo" } }, "visibility": "internal" }], "id": 161252, "initialValue": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 161249, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161230, "src": "59438:10:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "id": 161250, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "59449:11:233", "memberName": "getPoolInfo", "nodeType": "MemberAccess", "referencedDeclaration": 11881, "src": "59438:22:233", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolInfo_$10913_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolInfo memory)" } }, "id": 161251, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "59438:24:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "nodeType": "VariableDeclarationStatement", "src": "59403:59:233" }, { "expression": { "commonType": { "typeIdentifier": "t_int256", "typeString": "int256" }, "id": 161273, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "commonType": { "typeIdentifier": "t_int256", "typeString": "int256" }, "id": 161267, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "arguments": [{ "expression": { "id": 161255, "name": "info", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161248, "src": "59498:4:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 161256, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "59503:13:233", "memberName": "shareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 10870, "src": "59498:18:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 161254, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "59491:6:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_int256_$", "typeString": "type(int256)" }, "typeName": { "id": 161253, "name": "int256", "nodeType": "ElementaryTypeName", "src": "59491:6:233", "typeDescriptions": {} } }, "id": 161257, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "59491:26:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [{ "arguments": [{ "expression": { "id": 161263, "name": "info", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161248, "src": "59565:4:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 161264, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "59570:15:233", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 10888, "src": "59565:20:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "expression": { "id": 161260, "name": "info", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161248, "src": "59539:4:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 161261, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "59544:12:233", "memberName": "longExposure", "nodeType": "MemberAccess", "referencedDeclaration": 10912, "src": "59539:17:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 161262, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "59557:7:233", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "59539:25:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 161265, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "59539:47:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 161259, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "59532:6:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_int256_$", "typeString": "type(int256)" }, "typeName": { "id": 161258, "name": "int256", "nodeType": "ElementaryTypeName", "src": "59532:6:233", "typeDescriptions": {} } }, "id": 161266, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "59532:55:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "src": "59491:96:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [{ "expression": { "id": 161270, "name": "config", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161239, "src": "59609:6:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 161271, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "59616:20:233", "memberName": "minimumShareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 10841, "src": "59609:27:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 161269, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "59602:6:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_int256_$", "typeString": "type(int256)" }, "typeName": { "id": 161268, "name": "int256", "nodeType": "ElementaryTypeName", "src": "59602:6:233", "typeDescriptions": {} } }, "id": 161272, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "59602:35:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "src": "59491:146:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "functionReturnParameters": 161234, "id": 161274, "nodeType": "Return", "src": "59472:165:233" }] }, "implemented": true, "kind": "function", "modifiers": [], "name": "solvency", "nameLocation": "59254:8:233", "parameters": { "id": 161231, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 161230, "mutability": "mutable", "name": "hyperdrive", "nameLocation": "59275:10:233", "nodeType": "VariableDeclaration", "scope": 161276, "src": "59263:22:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" }, "typeName": { "id": 161229, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 161228, "name": "IHyperdrive", "nameLocations": ["59263:11:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 11076, "src": "59263:11:233" }, "referencedDeclaration": 11076, "src": "59263:11:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "visibility": "internal" }], "src": "59262:24:233" }, "returnParameters": { "id": 161234, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 161233, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 161276, "src": "59310:6:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" }, "typeName": { "id": 161232, "name": "int256", "nodeType": "ElementaryTypeName", "src": "59310:6:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "visibility": "internal" }], "src": "59309:8:233" }, "scope": 161325, "stateMutability": "view", "virtual": false, "visibility": "internal" }, { "id": 161324, "nodeType": "FunctionDefinition", "src": "59650:607:233", "nodes": [], "body": { "id": 161323, "nodeType": "Block", "src": "59717:540:233", "nodes": [], "statements": [{ "assignments": [161288], "declarations": [{ "constant": false, "id": 161288, "mutability": "mutable", "name": "config", "nameLocation": "59757:6:233", "nodeType": "VariableDeclaration", "scope": 161323, "src": "59727:36:233", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig" }, "typeName": { "id": 161287, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 161286, "name": "IHyperdrive.PoolConfig", "nameLocations": ["59727:11:233", "59739:10:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 10867, "src": "59727:22:233" }, "referencedDeclaration": 10867, "src": "59727:22:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_storage_ptr", "typeString": "struct IHyperdrive.PoolConfig" } }, "visibility": "internal" }], "id": 161292, "initialValue": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 161289, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161279, "src": "59766:10:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "id": 161290, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "59777:13:233", "memberName": "getPoolConfig", "nodeType": "MemberAccess", "referencedDeclaration": 11874, "src": "59766:24:233", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolConfig_$10867_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolConfig memory)" } }, "id": 161291, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "59766:26:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "nodeType": "VariableDeclarationStatement", "src": "59727:65:233" }, { "assignments": [161297], "declarations": [{ "constant": false, "id": 161297, "mutability": "mutable", "name": "info", "nameLocation": "59830:4:233", "nodeType": "VariableDeclaration", "scope": 161323, "src": "59802:32:233", "stateVariable": false, "storageLocation": "memory", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo" }, "typeName": { "id": 161296, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 161295, "name": "IHyperdrive.PoolInfo", "nameLocations": ["59802:11:233", "59814:8:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 10913, "src": "59802:20:233" }, "referencedDeclaration": 10913, "src": "59802:20:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_storage_ptr", "typeString": "struct IHyperdrive.PoolInfo" } }, "visibility": "internal" }], "id": 161301, "initialValue": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 161298, "name": "hyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161279, "src": "59837:10:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "id": 161299, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "59848:11:233", "memberName": "getPoolInfo", "nodeType": "MemberAccess", "referencedDeclaration": 11881, "src": "59837:22:233", "typeDescriptions": { "typeIdentifier": "t_function_external_view$__$returns$_t_struct$_PoolInfo_$10913_memory_ptr_$", "typeString": "function () view external returns (struct IHyperdrive.PoolInfo memory)" } }, "id": 161300, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "59837:24:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "nodeType": "VariableDeclarationStatement", "src": "59802:59:233" }, { "expression": { "arguments": [{ "arguments": [{ "expression": { "id": 161306, "name": "info", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161297, "src": "59996:4:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 161307, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "60001:13:233", "memberName": "shareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 10870, "src": "59996:18:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 161308, "name": "info", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161297, "src": "60036:4:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 161309, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "60041:15:233", "memberName": "shareAdjustment", "nodeType": "MemberAccess", "referencedDeclaration": 10873, "src": "60036:20:233", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_int256", "typeString": "int256" }], "expression": { "id": 161304, "name": "HyperdriveMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20190, "src": "59928:14:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_HyperdriveMath_$20190_$", "typeString": "type(library HyperdriveMath)" } }, "id": 161305, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "59943:31:233", "memberName": "calculateEffectiveShareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 19633, "src": "59928:46:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_int256_$returns$_t_uint256_$", "typeString": "function (uint256,int256) pure returns (uint256)" } }, "id": 161310, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "59928:146:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 161311, "name": "info", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161297, "src": "60092:4:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 161312, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "60097:12:233", "memberName": "bondReserves", "nodeType": "MemberAccess", "referencedDeclaration": 10882, "src": "60092:17:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 161316, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 161313, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "60127:3:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "expression": { "id": 161314, "name": "config", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161288, "src": "60133:6:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 161315, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "60140:11:233", "memberName": "timeStretch", "nodeType": "MemberAccess", "referencedDeclaration": 10853, "src": "60133:18:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "60127:24:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 161317, "name": "info", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161297, "src": "60169:4:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolInfo_$10913_memory_ptr", "typeString": "struct IHyperdrive.PoolInfo memory" } }, "id": 161318, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "60174:15:233", "memberName": "vaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 10888, "src": "60169:20:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "expression": { "id": 161319, "name": "config", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 161288, "src": "60207:6:233", "typeDescriptions": { "typeIdentifier": "t_struct$_PoolConfig_$10867_memory_ptr", "typeString": "struct IHyperdrive.PoolConfig memory" } }, "id": 161320, "isConstant": false, "isLValue": true, "isPure": false, "lValueRequested": false, "memberLocation": "60214:22:233", "memberName": "initialVaultSharePrice", "nodeType": "MemberAccess", "referencedDeclaration": 10838, "src": "60207:29:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 161302, "name": "YieldSpaceMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 23292, "src": "59890:14:233", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_YieldSpaceMath_$23292_$", "typeString": "type(library YieldSpaceMath)" } }, "id": 161303, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "59905:5:233", "memberName": "kDown", "nodeType": "MemberAccess", "referencedDeclaration": 23291, "src": "59890:20:233", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256,uint256,uint256) pure returns (uint256)" } }, "id": 161321, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "59890:360:233", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 161283, "id": 161322, "nodeType": "Return", "src": "59871:379:233" }] }, "implemented": true, "kind": "function", "modifiers": [], "name": "k", "nameLocation": "59659:1:233", "parameters": { "id": 161280, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 161279, "mutability": "mutable", "name": "hyperdrive", "nameLocation": "59673:10:233", "nodeType": "VariableDeclaration", "scope": 161324, "src": "59661:22:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" }, "typeName": { "id": 161278, "nodeType": "UserDefinedTypeName", "pathNode": { "id": 161277, "name": "IHyperdrive", "nameLocations": ["59661:11:233"], "nodeType": "IdentifierPath", "referencedDeclaration": 11076, "src": "59661:11:233" }, "referencedDeclaration": 11076, "src": "59661:11:233", "typeDescriptions": { "typeIdentifier": "t_contract$_IHyperdrive_$11076", "typeString": "contract IHyperdrive" } }, "visibility": "internal" }], "src": "59660:24:233" }, "returnParameters": { "id": 161283, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 161282, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 161324, "src": "59708:7:233", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 161281, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "59708:7:233", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "59707:9:233" }, "scope": 161325, "stateMutability": "view", "virtual": false, "visibility": "internal" }], "abstract": false, "baseContracts": [], "canonicalName": "HyperdriveUtils", "contractDependencies": [], "contractKind": "library", "fullyImplemented": true, "linearizedBaseContracts": [161325], "name": "HyperdriveUtils", "nameLocation": "505:15:233", "scope": 161326, "usedErrors": [], "usedEvents": [] }], "license": "Apache-2.0" }, "id": 233 };
