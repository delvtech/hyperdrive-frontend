export const HyperdriveMath = { "abi": [], "bytecode": { "object": "0x60566037600b82828239805160001a607314602a57634e487b7160e01b600052600060045260246000fd5b30600052607381538281f3fe73000000000000000000000000000000000000000030146080604052600080fdfea2646970667358221220e4e01be80aaa6138e8aaeb2cfbbe86d6e3c02a856c9939197209e629a5c66c5e64736f6c63430008140033", "sourceMap": "638:32299:125:-:0;;;;;;;;;;;;;;;-1:-1:-1;;;638:32299:125;;;;;;;;;;;;;;;;;", "linkReferences": {} }, "deployedBytecode": { "object": "0x73000000000000000000000000000000000000000030146080604052600080fdfea2646970667358221220e4e01be80aaa6138e8aaeb2cfbbe86d6e3c02a856c9939197209e629a5c66c5e64736f6c63430008140033", "sourceMap": "638:32299:125:-:0;;;;;;;;", "linkReferences": {} }, "methodIdentifiers": {}, "rawMetadata": "{\"compiler\":{\"version\":\"0.8.20+commit.a1b79de6\"},\"language\":\"Solidity\",\"output\":{\"abi\":[],\"devdoc\":{\"author\":\"DELV\",\"custom:disclaimer\":\"The language used in this code is for coding convenience                    only, and is not intended to, and does not, have any                    particular legal or regulatory significance.\",\"kind\":\"dev\",\"methods\":{},\"title\":\"Hyperdrive\",\"version\":1},\"userdoc\":{\"kind\":\"user\",\"methods\":{},\"notice\":\"Math for the Hyperdrive pricing model.\",\"version\":1}},\"settings\":{\"compilationTarget\":{\"contracts/src/libraries/HyperdriveMath.sol\":\"HyperdriveMath\"},\"evmVersion\":\"paris\",\"libraries\":{},\"metadata\":{\"bytecodeHash\":\"ipfs\"},\"optimizer\":{\"enabled\":true,\"runs\":200},\"remappings\":[\":@openzeppelin/contracts/=lib/openzeppelin-contracts/contracts/\",\":aave-v3-core/=lib/aave-v3-core/\",\":ds-test/=lib/forge-std/lib/ds-test/src/\",\":erc4626-tests/=lib/openzeppelin-contracts/lib/erc4626-tests/\",\":forge-std/=lib/forge-std/src/\",\":openzeppelin-contracts/=lib/openzeppelin-contracts/\",\":openzeppelin/=lib/openzeppelin-contracts/contracts/\",\":solmate/=lib/solmate/src/\"]},\"sources\":{\"contracts/src/interfaces/IERC20.sol\":{\"keccak256\":\"0x5f446a4987d57c64380d44c234ee079172e98bed9595ec067eb519898c3117d9\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://a3245994c58110716f5099c07e5cb270137356d288044f03c713d29c36e207ac\",\"dweb:/ipfs/QmYdn52sGRQKXfSyL8ieSz8HysG6R5kLJWsNwEnyX1e22p\"]},\"contracts/src/interfaces/IHyperdrive.sol\":{\"keccak256\":\"0xb8ee04f3090b498966970e210f7de0f982f6445628556f2f176385423d8c5952\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://db789f03faa935c6e3b0882b6e873e8f683c9c8841a4b128366dcbe7321911bf\",\"dweb:/ipfs/QmSQh1cX79nApuSAfJbVN99dmEaE4CK9QwWfEGcwhJMBLK\"]},\"contracts/src/interfaces/IHyperdriveCore.sol\":{\"keccak256\":\"0x68adcd293ff25711add1698b6024faa45beec01eb044bd0103d3020aa96d856e\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://0e0f5e35a7d2c656e249394d25896e5adfb9af3e210c01b9ef5fa81d25a45e24\",\"dweb:/ipfs/QmbLASezHPWHcbodqSfw3Qh9NzqekqVPM8FhCXKGTCXL1h\"]},\"contracts/src/interfaces/IHyperdriveEvents.sol\":{\"keccak256\":\"0x812ccb32dff907e8614c89a65196eec239eceb3e63f9f14dde2b2269c75a67c0\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://da5f2ce974bfcd8185342c121c879ba5aef23e1e4e7b36cf9fcba68296b8892c\",\"dweb:/ipfs/QmSho3PWs9bzejTYYjySuXcH9tVP4xFnkbUmSzQA54g8eG\"]},\"contracts/src/interfaces/IHyperdriveRead.sol\":{\"keccak256\":\"0x5922cbd86a7267c8fd19e3dc7a6f2636bad2b3330c28bca8e66adc7cd8ce2b55\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://ced8bce3f3c15a9f0bcdd11ba16e69651179edd6b16e267936788f4ab4d6eabf\",\"dweb:/ipfs/QmcoZPj4h2ym6r13KDU7JG2GoVdDWa1GwfKL2jjFRsp8H6\"]},\"contracts/src/interfaces/IMultiToken.sol\":{\"keccak256\":\"0xf5f82b8223e0c1bfcf4f73566a909ba07a9266960dfe2335c1494e06debbbe3f\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://920cf3fd66132a1e98a6a5708ad9a3bb047f4df8848119ab382b51094c1290a7\",\"dweb:/ipfs/QmWL3SyG8L91Coe9DsHz3Ke9tGMvYBf2NgRRDr3Fg5xFzp\"]},\"contracts/src/interfaces/IMultiTokenCore.sol\":{\"keccak256\":\"0x5c27315743bb6ef8a121ecf72cb24d5c144786dedb6526ef010f580eb872e501\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://3e102c51bac9c82766c9826d97dc780a05a2bf64703b070757a7531a0851a1ae\",\"dweb:/ipfs/QmXYwbzPbiznj5AeDiX7NNfRE9xyhSx1huTMfMFndrUZWs\"]},\"contracts/src/interfaces/IMultiTokenEvents.sol\":{\"keccak256\":\"0x165f79e628b1975343f979549f3fdb5073a29aeecb03861f41d165961ee39fdb\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://3c0751cf322944d080a7a6692897807d0cef798268689afc1f6c8f91182a4222\",\"dweb:/ipfs/QmQVWtCgphU9sjqD2q6F6ww62uXDSWZx5KJVj6jFJpXeDK\"]},\"contracts/src/interfaces/IMultiTokenMetadata.sol\":{\"keccak256\":\"0xcc21ad6d3d4e3de354fbc25a472d940e5e2af0b48766404f9efecdac600d72ca\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://b48fa111a773c820fe578efdd737d164e3957930ed46f3f304c6a8602a7e26a3\",\"dweb:/ipfs/QmcA7bjBC6ZBvYyojZZx3eKpugHmSrAAA14p14bQugiVKG\"]},\"contracts/src/interfaces/IMultiTokenRead.sol\":{\"keccak256\":\"0xac84dd306f29ae9d6becf764d93545c33f7c37737bb1aeb714c85930d0c074a0\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://d9082a16d5a736ab7ce5670be4f2475ea5c5fdae8ad7096ed9663f84eed96b11\",\"dweb:/ipfs/QmUTH8dZaQJt56UsT7N2aCUCKmjQYj7Ah53rRXk6DuVNUR\"]},\"contracts/src/libraries/Errors.sol\":{\"keccak256\":\"0x45f48f5b8caec5b751850b7266abd84c7400debfbad0f112847582bb052058b0\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://46c85e0c750cdb752bec5d67a8a0bc8df071d934c568c880d08a5120a1a11d88\",\"dweb:/ipfs/Qmc2L1ePB1gqBwUiaAUeoG6hvoPtS2hdY6rhEXzX1SfB41\"]},\"contracts/src/libraries/FixedPointMath.sol\":{\"keccak256\":\"0x631f6529908f62f71775f8c6120afdca3a836fb24fa9fa4701cad54f4a9da076\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://2baf6ad8917a3fbb6d040334451f6b4f6936b00518c4cd308b9c6fa11569b2bd\",\"dweb:/ipfs/QmXD16vk6MRxmPRqy8ZXSpRA5XxhSf1pnsQH32ARDJTk8L\"]},\"contracts/src/libraries/HyperdriveMath.sol\":{\"keccak256\":\"0xcf305dde8aa320d1e1b767734ce8edce456af537525d40e30d5345f09f6e34ab\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://056c9a563f1a9e0133e17463497ad19be517d35b770170122edea50ca9fbe002\",\"dweb:/ipfs/QmS6dkVRHzdbv7etumcCtNtm9GuXDCjqZxxhtYfP6keAAY\"]},\"contracts/src/libraries/SafeCast.sol\":{\"keccak256\":\"0xc5282be69c8c85c1a1bbbf1554a501c17599f4b84119339b660018ae90eb7148\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://fd29b570d1e3205d25939b1c0e78e98ae34747a8118703fc5b2c9690791b26c8\",\"dweb:/ipfs/QmSdecxKRE66cgEipikK5uS4mUJxz2FgfncCk9iXvkdjG8\"]},\"contracts/src/libraries/YieldSpaceMath.sol\":{\"keccak256\":\"0x4a9c91313bed7cda6ef503af23c9f777008b5258e9cb2176eab6acc52be79891\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://88da1f5502a12fe1024be90f6a6ea08556cc1f2660ab8cbeb5e07640abb7711c\",\"dweb:/ipfs/QmVQoG9TyrAsVYcgvgZfgA5pQk8V8wvS4BewGNP4B3Txyy\"]}},\"version\":1}", "metadata": { "compiler": { "version": "0.8.20+commit.a1b79de6" }, "language": "Solidity", "output": { "abi": [], "devdoc": { "kind": "dev", "methods": {}, "version": 1 }, "userdoc": { "kind": "user", "methods": {}, "version": 1 } }, "settings": { "remappings": ["@openzeppelin/contracts/=lib/openzeppelin-contracts/contracts/", "aave-v3-core/=lib/aave-v3-core/", "ds-test/=lib/forge-std/lib/ds-test/src/", "erc4626-tests/=lib/openzeppelin-contracts/lib/erc4626-tests/", "forge-std/=lib/forge-std/src/", "openzeppelin-contracts/=lib/openzeppelin-contracts/", "openzeppelin/=lib/openzeppelin-contracts/contracts/", "solmate/=lib/solmate/src/"], "optimizer": { "enabled": true, "runs": 200 }, "metadata": { "bytecodeHash": "ipfs" }, "compilationTarget": { "contracts/src/libraries/HyperdriveMath.sol": "HyperdriveMath" }, "libraries": {} }, "sources": { "contracts/src/interfaces/IERC20.sol": { "keccak256": "0x5f446a4987d57c64380d44c234ee079172e98bed9595ec067eb519898c3117d9", "urls": ["bzz-raw://a3245994c58110716f5099c07e5cb270137356d288044f03c713d29c36e207ac", "dweb:/ipfs/QmYdn52sGRQKXfSyL8ieSz8HysG6R5kLJWsNwEnyX1e22p"], "license": "Apache-2.0" }, "contracts/src/interfaces/IHyperdrive.sol": { "keccak256": "0xb8ee04f3090b498966970e210f7de0f982f6445628556f2f176385423d8c5952", "urls": ["bzz-raw://db789f03faa935c6e3b0882b6e873e8f683c9c8841a4b128366dcbe7321911bf", "dweb:/ipfs/QmSQh1cX79nApuSAfJbVN99dmEaE4CK9QwWfEGcwhJMBLK"], "license": "Apache-2.0" }, "contracts/src/interfaces/IHyperdriveCore.sol": { "keccak256": "0x68adcd293ff25711add1698b6024faa45beec01eb044bd0103d3020aa96d856e", "urls": ["bzz-raw://0e0f5e35a7d2c656e249394d25896e5adfb9af3e210c01b9ef5fa81d25a45e24", "dweb:/ipfs/QmbLASezHPWHcbodqSfw3Qh9NzqekqVPM8FhCXKGTCXL1h"], "license": "Apache-2.0" }, "contracts/src/interfaces/IHyperdriveEvents.sol": { "keccak256": "0x812ccb32dff907e8614c89a65196eec239eceb3e63f9f14dde2b2269c75a67c0", "urls": ["bzz-raw://da5f2ce974bfcd8185342c121c879ba5aef23e1e4e7b36cf9fcba68296b8892c", "dweb:/ipfs/QmSho3PWs9bzejTYYjySuXcH9tVP4xFnkbUmSzQA54g8eG"], "license": "Apache-2.0" }, "contracts/src/interfaces/IHyperdriveRead.sol": { "keccak256": "0x5922cbd86a7267c8fd19e3dc7a6f2636bad2b3330c28bca8e66adc7cd8ce2b55", "urls": ["bzz-raw://ced8bce3f3c15a9f0bcdd11ba16e69651179edd6b16e267936788f4ab4d6eabf", "dweb:/ipfs/QmcoZPj4h2ym6r13KDU7JG2GoVdDWa1GwfKL2jjFRsp8H6"], "license": "Apache-2.0" }, "contracts/src/interfaces/IMultiToken.sol": { "keccak256": "0xf5f82b8223e0c1bfcf4f73566a909ba07a9266960dfe2335c1494e06debbbe3f", "urls": ["bzz-raw://920cf3fd66132a1e98a6a5708ad9a3bb047f4df8848119ab382b51094c1290a7", "dweb:/ipfs/QmWL3SyG8L91Coe9DsHz3Ke9tGMvYBf2NgRRDr3Fg5xFzp"], "license": "Apache-2.0" }, "contracts/src/interfaces/IMultiTokenCore.sol": { "keccak256": "0x5c27315743bb6ef8a121ecf72cb24d5c144786dedb6526ef010f580eb872e501", "urls": ["bzz-raw://3e102c51bac9c82766c9826d97dc780a05a2bf64703b070757a7531a0851a1ae", "dweb:/ipfs/QmXYwbzPbiznj5AeDiX7NNfRE9xyhSx1huTMfMFndrUZWs"], "license": "Apache-2.0" }, "contracts/src/interfaces/IMultiTokenEvents.sol": { "keccak256": "0x165f79e628b1975343f979549f3fdb5073a29aeecb03861f41d165961ee39fdb", "urls": ["bzz-raw://3c0751cf322944d080a7a6692897807d0cef798268689afc1f6c8f91182a4222", "dweb:/ipfs/QmQVWtCgphU9sjqD2q6F6ww62uXDSWZx5KJVj6jFJpXeDK"], "license": "Apache-2.0" }, "contracts/src/interfaces/IMultiTokenMetadata.sol": { "keccak256": "0xcc21ad6d3d4e3de354fbc25a472d940e5e2af0b48766404f9efecdac600d72ca", "urls": ["bzz-raw://b48fa111a773c820fe578efdd737d164e3957930ed46f3f304c6a8602a7e26a3", "dweb:/ipfs/QmcA7bjBC6ZBvYyojZZx3eKpugHmSrAAA14p14bQugiVKG"], "license": "Apache-2.0" }, "contracts/src/interfaces/IMultiTokenRead.sol": { "keccak256": "0xac84dd306f29ae9d6becf764d93545c33f7c37737bb1aeb714c85930d0c074a0", "urls": ["bzz-raw://d9082a16d5a736ab7ce5670be4f2475ea5c5fdae8ad7096ed9663f84eed96b11", "dweb:/ipfs/QmUTH8dZaQJt56UsT7N2aCUCKmjQYj7Ah53rRXk6DuVNUR"], "license": "Apache-2.0" }, "contracts/src/libraries/Errors.sol": { "keccak256": "0x45f48f5b8caec5b751850b7266abd84c7400debfbad0f112847582bb052058b0", "urls": ["bzz-raw://46c85e0c750cdb752bec5d67a8a0bc8df071d934c568c880d08a5120a1a11d88", "dweb:/ipfs/Qmc2L1ePB1gqBwUiaAUeoG6hvoPtS2hdY6rhEXzX1SfB41"], "license": "Apache-2.0" }, "contracts/src/libraries/FixedPointMath.sol": { "keccak256": "0x631f6529908f62f71775f8c6120afdca3a836fb24fa9fa4701cad54f4a9da076", "urls": ["bzz-raw://2baf6ad8917a3fbb6d040334451f6b4f6936b00518c4cd308b9c6fa11569b2bd", "dweb:/ipfs/QmXD16vk6MRxmPRqy8ZXSpRA5XxhSf1pnsQH32ARDJTk8L"], "license": "Apache-2.0" }, "contracts/src/libraries/HyperdriveMath.sol": { "keccak256": "0xcf305dde8aa320d1e1b767734ce8edce456af537525d40e30d5345f09f6e34ab", "urls": ["bzz-raw://056c9a563f1a9e0133e17463497ad19be517d35b770170122edea50ca9fbe002", "dweb:/ipfs/QmS6dkVRHzdbv7etumcCtNtm9GuXDCjqZxxhtYfP6keAAY"], "license": "Apache-2.0" }, "contracts/src/libraries/SafeCast.sol": { "keccak256": "0xc5282be69c8c85c1a1bbbf1554a501c17599f4b84119339b660018ae90eb7148", "urls": ["bzz-raw://fd29b570d1e3205d25939b1c0e78e98ae34747a8118703fc5b2c9690791b26c8", "dweb:/ipfs/QmSdecxKRE66cgEipikK5uS4mUJxz2FgfncCk9iXvkdjG8"], "license": "Apache-2.0" }, "contracts/src/libraries/YieldSpaceMath.sol": { "keccak256": "0x4a9c91313bed7cda6ef503af23c9f777008b5258e9cb2176eab6acc52be79891", "urls": ["bzz-raw://88da1f5502a12fe1024be90f6a6ea08556cc1f2660ab8cbeb5e07640abb7711c", "dweb:/ipfs/QmVQoG9TyrAsVYcgvgZfgA5pQk8V8wvS4BewGNP4B3Txyy"], "license": "Apache-2.0" } }, "version": 1 }, "ast": { "absolutePath": "contracts/src/libraries/HyperdriveMath.sol", "id": 20191, "exportedSymbols": { "Errors": [18667], "FixedPointMath": [19442], "HyperdriveMath": [20190], "IHyperdrive": [11076], "ONE": [18676], "SafeCast": [22313], "YieldSpaceMath": [23292] }, "nodeType": "SourceUnit", "src": "40:32898:125", "nodes": [{ "id": 19444, "nodeType": "PragmaDirective", "src": "40:23:125", "nodes": [], "literals": ["solidity", "0.8", ".20"] }, { "id": 19446, "nodeType": "ImportDirective", "src": "65:60:125", "nodes": [], "absolutePath": "contracts/src/interfaces/IHyperdrive.sol", "file": "../interfaces/IHyperdrive.sol", "nameLocation": "-1:-1:-1", "scope": 20191, "sourceUnit": 11077, "symbolAliases": [{ "foreign": { "id": 19445, "name": "IHyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 11076, "src": "74:11:125", "typeDescriptions": {} }, "nameLocation": "-1:-1:-1" }], "unitAlias": "" }, { "id": 19448, "nodeType": "ImportDirective", "src": "126:38:125", "nodes": [], "absolutePath": "contracts/src/libraries/Errors.sol", "file": "./Errors.sol", "nameLocation": "-1:-1:-1", "scope": 20191, "sourceUnit": 18668, "symbolAliases": [{ "foreign": { "id": 19447, "name": "Errors", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18667, "src": "135:6:125", "typeDescriptions": {} }, "nameLocation": "-1:-1:-1" }], "unitAlias": "" }, { "id": 19451, "nodeType": "ImportDirective", "src": "165:59:125", "nodes": [], "absolutePath": "contracts/src/libraries/FixedPointMath.sol", "file": "./FixedPointMath.sol", "nameLocation": "-1:-1:-1", "scope": 20191, "sourceUnit": 19443, "symbolAliases": [{ "foreign": { "id": 19449, "name": "FixedPointMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19442, "src": "174:14:125", "typeDescriptions": {} }, "nameLocation": "-1:-1:-1" }, { "foreign": { "id": 19450, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "190:3:125", "typeDescriptions": {} }, "nameLocation": "-1:-1:-1" }], "unitAlias": "" }, { "id": 19453, "nodeType": "ImportDirective", "src": "225:42:125", "nodes": [], "absolutePath": "contracts/src/libraries/SafeCast.sol", "file": "./SafeCast.sol", "nameLocation": "-1:-1:-1", "scope": 20191, "sourceUnit": 22314, "symbolAliases": [{ "foreign": { "id": 19452, "name": "SafeCast", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 22313, "src": "234:8:125", "typeDescriptions": {} }, "nameLocation": "-1:-1:-1" }], "unitAlias": "" }, { "id": 19455, "nodeType": "ImportDirective", "src": "268:54:125", "nodes": [], "absolutePath": "contracts/src/libraries/YieldSpaceMath.sol", "file": "./YieldSpaceMath.sol", "nameLocation": "-1:-1:-1", "scope": 20191, "sourceUnit": 23293, "symbolAliases": [{ "foreign": { "id": 19454, "name": "YieldSpaceMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 23292, "src": "277:14:125", "typeDescriptions": {} }, "nameLocation": "-1:-1:-1" }], "unitAlias": "" }, { "id": 20190, "nodeType": "ContractDefinition", "src": "638:32299:125", "nodes": [{ "id": 19459, "nodeType": "UsingForDirective", "src": "667:33:125", "nodes": [], "global": false, "libraryName": { "id": 19457, "name": "FixedPointMath", "nameLocations": ["673:14:125"], "nodeType": "IdentifierPath", "referencedDeclaration": 19442, "src": "673:14:125" }, "typeName": { "id": 19458, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "692:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } } }, { "id": 19462, "nodeType": "UsingForDirective", "src": "705:32:125", "nodes": [], "global": false, "libraryName": { "id": 19460, "name": "FixedPointMath", "nameLocations": ["711:14:125"], "nodeType": "IdentifierPath", "referencedDeclaration": 19442, "src": "711:14:125" }, "typeName": { "id": 19461, "name": "int256", "nodeType": "ElementaryTypeName", "src": "730:6:125", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } } }, { "id": 19465, "nodeType": "UsingForDirective", "src": "742:27:125", "nodes": [], "global": false, "libraryName": { "id": 19463, "name": "SafeCast", "nameLocations": ["748:8:125"], "nodeType": "IdentifierPath", "referencedDeclaration": 22313, "src": "748:8:125" }, "typeName": { "id": 19464, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "761:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } } }, { "id": 19534, "nodeType": "FunctionDefinition", "src": "1405:1330:125", "nodes": [], "body": { "id": 19533, "nodeType": "Block", "src": "1530:1205:125", "nodes": [], "statements": [{ "assignments": [19476], "declarations": [{ "constant": false, "id": 19476, "mutability": "mutable", "name": "timeStretch", "nameLocation": "1670:11:125", "nodeType": "VariableDeclaration", "scope": 19533, "src": "1662:19:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19475, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "1662:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 19492, "initialValue": { "arguments": [{ "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 19489, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 19487, "name": "_apr", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19468, "src": "1753:4:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "*", "rightExpression": { "hexValue": "313030", "id": 19488, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "1760:3:125", "typeDescriptions": { "typeIdentifier": "t_rational_100_by_1", "typeString": "int_const 100" }, "value": "100" }, "src": "1753:10:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "hexValue": "302e3034363635653138", "id": 19484, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "1733:10:125", "typeDescriptions": { "typeIdentifier": "t_rational_46650000000000000_by_1", "typeString": "int_const 46650000000000000" }, "value": "0.04665e18" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_rational_46650000000000000_by_1", "typeString": "int_const 46650000000000000" }], "id": 19483, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "1725:7:125", "typeDescriptions": { "typeIdentifier": "t_type$_t_uint256_$", "typeString": "type(uint256)" }, "typeName": { "id": 19482, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "1725:7:125", "typeDescriptions": {} } }, "id": 19485, "isConstant": false, "isLValue": false, "isPure": true, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "1725:19:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19486, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "1745:7:125", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "1725:27:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19490, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "1725:39:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "hexValue": "352e3234353932653138", "id": 19479, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "1692:10:125", "typeDescriptions": { "typeIdentifier": "t_rational_5245920000000000000_by_1", "typeString": "int_const 5245920000000000000" }, "value": "5.24592e18" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_rational_5245920000000000000_by_1", "typeString": "int_const 5245920000000000000" }], "id": 19478, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "1684:7:125", "typeDescriptions": { "typeIdentifier": "t_type$_t_uint256_$", "typeString": "type(uint256)" }, "typeName": { "id": 19477, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "1684:7:125", "typeDescriptions": {} } }, "id": 19480, "isConstant": false, "isLValue": false, "isPure": true, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "1684:19:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19481, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "1704:7:125", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "1684:27:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19491, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "1684:90:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "1662:112:125" }, { "expression": { "id": 19498, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 19493, "name": "timeStretch", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19476, "src": "1784:11:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 19496, "name": "timeStretch", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19476, "src": "1810:11:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 19494, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "1798:3:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19495, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "1802:7:125", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "1798:11:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19497, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "1798:24:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "1784:38:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19499, "nodeType": "ExpressionStatement", "src": "1784:38:125" }, { "expression": { "arguments": [{ "id": 19530, "name": "timeStretch", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19476, "src": "2716:11:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "components": [{ "arguments": [{ "arguments": [{ "arguments": [], "expression": { "argumentTypes": [], "expression": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 19520, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 19518, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "2664:3:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "id": 19519, "name": "_apr", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19468, "src": "2670:4:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "2664:10:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 19521, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "2663:12:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19522, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "2676:8:125", "memberName": "toInt256", "nodeType": "MemberAccess", "referencedDeclaration": 22312, "src": "2663:21:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$returns$_t_int256_$attached_to$_t_uint256_$", "typeString": "function (uint256) pure returns (int256)" } }, "id": 19523, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "2663:23:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "id": 19524, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "2687:2:125", "memberName": "ln", "nodeType": "MemberAccess", "referencedDeclaration": 19266, "src": "2663:26:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_int256_$returns$_t_int256_$attached_to$_t_int256_$", "typeString": "function (int256) pure returns (int256)" } }, "id": 19525, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "2663:28:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 19517, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "2655:7:125", "typeDescriptions": { "typeIdentifier": "t_type$_t_uint256_$", "typeString": "type(uint256)" }, "typeName": { "id": 19516, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "2655:7:125", "typeDescriptions": {} } }, "id": 19526, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "2655:37:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "arguments": [], "expression": { "argumentTypes": [], "expression": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 19508, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 19502, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "2511:3:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "arguments": [{ "id": 19505, "name": "_positionDuration", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19470, "src": "2533:17:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "hexValue": "333635", "id": 19506, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "2552:8:125", "subdenomination": "days", "typeDescriptions": { "typeIdentifier": "t_rational_31536000_by_1", "typeString": "int_const 31536000" }, "value": "365" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_rational_31536000_by_1", "typeString": "int_const 31536000" }], "expression": { "id": 19503, "name": "_apr", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19468, "src": "2517:4:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19504, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "2522:10:125", "memberName": "mulDivDown", "nodeType": "MemberAccess", "referencedDeclaration": 18704, "src": "2517:15:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 19507, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "2517:44:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "2511:50:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 19509, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "2510:52:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19510, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "2588:8:125", "memberName": "toInt256", "nodeType": "MemberAccess", "referencedDeclaration": 22312, "src": "2510:86:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$returns$_t_int256_$attached_to$_t_uint256_$", "typeString": "function (uint256) pure returns (int256)" } }, "id": 19511, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "2510:88:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "id": 19512, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "2624:2:125", "memberName": "ln", "nodeType": "MemberAccess", "referencedDeclaration": 19266, "src": "2510:116:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_int256_$returns$_t_int256_$attached_to$_t_int256_$", "typeString": "function (int256) pure returns (int256)" } }, "id": 19513, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "2510:118:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 19501, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "2481:7:125", "typeDescriptions": { "typeIdentifier": "t_type$_t_uint256_$", "typeString": "type(uint256)" }, "typeName": { "id": 19500, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "2481:7:125", "typeDescriptions": {} } }, "id": 19514, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "2481:165:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19515, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "2647:7:125", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "2481:173:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19527, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "2481:212:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 19528, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "2463:244:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19529, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "2708:7:125", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "2463:252:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19531, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "2463:265:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 19474, "id": 19532, "nodeType": "Return", "src": "2444:284:125" }] }, "documentation": { "id": 19466, "nodeType": "StructuredDocumentation", "src": "775:625:125", "text": "@dev Calculates the time stretch parameter for the YieldSpace curve.\n      This parameter modifies the curvature in order to support a larger\n      or smaller range of APRs. The lower the time stretch, the flatter\n      the curve will be and the narrower the range of feasible APRs. The\n      higher the time stretch, the higher the curvature will be and the\n      wider the range of feasible APRs.\n @param _apr The target APR to use when calculating the time stretch.\n @param _positionDuration The position duration in seconds.\n @return The time stretch parameter." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateTimeStretch", "nameLocation": "1414:20:125", "parameters": { "id": 19471, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19468, "mutability": "mutable", "name": "_apr", "nameLocation": "1452:4:125", "nodeType": "VariableDeclaration", "scope": 19534, "src": "1444:12:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19467, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "1444:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19470, "mutability": "mutable", "name": "_positionDuration", "nameLocation": "1474:17:125", "nodeType": "VariableDeclaration", "scope": 19534, "src": "1466:25:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19469, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "1466:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "1434:63:125" }, "returnParameters": { "id": 19474, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19473, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 19534, "src": "1521:7:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19472, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "1521:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "1520:9:125" }, "scope": 20190, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 19560, "nodeType": "FunctionDefinition", "src": "3330:531:125", "nodes": [], "body": { "id": 19559, "nodeType": "Block", "src": "3549:312:125", "nodes": [], "statements": [{ "expression": { "id": 19557, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 19548, "name": "spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19546, "src": "3724:9:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 19555, "name": "_timeStretch", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19543, "src": "3841:12:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "id": 19551, "name": "_effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19537, "src": "3784:23:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 19552, "name": "_bondReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19539, "src": "3809:13:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 19549, "name": "_initialVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19541, "src": "3736:23:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19550, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "3773:10:125", "memberName": "mulDivDown", "nodeType": "MemberAccess", "referencedDeclaration": 18704, "src": "3736:47:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 19553, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "3736:87:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19554, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "3837:3:125", "memberName": "pow", "nodeType": "MemberAccess", "referencedDeclaration": 18847, "src": "3736:104:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19556, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "3736:118:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "3724:130:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19558, "nodeType": "ExpressionStatement", "src": "3724:130:125" }] }, "documentation": { "id": 19535, "nodeType": "StructuredDocumentation", "src": "2741:584:125", "text": "@dev Calculates the spot price of bonds in terms of base. This\n      calculation underestimates the pool's spot price.\n @param _effectiveShareReserves The pool's effective share reserves. The\n        effective share reserves are a modified version of the share\n        reserves used when pricing trades.\n @param _bondReserves The pool's bond reserves.\n @param _initialVaultSharePrice The initial vault share price.\n @param _timeStretch The time stretch parameter.\n @return spotPrice The spot price of bonds in terms of base." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateSpotPrice", "nameLocation": "3339:18:125", "parameters": { "id": 19544, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19537, "mutability": "mutable", "name": "_effectiveShareReserves", "nameLocation": "3375:23:125", "nodeType": "VariableDeclaration", "scope": 19560, "src": "3367:31:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19536, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "3367:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19539, "mutability": "mutable", "name": "_bondReserves", "nameLocation": "3416:13:125", "nodeType": "VariableDeclaration", "scope": 19560, "src": "3408:21:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19538, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "3408:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19541, "mutability": "mutable", "name": "_initialVaultSharePrice", "nameLocation": "3447:23:125", "nodeType": "VariableDeclaration", "scope": 19560, "src": "3439:31:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19540, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "3439:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19543, "mutability": "mutable", "name": "_timeStretch", "nameLocation": "3488:12:125", "nodeType": "VariableDeclaration", "scope": 19560, "src": "3480:20:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19542, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "3480:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "3357:149:125" }, "returnParameters": { "id": 19547, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19546, "mutability": "mutable", "name": "spotPrice", "nameLocation": "3538:9:125", "nodeType": "VariableDeclaration", "scope": 19560, "src": "3530:17:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19545, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "3530:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "3529:19:125" }, "scope": 20190, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 19598, "nodeType": "FunctionDefinition", "src": "4497:945:125", "nodes": [], "body": { "id": 19597, "nodeType": "Block", "src": "4743:699:125", "nodes": [], "statements": [{ "assignments": [19577], "declarations": [{ "constant": false, "id": 19577, "mutability": "mutable", "name": "spotPrice", "nameLocation": "5067:9:125", "nodeType": "VariableDeclaration", "scope": 19597, "src": "5059:17:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19576, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "5059:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 19584, "initialValue": { "arguments": [{ "id": 19579, "name": "_effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19563, "src": "5111:23:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 19580, "name": "_bondReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19565, "src": "5148:13:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 19581, "name": "_initialVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19567, "src": "5175:23:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 19582, "name": "_timeStretch", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19571, "src": "5212:12:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 19578, "name": "calculateSpotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19560, "src": "5079:18:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256,uint256) pure returns (uint256)" } }, "id": 19583, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "5079:155:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "5059:175:125" }, { "expression": { "arguments": [{ "arguments": [{ "id": 19592, "name": "_positionDuration", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19569, "src": "5393:17:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "hexValue": "333635", "id": 19593, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "5412:8:125", "subdenomination": "days", "typeDescriptions": { "typeIdentifier": "t_rational_31536000_by_1", "typeString": "int_const 31536000" }, "value": "365" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_rational_31536000_by_1", "typeString": "int_const 31536000" }], "expression": { "id": 19590, "name": "spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19577, "src": "5374:9:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19591, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "5384:8:125", "memberName": "mulDivUp", "nodeType": "MemberAccess", "referencedDeclaration": 18754, "src": "5374:18:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 19594, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "5374:47:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 19587, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 19585, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "5264:3:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 19586, "name": "spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19577, "src": "5270:9:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "5264:15:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 19588, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "5263:17:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19589, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "5281:7:125", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "5263:25:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19595, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "5263:172:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 19575, "id": 19596, "nodeType": "Return", "src": "5244:191:125" }] }, "documentation": { "id": 19561, "nodeType": "StructuredDocumentation", "src": "3867:625:125", "text": "@dev Calculates the spot APR of the pool. This calculation\n      underestimates the pool's spot APR.\n @param _effectiveShareReserves The pool's effective share reserves. The\n        effective share reserves are a modified version of the share\n        reserves used when pricing trades.\n @param _bondReserves The pool's bond reserves.\n @param _initialVaultSharePrice The pool's initial vault share price.\n @param _positionDuration The amount of time until maturity in seconds.\n @param _timeStretch The time stretch parameter.\n @return apr The pool's spot APR." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateSpotAPR", "nameLocation": "4506:16:125", "parameters": { "id": 19572, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19563, "mutability": "mutable", "name": "_effectiveShareReserves", "nameLocation": "4540:23:125", "nodeType": "VariableDeclaration", "scope": 19598, "src": "4532:31:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19562, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "4532:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19565, "mutability": "mutable", "name": "_bondReserves", "nameLocation": "4581:13:125", "nodeType": "VariableDeclaration", "scope": 19598, "src": "4573:21:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19564, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "4573:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19567, "mutability": "mutable", "name": "_initialVaultSharePrice", "nameLocation": "4612:23:125", "nodeType": "VariableDeclaration", "scope": 19598, "src": "4604:31:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19566, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "4604:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19569, "mutability": "mutable", "name": "_positionDuration", "nameLocation": "4653:17:125", "nodeType": "VariableDeclaration", "scope": 19598, "src": "4645:25:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19568, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "4645:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19571, "mutability": "mutable", "name": "_timeStretch", "nameLocation": "4688:12:125", "nodeType": "VariableDeclaration", "scope": 19598, "src": "4680:20:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19570, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "4680:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "4522:184:125" }, "returnParameters": { "id": 19575, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19574, "mutability": "mutable", "name": "apr", "nameLocation": "4738:3:125", "nodeType": "VariableDeclaration", "scope": 19598, "src": "4730:11:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19573, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "4730:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "4729:13:125" }, "scope": 20190, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 19633, "nodeType": "FunctionDefinition", "src": "6050:574:125", "nodes": [], "body": { "id": 19632, "nodeType": "Block", "src": "6217:407:125", "nodes": [], "statements": [{ "assignments": [19609], "declarations": [{ "constant": false, "id": 19609, "mutability": "mutable", "name": "success", "nameLocation": "6232:7:125", "nodeType": "VariableDeclaration", "scope": 19632, "src": "6227:12:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "typeName": { "id": 19608, "name": "bool", "nodeType": "ElementaryTypeName", "src": "6227:4:125", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "visibility": "internal" }], "id": 19610, "nodeType": "VariableDeclarationStatement", "src": "6227:12:125" }, { "expression": { "id": 19618, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "components": [{ "id": 19611, "name": "effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19606, "src": "6250:22:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 19612, "name": "success", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19609, "src": "6274:7:125", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }], "id": 19613, "isConstant": false, "isInlineArray": false, "isLValue": true, "isPure": false, "lValueRequested": true, "nodeType": "TupleExpression", "src": "6249:33:125", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 19615, "name": "_shareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19601, "src": "6334:14:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 19616, "name": "_shareAdjustment", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19603, "src": "6362:16:125", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 19614, "name": "calculateEffectiveShareReservesSafe", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19670, "src": "6285:35:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_int256_$returns$_t_uint256_$_t_bool_$", "typeString": "function (uint256,int256) pure returns (uint256,bool)" } }, "id": 19617, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "6285:103:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "src": "6249:139:125", "typeDescriptions": { "typeIdentifier": "t_tuple$__$", "typeString": "tuple()" } }, "id": 19619, "nodeType": "ExpressionStatement", "src": "6249:139:125" }, { "condition": { "id": 19621, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "UnaryOperation", "operator": "!", "prefix": true, "src": "6402:8:125", "subExpression": { "id": 19620, "name": "success", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19609, "src": "6403:7:125", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "id": 19631, "nodeType": "IfStatement", "src": "6398:220:125", "trueBody": { "id": 19630, "nodeType": "Block", "src": "6412:206:125", "statements": [{ "expression": { "arguments": [{ "expression": { "expression": { "id": 19625, "name": "IHyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 11076, "src": "6482:11:125", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_IHyperdrive_$11076_$", "typeString": "type(contract IHyperdrive)" } }, "id": 19626, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "6515:27:125", "memberName": "InsufficientLiquidityReason", "nodeType": "MemberAccess", "referencedDeclaration": 10929, "src": "6482:60:125", "typeDescriptions": { "typeIdentifier": "t_type$_t_enum$_InsufficientLiquidityReason_$10929_$", "typeString": "type(enum IHyperdrive.InsufficientLiquidityReason)" } }, "id": 19627, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "memberLocation": "6564:29:125", "memberName": "InvalidEffectiveShareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 10926, "src": "6482:111:125", "typeDescriptions": { "typeIdentifier": "t_enum$_InsufficientLiquidityReason_$10929", "typeString": "enum IHyperdrive.InsufficientLiquidityReason" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_enum$_InsufficientLiquidityReason_$10929", "typeString": "enum IHyperdrive.InsufficientLiquidityReason" }], "expression": { "id": 19622, "name": "Errors", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18667, "src": "6426:6:125", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_Errors_$18667_$", "typeString": "type(library Errors)" } }, "id": 19624, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "6433:31:125", "memberName": "throwInsufficientLiquidityError", "nodeType": "MemberAccess", "referencedDeclaration": 18666, "src": "6426:38:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_enum$_InsufficientLiquidityReason_$10929_$returns$__$", "typeString": "function (enum IHyperdrive.InsufficientLiquidityReason) pure" } }, "id": 19628, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "6426:181:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_tuple$__$", "typeString": "tuple()" } }, "id": 19629, "nodeType": "ExpressionStatement", "src": "6426:181:125" }] } }] }, "documentation": { "id": 19599, "nodeType": "StructuredDocumentation", "src": "5448:597:125", "text": "@dev Calculates the effective share reserves. The effective share\n      reserves are the share reserves minus the share adjustment or\n      z - zeta. We use the effective share reserves as the z-parameter\n      to the YieldSpace pricing model. The share adjustment is used to\n      hold the pricing mechanism invariant under the flat component of\n      flat+curve trades.\n @param _shareReserves The pool's share reserves.\n @param _shareAdjustment The pool's share adjustment.\n @return effectiveShareReserves The effective share reserves." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateEffectiveShareReserves", "nameLocation": "6059:31:125", "parameters": { "id": 19604, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19601, "mutability": "mutable", "name": "_shareReserves", "nameLocation": "6108:14:125", "nodeType": "VariableDeclaration", "scope": 19633, "src": "6100:22:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19600, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "6100:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19603, "mutability": "mutable", "name": "_shareAdjustment", "nameLocation": "6139:16:125", "nodeType": "VariableDeclaration", "scope": 19633, "src": "6132:23:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" }, "typeName": { "id": 19602, "name": "int256", "nodeType": "ElementaryTypeName", "src": "6132:6:125", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "visibility": "internal" }], "src": "6090:71:125" }, "returnParameters": { "id": 19607, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19606, "mutability": "mutable", "name": "effectiveShareReserves", "nameLocation": "6193:22:125", "nodeType": "VariableDeclaration", "scope": 19633, "src": "6185:30:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19605, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "6185:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "6184:32:125" }, "scope": 20190, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 19670, "nodeType": "FunctionDefinition", "src": "7273:398:125", "nodes": [], "body": { "id": 19669, "nodeType": "Block", "src": "7427:244:125", "nodes": [], "statements": [{ "assignments": [19646], "declarations": [{ "constant": false, "id": 19646, "mutability": "mutable", "name": "effectiveShareReserves", "nameLocation": "7444:22:125", "nodeType": "VariableDeclaration", "scope": 19669, "src": "7437:29:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" }, "typeName": { "id": 19645, "name": "int256", "nodeType": "ElementaryTypeName", "src": "7437:6:125", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "visibility": "internal" }], "id": 19652, "initialValue": { "commonType": { "typeIdentifier": "t_int256", "typeString": "int256" }, "id": 19651, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 19647, "name": "_shareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19636, "src": "7469:14:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19648, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "7484:8:125", "memberName": "toInt256", "nodeType": "MemberAccess", "referencedDeclaration": 22312, "src": "7469:23:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$returns$_t_int256_$attached_to$_t_uint256_$", "typeString": "function (uint256) pure returns (int256)" } }, "id": 19649, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "7469:25:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 19650, "name": "_shareAdjustment", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19638, "src": "7509:16:125", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "src": "7469:56:125", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "nodeType": "VariableDeclarationStatement", "src": "7437:88:125" }, { "condition": { "commonType": { "typeIdentifier": "t_int256", "typeString": "int256" }, "id": 19655, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 19653, "name": "effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19646, "src": "7539:22:125", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "nodeType": "BinaryOperation", "operator": "<", "rightExpression": { "hexValue": "30", "id": 19654, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "7564:1:125", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }, "src": "7539:26:125", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "id": 19661, "nodeType": "IfStatement", "src": "7535:74:125", "trueBody": { "id": 19660, "nodeType": "Block", "src": "7567:42:125", "statements": [{ "expression": { "components": [{ "hexValue": "30", "id": 19656, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "7589:1:125", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }, { "hexValue": "66616c7365", "id": 19657, "isConstant": false, "isLValue": false, "isPure": true, "kind": "bool", "lValueRequested": false, "nodeType": "Literal", "src": "7592:5:125", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "value": "false" }], "id": 19658, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "TupleExpression", "src": "7588:10:125", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_rational_0_by_1_$_t_bool_$", "typeString": "tuple(int_const 0,bool)" } }, "functionReturnParameters": 19644, "id": 19659, "nodeType": "Return", "src": "7581:17:125" }] } }, { "expression": { "components": [{ "arguments": [{ "id": 19664, "name": "effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19646, "src": "7634:22:125", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 19663, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "7626:7:125", "typeDescriptions": { "typeIdentifier": "t_type$_t_uint256_$", "typeString": "type(uint256)" }, "typeName": { "id": 19662, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "7626:7:125", "typeDescriptions": {} } }, "id": 19665, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "7626:31:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "hexValue": "74727565", "id": 19666, "isConstant": false, "isLValue": false, "isPure": true, "kind": "bool", "lValueRequested": false, "nodeType": "Literal", "src": "7659:4:125", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "value": "true" }], "id": 19667, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "7625:39:125", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "functionReturnParameters": 19644, "id": 19668, "nodeType": "Return", "src": "7618:46:125" }] }, "documentation": { "id": 19634, "nodeType": "StructuredDocumentation", "src": "6630:638:125", "text": "@dev Calculates the effective share reserves. The effective share\n      reserves are the share reserves minus the share adjustment or\n      z - zeta. We use the effective share reserves as the z-parameter\n      to the YieldSpace pricing model. The share adjustment is used to\n      hold the pricing mechanism invariant under the flat component of\n      flat+curve trades.\n @param _shareReserves The pool's share reserves.\n @param _shareAdjustment The pool's share adjustment.\n @return The effective share reserves.\n @return A flag indicating if the calculation succeeded." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateEffectiveShareReservesSafe", "nameLocation": "7282:35:125", "parameters": { "id": 19639, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19636, "mutability": "mutable", "name": "_shareReserves", "nameLocation": "7335:14:125", "nodeType": "VariableDeclaration", "scope": 19670, "src": "7327:22:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19635, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "7327:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19638, "mutability": "mutable", "name": "_shareAdjustment", "nameLocation": "7366:16:125", "nodeType": "VariableDeclaration", "scope": 19670, "src": "7359:23:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" }, "typeName": { "id": 19637, "name": "int256", "nodeType": "ElementaryTypeName", "src": "7359:6:125", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "visibility": "internal" }], "src": "7317:71:125" }, "returnParameters": { "id": 19644, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19641, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 19670, "src": "7412:7:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19640, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "7412:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19643, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 19670, "src": "7421:4:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "typeName": { "id": 19642, "name": "bool", "nodeType": "ElementaryTypeName", "src": "7421:4:125", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "visibility": "internal" }], "src": "7411:15:125" }, "scope": 20190, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 19737, "nodeType": "FunctionDefinition", "src": "8756:1272:125", "nodes": [], "body": { "id": 19736, "nodeType": "Block", "src": "9014:1014:125", "nodes": [], "statements": [{ "assignments": [19687], "declarations": [{ "constant": false, "id": 19687, "mutability": "mutable", "name": "t", "nameLocation": "9226:1:125", "nodeType": "VariableDeclaration", "scope": 19736, "src": "9218:9:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19686, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "9218:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 19692, "initialValue": { "arguments": [{ "hexValue": "333635", "id": 19690, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "9256:8:125", "subdenomination": "days", "typeDescriptions": { "typeIdentifier": "t_rational_31536000_by_1", "typeString": "int_const 31536000" }, "value": "365" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_rational_31536000_by_1", "typeString": "int_const 31536000" }], "expression": { "id": 19688, "name": "_positionDuration", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19679, "src": "9230:17:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19689, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "9248:7:125", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "9230:25:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19691, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "9230:35:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "9218:47:125" }, { "assignments": [19694], "declarations": [{ "constant": false, "id": 19694, "mutability": "mutable", "name": "inner", "nameLocation": "9413:5:125", "nodeType": "VariableDeclaration", "scope": 19736, "src": "9405:13:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19693, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "9405:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 19701, "initialValue": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 19700, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 19695, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "9421:3:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "arguments": [{ "id": 19698, "name": "t", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19687, "src": "9440:1:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 19696, "name": "_apr", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19677, "src": "9427:4:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19697, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "9432:7:125", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "9427:12:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19699, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "9427:15:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "9421:21:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "9405:37:125" }, { "condition": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 19704, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 19702, "name": "inner", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19694, "src": "9456:5:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": ">=", "rightExpression": { "id": 19703, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "9465:3:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "9456:12:125", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "falseBody": { "id": 19726, "nodeType": "Block", "src": "9616:136:125", "statements": [{ "expression": { "id": 19724, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 19716, "name": "inner", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19694, "src": "9699:5:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "arguments": [{ "id": 19721, "name": "_timeStretch", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19681, "src": "9727:12:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 19719, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "9717:3:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19720, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "9721:5:125", "memberName": "divUp", "nodeType": "MemberAccess", "referencedDeclaration": 18790, "src": "9717:9:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19722, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "9717:23:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 19717, "name": "inner", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19694, "src": "9707:5:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19718, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "9713:3:125", "memberName": "pow", "nodeType": "MemberAccess", "referencedDeclaration": 18847, "src": "9707:9:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19723, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "9707:34:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "9699:42:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19725, "nodeType": "ExpressionStatement", "src": "9699:42:125" }] }, "id": 19727, "nodeType": "IfStatement", "src": "9452:300:125", "trueBody": { "id": 19715, "nodeType": "Block", "src": "9470:140:125", "statements": [{ "expression": { "id": 19713, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 19705, "name": "inner", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19694, "src": "9555:5:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "arguments": [{ "id": 19710, "name": "_timeStretch", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19681, "src": "9585:12:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 19708, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "9573:3:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19709, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "9577:7:125", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "9573:11:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19711, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "9573:25:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 19706, "name": "inner", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19694, "src": "9563:5:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19707, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "9569:3:125", "memberName": "pow", "nodeType": "MemberAccess", "referencedDeclaration": 18847, "src": "9563:9:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19712, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "9563:36:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "9555:44:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19714, "nodeType": "ExpressionStatement", "src": "9555:44:125" }] } }, { "expression": { "arguments": [{ "id": 19733, "name": "inner", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19694, "src": "10002:5:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "id": 19730, "name": "_effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19673, "src": "9952:23:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 19728, "name": "_initialVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19675, "src": "9920:23:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19729, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "9944:7:125", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "9920:31:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19731, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "9920:56:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19732, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "9977:7:125", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "9920:64:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19734, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "9920:101:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 19685, "id": 19735, "nodeType": "Return", "src": "9901:120:125" }] }, "documentation": { "id": 19671, "nodeType": "StructuredDocumentation", "src": "7677:1074:125", "text": "@dev Calculates the initial bond reserves assuming that the initial LP\n      receives LP shares amounting to c * z + y. Throughout the rest of\n      the codebase, the bond reserves used include the LP share\n      adjustment specified in YieldSpace. The bond reserves returned by\n      this function are unadjusted which makes it easier to calculate the\n      initial LP shares. This calculation underestimates the pool's\n      initial bond reserves.\n @param _effectiveShareReserves The pool's effective share reserves. The\n        effective share reserves are a modified version of the share\n        reserves used when pricing trades.\n @param _initialVaultSharePrice The pool's initial vault share price.\n @param _apr The pool's APR.\n @param _positionDuration The amount of time until maturity in seconds.\n @param _timeStretch The time stretch parameter.\n @return bondReserves The bond reserves (without adjustment) that make\n         the pool have a specified APR." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateInitialBondReserves", "nameLocation": "8765:28:125", "parameters": { "id": 19682, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19673, "mutability": "mutable", "name": "_effectiveShareReserves", "nameLocation": "8811:23:125", "nodeType": "VariableDeclaration", "scope": 19737, "src": "8803:31:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19672, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "8803:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19675, "mutability": "mutable", "name": "_initialVaultSharePrice", "nameLocation": "8852:23:125", "nodeType": "VariableDeclaration", "scope": 19737, "src": "8844:31:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19674, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "8844:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19677, "mutability": "mutable", "name": "_apr", "nameLocation": "8893:4:125", "nodeType": "VariableDeclaration", "scope": 19737, "src": "8885:12:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19676, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "8885:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19679, "mutability": "mutable", "name": "_positionDuration", "nameLocation": "8915:17:125", "nodeType": "VariableDeclaration", "scope": 19737, "src": "8907:25:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19678, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "8907:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19681, "mutability": "mutable", "name": "_timeStretch", "nameLocation": "8950:12:125", "nodeType": "VariableDeclaration", "scope": 19737, "src": "8942:20:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19680, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "8942:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "8793:175:125" }, "returnParameters": { "id": 19685, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19684, "mutability": "mutable", "name": "bondReserves", "nameLocation": "9000:12:125", "nodeType": "VariableDeclaration", "scope": 19737, "src": "8992:20:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19683, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "8992:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "8991:22:125" }, "scope": 20190, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 19789, "nodeType": "FunctionDefinition", "src": "11517:1660:125", "nodes": [], "body": { "id": 19788, "nodeType": "Block", "src": "11799:1378:125", "nodes": [], "statements": [{ "assignments": [19756], "declarations": [{ "constant": false, "id": 19756, "mutability": "mutable", "name": "totalValue", "nameLocation": "12226:10:125", "nodeType": "VariableDeclaration", "scope": 19788, "src": "12218:18:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19755, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "12218:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 19765, "initialValue": { "arguments": [{ "id": 19763, "name": "_vaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19748, "src": "12337:16:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "id": 19759, "name": "_closeVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19746, "src": "12273:21:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 19760, "name": "_openVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19744, "src": "12296:20:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 19757, "name": "_bondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19740, "src": "12239:11:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19758, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "12264:8:125", "memberName": "mulDivUp", "nodeType": "MemberAccess", "referencedDeclaration": 18754, "src": "12239:33:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 19761, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "12239:78:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19762, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "12331:5:125", "memberName": "divUp", "nodeType": "MemberAccess", "referencedDeclaration": 18790, "src": "12239:97:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19764, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "12239:115:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "12218:136:125" }, { "expression": { "id": 19772, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 19766, "name": "totalValue", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19756, "src": "12588:10:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "+=", "rightHandSide": { "arguments": [{ "id": 19769, "name": "_flatFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19750, "src": "12623:8:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 19770, "name": "_vaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19748, "src": "12633:16:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 19767, "name": "_bondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19740, "src": "12602:11:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19768, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "12614:8:125", "memberName": "mulDivUp", "nodeType": "MemberAccess", "referencedDeclaration": 18754, "src": "12602:20:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 19771, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "12602:48:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "12588:62:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19773, "nodeType": "ExpressionStatement", "src": "12588:62:125" }, { "condition": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 19776, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 19774, "name": "totalValue", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19756, "src": "12953:10:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": ">", "rightExpression": { "id": 19775, "name": "_shareAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19742, "src": "12966:12:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "12953:25:125", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "id": 19785, "nodeType": "IfStatement", "src": "12949:191:125", "trueBody": { "id": 19784, "nodeType": "Block", "src": "12980:160:125", "statements": [{ "id": 19783, "nodeType": "UncheckedBlock", "src": "13046:84:125", "statements": [{ "expression": { "id": 19781, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 19777, "name": "shareProceeds", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19753, "src": "13074:13:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 19780, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 19778, "name": "totalValue", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19756, "src": "13090:10:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 19779, "name": "_shareAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19742, "src": "13103:12:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "13090:25:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "13074:41:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19782, "nodeType": "ExpressionStatement", "src": "13074:41:125" }] }] } }, { "expression": { "id": 19786, "name": "shareProceeds", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19753, "src": "13157:13:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 19754, "id": 19787, "nodeType": "Return", "src": "13150:20:125" }] }, "documentation": { "id": 19738, "nodeType": "StructuredDocumentation", "src": "10034:1478:125", "text": "@dev Calculates the proceeds in shares of closing a short position. This\n      takes into account the trading profits, the interest that was\n      earned by the short, the flat fee the short pays, and the amount of\n      margin that was released by closing the short. The math for the\n      short's proceeds in base is given by:\n      proceeds = (1 + flat_fee) * dy - c * dz + (c1 - c0) * (dy / c0)\n               = (1 + flat_fee) * dy - c * dz + (c1 / c0) * dy - dy\n               = (c1 / c0 + flat_fee) * dy - c * dz\n      We convert the proceeds to shares by dividing by the current vault\n      share price. In the event that the interest is negative and\n      outweighs the trading profits and margin released, the short's\n      proceeds are marked to zero.\n      This variant of the calculation overestimates the short proceeds.\n @param _bondAmount The amount of bonds underlying the closed short.\n @param _shareAmount The amount of shares that it costs to close the\n                     short.\n @param _openVaultSharePrice The vault share price at the short's open.\n @param _closeVaultSharePrice The vault share price at the short's close.\n @param _vaultSharePrice The current vault share price.\n @param _flatFee The flat fee currently within the pool\n @return shareProceeds The short proceeds in shares." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateShortProceedsUp", "nameLocation": "11526:24:125", "parameters": { "id": 19751, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19740, "mutability": "mutable", "name": "_bondAmount", "nameLocation": "11568:11:125", "nodeType": "VariableDeclaration", "scope": 19789, "src": "11560:19:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19739, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "11560:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19742, "mutability": "mutable", "name": "_shareAmount", "nameLocation": "11597:12:125", "nodeType": "VariableDeclaration", "scope": 19789, "src": "11589:20:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19741, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "11589:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19744, "mutability": "mutable", "name": "_openVaultSharePrice", "nameLocation": "11627:20:125", "nodeType": "VariableDeclaration", "scope": 19789, "src": "11619:28:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19743, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "11619:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19746, "mutability": "mutable", "name": "_closeVaultSharePrice", "nameLocation": "11665:21:125", "nodeType": "VariableDeclaration", "scope": 19789, "src": "11657:29:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19745, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "11657:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19748, "mutability": "mutable", "name": "_vaultSharePrice", "nameLocation": "11704:16:125", "nodeType": "VariableDeclaration", "scope": 19789, "src": "11696:24:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19747, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "11696:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19750, "mutability": "mutable", "name": "_flatFee", "nameLocation": "11738:8:125", "nodeType": "VariableDeclaration", "scope": 19789, "src": "11730:16:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19749, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "11730:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "11550:202:125" }, "returnParameters": { "id": 19754, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19753, "mutability": "mutable", "name": "shareProceeds", "nameLocation": "11784:13:125", "nodeType": "VariableDeclaration", "scope": 19789, "src": "11776:21:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19752, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "11776:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "11775:23:125" }, "scope": 20190, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 19841, "nodeType": "FunctionDefinition", "src": "14667:1674:125", "nodes": [], "body": { "id": 19840, "nodeType": "Block", "src": "14951:1390:125", "nodes": [], "statements": [{ "assignments": [19808], "declarations": [{ "constant": false, "id": 19808, "mutability": "mutable", "name": "totalValue", "nameLocation": "15381:10:125", "nodeType": "VariableDeclaration", "scope": 19840, "src": "15373:18:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19807, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "15373:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 19817, "initialValue": { "arguments": [{ "id": 19815, "name": "_vaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19800, "src": "15496:16:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "id": 19811, "name": "_closeVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19798, "src": "15430:21:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 19812, "name": "_openVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19796, "src": "15453:20:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 19809, "name": "_bondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19792, "src": "15394:11:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19810, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "15419:10:125", "memberName": "mulDivDown", "nodeType": "MemberAccess", "referencedDeclaration": 18704, "src": "15394:35:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 19813, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "15394:80:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19814, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "15488:7:125", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "15394:101:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19816, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "15394:119:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "15373:140:125" }, { "expression": { "id": 19824, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 19818, "name": "totalValue", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19808, "src": "15750:10:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "+=", "rightHandSide": { "arguments": [{ "id": 19821, "name": "_flatFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19802, "src": "15787:8:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 19822, "name": "_vaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19800, "src": "15797:16:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 19819, "name": "_bondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19792, "src": "15764:11:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19820, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "15776:10:125", "memberName": "mulDivDown", "nodeType": "MemberAccess", "referencedDeclaration": 18704, "src": "15764:22:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 19823, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "15764:50:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "15750:64:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19825, "nodeType": "ExpressionStatement", "src": "15750:64:125" }, { "condition": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 19828, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 19826, "name": "totalValue", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19808, "src": "16117:10:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": ">", "rightExpression": { "id": 19827, "name": "_shareAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19794, "src": "16130:12:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "16117:25:125", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "id": 19837, "nodeType": "IfStatement", "src": "16113:191:125", "trueBody": { "id": 19836, "nodeType": "Block", "src": "16144:160:125", "statements": [{ "id": 19835, "nodeType": "UncheckedBlock", "src": "16210:84:125", "statements": [{ "expression": { "id": 19833, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 19829, "name": "shareProceeds", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19805, "src": "16238:13:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 19832, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 19830, "name": "totalValue", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19808, "src": "16254:10:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 19831, "name": "_shareAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19794, "src": "16267:12:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "16254:25:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "16238:41:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19834, "nodeType": "ExpressionStatement", "src": "16238:41:125" }] }] } }, { "expression": { "id": 19838, "name": "shareProceeds", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19805, "src": "16321:13:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 19806, "id": 19839, "nodeType": "Return", "src": "16314:20:125" }] }, "documentation": { "id": 19790, "nodeType": "StructuredDocumentation", "src": "13183:1479:125", "text": "@dev Calculates the proceeds in shares of closing a short position. This\n      takes into account the trading profits, the interest that was\n      earned by the short, the flat fee the short pays, and the amount of\n      margin that was released by closing the short. The math for the\n      short's proceeds in base is given by:\n      proceeds = (1 + flat_fee) * dy - c * dz + (c1 - c0) * (dy / c0)\n               = (1 + flat_fee) * dy - c * dz + (c1 / c0) * dy - dy\n               = (c1 / c0 + flat_fee) * dy - c * dz\n      We convert the proceeds to shares by dividing by the current vault\n      share price. In the event that the interest is negative and\n      outweighs the trading profits and margin released, the short's\n      proceeds are marked to zero.\n      This variant of the calculation underestimates the short proceeds.\n @param _bondAmount The amount of bonds underlying the closed short.\n @param _shareAmount The amount of shares that it costs to close the\n                     short.\n @param _openVaultSharePrice The vault share price at the short's open.\n @param _closeVaultSharePrice The vault share price at the short's close.\n @param _vaultSharePrice The current vault share price.\n @param _flatFee The flat fee currently within the pool\n @return shareProceeds The short proceeds in shares." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateShortProceedsDown", "nameLocation": "14676:26:125", "parameters": { "id": 19803, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19792, "mutability": "mutable", "name": "_bondAmount", "nameLocation": "14720:11:125", "nodeType": "VariableDeclaration", "scope": 19841, "src": "14712:19:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19791, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "14712:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19794, "mutability": "mutable", "name": "_shareAmount", "nameLocation": "14749:12:125", "nodeType": "VariableDeclaration", "scope": 19841, "src": "14741:20:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19793, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "14741:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19796, "mutability": "mutable", "name": "_openVaultSharePrice", "nameLocation": "14779:20:125", "nodeType": "VariableDeclaration", "scope": 19841, "src": "14771:28:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19795, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "14771:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19798, "mutability": "mutable", "name": "_closeVaultSharePrice", "nameLocation": "14817:21:125", "nodeType": "VariableDeclaration", "scope": 19841, "src": "14809:29:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19797, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "14809:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19800, "mutability": "mutable", "name": "_vaultSharePrice", "nameLocation": "14856:16:125", "nodeType": "VariableDeclaration", "scope": 19841, "src": "14848:24:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19799, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "14848:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19802, "mutability": "mutable", "name": "_flatFee", "nameLocation": "14890:8:125", "nodeType": "VariableDeclaration", "scope": 19841, "src": "14882:16:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19801, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "14882:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "14702:202:125" }, "returnParameters": { "id": 19806, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19805, "mutability": "mutable", "name": "shareProceeds", "nameLocation": "14936:13:125", "nodeType": "VariableDeclaration", "scope": 19841, "src": "14928:21:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19804, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "14928:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "14927:23:125" }, "scope": 20190, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 19877, "nodeType": "FunctionDefinition", "src": "17063:541:125", "nodes": [], "body": { "id": 19876, "nodeType": "Block", "src": "17229:375:125", "nodes": [], "statements": [{ "expression": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 19873, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 19858, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "17437:3:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 19871, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 19869, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "17547:3:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 19870, "name": "_flatFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19848, "src": "17553:8:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "17547:14:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 19866, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "arguments": [{ "id": 19863, "name": "_startingSpotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19844, "src": "17489:18:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 19861, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "17479:3:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19862, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "17483:5:125", "memberName": "divUp", "nodeType": "MemberAccess", "referencedDeclaration": 18790, "src": "17479:9:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19864, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "17479:29:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 19865, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "17511:3:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "17479:35:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 19859, "name": "_curveFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19846, "src": "17463:9:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19860, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "17473:5:125", "memberName": "mulUp", "nodeType": "MemberAccess", "referencedDeclaration": 18772, "src": "17463:15:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19867, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "17463:52:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19868, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "17516:5:125", "memberName": "mulUp", "nodeType": "MemberAccess", "referencedDeclaration": 18772, "src": "17463:58:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19872, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "17463:120:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "17437:146:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 19855, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 19853, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "17328:3:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 19854, "name": "_flatFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19848, "src": "17334:8:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "17328:14:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 19856, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "17327:16:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19857, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "17344:7:125", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18740, "src": "17327:24:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19874, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "17327:270:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 19852, "id": 19875, "nodeType": "Return", "src": "17308:289:125" }] }, "documentation": { "id": 19842, "nodeType": "StructuredDocumentation", "src": "16347:711:125", "text": "@dev Since traders pay a curve fee when they open longs on Hyperdrive,\n      it is possible for traders to receive a negative interest rate even\n      if curve's spot price is less than or equal to 1.\n      Given the curve fee `phi_c` and the starting spot price `p_0`, the\n      maximum spot price is given by:\n      p_max = (1 - phi_f) / (1 + phi_c * (1 / p_0 - 1) * (1 - phi_f))\n      We underestimate the maximum spot price to be conservative.\n @param _startingSpotPrice The spot price at the start of the trade.\n @param _curveFee The curve fee.\n @param _flatFee The flat fee.\n @return The maximum spot price." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateOpenLongMaxSpotPrice", "nameLocation": "17072:29:125", "parameters": { "id": 19849, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19844, "mutability": "mutable", "name": "_startingSpotPrice", "nameLocation": "17119:18:125", "nodeType": "VariableDeclaration", "scope": 19877, "src": "17111:26:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19843, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "17111:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19846, "mutability": "mutable", "name": "_curveFee", "nameLocation": "17155:9:125", "nodeType": "VariableDeclaration", "scope": 19877, "src": "17147:17:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19845, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "17147:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19848, "mutability": "mutable", "name": "_flatFee", "nameLocation": "17182:8:125", "nodeType": "VariableDeclaration", "scope": 19877, "src": "17174:16:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19847, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "17174:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "17101:95:125" }, "returnParameters": { "id": 19852, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19851, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 19877, "src": "17220:7:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19850, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "17220:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "17219:9:125" }, "scope": 20190, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 19897, "nodeType": "FunctionDefinition", "src": "18256:284:125", "nodes": [], "body": { "id": 19896, "nodeType": "Block", "src": "18398:142:125", "nodes": [], "statements": [{ "expression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 19894, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 19887, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "18486:3:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 19892, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 19890, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "18508:3:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 19891, "name": "_startingSpotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19880, "src": "18514:18:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "18508:24:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 19888, "name": "_curveFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19882, "src": "18492:9:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19889, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "18502:5:125", "memberName": "mulUp", "nodeType": "MemberAccess", "referencedDeclaration": 18772, "src": "18492:15:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19893, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "18492:41:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "18486:47:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 19886, "id": 19895, "nodeType": "Return", "src": "18479:54:125" }] }, "documentation": { "id": 19878, "nodeType": "StructuredDocumentation", "src": "17610:641:125", "text": "@dev Since traders pay a curve fee when they close shorts on Hyperdrive,\n      it is possible for traders to receive a negative interest rate even\n      if curve's spot price is less than or equal to 1.\n      Given the curve fee `phi_c` and the starting spot price `p_0`, the\n      maximum spot price is given by:\n      p_max = 1 - phi_c * (1 - p_0)\n      We underestimate the maximum spot price to be conservative.\n @param _startingSpotPrice The spot price at the start of the trade.\n @param _curveFee The curve fee.\n @return The maximum spot price." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateCloseShortMaxSpotPrice", "nameLocation": "18265:31:125", "parameters": { "id": 19883, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19880, "mutability": "mutable", "name": "_startingSpotPrice", "nameLocation": "18314:18:125", "nodeType": "VariableDeclaration", "scope": 19897, "src": "18306:26:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19879, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "18306:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19882, "mutability": "mutable", "name": "_curveFee", "nameLocation": "18350:9:125", "nodeType": "VariableDeclaration", "scope": 19897, "src": "18342:17:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19881, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "18342:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "18296:69:125" }, "returnParameters": { "id": 19886, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19885, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 19897, "src": "18389:7:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19884, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "18389:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "18388:9:125" }, "scope": 20190, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 19928, "nodeType": "FunctionDefinition", "src": "19247:892:125", "nodes": [], "body": { "id": 19927, "nodeType": "Block", "src": "19519:620:125", "nodes": [], "statements": [{ "expression": { "arguments": [{ "id": 19917, "name": "_effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19900, "src": "19714:23:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 19918, "name": "_bondReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19902, "src": "19755:13:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 19919, "name": "_shareAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19904, "src": "19786:12:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 19922, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 19920, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "20025:3:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 19921, "name": "_timeStretch", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19906, "src": "20031:12:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "20025:18:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 19923, "name": "_vaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19908, "src": "20061:16:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 19924, "name": "_initialVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19910, "src": "20095:23:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 19915, "name": "YieldSpaceMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 23292, "src": "19647:14:125", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_YieldSpaceMath_$23292_$", "typeString": "type(library YieldSpaceMath)" } }, "id": 19916, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "19662:34:125", "memberName": "calculateBondsOutGivenSharesInDown", "nodeType": "MemberAccess", "referencedDeclaration": 22444, "src": "19647:49:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256,uint256,uint256,uint256) pure returns (uint256)" } }, "id": 19925, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "19647:485:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 19914, "id": 19926, "nodeType": "Return", "src": "19628:504:125" }] }, "documentation": { "id": 19898, "nodeType": "StructuredDocumentation", "src": "18546:696:125", "text": "@dev Calculates the number of bonds a user will receive when opening a\n      long position.\n @param _effectiveShareReserves The pool's effective share reserves. The\n        effective share reserves are a modified version of the share\n        reserves used when pricing trades.\n @param _bondReserves The pool's bond reserves.\n @param _shareAmount The amount of shares the user is depositing.\n @param _timeStretch The time stretch parameter.\n @param _vaultSharePrice The vault share price.\n @param _initialVaultSharePrice The initial vault share price.\n @return bondReservesDelta The bonds paid by the reserves in the trade." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateOpenLong", "nameLocation": "19256:17:125", "parameters": { "id": 19911, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19900, "mutability": "mutable", "name": "_effectiveShareReserves", "nameLocation": "19291:23:125", "nodeType": "VariableDeclaration", "scope": 19928, "src": "19283:31:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19899, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "19283:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19902, "mutability": "mutable", "name": "_bondReserves", "nameLocation": "19332:13:125", "nodeType": "VariableDeclaration", "scope": 19928, "src": "19324:21:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19901, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "19324:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19904, "mutability": "mutable", "name": "_shareAmount", "nameLocation": "19363:12:125", "nodeType": "VariableDeclaration", "scope": 19928, "src": "19355:20:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19903, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "19355:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19906, "mutability": "mutable", "name": "_timeStretch", "nameLocation": "19393:12:125", "nodeType": "VariableDeclaration", "scope": 19928, "src": "19385:20:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19905, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "19385:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19908, "mutability": "mutable", "name": "_vaultSharePrice", "nameLocation": "19423:16:125", "nodeType": "VariableDeclaration", "scope": 19928, "src": "19415:24:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19907, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "19415:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19910, "mutability": "mutable", "name": "_initialVaultSharePrice", "nameLocation": "19457:23:125", "nodeType": "VariableDeclaration", "scope": 19928, "src": "19449:31:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19909, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "19449:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "19273:213:125" }, "returnParameters": { "id": 19914, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19913, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 19928, "src": "19510:7:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19912, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "19510:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "19509:9:125" }, "scope": 20190, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 19993, "nodeType": "FunctionDefinition", "src": "21120:2126:125", "nodes": [], "body": { "id": 19992, "nodeType": "Block", "src": "21569:1677:125", "nodes": [], "statements": [{ "expression": { "id": 19960, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 19952, "name": "shareProceeds", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19950, "src": "22144:13:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 19957, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 19955, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "22194:3:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 19956, "name": "_normalizedTimeRemaining", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19937, "src": "22200:24:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "22194:30:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 19958, "name": "_vaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19941, "src": "22238:16:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 19953, "name": "_amountIn", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19935, "src": "22160:9:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19954, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "22170:10:125", "memberName": "mulDivDown", "nodeType": "MemberAccess", "referencedDeclaration": 18704, "src": "22160:20:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 19959, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "22160:104:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "22144:120:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19961, "nodeType": "ExpressionStatement", "src": "22144:120:125" }, { "condition": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 19964, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 19962, "name": "_normalizedTimeRemaining", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19937, "src": "22278:24:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": ">", "rightExpression": { "hexValue": "30", "id": 19963, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "22305:1:125", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }, "src": "22278:28:125", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "id": 19991, "nodeType": "IfStatement", "src": "22274:966:125", "trueBody": { "id": 19990, "nodeType": "Block", "src": "22308:932:125", "statements": [{ "expression": { "id": 19970, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 19965, "name": "bondCurveDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19948, "src": "22497:14:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 19968, "name": "_normalizedTimeRemaining", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19937, "src": "22532:24:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 19966, "name": "_amountIn", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19935, "src": "22514:9:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19967, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "22524:7:125", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18722, "src": "22514:17:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19969, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "22514:43:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "22497:60:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19971, "nodeType": "ExpressionStatement", "src": "22497:60:125" }, { "expression": { "id": 19984, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 19972, "name": "shareCurveDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19946, "src": "22678:15:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 19975, "name": "_effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19931, "src": "22763:23:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 19976, "name": "_bondReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19933, "src": "22804:13:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 19977, "name": "bondCurveDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19948, "src": "22835:14:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 19980, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 19978, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "23076:3:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 19979, "name": "_timeStretch", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19939, "src": "23082:12:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "23076:18:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 19981, "name": "_vaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19941, "src": "23112:16:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 19982, "name": "_initialVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19943, "src": "23146:23:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 19973, "name": "YieldSpaceMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 23292, "src": "22696:14:125", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_YieldSpaceMath_$23292_$", "typeString": "type(library YieldSpaceMath)" } }, "id": 19974, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "22711:34:125", "memberName": "calculateSharesOutGivenBondsInDown", "nodeType": "MemberAccess", "referencedDeclaration": 22802, "src": "22696:49:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256,uint256,uint256,uint256) pure returns (uint256)" } }, "id": 19983, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "22696:487:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "22678:505:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19985, "nodeType": "ExpressionStatement", "src": "22678:505:125" }, { "expression": { "id": 19988, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 19986, "name": "shareProceeds", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19950, "src": "23197:13:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "+=", "rightHandSide": { "id": 19987, "name": "shareCurveDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19946, "src": "23214:15:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "23197:32:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19989, "nodeType": "ExpressionStatement", "src": "23197:32:125" }] } }] }, "documentation": { "id": 19929, "nodeType": "StructuredDocumentation", "src": "20145:970:125", "text": "@dev Calculates the amount of shares a user will receive when closing a\n      long position.\n @param _effectiveShareReserves The pool's effective share reserves. The\n        effective share reserves are a modified version of the share\n        reserves used when pricing trades.\n @param _bondReserves The pool's bond reserves.\n @param _amountIn The amount of bonds the user is closing.\n @param _normalizedTimeRemaining The normalized time remaining of the\n        position.\n @param _timeStretch The time stretch parameter.\n @param _vaultSharePrice The vault share price.\n @param _initialVaultSharePrice The vault share price when the pool was\n        deployed.\n @return shareCurveDelta The shares paid by the reserves in the trade.\n @return bondCurveDelta The bonds paid to the reserves in the trade.\n @return shareProceeds The shares that the user will receive." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateCloseLong", "nameLocation": "21129:18:125", "parameters": { "id": 19944, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19931, "mutability": "mutable", "name": "_effectiveShareReserves", "nameLocation": "21165:23:125", "nodeType": "VariableDeclaration", "scope": 19993, "src": "21157:31:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19930, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "21157:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19933, "mutability": "mutable", "name": "_bondReserves", "nameLocation": "21206:13:125", "nodeType": "VariableDeclaration", "scope": 19993, "src": "21198:21:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19932, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "21198:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19935, "mutability": "mutable", "name": "_amountIn", "nameLocation": "21237:9:125", "nodeType": "VariableDeclaration", "scope": 19993, "src": "21229:17:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19934, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "21229:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19937, "mutability": "mutable", "name": "_normalizedTimeRemaining", "nameLocation": "21264:24:125", "nodeType": "VariableDeclaration", "scope": 19993, "src": "21256:32:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19936, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "21256:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19939, "mutability": "mutable", "name": "_timeStretch", "nameLocation": "21306:12:125", "nodeType": "VariableDeclaration", "scope": 19993, "src": "21298:20:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19938, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "21298:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19941, "mutability": "mutable", "name": "_vaultSharePrice", "nameLocation": "21336:16:125", "nodeType": "VariableDeclaration", "scope": 19993, "src": "21328:24:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19940, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "21328:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19943, "mutability": "mutable", "name": "_initialVaultSharePrice", "nameLocation": "21370:23:125", "nodeType": "VariableDeclaration", "scope": 19993, "src": "21362:31:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19942, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "21362:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "21147:252:125" }, "returnParameters": { "id": 19951, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19946, "mutability": "mutable", "name": "shareCurveDelta", "nameLocation": "21468:15:125", "nodeType": "VariableDeclaration", "scope": 19993, "src": "21460:23:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19945, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "21460:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19948, "mutability": "mutable", "name": "bondCurveDelta", "nameLocation": "21505:14:125", "nodeType": "VariableDeclaration", "scope": 19993, "src": "21497:22:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19947, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "21497:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19950, "mutability": "mutable", "name": "shareProceeds", "nameLocation": "21541:13:125", "nodeType": "VariableDeclaration", "scope": 19993, "src": "21533:21:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19949, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "21533:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "21446:118:125" }, "scope": 20190, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 20024, "nodeType": "FunctionDefinition", "src": "23940:866:125", "nodes": [], "body": { "id": 20023, "nodeType": "Block", "src": "24210:596:125", "nodes": [], "statements": [{ "expression": { "arguments": [{ "id": 20013, "name": "_effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19996, "src": "24384:23:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 20014, "name": "_bondReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19998, "src": "24425:13:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 20015, "name": "_amountIn", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20000, "src": "24456:9:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 20018, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 20016, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "24692:3:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 20017, "name": "_timeStretch", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20002, "src": "24698:12:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "24692:18:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 20019, "name": "_vaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20004, "src": "24728:16:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 20020, "name": "_initialVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20006, "src": "24762:23:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 20011, "name": "YieldSpaceMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 23292, "src": "24317:14:125", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_YieldSpaceMath_$23292_$", "typeString": "type(library YieldSpaceMath)" } }, "id": 20012, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "24332:34:125", "memberName": "calculateSharesOutGivenBondsInDown", "nodeType": "MemberAccess", "referencedDeclaration": 22802, "src": "24317:49:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256,uint256,uint256,uint256) pure returns (uint256)" } }, "id": 20021, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "24317:482:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 20010, "id": 20022, "nodeType": "Return", "src": "24298:501:125" }] }, "documentation": { "id": 19994, "nodeType": "StructuredDocumentation", "src": "23252:683:125", "text": "@dev Calculates the amount of shares that will be received given a\n      specified amount of bonds.\n @param _effectiveShareReserves The pool's effective share reserves. The\n        effective share reserves are a modified version of the share\n        reserves used when pricing trades.\n @param _bondReserves The pool's bonds reserves.\n @param _amountIn The amount of bonds the user is providing.\n @param _timeStretch The time stretch parameter.\n @param _vaultSharePrice The vault share price.\n @param _initialVaultSharePrice The initial vault share price.\n @return The shares paid by the reserves in the trade." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateOpenShort", "nameLocation": "23949:18:125", "parameters": { "id": 20007, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19996, "mutability": "mutable", "name": "_effectiveShareReserves", "nameLocation": "23985:23:125", "nodeType": "VariableDeclaration", "scope": 20024, "src": "23977:31:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19995, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "23977:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19998, "mutability": "mutable", "name": "_bondReserves", "nameLocation": "24026:13:125", "nodeType": "VariableDeclaration", "scope": 20024, "src": "24018:21:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19997, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "24018:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20000, "mutability": "mutable", "name": "_amountIn", "nameLocation": "24057:9:125", "nodeType": "VariableDeclaration", "scope": 20024, "src": "24049:17:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19999, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "24049:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20002, "mutability": "mutable", "name": "_timeStretch", "nameLocation": "24084:12:125", "nodeType": "VariableDeclaration", "scope": 20024, "src": "24076:20:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20001, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "24076:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20004, "mutability": "mutable", "name": "_vaultSharePrice", "nameLocation": "24114:16:125", "nodeType": "VariableDeclaration", "scope": 20024, "src": "24106:24:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20003, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "24106:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20006, "mutability": "mutable", "name": "_initialVaultSharePrice", "nameLocation": "24148:23:125", "nodeType": "VariableDeclaration", "scope": 20024, "src": "24140:31:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20005, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "24140:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "23967:210:125" }, "returnParameters": { "id": 20010, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 20009, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 20024, "src": "24201:7:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20008, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "24201:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "24200:9:125" }, "scope": 20190, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 20089, "nodeType": "FunctionDefinition", "src": "25764:2130:125", "nodes": [], "body": { "id": 20088, "nodeType": "Block", "src": "26214:1680:125", "nodes": [], "statements": [{ "expression": { "id": 20056, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 20048, "name": "sharePayment", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20046, "src": "26876:12:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 20053, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 20051, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "26924:3:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 20052, "name": "_normalizedTimeRemaining", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20033, "src": "26930:24:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "26924:30:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 20054, "name": "_vaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20037, "src": "26968:16:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 20049, "name": "_amountOut", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20031, "src": "26891:10:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20050, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "26902:8:125", "memberName": "mulDivUp", "nodeType": "MemberAccess", "referencedDeclaration": 18754, "src": "26891:19:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 20055, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "26891:103:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "26876:118:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20057, "nodeType": "ExpressionStatement", "src": "26876:118:125" }, { "condition": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 20060, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 20058, "name": "_normalizedTimeRemaining", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20033, "src": "27008:24:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": ">", "rightExpression": { "hexValue": "30", "id": 20059, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "27035:1:125", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }, "src": "27008:28:125", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "id": 20087, "nodeType": "IfStatement", "src": "27004:884:125", "trueBody": { "id": 20086, "nodeType": "Block", "src": "27038:850:125", "statements": [{ "expression": { "id": 20066, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 20061, "name": "bondCurveDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20044, "src": "27153:14:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 20064, "name": "_normalizedTimeRemaining", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20033, "src": "27187:24:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 20062, "name": "_amountOut", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20031, "src": "27170:10:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20063, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "27181:5:125", "memberName": "mulUp", "nodeType": "MemberAccess", "referencedDeclaration": 18772, "src": "27170:16:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 20065, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "27170:42:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "27153:59:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20067, "nodeType": "ExpressionStatement", "src": "27153:59:125" }, { "expression": { "id": 20080, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 20068, "name": "shareCurveDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20042, "src": "27329:15:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 20071, "name": "_effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20027, "src": "27412:23:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 20072, "name": "_bondReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20029, "src": "27453:13:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 20073, "name": "bondCurveDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20044, "src": "27484:14:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 20076, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 20074, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18676, "src": "27725:3:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 20075, "name": "_timeStretch", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20035, "src": "27731:12:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "27725:18:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 20077, "name": "_vaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20037, "src": "27761:16:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 20078, "name": "_initialVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20039, "src": "27795:23:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 20069, "name": "YieldSpaceMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 23292, "src": "27347:14:125", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_YieldSpaceMath_$23292_$", "typeString": "type(library YieldSpaceMath)" } }, "id": 20070, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "27362:32:125", "memberName": "calculateSharesInGivenBondsOutUp", "nodeType": "MemberAccess", "referencedDeclaration": 22491, "src": "27347:47:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256,uint256,uint256,uint256) pure returns (uint256)" } }, "id": 20079, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "27347:485:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "27329:503:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20081, "nodeType": "ExpressionStatement", "src": "27329:503:125" }, { "expression": { "id": 20084, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 20082, "name": "sharePayment", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20046, "src": "27846:12:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "+=", "rightHandSide": { "id": 20083, "name": "shareCurveDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20042, "src": "27862:15:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "27846:31:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20085, "nodeType": "ExpressionStatement", "src": "27846:31:125" }] } }] }, "documentation": { "id": 20025, "nodeType": "StructuredDocumentation", "src": "24812:947:125", "text": "@dev Calculates the amount of base that a user will receive when closing\n      a short position.\n @param _effectiveShareReserves The pool's effective share reserves. The\n        effective share reserves are a modified version of the share\n        reserves used when pricing trades.\n @param _bondReserves The pool's bonds reserves.\n @param _amountOut The amount of the asset that is received.\n @param _normalizedTimeRemaining The amount of time remaining until\n        maturity in seconds.\n @param _timeStretch The time stretch parameter.\n @param _vaultSharePrice The vault share price.\n @param _initialVaultSharePrice The initial vault share price.\n @return shareCurveDelta The shares paid to the reserves in the trade.\n @return bondCurveDelta The bonds paid by the reserves in the trade.\n @return sharePayment The shares that the user must pay." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateCloseShort", "nameLocation": "25773:19:125", "parameters": { "id": 20040, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 20027, "mutability": "mutable", "name": "_effectiveShareReserves", "nameLocation": "25810:23:125", "nodeType": "VariableDeclaration", "scope": 20089, "src": "25802:31:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20026, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "25802:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20029, "mutability": "mutable", "name": "_bondReserves", "nameLocation": "25851:13:125", "nodeType": "VariableDeclaration", "scope": 20089, "src": "25843:21:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20028, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "25843:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20031, "mutability": "mutable", "name": "_amountOut", "nameLocation": "25882:10:125", "nodeType": "VariableDeclaration", "scope": 20089, "src": "25874:18:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20030, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "25874:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20033, "mutability": "mutable", "name": "_normalizedTimeRemaining", "nameLocation": "25910:24:125", "nodeType": "VariableDeclaration", "scope": 20089, "src": "25902:32:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20032, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "25902:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20035, "mutability": "mutable", "name": "_timeStretch", "nameLocation": "25952:12:125", "nodeType": "VariableDeclaration", "scope": 20089, "src": "25944:20:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20034, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "25944:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20037, "mutability": "mutable", "name": "_vaultSharePrice", "nameLocation": "25982:16:125", "nodeType": "VariableDeclaration", "scope": 20089, "src": "25974:24:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20036, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "25974:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20039, "mutability": "mutable", "name": "_initialVaultSharePrice", "nameLocation": "26016:23:125", "nodeType": "VariableDeclaration", "scope": 20089, "src": "26008:31:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20038, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "26008:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "25792:253:125" }, "returnParameters": { "id": 20047, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 20042, "mutability": "mutable", "name": "shareCurveDelta", "nameLocation": "26114:15:125", "nodeType": "VariableDeclaration", "scope": 20089, "src": "26106:23:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20041, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "26106:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20044, "mutability": "mutable", "name": "bondCurveDelta", "nameLocation": "26151:14:125", "nodeType": "VariableDeclaration", "scope": 20089, "src": "26143:22:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20043, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "26143:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20046, "mutability": "mutable", "name": "sharePayment", "nameLocation": "26187:12:125", "nodeType": "VariableDeclaration", "scope": 20089, "src": "26179:20:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20045, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "26179:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "26092:117:125" }, "scope": 20190, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 20189, "nodeType": "FunctionDefinition", "src": "29982:2953:125", "nodes": [], "body": { "id": 20188, "nodeType": "Block", "src": "30336:2599:125", "nodes": [], "statements": [{ "assignments": [20118], "declarations": [{ "constant": false, "id": 20118, "mutability": "mutable", "name": "shareAdjustmentDelta", "nameLocation": "31268:20:125", "nodeType": "VariableDeclaration", "scope": 20188, "src": "31261:27:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" }, "typeName": { "id": 20117, "name": "int256", "nodeType": "ElementaryTypeName", "src": "31261:6:125", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "visibility": "internal" }], "id": 20119, "nodeType": "VariableDeclarationStatement", "src": "31261:27:125" }, { "condition": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 20122, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 20120, "name": "_closeVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20102, "src": "31302:21:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "<", "rightExpression": { "id": 20121, "name": "_openVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20100, "src": "31326:20:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "31302:44:125", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "falseBody": { "id": 20179, "nodeType": "Block", "src": "32603:140:125", "statements": [{ "expression": { "id": 20177, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 20169, "name": "shareAdjustmentDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20118, "src": "32617:20:125", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "commonType": { "typeIdentifier": "t_int256", "typeString": "int256" }, "id": 20176, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 20170, "name": "_shareReservesDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20094, "src": "32656:19:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20171, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "32676:8:125", "memberName": "toInt256", "nodeType": "MemberAccess", "referencedDeclaration": 22312, "src": "32656:28:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$returns$_t_int256_$attached_to$_t_uint256_$", "typeString": "function (uint256) pure returns (int256)" } }, "id": 20172, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "32656:30:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 20173, "name": "_shareCurveDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20096, "src": "32705:16:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20174, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "32722:8:125", "memberName": "toInt256", "nodeType": "MemberAccess", "referencedDeclaration": 22312, "src": "32705:25:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$returns$_t_int256_$attached_to$_t_uint256_$", "typeString": "function (uint256) pure returns (int256)" } }, "id": 20175, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "32705:27:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "src": "32656:76:125", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "src": "32617:115:125", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "id": 20178, "nodeType": "ExpressionStatement", "src": "32617:115:125" }] }, "id": 20180, "nodeType": "IfStatement", "src": "31298:1445:125", "trueBody": { "id": 20168, "nodeType": "Block", "src": "31348:1249:125", "statements": [{ "condition": { "id": 20123, "name": "_isLong", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20104, "src": "31631:7:125", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "id": 20133, "nodeType": "IfStatement", "src": "31627:191:125", "trueBody": { "id": 20132, "nodeType": "Block", "src": "31640:178:125", "statements": [{ "expression": { "id": 20130, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 20124, "name": "_shareProceeds", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20092, "src": "31658:14:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 20127, "name": "_closeVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20102, "src": "31722:21:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 20128, "name": "_openVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20100, "src": "31765:20:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 20125, "name": "_shareProceeds", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20092, "src": "31675:14:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20126, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "31690:10:125", "memberName": "mulDivDown", "nodeType": "MemberAccess", "referencedDeclaration": 18704, "src": "31675:25:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 20129, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "31675:128:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "31658:145:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20131, "nodeType": "ExpressionStatement", "src": "31658:145:125" }] } }, { "expression": { "id": 20140, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 20134, "name": "_shareReservesDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20094, "src": "31951:19:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 20137, "name": "_closeVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20102, "src": "32021:21:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 20138, "name": "_openVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20100, "src": "32060:20:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 20135, "name": "_shareReservesDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20094, "src": "31973:19:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20136, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "31993:10:125", "memberName": "mulDivDown", "nodeType": "MemberAccess", "referencedDeclaration": 18704, "src": "31973:30:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 20139, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "31973:121:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "31951:143:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20141, "nodeType": "ExpressionStatement", "src": "31951:143:125" }, { "expression": { "id": 20150, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 20142, "name": "shareAdjustmentDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20118, "src": "32163:20:125", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "commonType": { "typeIdentifier": "t_int256", "typeString": "int256" }, "id": 20149, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 20143, "name": "_shareReservesDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20094, "src": "32202:19:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20144, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "32222:8:125", "memberName": "toInt256", "nodeType": "MemberAccess", "referencedDeclaration": 22312, "src": "32202:28:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$returns$_t_int256_$attached_to$_t_uint256_$", "typeString": "function (uint256) pure returns (int256)" } }, "id": 20145, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "32202:30:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 20146, "name": "_shareCurveDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20096, "src": "32251:16:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20147, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "32268:8:125", "memberName": "toInt256", "nodeType": "MemberAccess", "referencedDeclaration": 22312, "src": "32251:25:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$returns$_t_int256_$attached_to$_t_uint256_$", "typeString": "function (uint256) pure returns (int256)" } }, "id": 20148, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "32251:27:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "src": "32202:76:125", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "src": "32163:115:125", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "id": 20151, "nodeType": "ExpressionStatement", "src": "32163:115:125" }, { "expression": { "id": 20158, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 20152, "name": "_shareCurveDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20096, "src": "32292:16:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 20155, "name": "_closeVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20102, "src": "32356:21:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 20156, "name": "_openVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20100, "src": "32395:20:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 20153, "name": "_shareCurveDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20096, "src": "32311:16:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20154, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "32328:10:125", "memberName": "mulDivDown", "nodeType": "MemberAccess", "referencedDeclaration": 18704, "src": "32311:27:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 20157, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "32311:118:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "32292:137:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20159, "nodeType": "ExpressionStatement", "src": "32292:137:125" }, { "expression": { "id": 20166, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 20160, "name": "_totalGovernanceFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20098, "src": "32443:19:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 20163, "name": "_closeVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20102, "src": "32513:21:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 20164, "name": "_openVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20100, "src": "32552:20:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 20161, "name": "_totalGovernanceFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20098, "src": "32465:19:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20162, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "32485:10:125", "memberName": "mulDivDown", "nodeType": "MemberAccess", "referencedDeclaration": 18704, "src": "32465:30:125", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 20165, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "32465:121:125", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "32443:143:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20167, "nodeType": "ExpressionStatement", "src": "32443:143:125" }] } }, { "expression": { "components": [{ "id": 20181, "name": "_shareProceeds", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20092, "src": "32774:14:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 20182, "name": "_shareReservesDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20094, "src": "32802:19:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 20183, "name": "_shareCurveDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20096, "src": "32835:16:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 20184, "name": "shareAdjustmentDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20118, "src": "32865:20:125", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, { "id": 20185, "name": "_totalGovernanceFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20098, "src": "32899:19:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 20186, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "32760:168:125", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_uint256_$_t_uint256_$_t_int256_$_t_uint256_$", "typeString": "tuple(uint256,uint256,uint256,int256,uint256)" } }, "functionReturnParameters": 20116, "id": 20187, "nodeType": "Return", "src": "32753:175:125" }] }, "documentation": { "id": 20090, "nodeType": "StructuredDocumentation", "src": "27900:2077:125", "text": "@dev If negative interest accrued over the term, we scale the share\n      proceeds by the negative interest amount. Shorts should be\n      responsible for negative interest, but negative interest can exceed\n      the margin that shorts provide. This leaves us with no choice but\n      to attribute the negative interest to longs. Along with scaling the\n      share proceeds, we also scale the fee amounts.\n      In order for our AMM invariant to be maintained, the effective\n      share reserves need to be adjusted by the same amount as the share\n      reserves delta calculated with YieldSpace including fees. We reduce\n      the share reserves by `min(c_1 / c_0, 1) * shareReservesDelta` and\n      the share adjustment by the `shareAdjustmentDelta`. We can solve\n      these equations simultaneously to find the share adjustment delta\n      as:\n      shareAdjustmentDelta = min(c_1 / c_0, 1) * sharePayment -\n                             shareReservesDelta\n      We underestimate the share proceeds to avoid sandwiches, and we\n      round the share reserves delta and share adjustment in the same\n      direction for consistency.\n @param _shareProceeds The proceeds in shares from the trade.\n @param _shareReservesDelta The change in share reserves from the trade.\n @param _shareCurveDelta The curve portion of the change in share reserves.\n @param _totalGovernanceFee The total governance fee.\n @param _openVaultSharePrice The vault share price at the beginning of\n        the term.\n @param _closeVaultSharePrice The vault share price at the end of the term.\n @param _isLong A flag indicating whether or not the trade is a long.\n @return The adjusted share proceeds.\n @return The adjusted share reserves delta.\n @return The adjusted share close proceeds.\n @return The share adjustment delta.\n @return The adjusted total governance fee." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateNegativeInterestOnClose", "nameLocation": "29991:32:125", "parameters": { "id": 20105, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 20092, "mutability": "mutable", "name": "_shareProceeds", "nameLocation": "30041:14:125", "nodeType": "VariableDeclaration", "scope": 20189, "src": "30033:22:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20091, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "30033:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20094, "mutability": "mutable", "name": "_shareReservesDelta", "nameLocation": "30073:19:125", "nodeType": "VariableDeclaration", "scope": 20189, "src": "30065:27:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20093, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "30065:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20096, "mutability": "mutable", "name": "_shareCurveDelta", "nameLocation": "30110:16:125", "nodeType": "VariableDeclaration", "scope": 20189, "src": "30102:24:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20095, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "30102:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20098, "mutability": "mutable", "name": "_totalGovernanceFee", "nameLocation": "30144:19:125", "nodeType": "VariableDeclaration", "scope": 20189, "src": "30136:27:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20097, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "30136:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20100, "mutability": "mutable", "name": "_openVaultSharePrice", "nameLocation": "30181:20:125", "nodeType": "VariableDeclaration", "scope": 20189, "src": "30173:28:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20099, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "30173:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20102, "mutability": "mutable", "name": "_closeVaultSharePrice", "nameLocation": "30219:21:125", "nodeType": "VariableDeclaration", "scope": 20189, "src": "30211:29:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20101, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "30211:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20104, "mutability": "mutable", "name": "_isLong", "nameLocation": "30255:7:125", "nodeType": "VariableDeclaration", "scope": 20189, "src": "30250:12:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "typeName": { "id": 20103, "name": "bool", "nodeType": "ElementaryTypeName", "src": "30250:4:125", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "visibility": "internal" }], "src": "30023:245:125" }, "returnParameters": { "id": 20116, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 20107, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 20189, "src": "30292:7:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20106, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "30292:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20109, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 20189, "src": "30301:7:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20108, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "30301:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20111, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 20189, "src": "30310:7:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20110, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "30310:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20113, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 20189, "src": "30319:6:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" }, "typeName": { "id": 20112, "name": "int256", "nodeType": "ElementaryTypeName", "src": "30319:6:125", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "visibility": "internal" }, { "constant": false, "id": 20115, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 20189, "src": "30327:7:125", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20114, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "30327:7:125", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "30291:44:125" }, "scope": 20190, "stateMutability": "pure", "virtual": false, "visibility": "internal" }], "abstract": false, "baseContracts": [], "canonicalName": "HyperdriveMath", "contractDependencies": [], "contractKind": "library", "documentation": { "id": 19456, "nodeType": "StructuredDocumentation", "src": "324:314:125", "text": "@author DELV\n @title Hyperdrive\n @notice Math for the Hyperdrive pricing model.\n @custom:disclaimer The language used in this code is for coding convenience\n                    only, and is not intended to, and does not, have any\n                    particular legal or regulatory significance." }, "fullyImplemented": true, "linearizedBaseContracts": [20190], "name": "HyperdriveMath", "nameLocation": "646:14:125", "scope": 20191, "usedErrors": [], "usedEvents": [] }], "license": "Apache-2.0" }, "id": 125 };
