export const HyperdriveMath = { "abi": [], "bytecode": { "object": "0x60566037600b82828239805160001a607314602a57634e487b7160e01b600052600060045260246000fd5b30600052607381538281f3fe73000000000000000000000000000000000000000030146080604052600080fdfea2646970667358221220e4e01be80aaa6138e8aaeb2cfbbe86d6e3c02a856c9939197209e629a5c66c5e64736f6c63430008140033", "sourceMap": "638:32299:129:-:0;;;;;;;;;;;;;;;-1:-1:-1;;;638:32299:129;;;;;;;;;;;;;;;;;", "linkReferences": {} }, "deployedBytecode": { "object": "0x73000000000000000000000000000000000000000030146080604052600080fdfea2646970667358221220e4e01be80aaa6138e8aaeb2cfbbe86d6e3c02a856c9939197209e629a5c66c5e64736f6c63430008140033", "sourceMap": "638:32299:129:-:0;;;;;;;;", "linkReferences": {} }, "methodIdentifiers": {}, "rawMetadata": "{\"compiler\":{\"version\":\"0.8.20+commit.a1b79de6\"},\"language\":\"Solidity\",\"output\":{\"abi\":[],\"devdoc\":{\"author\":\"DELV\",\"custom:disclaimer\":\"The language used in this code is for coding convenience                    only, and is not intended to, and does not, have any                    particular legal or regulatory significance.\",\"kind\":\"dev\",\"methods\":{},\"title\":\"Hyperdrive\",\"version\":1},\"userdoc\":{\"kind\":\"user\",\"methods\":{},\"notice\":\"Math for the Hyperdrive pricing model.\",\"version\":1}},\"settings\":{\"compilationTarget\":{\"contracts/src/libraries/HyperdriveMath.sol\":\"HyperdriveMath\"},\"evmVersion\":\"paris\",\"libraries\":{},\"metadata\":{\"bytecodeHash\":\"ipfs\"},\"optimizer\":{\"enabled\":true,\"runs\":200},\"remappings\":[\":@openzeppelin/contracts/=lib/openzeppelin-contracts/contracts/\",\":aave-v3-core/=lib/aave-v3-core/\",\":ds-test/=lib/forge-std/lib/ds-test/src/\",\":erc4626-tests/=lib/openzeppelin-contracts/lib/erc4626-tests/\",\":forge-std/=lib/forge-std/src/\",\":openzeppelin-contracts/=lib/openzeppelin-contracts/\",\":openzeppelin/=lib/openzeppelin-contracts/contracts/\",\":solmate/=lib/solmate/src/\"]},\"sources\":{\"contracts/src/interfaces/IERC20.sol\":{\"keccak256\":\"0x5f446a4987d57c64380d44c234ee079172e98bed9595ec067eb519898c3117d9\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://a3245994c58110716f5099c07e5cb270137356d288044f03c713d29c36e207ac\",\"dweb:/ipfs/QmYdn52sGRQKXfSyL8ieSz8HysG6R5kLJWsNwEnyX1e22p\"]},\"contracts/src/interfaces/IHyperdrive.sol\":{\"keccak256\":\"0xb8ee04f3090b498966970e210f7de0f982f6445628556f2f176385423d8c5952\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://db789f03faa935c6e3b0882b6e873e8f683c9c8841a4b128366dcbe7321911bf\",\"dweb:/ipfs/QmSQh1cX79nApuSAfJbVN99dmEaE4CK9QwWfEGcwhJMBLK\"]},\"contracts/src/interfaces/IHyperdriveCore.sol\":{\"keccak256\":\"0x68adcd293ff25711add1698b6024faa45beec01eb044bd0103d3020aa96d856e\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://0e0f5e35a7d2c656e249394d25896e5adfb9af3e210c01b9ef5fa81d25a45e24\",\"dweb:/ipfs/QmbLASezHPWHcbodqSfw3Qh9NzqekqVPM8FhCXKGTCXL1h\"]},\"contracts/src/interfaces/IHyperdriveEvents.sol\":{\"keccak256\":\"0x812ccb32dff907e8614c89a65196eec239eceb3e63f9f14dde2b2269c75a67c0\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://da5f2ce974bfcd8185342c121c879ba5aef23e1e4e7b36cf9fcba68296b8892c\",\"dweb:/ipfs/QmSho3PWs9bzejTYYjySuXcH9tVP4xFnkbUmSzQA54g8eG\"]},\"contracts/src/interfaces/IHyperdriveRead.sol\":{\"keccak256\":\"0x5922cbd86a7267c8fd19e3dc7a6f2636bad2b3330c28bca8e66adc7cd8ce2b55\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://ced8bce3f3c15a9f0bcdd11ba16e69651179edd6b16e267936788f4ab4d6eabf\",\"dweb:/ipfs/QmcoZPj4h2ym6r13KDU7JG2GoVdDWa1GwfKL2jjFRsp8H6\"]},\"contracts/src/interfaces/IMultiToken.sol\":{\"keccak256\":\"0xf5f82b8223e0c1bfcf4f73566a909ba07a9266960dfe2335c1494e06debbbe3f\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://920cf3fd66132a1e98a6a5708ad9a3bb047f4df8848119ab382b51094c1290a7\",\"dweb:/ipfs/QmWL3SyG8L91Coe9DsHz3Ke9tGMvYBf2NgRRDr3Fg5xFzp\"]},\"contracts/src/interfaces/IMultiTokenCore.sol\":{\"keccak256\":\"0x5c27315743bb6ef8a121ecf72cb24d5c144786dedb6526ef010f580eb872e501\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://3e102c51bac9c82766c9826d97dc780a05a2bf64703b070757a7531a0851a1ae\",\"dweb:/ipfs/QmXYwbzPbiznj5AeDiX7NNfRE9xyhSx1huTMfMFndrUZWs\"]},\"contracts/src/interfaces/IMultiTokenEvents.sol\":{\"keccak256\":\"0x165f79e628b1975343f979549f3fdb5073a29aeecb03861f41d165961ee39fdb\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://3c0751cf322944d080a7a6692897807d0cef798268689afc1f6c8f91182a4222\",\"dweb:/ipfs/QmQVWtCgphU9sjqD2q6F6ww62uXDSWZx5KJVj6jFJpXeDK\"]},\"contracts/src/interfaces/IMultiTokenMetadata.sol\":{\"keccak256\":\"0xcc21ad6d3d4e3de354fbc25a472d940e5e2af0b48766404f9efecdac600d72ca\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://b48fa111a773c820fe578efdd737d164e3957930ed46f3f304c6a8602a7e26a3\",\"dweb:/ipfs/QmcA7bjBC6ZBvYyojZZx3eKpugHmSrAAA14p14bQugiVKG\"]},\"contracts/src/interfaces/IMultiTokenRead.sol\":{\"keccak256\":\"0xac84dd306f29ae9d6becf764d93545c33f7c37737bb1aeb714c85930d0c074a0\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://d9082a16d5a736ab7ce5670be4f2475ea5c5fdae8ad7096ed9663f84eed96b11\",\"dweb:/ipfs/QmUTH8dZaQJt56UsT7N2aCUCKmjQYj7Ah53rRXk6DuVNUR\"]},\"contracts/src/libraries/Errors.sol\":{\"keccak256\":\"0x45f48f5b8caec5b751850b7266abd84c7400debfbad0f112847582bb052058b0\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://46c85e0c750cdb752bec5d67a8a0bc8df071d934c568c880d08a5120a1a11d88\",\"dweb:/ipfs/Qmc2L1ePB1gqBwUiaAUeoG6hvoPtS2hdY6rhEXzX1SfB41\"]},\"contracts/src/libraries/FixedPointMath.sol\":{\"keccak256\":\"0x631f6529908f62f71775f8c6120afdca3a836fb24fa9fa4701cad54f4a9da076\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://2baf6ad8917a3fbb6d040334451f6b4f6936b00518c4cd308b9c6fa11569b2bd\",\"dweb:/ipfs/QmXD16vk6MRxmPRqy8ZXSpRA5XxhSf1pnsQH32ARDJTk8L\"]},\"contracts/src/libraries/HyperdriveMath.sol\":{\"keccak256\":\"0xcf305dde8aa320d1e1b767734ce8edce456af537525d40e30d5345f09f6e34ab\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://056c9a563f1a9e0133e17463497ad19be517d35b770170122edea50ca9fbe002\",\"dweb:/ipfs/QmS6dkVRHzdbv7etumcCtNtm9GuXDCjqZxxhtYfP6keAAY\"]},\"contracts/src/libraries/SafeCast.sol\":{\"keccak256\":\"0xc5282be69c8c85c1a1bbbf1554a501c17599f4b84119339b660018ae90eb7148\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://fd29b570d1e3205d25939b1c0e78e98ae34747a8118703fc5b2c9690791b26c8\",\"dweb:/ipfs/QmSdecxKRE66cgEipikK5uS4mUJxz2FgfncCk9iXvkdjG8\"]},\"contracts/src/libraries/YieldSpaceMath.sol\":{\"keccak256\":\"0x4a9c91313bed7cda6ef503af23c9f777008b5258e9cb2176eab6acc52be79891\",\"license\":\"Apache-2.0\",\"urls\":[\"bzz-raw://88da1f5502a12fe1024be90f6a6ea08556cc1f2660ab8cbeb5e07640abb7711c\",\"dweb:/ipfs/QmVQoG9TyrAsVYcgvgZfgA5pQk8V8wvS4BewGNP4B3Txyy\"]}},\"version\":1}", "metadata": { "compiler": { "version": "0.8.20+commit.a1b79de6" }, "language": "Solidity", "output": { "abi": [], "devdoc": { "kind": "dev", "methods": {}, "version": 1 }, "userdoc": { "kind": "user", "methods": {}, "version": 1 } }, "settings": { "remappings": ["@openzeppelin/contracts/=lib/openzeppelin-contracts/contracts/", "aave-v3-core/=lib/aave-v3-core/", "ds-test/=lib/forge-std/lib/ds-test/src/", "erc4626-tests/=lib/openzeppelin-contracts/lib/erc4626-tests/", "forge-std/=lib/forge-std/src/", "openzeppelin-contracts/=lib/openzeppelin-contracts/", "openzeppelin/=lib/openzeppelin-contracts/contracts/", "solmate/=lib/solmate/src/"], "optimizer": { "enabled": true, "runs": 200 }, "metadata": { "bytecodeHash": "ipfs" }, "compilationTarget": { "contracts/src/libraries/HyperdriveMath.sol": "HyperdriveMath" }, "libraries": {} }, "sources": { "contracts/src/interfaces/IERC20.sol": { "keccak256": "0x5f446a4987d57c64380d44c234ee079172e98bed9595ec067eb519898c3117d9", "urls": ["bzz-raw://a3245994c58110716f5099c07e5cb270137356d288044f03c713d29c36e207ac", "dweb:/ipfs/QmYdn52sGRQKXfSyL8ieSz8HysG6R5kLJWsNwEnyX1e22p"], "license": "Apache-2.0" }, "contracts/src/interfaces/IHyperdrive.sol": { "keccak256": "0xb8ee04f3090b498966970e210f7de0f982f6445628556f2f176385423d8c5952", "urls": ["bzz-raw://db789f03faa935c6e3b0882b6e873e8f683c9c8841a4b128366dcbe7321911bf", "dweb:/ipfs/QmSQh1cX79nApuSAfJbVN99dmEaE4CK9QwWfEGcwhJMBLK"], "license": "Apache-2.0" }, "contracts/src/interfaces/IHyperdriveCore.sol": { "keccak256": "0x68adcd293ff25711add1698b6024faa45beec01eb044bd0103d3020aa96d856e", "urls": ["bzz-raw://0e0f5e35a7d2c656e249394d25896e5adfb9af3e210c01b9ef5fa81d25a45e24", "dweb:/ipfs/QmbLASezHPWHcbodqSfw3Qh9NzqekqVPM8FhCXKGTCXL1h"], "license": "Apache-2.0" }, "contracts/src/interfaces/IHyperdriveEvents.sol": { "keccak256": "0x812ccb32dff907e8614c89a65196eec239eceb3e63f9f14dde2b2269c75a67c0", "urls": ["bzz-raw://da5f2ce974bfcd8185342c121c879ba5aef23e1e4e7b36cf9fcba68296b8892c", "dweb:/ipfs/QmSho3PWs9bzejTYYjySuXcH9tVP4xFnkbUmSzQA54g8eG"], "license": "Apache-2.0" }, "contracts/src/interfaces/IHyperdriveRead.sol": { "keccak256": "0x5922cbd86a7267c8fd19e3dc7a6f2636bad2b3330c28bca8e66adc7cd8ce2b55", "urls": ["bzz-raw://ced8bce3f3c15a9f0bcdd11ba16e69651179edd6b16e267936788f4ab4d6eabf", "dweb:/ipfs/QmcoZPj4h2ym6r13KDU7JG2GoVdDWa1GwfKL2jjFRsp8H6"], "license": "Apache-2.0" }, "contracts/src/interfaces/IMultiToken.sol": { "keccak256": "0xf5f82b8223e0c1bfcf4f73566a909ba07a9266960dfe2335c1494e06debbbe3f", "urls": ["bzz-raw://920cf3fd66132a1e98a6a5708ad9a3bb047f4df8848119ab382b51094c1290a7", "dweb:/ipfs/QmWL3SyG8L91Coe9DsHz3Ke9tGMvYBf2NgRRDr3Fg5xFzp"], "license": "Apache-2.0" }, "contracts/src/interfaces/IMultiTokenCore.sol": { "keccak256": "0x5c27315743bb6ef8a121ecf72cb24d5c144786dedb6526ef010f580eb872e501", "urls": ["bzz-raw://3e102c51bac9c82766c9826d97dc780a05a2bf64703b070757a7531a0851a1ae", "dweb:/ipfs/QmXYwbzPbiznj5AeDiX7NNfRE9xyhSx1huTMfMFndrUZWs"], "license": "Apache-2.0" }, "contracts/src/interfaces/IMultiTokenEvents.sol": { "keccak256": "0x165f79e628b1975343f979549f3fdb5073a29aeecb03861f41d165961ee39fdb", "urls": ["bzz-raw://3c0751cf322944d080a7a6692897807d0cef798268689afc1f6c8f91182a4222", "dweb:/ipfs/QmQVWtCgphU9sjqD2q6F6ww62uXDSWZx5KJVj6jFJpXeDK"], "license": "Apache-2.0" }, "contracts/src/interfaces/IMultiTokenMetadata.sol": { "keccak256": "0xcc21ad6d3d4e3de354fbc25a472d940e5e2af0b48766404f9efecdac600d72ca", "urls": ["bzz-raw://b48fa111a773c820fe578efdd737d164e3957930ed46f3f304c6a8602a7e26a3", "dweb:/ipfs/QmcA7bjBC6ZBvYyojZZx3eKpugHmSrAAA14p14bQugiVKG"], "license": "Apache-2.0" }, "contracts/src/interfaces/IMultiTokenRead.sol": { "keccak256": "0xac84dd306f29ae9d6becf764d93545c33f7c37737bb1aeb714c85930d0c074a0", "urls": ["bzz-raw://d9082a16d5a736ab7ce5670be4f2475ea5c5fdae8ad7096ed9663f84eed96b11", "dweb:/ipfs/QmUTH8dZaQJt56UsT7N2aCUCKmjQYj7Ah53rRXk6DuVNUR"], "license": "Apache-2.0" }, "contracts/src/libraries/Errors.sol": { "keccak256": "0x45f48f5b8caec5b751850b7266abd84c7400debfbad0f112847582bb052058b0", "urls": ["bzz-raw://46c85e0c750cdb752bec5d67a8a0bc8df071d934c568c880d08a5120a1a11d88", "dweb:/ipfs/Qmc2L1ePB1gqBwUiaAUeoG6hvoPtS2hdY6rhEXzX1SfB41"], "license": "Apache-2.0" }, "contracts/src/libraries/FixedPointMath.sol": { "keccak256": "0x631f6529908f62f71775f8c6120afdca3a836fb24fa9fa4701cad54f4a9da076", "urls": ["bzz-raw://2baf6ad8917a3fbb6d040334451f6b4f6936b00518c4cd308b9c6fa11569b2bd", "dweb:/ipfs/QmXD16vk6MRxmPRqy8ZXSpRA5XxhSf1pnsQH32ARDJTk8L"], "license": "Apache-2.0" }, "contracts/src/libraries/HyperdriveMath.sol": { "keccak256": "0xcf305dde8aa320d1e1b767734ce8edce456af537525d40e30d5345f09f6e34ab", "urls": ["bzz-raw://056c9a563f1a9e0133e17463497ad19be517d35b770170122edea50ca9fbe002", "dweb:/ipfs/QmS6dkVRHzdbv7etumcCtNtm9GuXDCjqZxxhtYfP6keAAY"], "license": "Apache-2.0" }, "contracts/src/libraries/SafeCast.sol": { "keccak256": "0xc5282be69c8c85c1a1bbbf1554a501c17599f4b84119339b660018ae90eb7148", "urls": ["bzz-raw://fd29b570d1e3205d25939b1c0e78e98ae34747a8118703fc5b2c9690791b26c8", "dweb:/ipfs/QmSdecxKRE66cgEipikK5uS4mUJxz2FgfncCk9iXvkdjG8"], "license": "Apache-2.0" }, "contracts/src/libraries/YieldSpaceMath.sol": { "keccak256": "0x4a9c91313bed7cda6ef503af23c9f777008b5258e9cb2176eab6acc52be79891", "urls": ["bzz-raw://88da1f5502a12fe1024be90f6a6ea08556cc1f2660ab8cbeb5e07640abb7711c", "dweb:/ipfs/QmVQoG9TyrAsVYcgvgZfgA5pQk8V8wvS4BewGNP4B3Txyy"], "license": "Apache-2.0" } }, "version": 1 }, "ast": { "absolutePath": "contracts/src/libraries/HyperdriveMath.sol", "id": 20321, "exportedSymbols": { "Errors": [18797], "FixedPointMath": [19572], "HyperdriveMath": [20320], "IHyperdrive": [11143], "ONE": [18806], "SafeCast": [22443], "YieldSpaceMath": [23422] }, "nodeType": "SourceUnit", "src": "40:32898:129", "nodes": [{ "id": 19574, "nodeType": "PragmaDirective", "src": "40:23:129", "nodes": [], "literals": ["solidity", "0.8", ".20"] }, { "id": 19576, "nodeType": "ImportDirective", "src": "65:60:129", "nodes": [], "absolutePath": "contracts/src/interfaces/IHyperdrive.sol", "file": "../interfaces/IHyperdrive.sol", "nameLocation": "-1:-1:-1", "scope": 20321, "sourceUnit": 11144, "symbolAliases": [{ "foreign": { "id": 19575, "name": "IHyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 11143, "src": "74:11:129", "typeDescriptions": {} }, "nameLocation": "-1:-1:-1" }], "unitAlias": "" }, { "id": 19578, "nodeType": "ImportDirective", "src": "126:38:129", "nodes": [], "absolutePath": "contracts/src/libraries/Errors.sol", "file": "./Errors.sol", "nameLocation": "-1:-1:-1", "scope": 20321, "sourceUnit": 18798, "symbolAliases": [{ "foreign": { "id": 19577, "name": "Errors", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18797, "src": "135:6:129", "typeDescriptions": {} }, "nameLocation": "-1:-1:-1" }], "unitAlias": "" }, { "id": 19581, "nodeType": "ImportDirective", "src": "165:59:129", "nodes": [], "absolutePath": "contracts/src/libraries/FixedPointMath.sol", "file": "./FixedPointMath.sol", "nameLocation": "-1:-1:-1", "scope": 20321, "sourceUnit": 19573, "symbolAliases": [{ "foreign": { "id": 19579, "name": "FixedPointMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19572, "src": "174:14:129", "typeDescriptions": {} }, "nameLocation": "-1:-1:-1" }, { "foreign": { "id": 19580, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "190:3:129", "typeDescriptions": {} }, "nameLocation": "-1:-1:-1" }], "unitAlias": "" }, { "id": 19583, "nodeType": "ImportDirective", "src": "225:42:129", "nodes": [], "absolutePath": "contracts/src/libraries/SafeCast.sol", "file": "./SafeCast.sol", "nameLocation": "-1:-1:-1", "scope": 20321, "sourceUnit": 22444, "symbolAliases": [{ "foreign": { "id": 19582, "name": "SafeCast", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 22443, "src": "234:8:129", "typeDescriptions": {} }, "nameLocation": "-1:-1:-1" }], "unitAlias": "" }, { "id": 19585, "nodeType": "ImportDirective", "src": "268:54:129", "nodes": [], "absolutePath": "contracts/src/libraries/YieldSpaceMath.sol", "file": "./YieldSpaceMath.sol", "nameLocation": "-1:-1:-1", "scope": 20321, "sourceUnit": 23423, "symbolAliases": [{ "foreign": { "id": 19584, "name": "YieldSpaceMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 23422, "src": "277:14:129", "typeDescriptions": {} }, "nameLocation": "-1:-1:-1" }], "unitAlias": "" }, { "id": 20320, "nodeType": "ContractDefinition", "src": "638:32299:129", "nodes": [{ "id": 19589, "nodeType": "UsingForDirective", "src": "667:33:129", "nodes": [], "global": false, "libraryName": { "id": 19587, "name": "FixedPointMath", "nameLocations": ["673:14:129"], "nodeType": "IdentifierPath", "referencedDeclaration": 19572, "src": "673:14:129" }, "typeName": { "id": 19588, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "692:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } } }, { "id": 19592, "nodeType": "UsingForDirective", "src": "705:32:129", "nodes": [], "global": false, "libraryName": { "id": 19590, "name": "FixedPointMath", "nameLocations": ["711:14:129"], "nodeType": "IdentifierPath", "referencedDeclaration": 19572, "src": "711:14:129" }, "typeName": { "id": 19591, "name": "int256", "nodeType": "ElementaryTypeName", "src": "730:6:129", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } } }, { "id": 19595, "nodeType": "UsingForDirective", "src": "742:27:129", "nodes": [], "global": false, "libraryName": { "id": 19593, "name": "SafeCast", "nameLocations": ["748:8:129"], "nodeType": "IdentifierPath", "referencedDeclaration": 22443, "src": "748:8:129" }, "typeName": { "id": 19594, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "761:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } } }, { "id": 19664, "nodeType": "FunctionDefinition", "src": "1405:1330:129", "nodes": [], "body": { "id": 19663, "nodeType": "Block", "src": "1530:1205:129", "nodes": [], "statements": [{ "assignments": [19606], "declarations": [{ "constant": false, "id": 19606, "mutability": "mutable", "name": "timeStretch", "nameLocation": "1670:11:129", "nodeType": "VariableDeclaration", "scope": 19663, "src": "1662:19:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19605, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "1662:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 19622, "initialValue": { "arguments": [{ "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 19619, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 19617, "name": "_apr", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19598, "src": "1753:4:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "*", "rightExpression": { "hexValue": "313030", "id": 19618, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "1760:3:129", "typeDescriptions": { "typeIdentifier": "t_rational_100_by_1", "typeString": "int_const 100" }, "value": "100" }, "src": "1753:10:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "hexValue": "302e3034363635653138", "id": 19614, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "1733:10:129", "typeDescriptions": { "typeIdentifier": "t_rational_46650000000000000_by_1", "typeString": "int_const 46650000000000000" }, "value": "0.04665e18" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_rational_46650000000000000_by_1", "typeString": "int_const 46650000000000000" }], "id": 19613, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "1725:7:129", "typeDescriptions": { "typeIdentifier": "t_type$_t_uint256_$", "typeString": "type(uint256)" }, "typeName": { "id": 19612, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "1725:7:129", "typeDescriptions": {} } }, "id": 19615, "isConstant": false, "isLValue": false, "isPure": true, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "1725:19:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19616, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "1745:7:129", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "1725:27:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19620, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "1725:39:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "hexValue": "352e3234353932653138", "id": 19609, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "1692:10:129", "typeDescriptions": { "typeIdentifier": "t_rational_5245920000000000000_by_1", "typeString": "int_const 5245920000000000000" }, "value": "5.24592e18" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_rational_5245920000000000000_by_1", "typeString": "int_const 5245920000000000000" }], "id": 19608, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "1684:7:129", "typeDescriptions": { "typeIdentifier": "t_type$_t_uint256_$", "typeString": "type(uint256)" }, "typeName": { "id": 19607, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "1684:7:129", "typeDescriptions": {} } }, "id": 19610, "isConstant": false, "isLValue": false, "isPure": true, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "1684:19:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19611, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "1704:7:129", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "1684:27:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19621, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "1684:90:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "1662:112:129" }, { "expression": { "id": 19628, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 19623, "name": "timeStretch", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19606, "src": "1784:11:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 19626, "name": "timeStretch", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19606, "src": "1810:11:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 19624, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "1798:3:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19625, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "1802:7:129", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "1798:11:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19627, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "1798:24:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "1784:38:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19629, "nodeType": "ExpressionStatement", "src": "1784:38:129" }, { "expression": { "arguments": [{ "id": 19660, "name": "timeStretch", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19606, "src": "2716:11:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "components": [{ "arguments": [{ "arguments": [{ "arguments": [], "expression": { "argumentTypes": [], "expression": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 19650, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 19648, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "2664:3:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "id": 19649, "name": "_apr", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19598, "src": "2670:4:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "2664:10:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 19651, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "2663:12:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19652, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "2676:8:129", "memberName": "toInt256", "nodeType": "MemberAccess", "referencedDeclaration": 22442, "src": "2663:21:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$returns$_t_int256_$attached_to$_t_uint256_$", "typeString": "function (uint256) pure returns (int256)" } }, "id": 19653, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "2663:23:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "id": 19654, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "2687:2:129", "memberName": "ln", "nodeType": "MemberAccess", "referencedDeclaration": 19396, "src": "2663:26:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_int256_$returns$_t_int256_$attached_to$_t_int256_$", "typeString": "function (int256) pure returns (int256)" } }, "id": 19655, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "2663:28:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 19647, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "2655:7:129", "typeDescriptions": { "typeIdentifier": "t_type$_t_uint256_$", "typeString": "type(uint256)" }, "typeName": { "id": 19646, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "2655:7:129", "typeDescriptions": {} } }, "id": 19656, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "2655:37:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "arguments": [], "expression": { "argumentTypes": [], "expression": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 19638, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 19632, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "2511:3:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "arguments": [{ "id": 19635, "name": "_positionDuration", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19600, "src": "2533:17:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "hexValue": "333635", "id": 19636, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "2552:8:129", "subdenomination": "days", "typeDescriptions": { "typeIdentifier": "t_rational_31536000_by_1", "typeString": "int_const 31536000" }, "value": "365" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_rational_31536000_by_1", "typeString": "int_const 31536000" }], "expression": { "id": 19633, "name": "_apr", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19598, "src": "2517:4:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19634, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "2522:10:129", "memberName": "mulDivDown", "nodeType": "MemberAccess", "referencedDeclaration": 18834, "src": "2517:15:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 19637, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "2517:44:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "2511:50:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 19639, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "2510:52:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19640, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "2588:8:129", "memberName": "toInt256", "nodeType": "MemberAccess", "referencedDeclaration": 22442, "src": "2510:86:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$returns$_t_int256_$attached_to$_t_uint256_$", "typeString": "function (uint256) pure returns (int256)" } }, "id": 19641, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "2510:88:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "id": 19642, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "2624:2:129", "memberName": "ln", "nodeType": "MemberAccess", "referencedDeclaration": 19396, "src": "2510:116:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_int256_$returns$_t_int256_$attached_to$_t_int256_$", "typeString": "function (int256) pure returns (int256)" } }, "id": 19643, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "2510:118:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 19631, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "2481:7:129", "typeDescriptions": { "typeIdentifier": "t_type$_t_uint256_$", "typeString": "type(uint256)" }, "typeName": { "id": 19630, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "2481:7:129", "typeDescriptions": {} } }, "id": 19644, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "2481:165:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19645, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "2647:7:129", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "2481:173:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19657, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "2481:212:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 19658, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "2463:244:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19659, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "2708:7:129", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "2463:252:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19661, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "2463:265:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 19604, "id": 19662, "nodeType": "Return", "src": "2444:284:129" }] }, "documentation": { "id": 19596, "nodeType": "StructuredDocumentation", "src": "775:625:129", "text": "@dev Calculates the time stretch parameter for the YieldSpace curve.\n      This parameter modifies the curvature in order to support a larger\n      or smaller range of APRs. The lower the time stretch, the flatter\n      the curve will be and the narrower the range of feasible APRs. The\n      higher the time stretch, the higher the curvature will be and the\n      wider the range of feasible APRs.\n @param _apr The target APR to use when calculating the time stretch.\n @param _positionDuration The position duration in seconds.\n @return The time stretch parameter." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateTimeStretch", "nameLocation": "1414:20:129", "parameters": { "id": 19601, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19598, "mutability": "mutable", "name": "_apr", "nameLocation": "1452:4:129", "nodeType": "VariableDeclaration", "scope": 19664, "src": "1444:12:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19597, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "1444:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19600, "mutability": "mutable", "name": "_positionDuration", "nameLocation": "1474:17:129", "nodeType": "VariableDeclaration", "scope": 19664, "src": "1466:25:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19599, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "1466:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "1434:63:129" }, "returnParameters": { "id": 19604, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19603, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 19664, "src": "1521:7:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19602, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "1521:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "1520:9:129" }, "scope": 20320, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 19690, "nodeType": "FunctionDefinition", "src": "3330:531:129", "nodes": [], "body": { "id": 19689, "nodeType": "Block", "src": "3549:312:129", "nodes": [], "statements": [{ "expression": { "id": 19687, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 19678, "name": "spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19676, "src": "3724:9:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 19685, "name": "_timeStretch", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19673, "src": "3841:12:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "id": 19681, "name": "_effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19667, "src": "3784:23:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 19682, "name": "_bondReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19669, "src": "3809:13:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 19679, "name": "_initialVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19671, "src": "3736:23:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19680, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "3773:10:129", "memberName": "mulDivDown", "nodeType": "MemberAccess", "referencedDeclaration": 18834, "src": "3736:47:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 19683, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "3736:87:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19684, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "3837:3:129", "memberName": "pow", "nodeType": "MemberAccess", "referencedDeclaration": 18977, "src": "3736:104:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19686, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "3736:118:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "3724:130:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19688, "nodeType": "ExpressionStatement", "src": "3724:130:129" }] }, "documentation": { "id": 19665, "nodeType": "StructuredDocumentation", "src": "2741:584:129", "text": "@dev Calculates the spot price of bonds in terms of base. This\n      calculation underestimates the pool's spot price.\n @param _effectiveShareReserves The pool's effective share reserves. The\n        effective share reserves are a modified version of the share\n        reserves used when pricing trades.\n @param _bondReserves The pool's bond reserves.\n @param _initialVaultSharePrice The initial vault share price.\n @param _timeStretch The time stretch parameter.\n @return spotPrice The spot price of bonds in terms of base." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateSpotPrice", "nameLocation": "3339:18:129", "parameters": { "id": 19674, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19667, "mutability": "mutable", "name": "_effectiveShareReserves", "nameLocation": "3375:23:129", "nodeType": "VariableDeclaration", "scope": 19690, "src": "3367:31:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19666, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "3367:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19669, "mutability": "mutable", "name": "_bondReserves", "nameLocation": "3416:13:129", "nodeType": "VariableDeclaration", "scope": 19690, "src": "3408:21:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19668, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "3408:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19671, "mutability": "mutable", "name": "_initialVaultSharePrice", "nameLocation": "3447:23:129", "nodeType": "VariableDeclaration", "scope": 19690, "src": "3439:31:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19670, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "3439:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19673, "mutability": "mutable", "name": "_timeStretch", "nameLocation": "3488:12:129", "nodeType": "VariableDeclaration", "scope": 19690, "src": "3480:20:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19672, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "3480:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "3357:149:129" }, "returnParameters": { "id": 19677, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19676, "mutability": "mutable", "name": "spotPrice", "nameLocation": "3538:9:129", "nodeType": "VariableDeclaration", "scope": 19690, "src": "3530:17:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19675, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "3530:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "3529:19:129" }, "scope": 20320, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 19728, "nodeType": "FunctionDefinition", "src": "4497:945:129", "nodes": [], "body": { "id": 19727, "nodeType": "Block", "src": "4743:699:129", "nodes": [], "statements": [{ "assignments": [19707], "declarations": [{ "constant": false, "id": 19707, "mutability": "mutable", "name": "spotPrice", "nameLocation": "5067:9:129", "nodeType": "VariableDeclaration", "scope": 19727, "src": "5059:17:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19706, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "5059:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 19714, "initialValue": { "arguments": [{ "id": 19709, "name": "_effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19693, "src": "5111:23:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 19710, "name": "_bondReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19695, "src": "5148:13:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 19711, "name": "_initialVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19697, "src": "5175:23:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 19712, "name": "_timeStretch", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19701, "src": "5212:12:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "id": 19708, "name": "calculateSpotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19690, "src": "5079:18:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256,uint256) pure returns (uint256)" } }, "id": 19713, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "5079:155:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "5059:175:129" }, { "expression": { "arguments": [{ "arguments": [{ "id": 19722, "name": "_positionDuration", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19699, "src": "5393:17:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "hexValue": "333635", "id": 19723, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "5412:8:129", "subdenomination": "days", "typeDescriptions": { "typeIdentifier": "t_rational_31536000_by_1", "typeString": "int_const 31536000" }, "value": "365" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_rational_31536000_by_1", "typeString": "int_const 31536000" }], "expression": { "id": 19720, "name": "spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19707, "src": "5374:9:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19721, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "5384:8:129", "memberName": "mulDivUp", "nodeType": "MemberAccess", "referencedDeclaration": 18884, "src": "5374:18:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 19724, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "5374:47:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 19717, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 19715, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "5264:3:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 19716, "name": "spotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19707, "src": "5270:9:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "5264:15:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 19718, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "5263:17:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19719, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "5281:7:129", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "5263:25:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19725, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "5263:172:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 19705, "id": 19726, "nodeType": "Return", "src": "5244:191:129" }] }, "documentation": { "id": 19691, "nodeType": "StructuredDocumentation", "src": "3867:625:129", "text": "@dev Calculates the spot APR of the pool. This calculation\n      underestimates the pool's spot APR.\n @param _effectiveShareReserves The pool's effective share reserves. The\n        effective share reserves are a modified version of the share\n        reserves used when pricing trades.\n @param _bondReserves The pool's bond reserves.\n @param _initialVaultSharePrice The pool's initial vault share price.\n @param _positionDuration The amount of time until maturity in seconds.\n @param _timeStretch The time stretch parameter.\n @return apr The pool's spot APR." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateSpotAPR", "nameLocation": "4506:16:129", "parameters": { "id": 19702, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19693, "mutability": "mutable", "name": "_effectiveShareReserves", "nameLocation": "4540:23:129", "nodeType": "VariableDeclaration", "scope": 19728, "src": "4532:31:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19692, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "4532:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19695, "mutability": "mutable", "name": "_bondReserves", "nameLocation": "4581:13:129", "nodeType": "VariableDeclaration", "scope": 19728, "src": "4573:21:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19694, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "4573:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19697, "mutability": "mutable", "name": "_initialVaultSharePrice", "nameLocation": "4612:23:129", "nodeType": "VariableDeclaration", "scope": 19728, "src": "4604:31:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19696, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "4604:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19699, "mutability": "mutable", "name": "_positionDuration", "nameLocation": "4653:17:129", "nodeType": "VariableDeclaration", "scope": 19728, "src": "4645:25:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19698, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "4645:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19701, "mutability": "mutable", "name": "_timeStretch", "nameLocation": "4688:12:129", "nodeType": "VariableDeclaration", "scope": 19728, "src": "4680:20:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19700, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "4680:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "4522:184:129" }, "returnParameters": { "id": 19705, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19704, "mutability": "mutable", "name": "apr", "nameLocation": "4738:3:129", "nodeType": "VariableDeclaration", "scope": 19728, "src": "4730:11:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19703, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "4730:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "4729:13:129" }, "scope": 20320, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 19763, "nodeType": "FunctionDefinition", "src": "6050:574:129", "nodes": [], "body": { "id": 19762, "nodeType": "Block", "src": "6217:407:129", "nodes": [], "statements": [{ "assignments": [19739], "declarations": [{ "constant": false, "id": 19739, "mutability": "mutable", "name": "success", "nameLocation": "6232:7:129", "nodeType": "VariableDeclaration", "scope": 19762, "src": "6227:12:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "typeName": { "id": 19738, "name": "bool", "nodeType": "ElementaryTypeName", "src": "6227:4:129", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "visibility": "internal" }], "id": 19740, "nodeType": "VariableDeclarationStatement", "src": "6227:12:129" }, { "expression": { "id": 19748, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "components": [{ "id": 19741, "name": "effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19736, "src": "6250:22:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 19742, "name": "success", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19739, "src": "6274:7:129", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }], "id": 19743, "isConstant": false, "isInlineArray": false, "isLValue": true, "isPure": false, "lValueRequested": true, "nodeType": "TupleExpression", "src": "6249:33:129", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 19745, "name": "_shareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19731, "src": "6334:14:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 19746, "name": "_shareAdjustment", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19733, "src": "6362:16:129", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 19744, "name": "calculateEffectiveShareReservesSafe", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19800, "src": "6285:35:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_int256_$returns$_t_uint256_$_t_bool_$", "typeString": "function (uint256,int256) pure returns (uint256,bool)" } }, "id": 19747, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "6285:103:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "src": "6249:139:129", "typeDescriptions": { "typeIdentifier": "t_tuple$__$", "typeString": "tuple()" } }, "id": 19749, "nodeType": "ExpressionStatement", "src": "6249:139:129" }, { "condition": { "id": 19751, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "UnaryOperation", "operator": "!", "prefix": true, "src": "6402:8:129", "subExpression": { "id": 19750, "name": "success", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19739, "src": "6403:7:129", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "id": 19761, "nodeType": "IfStatement", "src": "6398:220:129", "trueBody": { "id": 19760, "nodeType": "Block", "src": "6412:206:129", "statements": [{ "expression": { "arguments": [{ "expression": { "expression": { "id": 19755, "name": "IHyperdrive", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 11143, "src": "6482:11:129", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_IHyperdrive_$11143_$", "typeString": "type(contract IHyperdrive)" } }, "id": 19756, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "6515:27:129", "memberName": "InsufficientLiquidityReason", "nodeType": "MemberAccess", "referencedDeclaration": 10996, "src": "6482:60:129", "typeDescriptions": { "typeIdentifier": "t_type$_t_enum$_InsufficientLiquidityReason_$10996_$", "typeString": "type(enum IHyperdrive.InsufficientLiquidityReason)" } }, "id": 19757, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "memberLocation": "6564:29:129", "memberName": "InvalidEffectiveShareReserves", "nodeType": "MemberAccess", "referencedDeclaration": 10993, "src": "6482:111:129", "typeDescriptions": { "typeIdentifier": "t_enum$_InsufficientLiquidityReason_$10996", "typeString": "enum IHyperdrive.InsufficientLiquidityReason" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_enum$_InsufficientLiquidityReason_$10996", "typeString": "enum IHyperdrive.InsufficientLiquidityReason" }], "expression": { "id": 19752, "name": "Errors", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18797, "src": "6426:6:129", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_Errors_$18797_$", "typeString": "type(library Errors)" } }, "id": 19754, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "6433:31:129", "memberName": "throwInsufficientLiquidityError", "nodeType": "MemberAccess", "referencedDeclaration": 18796, "src": "6426:38:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_enum$_InsufficientLiquidityReason_$10996_$returns$__$", "typeString": "function (enum IHyperdrive.InsufficientLiquidityReason) pure" } }, "id": 19758, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "6426:181:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_tuple$__$", "typeString": "tuple()" } }, "id": 19759, "nodeType": "ExpressionStatement", "src": "6426:181:129" }] } }] }, "documentation": { "id": 19729, "nodeType": "StructuredDocumentation", "src": "5448:597:129", "text": "@dev Calculates the effective share reserves. The effective share\n      reserves are the share reserves minus the share adjustment or\n      z - zeta. We use the effective share reserves as the z-parameter\n      to the YieldSpace pricing model. The share adjustment is used to\n      hold the pricing mechanism invariant under the flat component of\n      flat+curve trades.\n @param _shareReserves The pool's share reserves.\n @param _shareAdjustment The pool's share adjustment.\n @return effectiveShareReserves The effective share reserves." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateEffectiveShareReserves", "nameLocation": "6059:31:129", "parameters": { "id": 19734, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19731, "mutability": "mutable", "name": "_shareReserves", "nameLocation": "6108:14:129", "nodeType": "VariableDeclaration", "scope": 19763, "src": "6100:22:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19730, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "6100:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19733, "mutability": "mutable", "name": "_shareAdjustment", "nameLocation": "6139:16:129", "nodeType": "VariableDeclaration", "scope": 19763, "src": "6132:23:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" }, "typeName": { "id": 19732, "name": "int256", "nodeType": "ElementaryTypeName", "src": "6132:6:129", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "visibility": "internal" }], "src": "6090:71:129" }, "returnParameters": { "id": 19737, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19736, "mutability": "mutable", "name": "effectiveShareReserves", "nameLocation": "6193:22:129", "nodeType": "VariableDeclaration", "scope": 19763, "src": "6185:30:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19735, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "6185:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "6184:32:129" }, "scope": 20320, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 19800, "nodeType": "FunctionDefinition", "src": "7273:398:129", "nodes": [], "body": { "id": 19799, "nodeType": "Block", "src": "7427:244:129", "nodes": [], "statements": [{ "assignments": [19776], "declarations": [{ "constant": false, "id": 19776, "mutability": "mutable", "name": "effectiveShareReserves", "nameLocation": "7444:22:129", "nodeType": "VariableDeclaration", "scope": 19799, "src": "7437:29:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" }, "typeName": { "id": 19775, "name": "int256", "nodeType": "ElementaryTypeName", "src": "7437:6:129", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "visibility": "internal" }], "id": 19782, "initialValue": { "commonType": { "typeIdentifier": "t_int256", "typeString": "int256" }, "id": 19781, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 19777, "name": "_shareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19766, "src": "7469:14:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19778, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "7484:8:129", "memberName": "toInt256", "nodeType": "MemberAccess", "referencedDeclaration": 22442, "src": "7469:23:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$returns$_t_int256_$attached_to$_t_uint256_$", "typeString": "function (uint256) pure returns (int256)" } }, "id": 19779, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "7469:25:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 19780, "name": "_shareAdjustment", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19768, "src": "7509:16:129", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "src": "7469:56:129", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "nodeType": "VariableDeclarationStatement", "src": "7437:88:129" }, { "condition": { "commonType": { "typeIdentifier": "t_int256", "typeString": "int256" }, "id": 19785, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 19783, "name": "effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19776, "src": "7539:22:129", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "nodeType": "BinaryOperation", "operator": "<", "rightExpression": { "hexValue": "30", "id": 19784, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "7564:1:129", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }, "src": "7539:26:129", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "id": 19791, "nodeType": "IfStatement", "src": "7535:74:129", "trueBody": { "id": 19790, "nodeType": "Block", "src": "7567:42:129", "statements": [{ "expression": { "components": [{ "hexValue": "30", "id": 19786, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "7589:1:129", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }, { "hexValue": "66616c7365", "id": 19787, "isConstant": false, "isLValue": false, "isPure": true, "kind": "bool", "lValueRequested": false, "nodeType": "Literal", "src": "7592:5:129", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "value": "false" }], "id": 19788, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "TupleExpression", "src": "7588:10:129", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_rational_0_by_1_$_t_bool_$", "typeString": "tuple(int_const 0,bool)" } }, "functionReturnParameters": 19774, "id": 19789, "nodeType": "Return", "src": "7581:17:129" }] } }, { "expression": { "components": [{ "arguments": [{ "id": 19794, "name": "effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19776, "src": "7634:22:129", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_int256", "typeString": "int256" }], "id": 19793, "isConstant": false, "isLValue": false, "isPure": true, "lValueRequested": false, "nodeType": "ElementaryTypeNameExpression", "src": "7626:7:129", "typeDescriptions": { "typeIdentifier": "t_type$_t_uint256_$", "typeString": "type(uint256)" }, "typeName": { "id": 19792, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "7626:7:129", "typeDescriptions": {} } }, "id": 19795, "isConstant": false, "isLValue": false, "isPure": false, "kind": "typeConversion", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "7626:31:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "hexValue": "74727565", "id": 19796, "isConstant": false, "isLValue": false, "isPure": true, "kind": "bool", "lValueRequested": false, "nodeType": "Literal", "src": "7659:4:129", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "value": "true" }], "id": 19797, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "7625:39:129", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_bool_$", "typeString": "tuple(uint256,bool)" } }, "functionReturnParameters": 19774, "id": 19798, "nodeType": "Return", "src": "7618:46:129" }] }, "documentation": { "id": 19764, "nodeType": "StructuredDocumentation", "src": "6630:638:129", "text": "@dev Calculates the effective share reserves. The effective share\n      reserves are the share reserves minus the share adjustment or\n      z - zeta. We use the effective share reserves as the z-parameter\n      to the YieldSpace pricing model. The share adjustment is used to\n      hold the pricing mechanism invariant under the flat component of\n      flat+curve trades.\n @param _shareReserves The pool's share reserves.\n @param _shareAdjustment The pool's share adjustment.\n @return The effective share reserves.\n @return A flag indicating if the calculation succeeded." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateEffectiveShareReservesSafe", "nameLocation": "7282:35:129", "parameters": { "id": 19769, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19766, "mutability": "mutable", "name": "_shareReserves", "nameLocation": "7335:14:129", "nodeType": "VariableDeclaration", "scope": 19800, "src": "7327:22:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19765, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "7327:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19768, "mutability": "mutable", "name": "_shareAdjustment", "nameLocation": "7366:16:129", "nodeType": "VariableDeclaration", "scope": 19800, "src": "7359:23:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" }, "typeName": { "id": 19767, "name": "int256", "nodeType": "ElementaryTypeName", "src": "7359:6:129", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "visibility": "internal" }], "src": "7317:71:129" }, "returnParameters": { "id": 19774, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19771, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 19800, "src": "7412:7:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19770, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "7412:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19773, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 19800, "src": "7421:4:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "typeName": { "id": 19772, "name": "bool", "nodeType": "ElementaryTypeName", "src": "7421:4:129", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "visibility": "internal" }], "src": "7411:15:129" }, "scope": 20320, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 19867, "nodeType": "FunctionDefinition", "src": "8756:1272:129", "nodes": [], "body": { "id": 19866, "nodeType": "Block", "src": "9014:1014:129", "nodes": [], "statements": [{ "assignments": [19817], "declarations": [{ "constant": false, "id": 19817, "mutability": "mutable", "name": "t", "nameLocation": "9226:1:129", "nodeType": "VariableDeclaration", "scope": 19866, "src": "9218:9:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19816, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "9218:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 19822, "initialValue": { "arguments": [{ "hexValue": "333635", "id": 19820, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "9256:8:129", "subdenomination": "days", "typeDescriptions": { "typeIdentifier": "t_rational_31536000_by_1", "typeString": "int_const 31536000" }, "value": "365" }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_rational_31536000_by_1", "typeString": "int_const 31536000" }], "expression": { "id": 19818, "name": "_positionDuration", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19809, "src": "9230:17:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19819, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "9248:7:129", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "9230:25:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19821, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "9230:35:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "9218:47:129" }, { "assignments": [19824], "declarations": [{ "constant": false, "id": 19824, "mutability": "mutable", "name": "inner", "nameLocation": "9413:5:129", "nodeType": "VariableDeclaration", "scope": 19866, "src": "9405:13:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19823, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "9405:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 19831, "initialValue": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 19830, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 19825, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "9421:3:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "arguments": [{ "id": 19828, "name": "t", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19817, "src": "9440:1:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 19826, "name": "_apr", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19807, "src": "9427:4:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19827, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "9432:7:129", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "9427:12:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19829, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "9427:15:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "9421:21:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "9405:37:129" }, { "condition": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 19834, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 19832, "name": "inner", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19824, "src": "9456:5:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": ">=", "rightExpression": { "id": 19833, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "9465:3:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "9456:12:129", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "falseBody": { "id": 19856, "nodeType": "Block", "src": "9616:136:129", "statements": [{ "expression": { "id": 19854, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 19846, "name": "inner", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19824, "src": "9699:5:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "arguments": [{ "id": 19851, "name": "_timeStretch", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19811, "src": "9727:12:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 19849, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "9717:3:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19850, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "9721:5:129", "memberName": "divUp", "nodeType": "MemberAccess", "referencedDeclaration": 18920, "src": "9717:9:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19852, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "9717:23:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 19847, "name": "inner", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19824, "src": "9707:5:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19848, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "9713:3:129", "memberName": "pow", "nodeType": "MemberAccess", "referencedDeclaration": 18977, "src": "9707:9:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19853, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "9707:34:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "9699:42:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19855, "nodeType": "ExpressionStatement", "src": "9699:42:129" }] }, "id": 19857, "nodeType": "IfStatement", "src": "9452:300:129", "trueBody": { "id": 19845, "nodeType": "Block", "src": "9470:140:129", "statements": [{ "expression": { "id": 19843, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 19835, "name": "inner", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19824, "src": "9555:5:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "arguments": [{ "id": 19840, "name": "_timeStretch", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19811, "src": "9585:12:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 19838, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "9573:3:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19839, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "9577:7:129", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "9573:11:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19841, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "9573:25:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 19836, "name": "inner", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19824, "src": "9563:5:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19837, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "9569:3:129", "memberName": "pow", "nodeType": "MemberAccess", "referencedDeclaration": 18977, "src": "9563:9:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19842, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "9563:36:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "9555:44:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19844, "nodeType": "ExpressionStatement", "src": "9555:44:129" }] } }, { "expression": { "arguments": [{ "id": 19863, "name": "inner", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19824, "src": "10002:5:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "id": 19860, "name": "_effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19803, "src": "9952:23:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 19858, "name": "_initialVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19805, "src": "9920:23:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19859, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "9944:7:129", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "9920:31:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19861, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "9920:56:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19862, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "9977:7:129", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "9920:64:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19864, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "9920:101:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 19815, "id": 19865, "nodeType": "Return", "src": "9901:120:129" }] }, "documentation": { "id": 19801, "nodeType": "StructuredDocumentation", "src": "7677:1074:129", "text": "@dev Calculates the initial bond reserves assuming that the initial LP\n      receives LP shares amounting to c * z + y. Throughout the rest of\n      the codebase, the bond reserves used include the LP share\n      adjustment specified in YieldSpace. The bond reserves returned by\n      this function are unadjusted which makes it easier to calculate the\n      initial LP shares. This calculation underestimates the pool's\n      initial bond reserves.\n @param _effectiveShareReserves The pool's effective share reserves. The\n        effective share reserves are a modified version of the share\n        reserves used when pricing trades.\n @param _initialVaultSharePrice The pool's initial vault share price.\n @param _apr The pool's APR.\n @param _positionDuration The amount of time until maturity in seconds.\n @param _timeStretch The time stretch parameter.\n @return bondReserves The bond reserves (without adjustment) that make\n         the pool have a specified APR." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateInitialBondReserves", "nameLocation": "8765:28:129", "parameters": { "id": 19812, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19803, "mutability": "mutable", "name": "_effectiveShareReserves", "nameLocation": "8811:23:129", "nodeType": "VariableDeclaration", "scope": 19867, "src": "8803:31:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19802, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "8803:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19805, "mutability": "mutable", "name": "_initialVaultSharePrice", "nameLocation": "8852:23:129", "nodeType": "VariableDeclaration", "scope": 19867, "src": "8844:31:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19804, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "8844:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19807, "mutability": "mutable", "name": "_apr", "nameLocation": "8893:4:129", "nodeType": "VariableDeclaration", "scope": 19867, "src": "8885:12:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19806, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "8885:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19809, "mutability": "mutable", "name": "_positionDuration", "nameLocation": "8915:17:129", "nodeType": "VariableDeclaration", "scope": 19867, "src": "8907:25:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19808, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "8907:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19811, "mutability": "mutable", "name": "_timeStretch", "nameLocation": "8950:12:129", "nodeType": "VariableDeclaration", "scope": 19867, "src": "8942:20:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19810, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "8942:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "8793:175:129" }, "returnParameters": { "id": 19815, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19814, "mutability": "mutable", "name": "bondReserves", "nameLocation": "9000:12:129", "nodeType": "VariableDeclaration", "scope": 19867, "src": "8992:20:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19813, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "8992:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "8991:22:129" }, "scope": 20320, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 19919, "nodeType": "FunctionDefinition", "src": "11517:1660:129", "nodes": [], "body": { "id": 19918, "nodeType": "Block", "src": "11799:1378:129", "nodes": [], "statements": [{ "assignments": [19886], "declarations": [{ "constant": false, "id": 19886, "mutability": "mutable", "name": "totalValue", "nameLocation": "12226:10:129", "nodeType": "VariableDeclaration", "scope": 19918, "src": "12218:18:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19885, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "12218:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 19895, "initialValue": { "arguments": [{ "id": 19893, "name": "_vaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19878, "src": "12337:16:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "id": 19889, "name": "_closeVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19876, "src": "12273:21:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 19890, "name": "_openVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19874, "src": "12296:20:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 19887, "name": "_bondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19870, "src": "12239:11:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19888, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "12264:8:129", "memberName": "mulDivUp", "nodeType": "MemberAccess", "referencedDeclaration": 18884, "src": "12239:33:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 19891, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "12239:78:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19892, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "12331:5:129", "memberName": "divUp", "nodeType": "MemberAccess", "referencedDeclaration": 18920, "src": "12239:97:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19894, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "12239:115:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "12218:136:129" }, { "expression": { "id": 19902, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 19896, "name": "totalValue", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19886, "src": "12588:10:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "+=", "rightHandSide": { "arguments": [{ "id": 19899, "name": "_flatFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19880, "src": "12623:8:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 19900, "name": "_vaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19878, "src": "12633:16:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 19897, "name": "_bondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19870, "src": "12602:11:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19898, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "12614:8:129", "memberName": "mulDivUp", "nodeType": "MemberAccess", "referencedDeclaration": 18884, "src": "12602:20:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 19901, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "12602:48:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "12588:62:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19903, "nodeType": "ExpressionStatement", "src": "12588:62:129" }, { "condition": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 19906, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 19904, "name": "totalValue", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19886, "src": "12953:10:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": ">", "rightExpression": { "id": 19905, "name": "_shareAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19872, "src": "12966:12:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "12953:25:129", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "id": 19915, "nodeType": "IfStatement", "src": "12949:191:129", "trueBody": { "id": 19914, "nodeType": "Block", "src": "12980:160:129", "statements": [{ "id": 19913, "nodeType": "UncheckedBlock", "src": "13046:84:129", "statements": [{ "expression": { "id": 19911, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 19907, "name": "shareProceeds", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19883, "src": "13074:13:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 19910, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 19908, "name": "totalValue", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19886, "src": "13090:10:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 19909, "name": "_shareAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19872, "src": "13103:12:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "13090:25:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "13074:41:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19912, "nodeType": "ExpressionStatement", "src": "13074:41:129" }] }] } }, { "expression": { "id": 19916, "name": "shareProceeds", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19883, "src": "13157:13:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 19884, "id": 19917, "nodeType": "Return", "src": "13150:20:129" }] }, "documentation": { "id": 19868, "nodeType": "StructuredDocumentation", "src": "10034:1478:129", "text": "@dev Calculates the proceeds in shares of closing a short position. This\n      takes into account the trading profits, the interest that was\n      earned by the short, the flat fee the short pays, and the amount of\n      margin that was released by closing the short. The math for the\n      short's proceeds in base is given by:\n      proceeds = (1 + flat_fee) * dy - c * dz + (c1 - c0) * (dy / c0)\n               = (1 + flat_fee) * dy - c * dz + (c1 / c0) * dy - dy\n               = (c1 / c0 + flat_fee) * dy - c * dz\n      We convert the proceeds to shares by dividing by the current vault\n      share price. In the event that the interest is negative and\n      outweighs the trading profits and margin released, the short's\n      proceeds are marked to zero.\n      This variant of the calculation overestimates the short proceeds.\n @param _bondAmount The amount of bonds underlying the closed short.\n @param _shareAmount The amount of shares that it costs to close the\n                     short.\n @param _openVaultSharePrice The vault share price at the short's open.\n @param _closeVaultSharePrice The vault share price at the short's close.\n @param _vaultSharePrice The current vault share price.\n @param _flatFee The flat fee currently within the pool\n @return shareProceeds The short proceeds in shares." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateShortProceedsUp", "nameLocation": "11526:24:129", "parameters": { "id": 19881, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19870, "mutability": "mutable", "name": "_bondAmount", "nameLocation": "11568:11:129", "nodeType": "VariableDeclaration", "scope": 19919, "src": "11560:19:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19869, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "11560:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19872, "mutability": "mutable", "name": "_shareAmount", "nameLocation": "11597:12:129", "nodeType": "VariableDeclaration", "scope": 19919, "src": "11589:20:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19871, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "11589:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19874, "mutability": "mutable", "name": "_openVaultSharePrice", "nameLocation": "11627:20:129", "nodeType": "VariableDeclaration", "scope": 19919, "src": "11619:28:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19873, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "11619:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19876, "mutability": "mutable", "name": "_closeVaultSharePrice", "nameLocation": "11665:21:129", "nodeType": "VariableDeclaration", "scope": 19919, "src": "11657:29:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19875, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "11657:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19878, "mutability": "mutable", "name": "_vaultSharePrice", "nameLocation": "11704:16:129", "nodeType": "VariableDeclaration", "scope": 19919, "src": "11696:24:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19877, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "11696:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19880, "mutability": "mutable", "name": "_flatFee", "nameLocation": "11738:8:129", "nodeType": "VariableDeclaration", "scope": 19919, "src": "11730:16:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19879, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "11730:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "11550:202:129" }, "returnParameters": { "id": 19884, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19883, "mutability": "mutable", "name": "shareProceeds", "nameLocation": "11784:13:129", "nodeType": "VariableDeclaration", "scope": 19919, "src": "11776:21:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19882, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "11776:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "11775:23:129" }, "scope": 20320, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 19971, "nodeType": "FunctionDefinition", "src": "14667:1674:129", "nodes": [], "body": { "id": 19970, "nodeType": "Block", "src": "14951:1390:129", "nodes": [], "statements": [{ "assignments": [19938], "declarations": [{ "constant": false, "id": 19938, "mutability": "mutable", "name": "totalValue", "nameLocation": "15381:10:129", "nodeType": "VariableDeclaration", "scope": 19970, "src": "15373:18:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19937, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "15373:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "id": 19947, "initialValue": { "arguments": [{ "id": 19945, "name": "_vaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19930, "src": "15496:16:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "id": 19941, "name": "_closeVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19928, "src": "15430:21:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 19942, "name": "_openVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19926, "src": "15453:20:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 19939, "name": "_bondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19922, "src": "15394:11:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19940, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "15419:10:129", "memberName": "mulDivDown", "nodeType": "MemberAccess", "referencedDeclaration": 18834, "src": "15394:35:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 19943, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "15394:80:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19944, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "15488:7:129", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "15394:101:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19946, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "15394:119:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "VariableDeclarationStatement", "src": "15373:140:129" }, { "expression": { "id": 19954, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 19948, "name": "totalValue", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19938, "src": "15750:10:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "+=", "rightHandSide": { "arguments": [{ "id": 19951, "name": "_flatFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19932, "src": "15787:8:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 19952, "name": "_vaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19930, "src": "15797:16:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 19949, "name": "_bondAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19922, "src": "15764:11:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19950, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "15776:10:129", "memberName": "mulDivDown", "nodeType": "MemberAccess", "referencedDeclaration": 18834, "src": "15764:22:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 19953, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "15764:50:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "15750:64:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19955, "nodeType": "ExpressionStatement", "src": "15750:64:129" }, { "condition": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 19958, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 19956, "name": "totalValue", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19938, "src": "16117:10:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": ">", "rightExpression": { "id": 19957, "name": "_shareAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19924, "src": "16130:12:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "16117:25:129", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "id": 19967, "nodeType": "IfStatement", "src": "16113:191:129", "trueBody": { "id": 19966, "nodeType": "Block", "src": "16144:160:129", "statements": [{ "id": 19965, "nodeType": "UncheckedBlock", "src": "16210:84:129", "statements": [{ "expression": { "id": 19963, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 19959, "name": "shareProceeds", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19935, "src": "16238:13:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 19962, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 19960, "name": "totalValue", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19938, "src": "16254:10:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 19961, "name": "_shareAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19924, "src": "16267:12:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "16254:25:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "16238:41:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19964, "nodeType": "ExpressionStatement", "src": "16238:41:129" }] }] } }, { "expression": { "id": 19968, "name": "shareProceeds", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19935, "src": "16321:13:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 19936, "id": 19969, "nodeType": "Return", "src": "16314:20:129" }] }, "documentation": { "id": 19920, "nodeType": "StructuredDocumentation", "src": "13183:1479:129", "text": "@dev Calculates the proceeds in shares of closing a short position. This\n      takes into account the trading profits, the interest that was\n      earned by the short, the flat fee the short pays, and the amount of\n      margin that was released by closing the short. The math for the\n      short's proceeds in base is given by:\n      proceeds = (1 + flat_fee) * dy - c * dz + (c1 - c0) * (dy / c0)\n               = (1 + flat_fee) * dy - c * dz + (c1 / c0) * dy - dy\n               = (c1 / c0 + flat_fee) * dy - c * dz\n      We convert the proceeds to shares by dividing by the current vault\n      share price. In the event that the interest is negative and\n      outweighs the trading profits and margin released, the short's\n      proceeds are marked to zero.\n      This variant of the calculation underestimates the short proceeds.\n @param _bondAmount The amount of bonds underlying the closed short.\n @param _shareAmount The amount of shares that it costs to close the\n                     short.\n @param _openVaultSharePrice The vault share price at the short's open.\n @param _closeVaultSharePrice The vault share price at the short's close.\n @param _vaultSharePrice The current vault share price.\n @param _flatFee The flat fee currently within the pool\n @return shareProceeds The short proceeds in shares." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateShortProceedsDown", "nameLocation": "14676:26:129", "parameters": { "id": 19933, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19922, "mutability": "mutable", "name": "_bondAmount", "nameLocation": "14720:11:129", "nodeType": "VariableDeclaration", "scope": 19971, "src": "14712:19:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19921, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "14712:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19924, "mutability": "mutable", "name": "_shareAmount", "nameLocation": "14749:12:129", "nodeType": "VariableDeclaration", "scope": 19971, "src": "14741:20:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19923, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "14741:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19926, "mutability": "mutable", "name": "_openVaultSharePrice", "nameLocation": "14779:20:129", "nodeType": "VariableDeclaration", "scope": 19971, "src": "14771:28:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19925, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "14771:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19928, "mutability": "mutable", "name": "_closeVaultSharePrice", "nameLocation": "14817:21:129", "nodeType": "VariableDeclaration", "scope": 19971, "src": "14809:29:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19927, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "14809:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19930, "mutability": "mutable", "name": "_vaultSharePrice", "nameLocation": "14856:16:129", "nodeType": "VariableDeclaration", "scope": 19971, "src": "14848:24:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19929, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "14848:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19932, "mutability": "mutable", "name": "_flatFee", "nameLocation": "14890:8:129", "nodeType": "VariableDeclaration", "scope": 19971, "src": "14882:16:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19931, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "14882:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "14702:202:129" }, "returnParameters": { "id": 19936, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19935, "mutability": "mutable", "name": "shareProceeds", "nameLocation": "14936:13:129", "nodeType": "VariableDeclaration", "scope": 19971, "src": "14928:21:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19934, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "14928:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "14927:23:129" }, "scope": 20320, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 20007, "nodeType": "FunctionDefinition", "src": "17063:541:129", "nodes": [], "body": { "id": 20006, "nodeType": "Block", "src": "17229:375:129", "nodes": [], "statements": [{ "expression": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 20003, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 19988, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "17437:3:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "+", "rightExpression": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 20001, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 19999, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "17547:3:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 20000, "name": "_flatFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19978, "src": "17553:8:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "17547:14:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 19996, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "arguments": [{ "id": 19993, "name": "_startingSpotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19974, "src": "17489:18:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 19991, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "17479:3:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19992, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "17483:5:129", "memberName": "divUp", "nodeType": "MemberAccess", "referencedDeclaration": 18920, "src": "17479:9:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19994, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "17479:29:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 19995, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "17511:3:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "17479:35:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 19989, "name": "_curveFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19976, "src": "17463:9:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19990, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "17473:5:129", "memberName": "mulUp", "nodeType": "MemberAccess", "referencedDeclaration": 18902, "src": "17463:15:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 19997, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "17463:52:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19998, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "17516:5:129", "memberName": "mulUp", "nodeType": "MemberAccess", "referencedDeclaration": 18902, "src": "17463:58:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 20002, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "17463:120:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "17437:146:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "components": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 19985, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 19983, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "17328:3:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 19984, "name": "_flatFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 19978, "src": "17334:8:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "17328:14:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 19986, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "17327:16:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 19987, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "17344:7:129", "memberName": "divDown", "nodeType": "MemberAccess", "referencedDeclaration": 18870, "src": "17327:24:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 20004, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "17327:270:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 19982, "id": 20005, "nodeType": "Return", "src": "17308:289:129" }] }, "documentation": { "id": 19972, "nodeType": "StructuredDocumentation", "src": "16347:711:129", "text": "@dev Since traders pay a curve fee when they open longs on Hyperdrive,\n      it is possible for traders to receive a negative interest rate even\n      if curve's spot price is less than or equal to 1.\n      Given the curve fee `phi_c` and the starting spot price `p_0`, the\n      maximum spot price is given by:\n      p_max = (1 - phi_f) / (1 + phi_c * (1 / p_0 - 1) * (1 - phi_f))\n      We underestimate the maximum spot price to be conservative.\n @param _startingSpotPrice The spot price at the start of the trade.\n @param _curveFee The curve fee.\n @param _flatFee The flat fee.\n @return The maximum spot price." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateOpenLongMaxSpotPrice", "nameLocation": "17072:29:129", "parameters": { "id": 19979, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19974, "mutability": "mutable", "name": "_startingSpotPrice", "nameLocation": "17119:18:129", "nodeType": "VariableDeclaration", "scope": 20007, "src": "17111:26:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19973, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "17111:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19976, "mutability": "mutable", "name": "_curveFee", "nameLocation": "17155:9:129", "nodeType": "VariableDeclaration", "scope": 20007, "src": "17147:17:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19975, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "17147:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 19978, "mutability": "mutable", "name": "_flatFee", "nameLocation": "17182:8:129", "nodeType": "VariableDeclaration", "scope": 20007, "src": "17174:16:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19977, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "17174:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "17101:95:129" }, "returnParameters": { "id": 19982, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 19981, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 20007, "src": "17220:7:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 19980, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "17220:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "17219:9:129" }, "scope": 20320, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 20027, "nodeType": "FunctionDefinition", "src": "18256:284:129", "nodes": [], "body": { "id": 20026, "nodeType": "Block", "src": "18398:142:129", "nodes": [], "statements": [{ "expression": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 20024, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 20017, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "18486:3:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 20022, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 20020, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "18508:3:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 20021, "name": "_startingSpotPrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20010, "src": "18514:18:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "18508:24:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 20018, "name": "_curveFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20012, "src": "18492:9:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20019, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "18502:5:129", "memberName": "mulUp", "nodeType": "MemberAccess", "referencedDeclaration": 18902, "src": "18492:15:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 20023, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "18492:41:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "18486:47:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 20016, "id": 20025, "nodeType": "Return", "src": "18479:54:129" }] }, "documentation": { "id": 20008, "nodeType": "StructuredDocumentation", "src": "17610:641:129", "text": "@dev Since traders pay a curve fee when they close shorts on Hyperdrive,\n      it is possible for traders to receive a negative interest rate even\n      if curve's spot price is less than or equal to 1.\n      Given the curve fee `phi_c` and the starting spot price `p_0`, the\n      maximum spot price is given by:\n      p_max = 1 - phi_c * (1 - p_0)\n      We underestimate the maximum spot price to be conservative.\n @param _startingSpotPrice The spot price at the start of the trade.\n @param _curveFee The curve fee.\n @return The maximum spot price." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateCloseShortMaxSpotPrice", "nameLocation": "18265:31:129", "parameters": { "id": 20013, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 20010, "mutability": "mutable", "name": "_startingSpotPrice", "nameLocation": "18314:18:129", "nodeType": "VariableDeclaration", "scope": 20027, "src": "18306:26:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20009, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "18306:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20012, "mutability": "mutable", "name": "_curveFee", "nameLocation": "18350:9:129", "nodeType": "VariableDeclaration", "scope": 20027, "src": "18342:17:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20011, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "18342:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "18296:69:129" }, "returnParameters": { "id": 20016, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 20015, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 20027, "src": "18389:7:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20014, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "18389:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "18388:9:129" }, "scope": 20320, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 20058, "nodeType": "FunctionDefinition", "src": "19247:892:129", "nodes": [], "body": { "id": 20057, "nodeType": "Block", "src": "19519:620:129", "nodes": [], "statements": [{ "expression": { "arguments": [{ "id": 20047, "name": "_effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20030, "src": "19714:23:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 20048, "name": "_bondReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20032, "src": "19755:13:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 20049, "name": "_shareAmount", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20034, "src": "19786:12:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 20052, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 20050, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "20025:3:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 20051, "name": "_timeStretch", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20036, "src": "20031:12:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "20025:18:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 20053, "name": "_vaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20038, "src": "20061:16:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 20054, "name": "_initialVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20040, "src": "20095:23:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 20045, "name": "YieldSpaceMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 23422, "src": "19647:14:129", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_YieldSpaceMath_$23422_$", "typeString": "type(library YieldSpaceMath)" } }, "id": 20046, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "19662:34:129", "memberName": "calculateBondsOutGivenSharesInDown", "nodeType": "MemberAccess", "referencedDeclaration": 22574, "src": "19647:49:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256,uint256,uint256,uint256) pure returns (uint256)" } }, "id": 20055, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "19647:485:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 20044, "id": 20056, "nodeType": "Return", "src": "19628:504:129" }] }, "documentation": { "id": 20028, "nodeType": "StructuredDocumentation", "src": "18546:696:129", "text": "@dev Calculates the number of bonds a user will receive when opening a\n      long position.\n @param _effectiveShareReserves The pool's effective share reserves. The\n        effective share reserves are a modified version of the share\n        reserves used when pricing trades.\n @param _bondReserves The pool's bond reserves.\n @param _shareAmount The amount of shares the user is depositing.\n @param _timeStretch The time stretch parameter.\n @param _vaultSharePrice The vault share price.\n @param _initialVaultSharePrice The initial vault share price.\n @return bondReservesDelta The bonds paid by the reserves in the trade." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateOpenLong", "nameLocation": "19256:17:129", "parameters": { "id": 20041, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 20030, "mutability": "mutable", "name": "_effectiveShareReserves", "nameLocation": "19291:23:129", "nodeType": "VariableDeclaration", "scope": 20058, "src": "19283:31:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20029, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "19283:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20032, "mutability": "mutable", "name": "_bondReserves", "nameLocation": "19332:13:129", "nodeType": "VariableDeclaration", "scope": 20058, "src": "19324:21:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20031, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "19324:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20034, "mutability": "mutable", "name": "_shareAmount", "nameLocation": "19363:12:129", "nodeType": "VariableDeclaration", "scope": 20058, "src": "19355:20:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20033, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "19355:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20036, "mutability": "mutable", "name": "_timeStretch", "nameLocation": "19393:12:129", "nodeType": "VariableDeclaration", "scope": 20058, "src": "19385:20:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20035, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "19385:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20038, "mutability": "mutable", "name": "_vaultSharePrice", "nameLocation": "19423:16:129", "nodeType": "VariableDeclaration", "scope": 20058, "src": "19415:24:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20037, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "19415:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20040, "mutability": "mutable", "name": "_initialVaultSharePrice", "nameLocation": "19457:23:129", "nodeType": "VariableDeclaration", "scope": 20058, "src": "19449:31:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20039, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "19449:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "19273:213:129" }, "returnParameters": { "id": 20044, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 20043, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 20058, "src": "19510:7:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20042, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "19510:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "19509:9:129" }, "scope": 20320, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 20123, "nodeType": "FunctionDefinition", "src": "21120:2126:129", "nodes": [], "body": { "id": 20122, "nodeType": "Block", "src": "21569:1677:129", "nodes": [], "statements": [{ "expression": { "id": 20090, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 20082, "name": "shareProceeds", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20080, "src": "22144:13:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 20087, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 20085, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "22194:3:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 20086, "name": "_normalizedTimeRemaining", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20067, "src": "22200:24:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "22194:30:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 20088, "name": "_vaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20071, "src": "22238:16:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 20083, "name": "_amountIn", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20065, "src": "22160:9:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20084, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "22170:10:129", "memberName": "mulDivDown", "nodeType": "MemberAccess", "referencedDeclaration": 18834, "src": "22160:20:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 20089, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "22160:104:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "22144:120:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20091, "nodeType": "ExpressionStatement", "src": "22144:120:129" }, { "condition": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 20094, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 20092, "name": "_normalizedTimeRemaining", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20067, "src": "22278:24:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": ">", "rightExpression": { "hexValue": "30", "id": 20093, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "22305:1:129", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }, "src": "22278:28:129", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "id": 20121, "nodeType": "IfStatement", "src": "22274:966:129", "trueBody": { "id": 20120, "nodeType": "Block", "src": "22308:932:129", "statements": [{ "expression": { "id": 20100, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 20095, "name": "bondCurveDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20078, "src": "22497:14:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 20098, "name": "_normalizedTimeRemaining", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20067, "src": "22532:24:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 20096, "name": "_amountIn", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20065, "src": "22514:9:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20097, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "22524:7:129", "memberName": "mulDown", "nodeType": "MemberAccess", "referencedDeclaration": 18852, "src": "22514:17:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 20099, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "22514:43:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "22497:60:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20101, "nodeType": "ExpressionStatement", "src": "22497:60:129" }, { "expression": { "id": 20114, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 20102, "name": "shareCurveDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20076, "src": "22678:15:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 20105, "name": "_effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20061, "src": "22763:23:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 20106, "name": "_bondReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20063, "src": "22804:13:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 20107, "name": "bondCurveDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20078, "src": "22835:14:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 20110, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 20108, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "23076:3:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 20109, "name": "_timeStretch", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20069, "src": "23082:12:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "23076:18:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 20111, "name": "_vaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20071, "src": "23112:16:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 20112, "name": "_initialVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20073, "src": "23146:23:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 20103, "name": "YieldSpaceMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 23422, "src": "22696:14:129", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_YieldSpaceMath_$23422_$", "typeString": "type(library YieldSpaceMath)" } }, "id": 20104, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "22711:34:129", "memberName": "calculateSharesOutGivenBondsInDown", "nodeType": "MemberAccess", "referencedDeclaration": 22932, "src": "22696:49:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256,uint256,uint256,uint256) pure returns (uint256)" } }, "id": 20113, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "22696:487:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "22678:505:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20115, "nodeType": "ExpressionStatement", "src": "22678:505:129" }, { "expression": { "id": 20118, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 20116, "name": "shareProceeds", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20080, "src": "23197:13:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "+=", "rightHandSide": { "id": 20117, "name": "shareCurveDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20076, "src": "23214:15:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "23197:32:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20119, "nodeType": "ExpressionStatement", "src": "23197:32:129" }] } }] }, "documentation": { "id": 20059, "nodeType": "StructuredDocumentation", "src": "20145:970:129", "text": "@dev Calculates the amount of shares a user will receive when closing a\n      long position.\n @param _effectiveShareReserves The pool's effective share reserves. The\n        effective share reserves are a modified version of the share\n        reserves used when pricing trades.\n @param _bondReserves The pool's bond reserves.\n @param _amountIn The amount of bonds the user is closing.\n @param _normalizedTimeRemaining The normalized time remaining of the\n        position.\n @param _timeStretch The time stretch parameter.\n @param _vaultSharePrice The vault share price.\n @param _initialVaultSharePrice The vault share price when the pool was\n        deployed.\n @return shareCurveDelta The shares paid by the reserves in the trade.\n @return bondCurveDelta The bonds paid to the reserves in the trade.\n @return shareProceeds The shares that the user will receive." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateCloseLong", "nameLocation": "21129:18:129", "parameters": { "id": 20074, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 20061, "mutability": "mutable", "name": "_effectiveShareReserves", "nameLocation": "21165:23:129", "nodeType": "VariableDeclaration", "scope": 20123, "src": "21157:31:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20060, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "21157:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20063, "mutability": "mutable", "name": "_bondReserves", "nameLocation": "21206:13:129", "nodeType": "VariableDeclaration", "scope": 20123, "src": "21198:21:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20062, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "21198:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20065, "mutability": "mutable", "name": "_amountIn", "nameLocation": "21237:9:129", "nodeType": "VariableDeclaration", "scope": 20123, "src": "21229:17:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20064, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "21229:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20067, "mutability": "mutable", "name": "_normalizedTimeRemaining", "nameLocation": "21264:24:129", "nodeType": "VariableDeclaration", "scope": 20123, "src": "21256:32:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20066, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "21256:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20069, "mutability": "mutable", "name": "_timeStretch", "nameLocation": "21306:12:129", "nodeType": "VariableDeclaration", "scope": 20123, "src": "21298:20:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20068, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "21298:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20071, "mutability": "mutable", "name": "_vaultSharePrice", "nameLocation": "21336:16:129", "nodeType": "VariableDeclaration", "scope": 20123, "src": "21328:24:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20070, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "21328:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20073, "mutability": "mutable", "name": "_initialVaultSharePrice", "nameLocation": "21370:23:129", "nodeType": "VariableDeclaration", "scope": 20123, "src": "21362:31:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20072, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "21362:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "21147:252:129" }, "returnParameters": { "id": 20081, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 20076, "mutability": "mutable", "name": "shareCurveDelta", "nameLocation": "21468:15:129", "nodeType": "VariableDeclaration", "scope": 20123, "src": "21460:23:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20075, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "21460:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20078, "mutability": "mutable", "name": "bondCurveDelta", "nameLocation": "21505:14:129", "nodeType": "VariableDeclaration", "scope": 20123, "src": "21497:22:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20077, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "21497:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20080, "mutability": "mutable", "name": "shareProceeds", "nameLocation": "21541:13:129", "nodeType": "VariableDeclaration", "scope": 20123, "src": "21533:21:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20079, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "21533:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "21446:118:129" }, "scope": 20320, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 20154, "nodeType": "FunctionDefinition", "src": "23940:866:129", "nodes": [], "body": { "id": 20153, "nodeType": "Block", "src": "24210:596:129", "nodes": [], "statements": [{ "expression": { "arguments": [{ "id": 20143, "name": "_effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20126, "src": "24384:23:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 20144, "name": "_bondReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20128, "src": "24425:13:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 20145, "name": "_amountIn", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20130, "src": "24456:9:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 20148, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 20146, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "24692:3:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 20147, "name": "_timeStretch", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20132, "src": "24698:12:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "24692:18:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 20149, "name": "_vaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20134, "src": "24728:16:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 20150, "name": "_initialVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20136, "src": "24762:23:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 20141, "name": "YieldSpaceMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 23422, "src": "24317:14:129", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_YieldSpaceMath_$23422_$", "typeString": "type(library YieldSpaceMath)" } }, "id": 20142, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "24332:34:129", "memberName": "calculateSharesOutGivenBondsInDown", "nodeType": "MemberAccess", "referencedDeclaration": 22932, "src": "24317:49:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256,uint256,uint256,uint256) pure returns (uint256)" } }, "id": 20151, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "24317:482:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "functionReturnParameters": 20140, "id": 20152, "nodeType": "Return", "src": "24298:501:129" }] }, "documentation": { "id": 20124, "nodeType": "StructuredDocumentation", "src": "23252:683:129", "text": "@dev Calculates the amount of shares that will be received given a\n      specified amount of bonds.\n @param _effectiveShareReserves The pool's effective share reserves. The\n        effective share reserves are a modified version of the share\n        reserves used when pricing trades.\n @param _bondReserves The pool's bonds reserves.\n @param _amountIn The amount of bonds the user is providing.\n @param _timeStretch The time stretch parameter.\n @param _vaultSharePrice The vault share price.\n @param _initialVaultSharePrice The initial vault share price.\n @return The shares paid by the reserves in the trade." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateOpenShort", "nameLocation": "23949:18:129", "parameters": { "id": 20137, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 20126, "mutability": "mutable", "name": "_effectiveShareReserves", "nameLocation": "23985:23:129", "nodeType": "VariableDeclaration", "scope": 20154, "src": "23977:31:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20125, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "23977:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20128, "mutability": "mutable", "name": "_bondReserves", "nameLocation": "24026:13:129", "nodeType": "VariableDeclaration", "scope": 20154, "src": "24018:21:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20127, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "24018:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20130, "mutability": "mutable", "name": "_amountIn", "nameLocation": "24057:9:129", "nodeType": "VariableDeclaration", "scope": 20154, "src": "24049:17:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20129, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "24049:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20132, "mutability": "mutable", "name": "_timeStretch", "nameLocation": "24084:12:129", "nodeType": "VariableDeclaration", "scope": 20154, "src": "24076:20:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20131, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "24076:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20134, "mutability": "mutable", "name": "_vaultSharePrice", "nameLocation": "24114:16:129", "nodeType": "VariableDeclaration", "scope": 20154, "src": "24106:24:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20133, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "24106:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20136, "mutability": "mutable", "name": "_initialVaultSharePrice", "nameLocation": "24148:23:129", "nodeType": "VariableDeclaration", "scope": 20154, "src": "24140:31:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20135, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "24140:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "23967:210:129" }, "returnParameters": { "id": 20140, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 20139, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 20154, "src": "24201:7:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20138, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "24201:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "24200:9:129" }, "scope": 20320, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 20219, "nodeType": "FunctionDefinition", "src": "25764:2130:129", "nodes": [], "body": { "id": 20218, "nodeType": "Block", "src": "26214:1680:129", "nodes": [], "statements": [{ "expression": { "id": 20186, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 20178, "name": "sharePayment", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20176, "src": "26876:12:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 20183, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 20181, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "26924:3:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 20182, "name": "_normalizedTimeRemaining", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20163, "src": "26930:24:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "26924:30:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 20184, "name": "_vaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20167, "src": "26968:16:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 20179, "name": "_amountOut", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20161, "src": "26891:10:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20180, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "26902:8:129", "memberName": "mulDivUp", "nodeType": "MemberAccess", "referencedDeclaration": 18884, "src": "26891:19:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 20185, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "26891:103:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "26876:118:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20187, "nodeType": "ExpressionStatement", "src": "26876:118:129" }, { "condition": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 20190, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 20188, "name": "_normalizedTimeRemaining", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20163, "src": "27008:24:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": ">", "rightExpression": { "hexValue": "30", "id": 20189, "isConstant": false, "isLValue": false, "isPure": true, "kind": "number", "lValueRequested": false, "nodeType": "Literal", "src": "27035:1:129", "typeDescriptions": { "typeIdentifier": "t_rational_0_by_1", "typeString": "int_const 0" }, "value": "0" }, "src": "27008:28:129", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "id": 20217, "nodeType": "IfStatement", "src": "27004:884:129", "trueBody": { "id": 20216, "nodeType": "Block", "src": "27038:850:129", "statements": [{ "expression": { "id": 20196, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 20191, "name": "bondCurveDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20174, "src": "27153:14:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 20194, "name": "_normalizedTimeRemaining", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20163, "src": "27187:24:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 20192, "name": "_amountOut", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20161, "src": "27170:10:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20193, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "27181:5:129", "memberName": "mulUp", "nodeType": "MemberAccess", "referencedDeclaration": 18902, "src": "27170:16:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256) pure returns (uint256)" } }, "id": 20195, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "27170:42:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "27153:59:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20197, "nodeType": "ExpressionStatement", "src": "27153:59:129" }, { "expression": { "id": 20210, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 20198, "name": "shareCurveDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20172, "src": "27329:15:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 20201, "name": "_effectiveShareReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20157, "src": "27412:23:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 20202, "name": "_bondReserves", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20159, "src": "27453:13:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 20203, "name": "bondCurveDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20174, "src": "27484:14:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 20206, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 20204, "name": "ONE", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 18806, "src": "27725:3:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "id": 20205, "name": "_timeStretch", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20165, "src": "27731:12:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "27725:18:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 20207, "name": "_vaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20167, "src": "27761:16:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 20208, "name": "_initialVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20169, "src": "27795:23:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 20199, "name": "YieldSpaceMath", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 23422, "src": "27347:14:129", "typeDescriptions": { "typeIdentifier": "t_type$_t_contract$_YieldSpaceMath_$23422_$", "typeString": "type(library YieldSpaceMath)" } }, "id": 20200, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "27362:32:129", "memberName": "calculateSharesInGivenBondsOutUp", "nodeType": "MemberAccess", "referencedDeclaration": 22621, "src": "27347:47:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$", "typeString": "function (uint256,uint256,uint256,uint256,uint256,uint256) pure returns (uint256)" } }, "id": 20209, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "27347:485:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "27329:503:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20211, "nodeType": "ExpressionStatement", "src": "27329:503:129" }, { "expression": { "id": 20214, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 20212, "name": "sharePayment", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20176, "src": "27846:12:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "+=", "rightHandSide": { "id": 20213, "name": "shareCurveDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20172, "src": "27862:15:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "27846:31:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20215, "nodeType": "ExpressionStatement", "src": "27846:31:129" }] } }] }, "documentation": { "id": 20155, "nodeType": "StructuredDocumentation", "src": "24812:947:129", "text": "@dev Calculates the amount of base that a user will receive when closing\n      a short position.\n @param _effectiveShareReserves The pool's effective share reserves. The\n        effective share reserves are a modified version of the share\n        reserves used when pricing trades.\n @param _bondReserves The pool's bonds reserves.\n @param _amountOut The amount of the asset that is received.\n @param _normalizedTimeRemaining The amount of time remaining until\n        maturity in seconds.\n @param _timeStretch The time stretch parameter.\n @param _vaultSharePrice The vault share price.\n @param _initialVaultSharePrice The initial vault share price.\n @return shareCurveDelta The shares paid to the reserves in the trade.\n @return bondCurveDelta The bonds paid by the reserves in the trade.\n @return sharePayment The shares that the user must pay." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateCloseShort", "nameLocation": "25773:19:129", "parameters": { "id": 20170, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 20157, "mutability": "mutable", "name": "_effectiveShareReserves", "nameLocation": "25810:23:129", "nodeType": "VariableDeclaration", "scope": 20219, "src": "25802:31:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20156, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "25802:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20159, "mutability": "mutable", "name": "_bondReserves", "nameLocation": "25851:13:129", "nodeType": "VariableDeclaration", "scope": 20219, "src": "25843:21:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20158, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "25843:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20161, "mutability": "mutable", "name": "_amountOut", "nameLocation": "25882:10:129", "nodeType": "VariableDeclaration", "scope": 20219, "src": "25874:18:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20160, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "25874:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20163, "mutability": "mutable", "name": "_normalizedTimeRemaining", "nameLocation": "25910:24:129", "nodeType": "VariableDeclaration", "scope": 20219, "src": "25902:32:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20162, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "25902:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20165, "mutability": "mutable", "name": "_timeStretch", "nameLocation": "25952:12:129", "nodeType": "VariableDeclaration", "scope": 20219, "src": "25944:20:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20164, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "25944:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20167, "mutability": "mutable", "name": "_vaultSharePrice", "nameLocation": "25982:16:129", "nodeType": "VariableDeclaration", "scope": 20219, "src": "25974:24:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20166, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "25974:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20169, "mutability": "mutable", "name": "_initialVaultSharePrice", "nameLocation": "26016:23:129", "nodeType": "VariableDeclaration", "scope": 20219, "src": "26008:31:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20168, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "26008:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "25792:253:129" }, "returnParameters": { "id": 20177, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 20172, "mutability": "mutable", "name": "shareCurveDelta", "nameLocation": "26114:15:129", "nodeType": "VariableDeclaration", "scope": 20219, "src": "26106:23:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20171, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "26106:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20174, "mutability": "mutable", "name": "bondCurveDelta", "nameLocation": "26151:14:129", "nodeType": "VariableDeclaration", "scope": 20219, "src": "26143:22:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20173, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "26143:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20176, "mutability": "mutable", "name": "sharePayment", "nameLocation": "26187:12:129", "nodeType": "VariableDeclaration", "scope": 20219, "src": "26179:20:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20175, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "26179:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "26092:117:129" }, "scope": 20320, "stateMutability": "pure", "virtual": false, "visibility": "internal" }, { "id": 20319, "nodeType": "FunctionDefinition", "src": "29982:2953:129", "nodes": [], "body": { "id": 20318, "nodeType": "Block", "src": "30336:2599:129", "nodes": [], "statements": [{ "assignments": [20248], "declarations": [{ "constant": false, "id": 20248, "mutability": "mutable", "name": "shareAdjustmentDelta", "nameLocation": "31268:20:129", "nodeType": "VariableDeclaration", "scope": 20318, "src": "31261:27:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" }, "typeName": { "id": 20247, "name": "int256", "nodeType": "ElementaryTypeName", "src": "31261:6:129", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "visibility": "internal" }], "id": 20249, "nodeType": "VariableDeclarationStatement", "src": "31261:27:129" }, { "condition": { "commonType": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "id": 20252, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "id": 20250, "name": "_closeVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20232, "src": "31302:21:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "BinaryOperation", "operator": "<", "rightExpression": { "id": 20251, "name": "_openVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20230, "src": "31326:20:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "31302:44:129", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "falseBody": { "id": 20309, "nodeType": "Block", "src": "32603:140:129", "statements": [{ "expression": { "id": 20307, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 20299, "name": "shareAdjustmentDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20248, "src": "32617:20:129", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "commonType": { "typeIdentifier": "t_int256", "typeString": "int256" }, "id": 20306, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 20300, "name": "_shareReservesDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20224, "src": "32656:19:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20301, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "32676:8:129", "memberName": "toInt256", "nodeType": "MemberAccess", "referencedDeclaration": 22442, "src": "32656:28:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$returns$_t_int256_$attached_to$_t_uint256_$", "typeString": "function (uint256) pure returns (int256)" } }, "id": 20302, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "32656:30:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 20303, "name": "_shareCurveDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20226, "src": "32705:16:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20304, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "32722:8:129", "memberName": "toInt256", "nodeType": "MemberAccess", "referencedDeclaration": 22442, "src": "32705:25:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$returns$_t_int256_$attached_to$_t_uint256_$", "typeString": "function (uint256) pure returns (int256)" } }, "id": 20305, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "32705:27:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "src": "32656:76:129", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "src": "32617:115:129", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "id": 20308, "nodeType": "ExpressionStatement", "src": "32617:115:129" }] }, "id": 20310, "nodeType": "IfStatement", "src": "31298:1445:129", "trueBody": { "id": 20298, "nodeType": "Block", "src": "31348:1249:129", "statements": [{ "condition": { "id": 20253, "name": "_isLong", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20234, "src": "31631:7:129", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "id": 20263, "nodeType": "IfStatement", "src": "31627:191:129", "trueBody": { "id": 20262, "nodeType": "Block", "src": "31640:178:129", "statements": [{ "expression": { "id": 20260, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 20254, "name": "_shareProceeds", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20222, "src": "31658:14:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 20257, "name": "_closeVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20232, "src": "31722:21:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 20258, "name": "_openVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20230, "src": "31765:20:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 20255, "name": "_shareProceeds", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20222, "src": "31675:14:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20256, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "31690:10:129", "memberName": "mulDivDown", "nodeType": "MemberAccess", "referencedDeclaration": 18834, "src": "31675:25:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 20259, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "31675:128:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "31658:145:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20261, "nodeType": "ExpressionStatement", "src": "31658:145:129" }] } }, { "expression": { "id": 20270, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 20264, "name": "_shareReservesDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20224, "src": "31951:19:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 20267, "name": "_closeVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20232, "src": "32021:21:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 20268, "name": "_openVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20230, "src": "32060:20:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 20265, "name": "_shareReservesDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20224, "src": "31973:19:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20266, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "31993:10:129", "memberName": "mulDivDown", "nodeType": "MemberAccess", "referencedDeclaration": 18834, "src": "31973:30:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 20269, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "31973:121:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "31951:143:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20271, "nodeType": "ExpressionStatement", "src": "31951:143:129" }, { "expression": { "id": 20280, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 20272, "name": "shareAdjustmentDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20248, "src": "32163:20:129", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "commonType": { "typeIdentifier": "t_int256", "typeString": "int256" }, "id": 20279, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftExpression": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 20273, "name": "_shareReservesDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20224, "src": "32202:19:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20274, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "32222:8:129", "memberName": "toInt256", "nodeType": "MemberAccess", "referencedDeclaration": 22442, "src": "32202:28:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$returns$_t_int256_$attached_to$_t_uint256_$", "typeString": "function (uint256) pure returns (int256)" } }, "id": 20275, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "32202:30:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "nodeType": "BinaryOperation", "operator": "-", "rightExpression": { "arguments": [], "expression": { "argumentTypes": [], "expression": { "id": 20276, "name": "_shareCurveDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20226, "src": "32251:16:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20277, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "32268:8:129", "memberName": "toInt256", "nodeType": "MemberAccess", "referencedDeclaration": 22442, "src": "32251:25:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$returns$_t_int256_$attached_to$_t_uint256_$", "typeString": "function (uint256) pure returns (int256)" } }, "id": 20278, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "32251:27:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "src": "32202:76:129", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "src": "32163:115:129", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "id": 20281, "nodeType": "ExpressionStatement", "src": "32163:115:129" }, { "expression": { "id": 20288, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 20282, "name": "_shareCurveDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20226, "src": "32292:16:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 20285, "name": "_closeVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20232, "src": "32356:21:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 20286, "name": "_openVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20230, "src": "32395:20:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 20283, "name": "_shareCurveDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20226, "src": "32311:16:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20284, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "32328:10:129", "memberName": "mulDivDown", "nodeType": "MemberAccess", "referencedDeclaration": 18834, "src": "32311:27:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 20287, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "32311:118:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "32292:137:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20289, "nodeType": "ExpressionStatement", "src": "32292:137:129" }, { "expression": { "id": 20296, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "leftHandSide": { "id": 20290, "name": "_totalGovernanceFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20228, "src": "32443:19:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "nodeType": "Assignment", "operator": "=", "rightHandSide": { "arguments": [{ "id": 20293, "name": "_closeVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20232, "src": "32513:21:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 20294, "name": "_openVaultSharePrice", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20230, "src": "32552:20:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "expression": { "argumentTypes": [{ "typeIdentifier": "t_uint256", "typeString": "uint256" }, { "typeIdentifier": "t_uint256", "typeString": "uint256" }], "expression": { "id": 20291, "name": "_totalGovernanceFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20228, "src": "32465:19:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20292, "isConstant": false, "isLValue": false, "isPure": false, "lValueRequested": false, "memberLocation": "32485:10:129", "memberName": "mulDivDown", "nodeType": "MemberAccess", "referencedDeclaration": 18834, "src": "32465:30:129", "typeDescriptions": { "typeIdentifier": "t_function_internal_pure$_t_uint256_$_t_uint256_$_t_uint256_$returns$_t_uint256_$attached_to$_t_uint256_$", "typeString": "function (uint256,uint256,uint256) pure returns (uint256)" } }, "id": 20295, "isConstant": false, "isLValue": false, "isPure": false, "kind": "functionCall", "lValueRequested": false, "nameLocations": [], "names": [], "nodeType": "FunctionCall", "src": "32465:121:129", "tryCall": false, "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "src": "32443:143:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "id": 20297, "nodeType": "ExpressionStatement", "src": "32443:143:129" }] } }, { "expression": { "components": [{ "id": 20311, "name": "_shareProceeds", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20222, "src": "32774:14:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 20312, "name": "_shareReservesDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20224, "src": "32802:19:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 20313, "name": "_shareCurveDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20226, "src": "32835:16:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, { "id": 20314, "name": "shareAdjustmentDelta", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20248, "src": "32865:20:129", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, { "id": 20315, "name": "_totalGovernanceFee", "nodeType": "Identifier", "overloadedDeclarations": [], "referencedDeclaration": 20228, "src": "32899:19:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }], "id": 20316, "isConstant": false, "isInlineArray": false, "isLValue": false, "isPure": false, "lValueRequested": false, "nodeType": "TupleExpression", "src": "32760:168:129", "typeDescriptions": { "typeIdentifier": "t_tuple$_t_uint256_$_t_uint256_$_t_uint256_$_t_int256_$_t_uint256_$", "typeString": "tuple(uint256,uint256,uint256,int256,uint256)" } }, "functionReturnParameters": 20246, "id": 20317, "nodeType": "Return", "src": "32753:175:129" }] }, "documentation": { "id": 20220, "nodeType": "StructuredDocumentation", "src": "27900:2077:129", "text": "@dev If negative interest accrued over the term, we scale the share\n      proceeds by the negative interest amount. Shorts should be\n      responsible for negative interest, but negative interest can exceed\n      the margin that shorts provide. This leaves us with no choice but\n      to attribute the negative interest to longs. Along with scaling the\n      share proceeds, we also scale the fee amounts.\n      In order for our AMM invariant to be maintained, the effective\n      share reserves need to be adjusted by the same amount as the share\n      reserves delta calculated with YieldSpace including fees. We reduce\n      the share reserves by `min(c_1 / c_0, 1) * shareReservesDelta` and\n      the share adjustment by the `shareAdjustmentDelta`. We can solve\n      these equations simultaneously to find the share adjustment delta\n      as:\n      shareAdjustmentDelta = min(c_1 / c_0, 1) * sharePayment -\n                             shareReservesDelta\n      We underestimate the share proceeds to avoid sandwiches, and we\n      round the share reserves delta and share adjustment in the same\n      direction for consistency.\n @param _shareProceeds The proceeds in shares from the trade.\n @param _shareReservesDelta The change in share reserves from the trade.\n @param _shareCurveDelta The curve portion of the change in share reserves.\n @param _totalGovernanceFee The total governance fee.\n @param _openVaultSharePrice The vault share price at the beginning of\n        the term.\n @param _closeVaultSharePrice The vault share price at the end of the term.\n @param _isLong A flag indicating whether or not the trade is a long.\n @return The adjusted share proceeds.\n @return The adjusted share reserves delta.\n @return The adjusted share close proceeds.\n @return The share adjustment delta.\n @return The adjusted total governance fee." }, "implemented": true, "kind": "function", "modifiers": [], "name": "calculateNegativeInterestOnClose", "nameLocation": "29991:32:129", "parameters": { "id": 20235, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 20222, "mutability": "mutable", "name": "_shareProceeds", "nameLocation": "30041:14:129", "nodeType": "VariableDeclaration", "scope": 20319, "src": "30033:22:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20221, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "30033:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20224, "mutability": "mutable", "name": "_shareReservesDelta", "nameLocation": "30073:19:129", "nodeType": "VariableDeclaration", "scope": 20319, "src": "30065:27:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20223, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "30065:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20226, "mutability": "mutable", "name": "_shareCurveDelta", "nameLocation": "30110:16:129", "nodeType": "VariableDeclaration", "scope": 20319, "src": "30102:24:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20225, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "30102:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20228, "mutability": "mutable", "name": "_totalGovernanceFee", "nameLocation": "30144:19:129", "nodeType": "VariableDeclaration", "scope": 20319, "src": "30136:27:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20227, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "30136:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20230, "mutability": "mutable", "name": "_openVaultSharePrice", "nameLocation": "30181:20:129", "nodeType": "VariableDeclaration", "scope": 20319, "src": "30173:28:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20229, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "30173:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20232, "mutability": "mutable", "name": "_closeVaultSharePrice", "nameLocation": "30219:21:129", "nodeType": "VariableDeclaration", "scope": 20319, "src": "30211:29:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20231, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "30211:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20234, "mutability": "mutable", "name": "_isLong", "nameLocation": "30255:7:129", "nodeType": "VariableDeclaration", "scope": 20319, "src": "30250:12:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" }, "typeName": { "id": 20233, "name": "bool", "nodeType": "ElementaryTypeName", "src": "30250:4:129", "typeDescriptions": { "typeIdentifier": "t_bool", "typeString": "bool" } }, "visibility": "internal" }], "src": "30023:245:129" }, "returnParameters": { "id": 20246, "nodeType": "ParameterList", "parameters": [{ "constant": false, "id": 20237, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 20319, "src": "30292:7:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20236, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "30292:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20239, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 20319, "src": "30301:7:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20238, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "30301:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20241, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 20319, "src": "30310:7:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20240, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "30310:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }, { "constant": false, "id": 20243, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 20319, "src": "30319:6:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" }, "typeName": { "id": 20242, "name": "int256", "nodeType": "ElementaryTypeName", "src": "30319:6:129", "typeDescriptions": { "typeIdentifier": "t_int256", "typeString": "int256" } }, "visibility": "internal" }, { "constant": false, "id": 20245, "mutability": "mutable", "name": "", "nameLocation": "-1:-1:-1", "nodeType": "VariableDeclaration", "scope": 20319, "src": "30327:7:129", "stateVariable": false, "storageLocation": "default", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" }, "typeName": { "id": 20244, "name": "uint256", "nodeType": "ElementaryTypeName", "src": "30327:7:129", "typeDescriptions": { "typeIdentifier": "t_uint256", "typeString": "uint256" } }, "visibility": "internal" }], "src": "30291:44:129" }, "scope": 20320, "stateMutability": "pure", "virtual": false, "visibility": "internal" }], "abstract": false, "baseContracts": [], "canonicalName": "HyperdriveMath", "contractDependencies": [], "contractKind": "library", "documentation": { "id": 19586, "nodeType": "StructuredDocumentation", "src": "324:314:129", "text": "@author DELV\n @title Hyperdrive\n @notice Math for the Hyperdrive pricing model.\n @custom:disclaimer The language used in this code is for coding convenience\n                    only, and is not intended to, and does not, have any\n                    particular legal or regulatory significance." }, "fullyImplemented": true, "linearizedBaseContracts": [20320], "name": "HyperdriveMath", "nameLocation": "646:14:129", "scope": 20321, "usedErrors": [], "usedEvents": [] }], "license": "Apache-2.0" }, "id": 129 };
